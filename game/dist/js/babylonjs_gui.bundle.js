"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[583],{6629:(t,e,i)=>{i.d(e,{e:()=>s});class s{}s.UseOpenGLOrientationForUV=!1},2543:(t,e,i)=>{i.d(e,{j:()=>d});var s=i(2554),r=i(5412),n=i(4551);class o{constructor(t,e,i){this.vectors=s.B.BuildArray(8,r.P.Zero),this.center=r.P.Zero(),this.centerWorld=r.P.Zero(),this.extendSize=r.P.Zero(),this.extendSizeWorld=r.P.Zero(),this.directions=s.B.BuildArray(3,r.P.Zero),this.vectorsWorld=s.B.BuildArray(8,r.P.Zero),this.minimumWorld=r.P.Zero(),this.maximumWorld=r.P.Zero(),this.minimum=r.P.Zero(),this.maximum=r.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,e,i)}reConstruct(t,e,i){const s=t.x,n=t.y,o=t.z,h=e.x,a=e.y,l=e.z,_=this.vectors;this.minimum.copyFromFloats(s,n,o),this.maximum.copyFromFloats(h,a,l),_[0].copyFromFloats(s,n,o),_[1].copyFromFloats(h,a,l),_[2].copyFromFloats(h,n,o),_[3].copyFromFloats(s,a,o),_[4].copyFromFloats(s,n,l),_[5].copyFromFloats(h,a,o),_[6].copyFromFloats(s,a,l),_[7].copyFromFloats(h,n,l),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||r.y3.IdentityReadOnly,this._update(this._worldMatrix)}scale(t){const e=o._TmpVector3,i=this.maximum.subtractToRef(this.minimum,e[0]),s=i.length();i.normalizeFromLength(s);const r=s*t,n=i.scaleInPlace(.5*r),h=this.center.subtractToRef(n,e[1]),a=this.center.addToRef(n,e[2]);return this.reConstruct(h,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){const e=this.minimumWorld,i=this.maximumWorld,s=this.directions,n=this.vectorsWorld,o=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let t=0;t<8;++t)n[t].copyFrom(o[t]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let s=0;s<8;++s){const h=n[s];r.P.TransformCoordinatesToRef(o[s],t,h),e.minimizeInPlace(h),i.maximizeInPlace(h)}i.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(e,this.centerWorld).scaleInPlace(.5)}r.P.FromArrayToRef(t.m,0,s[0]),r.P.FromArrayToRef(t.m,4,s[1]),r.P.FromArrayToRef(t.m,8,s[2]),this._worldMatrix=t}isInFrustum(t){return o.IsInFrustum(this.vectorsWorld,t)}isCompletelyInFrustum(t){return o.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsPoint(t){const e=this.minimumWorld,i=this.maximumWorld,s=e.x,r=e.y,o=e.z,h=i.x,a=i.y,l=i.z,_=t.x,c=t.y,d=t.z,u=-n.kn;return!(h-_<u||u>_-s||a-c<u||u>c-r||l-d<u||u>d-o)}intersectsSphere(t){return o.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}intersectsMinMax(t,e){const i=this.minimumWorld,s=this.maximumWorld,r=i.x,n=i.y,o=i.z,h=s.x,a=s.y,l=s.z,_=t.x,c=t.y,d=t.z,u=e.x,g=e.y,f=e.z;return!(h<_||r>u||a<c||n>g||l<d||o>f)}dispose(){var t,e;null===(t=this._drawWrapperFront)||void 0===t||t.dispose(),null===(e=this._drawWrapperBack)||void 0===e||e.dispose()}static Intersects(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)}static IntersectsSphere(t,e,i,s){const n=o._TmpVector3[0];return r.P.ClampToRef(i,t,e,n),r.P.DistanceSquared(i,n)<=s*s}static IsCompletelyInFrustum(t,e){for(let i=0;i<6;++i){const s=e[i];for(let e=0;e<8;++e)if(s.dotCoordinate(t[e])<0)return!1}return!0}static IsInFrustum(t,e){for(let i=0;i<6;++i){let s=!0;const r=e[i];for(let e=0;e<8;++e)if(r.dotCoordinate(t[e])>=0){s=!1;break}if(s)return!1}return!0}}o._TmpVector3=s.B.BuildArray(3,r.P.Zero);class h{constructor(t,e,i){this.center=r.P.Zero(),this.centerWorld=r.P.Zero(),this.minimum=r.P.Zero(),this.maximum=r.P.Zero(),this.reConstruct(t,e,i)}reConstruct(t,e,i){this.minimum.copyFrom(t),this.maximum.copyFrom(e);const s=r.P.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*s,this._update(i||r.y3.IdentityReadOnly)}scale(t){const e=this.radius*t,i=h._TmpVector3,s=i[0].setAll(e),r=this.center.subtractToRef(s,i[1]),n=this.center.addToRef(s,i[2]);return this.reConstruct(r,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{r.P.TransformCoordinatesToRef(this.center,t,this.centerWorld);const e=h._TmpVector3[0];r.P.TransformNormalFromFloatsToRef(1,1,1,t,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}}isInFrustum(t){const e=this.centerWorld,i=this.radiusWorld;for(let s=0;s<6;s++)if(t[s].dotCoordinate(e)<=-i)return!1;return!0}isCenterInFrustum(t){const e=this.centerWorld;for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}intersectsPoint(t){const e=r.P.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)}static Intersects(t,e){const i=r.P.DistanceSquared(t.centerWorld,e.centerWorld),s=t.radiusWorld+e.radiusWorld;return!(s*s<i)}static CreateFromCenterAndRadius(t,e,i){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,e),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const s=new h(this._TmpVector3[0],this._TmpVector3[2]);return s._worldMatrix=i||r.y3.Identity(),s}}h._TmpVector3=s.B.BuildArray(3,r.P.Zero);const a={min:0,max:0},l={min:0,max:0},_=(t,e,i)=>{const s=r.P.Dot(e.centerWorld,t),n=Math.abs(r.P.Dot(e.directions[0],t))*e.extendSize.x+Math.abs(r.P.Dot(e.directions[1],t))*e.extendSize.y+Math.abs(r.P.Dot(e.directions[2],t))*e.extendSize.z;i.min=s-n,i.max=s+n},c=(t,e,i)=>(_(t,e,a),_(t,i,l),!(a.min>l.max||l.min>a.max));class d{constructor(t,e,i){this._isLocked=!1,this.boundingBox=new o(t,e,i),this.boundingSphere=new h(t,e,i)}reConstruct(t,e,i){this.boundingBox.reConstruct(t,e,i),this.boundingSphere.reConstruct(t,e,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}update(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}centerOn(t,e){const i=d._TmpVector3[0].copyFrom(t).subtractInPlace(e),s=d._TmpVector3[1].copyFrom(t).addInPlace(e);return this.boundingBox.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this}encapsulate(t){const e=r.P.Minimize(this.minimum,t),i=r.P.Maximize(this.maximum,t);return this.reConstruct(e,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(t){return this.encapsulate(t.boundingBox.centerWorld.subtract(t.boundingBox.extendSizeWorld)),this.encapsulate(t.boundingBox.centerWorld.add(t.boundingBox.extendSizeWorld)),this}scale(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}isInFrustum(t,e=0){return!(2!==e&&3!==e||!this.boundingSphere.isCenterInFrustum(t))||!!this.boundingSphere.isInFrustum(t)&&(!(1!==e&&3!==e)||this.boundingBox.isInFrustum(t))}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,d._TmpVector3[0]).length()}isCompletelyInFrustum(t){return this.boundingBox.isCompletelyInFrustum(t)}_checkCollision(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(t){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t)}intersects(t,e){if(!h.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!o.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;const i=this.boundingBox,s=t.boundingBox;return!!(c(i.directions[0],i,s)&&c(i.directions[1],i,s)&&c(i.directions[2],i,s)&&c(s.directions[0],i,s)&&c(s.directions[1],i,s)&&c(s.directions[2],i,s)&&c(r.P.Cross(i.directions[0],s.directions[0]),i,s)&&c(r.P.Cross(i.directions[0],s.directions[1]),i,s)&&c(r.P.Cross(i.directions[0],s.directions[2]),i,s)&&c(r.P.Cross(i.directions[1],s.directions[0]),i,s)&&c(r.P.Cross(i.directions[1],s.directions[1]),i,s)&&c(r.P.Cross(i.directions[1],s.directions[2]),i,s)&&c(r.P.Cross(i.directions[2],s.directions[0]),i,s)&&c(r.P.Cross(i.directions[2],s.directions[1]),i,s)&&c(r.P.Cross(i.directions[2],s.directions[2]),i,s))}}d._TmpVector3=s.B.BuildArray(2,r.P.Zero)},8494:(t,e,i)=>{i.d(e,{g:()=>s});class s{}s.ALPHA_DISABLE=0,s.ALPHA_ADD=1,s.ALPHA_COMBINE=2,s.ALPHA_SUBTRACT=3,s.ALPHA_MULTIPLY=4,s.ALPHA_MAXIMIZED=5,s.ALPHA_ONEONE=6,s.ALPHA_PREMULTIPLIED=7,s.ALPHA_PREMULTIPLIED_PORTERDUFF=8,s.ALPHA_INTERPOLATE=9,s.ALPHA_SCREENMODE=10,s.ALPHA_ONEONE_ONEONE=11,s.ALPHA_ALPHATOCOLOR=12,s.ALPHA_REVERSEONEMINUS=13,s.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,s.ALPHA_ONEONE_ONEZERO=15,s.ALPHA_EXCLUSION=16,s.ALPHA_LAYER_ACCUMULATE=17,s.ALPHA_EQUATION_ADD=0,s.ALPHA_EQUATION_SUBSTRACT=1,s.ALPHA_EQUATION_REVERSE_SUBTRACT=2,s.ALPHA_EQUATION_MAX=3,s.ALPHA_EQUATION_MIN=4,s.ALPHA_EQUATION_DARKEN=5,s.DELAYLOADSTATE_NONE=0,s.DELAYLOADSTATE_LOADED=1,s.DELAYLOADSTATE_LOADING=2,s.DELAYLOADSTATE_NOTLOADED=4,s.NEVER=512,s.ALWAYS=519,s.LESS=513,s.EQUAL=514,s.LEQUAL=515,s.GREATER=516,s.GEQUAL=518,s.NOTEQUAL=517,s.KEEP=7680,s.ZERO=0,s.REPLACE=7681,s.INCR=7682,s.DECR=7683,s.INVERT=5386,s.INCR_WRAP=34055,s.DECR_WRAP=34056,s.TEXTURE_CLAMP_ADDRESSMODE=0,s.TEXTURE_WRAP_ADDRESSMODE=1,s.TEXTURE_MIRROR_ADDRESSMODE=2,s.TEXTURE_CREATIONFLAG_STORAGE=1,s.TEXTUREFORMAT_ALPHA=0,s.TEXTUREFORMAT_LUMINANCE=1,s.TEXTUREFORMAT_LUMINANCE_ALPHA=2,s.TEXTUREFORMAT_RGB=4,s.TEXTUREFORMAT_RGBA=5,s.TEXTUREFORMAT_RED=6,s.TEXTUREFORMAT_R=6,s.TEXTUREFORMAT_RG=7,s.TEXTUREFORMAT_RED_INTEGER=8,s.TEXTUREFORMAT_R_INTEGER=8,s.TEXTUREFORMAT_RG_INTEGER=9,s.TEXTUREFORMAT_RGB_INTEGER=10,s.TEXTUREFORMAT_RGBA_INTEGER=11,s.TEXTUREFORMAT_BGRA=12,s.TEXTUREFORMAT_DEPTH24_STENCIL8=13,s.TEXTUREFORMAT_DEPTH32_FLOAT=14,s.TEXTUREFORMAT_DEPTH16=15,s.TEXTUREFORMAT_DEPTH24=16,s.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,s.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,s.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,s.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,s.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,s.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,s.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,s.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,s.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,s.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,s.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,s.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,s.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,s.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,s.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,s.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,s.TEXTURETYPE_UNSIGNED_BYTE=0,s.TEXTURETYPE_UNSIGNED_INT=0,s.TEXTURETYPE_FLOAT=1,s.TEXTURETYPE_HALF_FLOAT=2,s.TEXTURETYPE_BYTE=3,s.TEXTURETYPE_SHORT=4,s.TEXTURETYPE_UNSIGNED_SHORT=5,s.TEXTURETYPE_INT=6,s.TEXTURETYPE_UNSIGNED_INTEGER=7,s.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,s.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,s.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,s.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,s.TEXTURETYPE_UNSIGNED_INT_24_8=12,s.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,s.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,s.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,s.TEXTURETYPE_UNDEFINED=16,s.TEXTURE_NEAREST_SAMPLINGMODE=1,s.TEXTURE_NEAREST_NEAREST=1,s.TEXTURE_BILINEAR_SAMPLINGMODE=2,s.TEXTURE_LINEAR_LINEAR=2,s.TEXTURE_TRILINEAR_SAMPLINGMODE=3,s.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,s.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,s.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,s.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,s.TEXTURE_NEAREST_LINEAR=7,s.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,s.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,s.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,s.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,s.TEXTURE_LINEAR_NEAREST=12,s.TEXTURE_EXPLICIT_MODE=0,s.TEXTURE_SPHERICAL_MODE=1,s.TEXTURE_PLANAR_MODE=2,s.TEXTURE_CUBIC_MODE=3,s.TEXTURE_PROJECTION_MODE=4,s.TEXTURE_SKYBOX_MODE=5,s.TEXTURE_INVCUBIC_MODE=6,s.TEXTURE_EQUIRECTANGULAR_MODE=7,s.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,s.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,s.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,s.TEXTURE_FILTERING_QUALITY_HIGH=64,s.TEXTURE_FILTERING_QUALITY_MEDIUM=16,s.TEXTURE_FILTERING_QUALITY_LOW=8,s.SCALEMODE_FLOOR=1,s.SCALEMODE_NEAREST=2,s.SCALEMODE_CEILING=3,s.MATERIAL_TextureDirtyFlag=1,s.MATERIAL_LightDirtyFlag=2,s.MATERIAL_FresnelDirtyFlag=4,s.MATERIAL_AttributesDirtyFlag=8,s.MATERIAL_MiscDirtyFlag=16,s.MATERIAL_PrePassDirtyFlag=32,s.MATERIAL_AllDirtyFlag=63,s.MATERIAL_TriangleFillMode=0,s.MATERIAL_WireFrameFillMode=1,s.MATERIAL_PointFillMode=2,s.MATERIAL_PointListDrawMode=3,s.MATERIAL_LineListDrawMode=4,s.MATERIAL_LineLoopDrawMode=5,s.MATERIAL_LineStripDrawMode=6,s.MATERIAL_TriangleStripDrawMode=7,s.MATERIAL_TriangleFanDrawMode=8,s.MATERIAL_ClockWiseSideOrientation=0,s.MATERIAL_CounterClockWiseSideOrientation=1,s.ACTION_NothingTrigger=0,s.ACTION_OnPickTrigger=1,s.ACTION_OnLeftPickTrigger=2,s.ACTION_OnRightPickTrigger=3,s.ACTION_OnCenterPickTrigger=4,s.ACTION_OnPickDownTrigger=5,s.ACTION_OnDoublePickTrigger=6,s.ACTION_OnPickUpTrigger=7,s.ACTION_OnPickOutTrigger=16,s.ACTION_OnLongPressTrigger=8,s.ACTION_OnPointerOverTrigger=9,s.ACTION_OnPointerOutTrigger=10,s.ACTION_OnEveryFrameTrigger=11,s.ACTION_OnIntersectionEnterTrigger=12,s.ACTION_OnIntersectionExitTrigger=13,s.ACTION_OnKeyDownTrigger=14,s.ACTION_OnKeyUpTrigger=15,s.PARTICLES_BILLBOARDMODE_Y=2,s.PARTICLES_BILLBOARDMODE_ALL=7,s.PARTICLES_BILLBOARDMODE_STRETCHED=8,s.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,s.MESHES_CULLINGSTRATEGY_STANDARD=0,s.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,s.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,s.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,s.SCENELOADER_NO_LOGGING=0,s.SCENELOADER_MINIMAL_LOGGING=1,s.SCENELOADER_SUMMARY_LOGGING=2,s.SCENELOADER_DETAILED_LOGGING=3,s.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,s.PREPASS_POSITION_TEXTURE_TYPE=1,s.PREPASS_VELOCITY_TEXTURE_TYPE=2,s.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,s.PREPASS_COLOR_TEXTURE_TYPE=4,s.PREPASS_DEPTH_TEXTURE_TYPE=5,s.PREPASS_NORMAL_TEXTURE_TYPE=6,s.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,s.BUFFER_CREATIONFLAG_READ=1,s.BUFFER_CREATIONFLAG_WRITE=2,s.BUFFER_CREATIONFLAG_READWRITE=3,s.BUFFER_CREATIONFLAG_UNIFORM=4,s.BUFFER_CREATIONFLAG_VERTEX=8,s.BUFFER_CREATIONFLAG_INDEX=16,s.BUFFER_CREATIONFLAG_STORAGE=32,s.RENDERPASS_MAIN=0,s.INPUT_ALT_KEY=18,s.INPUT_CTRL_KEY=17,s.INPUT_META_KEY1=91,s.INPUT_META_KEY2=92,s.INPUT_META_KEY3=93,s.INPUT_SHIFT_KEY=16,s.SNAPSHOTRENDERING_STANDARD=0,s.SNAPSHOTRENDERING_FAST=1,s.PERSPECTIVE_CAMERA=0,s.ORTHOGRAPHIC_CAMERA=1,s.FOVMODE_VERTICAL_FIXED=0,s.FOVMODE_HORIZONTAL_FIXED=1,s.RIG_MODE_NONE=0,s.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,s.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,s.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,s.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,s.RIG_MODE_STEREOSCOPIC_INTERLACED=14,s.RIG_MODE_VR=20,s.RIG_MODE_WEBVR=21,s.RIG_MODE_CUSTOM=22,s.MAX_SUPPORTED_UV_SETS=6,s.GL_ALPHA_EQUATION_ADD=32774,s.GL_ALPHA_EQUATION_MIN=32775,s.GL_ALPHA_EQUATION_MAX=32776,s.GL_ALPHA_EQUATION_SUBTRACT=32778,s.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,s.GL_ALPHA_FUNCTION_SRC=768,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,s.GL_ALPHA_FUNCTION_SRC_ALPHA=770,s.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,s.GL_ALPHA_FUNCTION_DST_ALPHA=772,s.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,s.GL_ALPHA_FUNCTION_DST_COLOR=774,s.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,s.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,s.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,s.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,s.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,s.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,s.SnippetUrl="https://snippet.babylonjs.com"},5194:(t,e,i)=>{i.d(e,{o:()=>r,p:()=>s});class s{}s.COPY=1,s.CUT=2,s.PASTE=3;class r{constructor(t,e){this.type=t,this.event=e}static GetTypeFromCharacter(t){switch(t){case 67:return s.COPY;case 86:return s.PASTE;case 88:return s.CUT;default:return-1}}}},554:(t,e,i)=>{i.d(e,{c:()=>h});var s=i(658),r=i(5356),n=i(6984),o=i(3369);n.B.prototype.createDynamicTexture=function(t,e,i,s){const r=new o.l(this,o.S.Dynamic);return r.baseWidth=t,r.baseHeight=e,i&&(t=this.needPOTTextures?n.B.GetExponentOfTwo(t,this._caps.maxTextureSize):t,e=this.needPOTTextures?n.B.GetExponentOfTwo(e,this._caps.maxTextureSize):e),r.width=t,r.height=e,r.isReady=!1,r.generateMipMaps=i,r.samplingMode=s,this.updateTextureSamplingMode(s,r),this._internalTexturesCache.push(r),r},n.B.prototype.updateDynamicTexture=function(t,e,i,s=!1,r,n=!1,o=!1){if(!t)return;const h=this._gl,a=h.TEXTURE_2D,l=this._bindTextureDirectly(a,t,!0,n);this._unpackFlipY(void 0===i?t.invertY:i),s&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const _=this._getWebGLTextureType(t.type),c=this._getInternalFormat(r||t.format),d=this._getRGBABufferInternalSizedFormat(t.type,c);h.texImage2D(a,0,d,c,_,e),t.generateMipMaps&&h.generateMipmap(a),l||this._bindTextureDirectly(a,null),s&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t.isReady=!0};class h extends r.x{constructor(t,e,i=null,s=!1,n=3,o=5,h){super(null,i,!s,h,n,void 0,void 0,void 0,void 0,o),this.name=t,this.wrapU=r.x.CLAMP_ADDRESSMODE,this.wrapV=r.x.CLAMP_ADDRESSMODE,this._generateMipMaps=s;const a=this._getEngine();if(!a)return;e.getContext?(this._canvas=e,this._texture=a.createDynamicTexture(e.width,e.height,s,n)):(this._canvas=a.createCanvas(1,1),e.width||0===e.width?this._texture=a.createDynamicTexture(e.width,e.height,s,n):this._texture=a.createDynamicTexture(e,e,s,n));const l=this.getSize();this._canvas.width!==l.width&&(this._canvas.width=l.width),this._canvas.height!==l.height&&(this._canvas.height=l.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}scale(t){const e=this.getSize();e.width*=t,e.height*=t,this._recreate(e)}scaleTo(t,e){const i=this.getSize();i.width=t,i.height=e,this._recreate(i)}getContext(){return this._context}clear(){const t=this.getSize();this._context.fillRect(0,0,t.width,t.height)}update(t,e=!1,i=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,e,this._format||void 0,void 0,i)}drawText(t,e,i,s,r,n,o,h=!0){const a=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,a.width,a.height)),this._context.font=s,null==e){const i=this._context.measureText(t);e=(a.width-i.width)/2}if(null==i){const t=parseInt(s.replace(/\D/g,""));i=a.height/2+t/3.65}this._context.fillStyle=r||"",this._context.fillText(t,e,i),h&&this.update(o)}clone(){const t=this.getScene();if(!t)return this;const e=this.getSize(),i=new h(this.name,e,t,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const t=this.getScene();t&&!t.isReady()&&s.Y.Warn("The scene must be ready before serializing the dynamic texture");const e=super.serialize();return h._IsCanvasElement(this._canvas)&&(e.base64String=this._canvas.toDataURL()),e.invertY=this._invertY,e.samplingMode=this.samplingMode,e}static _IsCanvasElement(t){return void 0!==t.toDataURL}_rebuild(){this.update()}}},5356:(t,e,i)=>{i.d(e,{x:()=>I});var s=i(1069),r=i(8137),n=i(8139),o=i(5412),h=i(5953),a=i(3706),l=(i(9485),i(3321));class _{get wrapU(){return this._wrapU}set wrapU(t){this._wrapU=t}get wrapV(){return this._wrapV}set wrapV(t){this._wrapV=t}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(t){this._texture&&(this._texture.isCube=t)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(t){this._texture&&(this._texture.is3D=t)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(t){this._texture&&(this._texture.is2DArray=t)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(t){return void 0!==(null==t?void 0:t._shareDepth)}constructor(t){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=l.$.Zero(),this._cachedBaseSize=l.$.Zero(),this._initialSamplingMode=2,this._texture=_._IsRenderTargetWrapper(t)?t.texture:t,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(t){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(t,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class c extends _{set hasAlpha(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(t){this._getAlphaFromRGB!==t&&(this._getAlphaFromRGB=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(t){this._coordinatesIndex!==t&&(this._coordinatesIndex=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(t){this._wrapU=t}get wrapV(){return this._wrapV}set wrapV(t){this._wrapV=t}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(t){this._texture?this._texture.isCube=t:this._isCube=t}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(t){this._texture&&(this._texture.is3D=t)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(t){this._texture&&(this._texture.is2DArray=t)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(t){if(this._texture){if(this._texture._gammaSpace===t)return;this._texture._gammaSpace=t}else{if(this._gammaSpace===t)return;this._gammaSpace=t}this._markAllSubMeshesAsTexturesDirty()}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(t){this._texture&&(this._texture._isRGBD=t)}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(t){this._texture&&(this._texture._lodGenerationOffset=t)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(t){this._texture&&(this._texture._lodGenerationScale=t)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(t){this._texture&&(this._texture._linearSpecularLOD=t)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(t){this._texture&&(this._texture._irradianceTexture=t)}get uid(){return this._uid||(this._uid=(0,a.f)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(t,e=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=new Array,this.onDisposeObservable=new n.y$,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,t?c._IsScene(t)?this._scene=t:this._engine=t:this._scene=h.l.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=e,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}checkTransformsAreIdentical(t){return null!==t}getTextureMatrix(){return o.y3.IdentityReadOnly}getReflectionTextureMatrix(){return o.y3.IdentityReadOnly}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(t){}get canRescale(){return!1}_getFromCache(t,e,i,s,r,n){const o=this._getEngine();if(!o)return null;const h=o._getUseSRGBBuffer(!!r,e),a=o.getLoadedTexturesCache();for(let o=0;o<a.length;o++){const l=a[o];if(!(void 0!==r&&h!==l._useSRGBBuffer||void 0!==s&&s!==l.invertY||l.url!==t||l.generateMipMaps!==!e||i&&i!==l.samplingMode||void 0!==n&&n!==l.isCube))return l.incrementReferences(),l}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}readPixels(t=0,e=0,i=null,s=!0,r=!1,n=0,o=0,h=Number.MAX_VALUE,a=Number.MAX_VALUE){if(!this._texture)return null;const l=this._getEngine();if(!l)return null;const _=this.getSize();let c=_.width,d=_.height;0!==e&&(c/=Math.pow(2,e),d/=Math.pow(2,e),c=Math.round(c),d=Math.round(d)),h=Math.min(c,h),a=Math.min(d,a);try{return this._texture.isCube?l._readTexturePixels(this._texture,h,a,t,e,i,s,r,n,o):l._readTexturePixels(this._texture,h,a,-1,e,i,s,r,n,o)}catch(t){return null}}_readPixelsSync(t=0,e=0,i=null,s=!0,r=!1){if(!this._texture)return null;const n=this.getSize();let o=n.width,h=n.height;const a=this._getEngine();if(!a)return null;0!=e&&(o/=Math.pow(2,e),h/=Math.pow(2,e),o=Math.round(o),h=Math.round(h));try{return this._texture.isCube?a._readTexturePixelsSync(this._texture,o,h,t,e,i,s,r):a._readTexturePixelsSync(this._texture,o,h,-1,e,i,s,r)}catch(t){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const t=this._scene.textures.indexOf(this);if(t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const t=this._parentContainer.textures.indexOf(this);t>-1&&this._parentContainer.textures.splice(t,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(t=!1){if(!this.name&&!t)return null;const e=r.p4.Serialize(this);return r.p4.AppendSerializedAnimations(this,e),e}static WhenAllReady(t,e){let i=t.length;if(0!==i)for(let s=0;s<t.length;s++){const r=t[s];if(r.isReady())0==--i&&e();else{const t=r.onLoadObservable;t?t.addOnce((()=>{0==--i&&e()})):0==--i&&e()}}else e()}static _IsScene(t){return"Scene"===t.getClassName()}}c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,s.gn)([(0,r.qC)()],c.prototype,"uniqueId",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"name",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"metadata",void 0),(0,s.gn)([(0,r.qC)("hasAlpha")],c.prototype,"_hasAlpha",void 0),(0,s.gn)([(0,r.qC)("getAlphaFromRGB")],c.prototype,"_getAlphaFromRGB",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"level",void 0),(0,s.gn)([(0,r.qC)("coordinatesIndex")],c.prototype,"_coordinatesIndex",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"optimizeUVAllocation",void 0),(0,s.gn)([(0,r.qC)("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"wrapU",null),(0,s.gn)([(0,r.qC)()],c.prototype,"wrapV",null),(0,s.gn)([(0,r.qC)()],c.prototype,"wrapR",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"anisotropicFilteringLevel",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"isCube",null),(0,s.gn)([(0,r.qC)()],c.prototype,"is3D",null),(0,s.gn)([(0,r.qC)()],c.prototype,"is2DArray",null),(0,s.gn)([(0,r.qC)()],c.prototype,"gammaSpace",null),(0,s.gn)([(0,r.qC)()],c.prototype,"invertZ",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"lodLevelInAlpha",void 0),(0,s.gn)([(0,r.qC)()],c.prototype,"lodGenerationOffset",null),(0,s.gn)([(0,r.qC)()],c.prototype,"lodGenerationScale",null),(0,s.gn)([(0,r.qC)()],c.prototype,"linearSpecularLOD",null),(0,s.gn)([(0,r.oU)()],c.prototype,"irradianceTexture",null),(0,s.gn)([(0,r.qC)()],c.prototype,"isRenderTarget",void 0);var d=i(646),u=i(9069),g=i(9447),f=i(6448),p=i(6504),m=i(8661);function x(t,e,i=!1){const s=e.width,r=e.height;if(t instanceof Float32Array){let e=t.byteLength/t.BYTES_PER_ELEMENT;const i=new Uint8Array(e);for(;--e>=0;){let s=t[e];s<0?s=0:s>1&&(s=1),i[e]=255*s}t=i}const n=document.createElement("canvas");n.width=s,n.height=r;const o=n.getContext("2d");if(!o)return null;const h=o.createImageData(s,r);if(h.data.set(t),o.putImageData(h,0,0),i){const t=document.createElement("canvas");t.width=s,t.height=r;const e=t.getContext("2d");return e?(e.translate(0,r),e.scale(1,-1),e.drawImage(n,0,0),t.toDataURL("image/png")):null}return n.toDataURL("image/png")}var b=i(6629);class I extends c{get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(t){this._isBlocking=t}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(t,e,i,s,r=I.TRILINEAR_SAMPLINGMODE,o=null,h=null,a=null,l=!1,_,c,d,u,f){var p,m,x,T,M,C,y,A,v;let O;super(e),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new n.y$,this._isBlocking=!0,this.name=t||"",this.url=t;let E=!1,S=null;"object"==typeof i&&null!==i?(O=null!==(p=i.noMipmap)&&void 0!==p&&p,s=null!==(m=i.invertY)&&void 0!==m?m:!b.e.UseOpenGLOrientationForUV,r=null!==(x=i.samplingMode)&&void 0!==x?x:I.TRILINEAR_SAMPLINGMODE,o=null!==(T=i.onLoad)&&void 0!==T?T:null,h=null!==(M=i.onError)&&void 0!==M?M:null,a=null!==(C=i.buffer)&&void 0!==C?C:null,l=null!==(y=i.deleteBuffer)&&void 0!==y&&y,_=i.format,c=i.mimeType,d=i.loaderOptions,u=i.creationFlags,E=null!==(A=i.useSRGBBuffer)&&void 0!==A&&A,S=null!==(v=i.internalTexture)&&void 0!==v?v:null):O=!!i,this._noMipmap=O,this._invertY=void 0===s?!b.e.UseOpenGLOrientationForUV:s,this._initialSamplingMode=r,this._buffer=a,this._deleteBuffer=l,this._mimeType=c,this._loaderOptions=d,this._creationFlags=u,this._useSRGBBuffer=E,this._forcedExtension=f,_&&(this._format=_);const D=this.getScene(),w=this._getEngine();if(!w)return;w.onBeforeTextureInitObservable.notifyObservers(this);const R=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),o&&o(),!this.isBlocking&&D&&D.resetCachedMaterial()},P=(t,e)=>{this._loadingError=!0,this._errorObject={message:t,exception:e},h&&h(t,e),I.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!S)return this._delayedOnLoad=R,void(this._delayedOnError=P);if(this._texture=null!=S?S:this._getFromCache(this.url,O,r,this._invertY,E),this._texture)if(this._texture.isReady)g.Q.SetImmediate((()=>R()));else{const t=this._texture.onLoadedObservable.add(R);this._texture.onErrorObservable.add((e=>{var i;P(e.message,e.exception),null===(i=this._texture)||void 0===i||i.onLoadedObservable.remove(t)}))}else if(D&&D.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=R,this._delayedOnError=P;else{try{this._texture=w.createTexture(this.url,O,this._invertY,D,r,R,P,this._buffer,void 0,this._format,this._forcedExtension,c,d,u,E)}catch(t){throw P("error loading",t),t}l&&(this._buffer=null)}}updateURL(t,e=null,i,s){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,this._buffer=e,this._forcedExtension=s,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const t=this.getScene();t&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?g.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=t.getEngine().createTexture(this.url,this._noMipmap,this._invertY,t,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(t,e,i,s){t*=this._cachedUScale,e*=this._cachedVScale,t-=this.uRotationCenter*this._cachedUScale,e-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,o.P.TransformCoordinatesFromFloatsToRef(t,e,i,this._rowGenerationMatrix,s),s.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,s.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,s.z+=this.wRotationCenter}checkTransformsAreIdentical(t){return null!==t&&this.uOffset===t.uOffset&&this.vOffset===t.vOffset&&this.uScale===t.uScale&&this.vScale===t.vScale&&this.uAng===t.uAng&&this.vAng===t.vAng&&this.wAng===t.wAng}getTextureMatrix(t=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=o.y3.Zero(),this._rowGenerationMatrix=new o.y3,this._t0=o.P.Zero(),this._t1=o.P.Zero(),this._t2=o.P.Zero()),o.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(o.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,o.jp.Matrix[0]),o.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,o.jp.Matrix[1]),o.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,o.jp.Matrix[2]),o.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,o.jp.Matrix[3]),o.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),o.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const e=this.getScene();return e?(this.optimizeUVAllocation&&e.markAllMaterialsAsDirty(1,(t=>t.hasTexture(this))),this._cachedTextureMatrix):this._cachedTextureMatrix}getReflectionTextureMatrix(){const t=this.getScene();if(!t)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==I.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=o.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=o.y3.Zero());const e=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case I.PLANAR_MODE:o.y3.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case I.PROJECTION_MODE:{o.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const e=t.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=e.updateFlag,e.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:o.y3.IdentityToRef(this._cachedReflectionTextureMatrix)}return e&&t.markAllMaterialsAsDirty(1,(t=>-1!==t.getActiveTextures().indexOf(this))),this._cachedReflectionTextureMatrix}clone(){const t={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return r.p4.Clone((()=>new I(this._texture?this._texture.url:null,this.getScene(),t)),this)}serialize(){var t,e;const i=this.name;I.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const s=super.serialize(I._SerializeInternalTextureUniqueId);return s?((I.SerializeBuffers||I.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(s.base64String=this._buffer,s.name=s.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?s.base64String="data:image/png;base64,"+(0,m.Gh)(this._buffer):(I.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(s.base64String=!this._engine||this._engine._features.supportSyncTextureRead?function(t,e=0,i=0){const s=t.getInternalTexture();if(!s)return null;const r=t._readPixelsSync(e,i);return r?x(r,t.getSize(),s.invertY):null}(this):async function(t,e=0,i=0){const s=t.getInternalTexture();if(!s)return null;const r=await t.readPixels(e,i);return r?x(r,t.getSize(),s.invertY):null}(this))),s.invertY=this._invertY,s.samplingMode=this.samplingMode,s._creationFlags=this._creationFlags,s._useSRGBBuffer=this._useSRGBBuffer,I._SerializeInternalTextureUniqueId&&(s.internalTextureUniqueId=null!==(e=null===(t=this._texture)||void 0===t?void 0:t.uniqueId)&&void 0!==e?e:void 0),this.name=i,s):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(t,e,i){if(t.customType){const s=f.K.Instantiate(t.customType).Parse(t,e,i);return t.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==t.samplingMode&&s.updateSamplingMode(t.samplingMode),s}if(t.isCube&&!t.isRenderTarget)return I._CubeTextureParser(t,e,i);const s=void 0!==t.internalTextureUniqueId;if(!t.name&&!t.isRenderTarget&&!s)return null;let n;if(s){const i=e.getEngine().getLoadedTexturesCache();for(const e of i)if(e.uniqueId===t.internalTextureUniqueId){n=e;break}}const o=e=>{var i;if(e&&e._texture&&(e._texture._cachedWrapU=null,e._texture._cachedWrapV=null,e._texture._cachedWrapR=null),t.samplingMode){const i=t.samplingMode;e&&e.samplingMode!==i&&e.updateSamplingMode(i)}if(e&&t.animations)for(let i=0;i<t.animations.length;i++){const s=t.animations[i],r=(0,d.q)("BABYLON.Animation");r&&e.animations.push(r.Parse(s))}s&&!n&&(null===(i=null==e?void 0:e._texture)||void 0===i||i._setUniqueId(t.internalTextureUniqueId))};return r.p4.Parse((()=>{var s,r,h;let a=!0;if(t.noMipmap&&(a=!1),t.mirrorPlane){const i=I._CreateMirror(t.name,t.renderTargetSize,e,a);return i._waitingRenderList=t.renderList,i.mirrorPlane=p.J.FromArray(t.mirrorPlane),o(i),i}if(t.isRenderTarget){let i=null;if(t.isCube){if(e.reflectionProbes)for(let i=0;i<e.reflectionProbes.length;i++){const s=e.reflectionProbes[i];if(s.name===t.name)return s.cubeTexture}}else i=I._CreateRenderTargetTexture(t.name,t.renderTargetSize,e,a,null!==(s=t._creationFlags)&&void 0!==s?s:0),i._waitingRenderList=t.renderList;return o(i),i}{let s;if(t.base64String&&!n)s=I.CreateFromBase64String(t.base64String,t.base64String,e,!a,t.invertY,t.samplingMode,(()=>{o(s)}),null!==(r=t._creationFlags)&&void 0!==r?r:0,null!==(h=t._useSRGBBuffer)&&void 0!==h&&h),s.name=t.name;else{let r;r=t.name&&t.name.indexOf("://")>0?t.name:i+t.name,t.url&&(t.url.startsWith("data:")||I.UseSerializedUrlIfAny)&&(r=t.url);const h={noMipmap:!a,invertY:t.invertY,samplingMode:t.samplingMode,onLoad:()=>{o(s)},internalTexture:n};s=new I(r,e,h)}return s}}),t,e)}static CreateFromBase64String(t,e,i,s,r,n=I.TRILINEAR_SAMPLINGMODE,o=null,h=null,a=5,l){return new I("data:"+e,i,s,r,n,o,h,t,!1,a,void 0,void 0,l)}static LoadFromDataString(t,e,i,s=!1,r,n=!0,o=I.TRILINEAR_SAMPLINGMODE,h=null,a=null,l=5,_){return"data:"!==t.substr(0,5)&&(t="data:"+t),new I(t,i,r,n,o,h,a,e,s,l,void 0,void 0,_)}}I.SerializeBuffers=!0,I.ForceSerializeBuffers=!1,I.OnTextureLoadErrorObservable=new n.y$,I._SerializeInternalTextureUniqueId=!1,I._CubeTextureParser=(t,e,i)=>{throw(0,u.S)("CubeTexture")},I._CreateMirror=(t,e,i,s)=>{throw(0,u.S)("MirrorTexture")},I._CreateRenderTargetTexture=(t,e,i,s,r)=>{throw(0,u.S)("RenderTargetTexture")},I.NEAREST_SAMPLINGMODE=1,I.NEAREST_NEAREST_MIPLINEAR=8,I.BILINEAR_SAMPLINGMODE=2,I.LINEAR_LINEAR_MIPNEAREST=11,I.TRILINEAR_SAMPLINGMODE=3,I.LINEAR_LINEAR_MIPLINEAR=3,I.NEAREST_NEAREST_MIPNEAREST=4,I.NEAREST_LINEAR_MIPNEAREST=5,I.NEAREST_LINEAR_MIPLINEAR=6,I.NEAREST_LINEAR=7,I.NEAREST_NEAREST=1,I.LINEAR_NEAREST_MIPNEAREST=9,I.LINEAR_NEAREST_MIPLINEAR=10,I.LINEAR_LINEAR=2,I.LINEAR_NEAREST=12,I.EXPLICIT_MODE=0,I.SPHERICAL_MODE=1,I.PLANAR_MODE=2,I.CUBIC_MODE=3,I.PROJECTION_MODE=4,I.SKYBOX_MODE=5,I.INVCUBIC_MODE=6,I.EQUIRECTANGULAR_MODE=7,I.FIXED_EQUIRECTANGULAR_MODE=8,I.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,I.CLAMP_ADDRESSMODE=0,I.WRAP_ADDRESSMODE=1,I.MIRROR_ADDRESSMODE=2,I.UseSerializedUrlIfAny=!1,(0,s.gn)([(0,r.qC)()],I.prototype,"url",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"uOffset",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"vOffset",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"uScale",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"vScale",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"uAng",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"vAng",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"wAng",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"uRotationCenter",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"vRotationCenter",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"wRotationCenter",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"homogeneousRotationInUVTransform",void 0),(0,s.gn)([(0,r.qC)()],I.prototype,"isBlocking",null),(0,d.H)("BABYLON.Texture",I),r.p4._TextureParser=I.Parse},5241:(t,e,i)=>{i.d(e,{RD:()=>o,T:()=>s,c7:()=>r});var s,r,n=i(5412);!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD",t[t.BONE=2]="BONE"}(s||(s={}));class o{}o.X=new n.P(1,0,0),o.Y=new n.P(0,1,0),o.Z=new n.P(0,0,1),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(r||(r={}))},7303:(t,e,i)=>{i.d(e,{k:()=>a,y:()=>h});var s=i(1069),r=i(5412),n=i(8137);class o{static extractMinAndMaxIndexed(t,e,i,s,r,n){for(let o=i;o<i+s;o++){const i=3*e[o],s=t[i],h=t[i+1],a=t[i+2];r.minimizeInPlaceFromFloats(s,h,a),n.maximizeInPlaceFromFloats(s,h,a)}}static extractMinAndMax(t,e,i,s,r,n){for(let o=e,h=e*s;o<e+i;o++,h+=s){const e=t[h],i=t[h+1],s=t[h+2];r.minimizeInPlaceFromFloats(e,i,s),n.maximizeInPlaceFromFloats(e,i,s)}}}function h(t,e,i,s,n=null){const h=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return o.extractMinAndMaxIndexed(t,e,i,s,h,a),n&&(h.x-=h.x*n.x+n.y,h.y-=h.y*n.x+n.y,h.z-=h.z*n.x+n.y,a.x+=a.x*n.x+n.y,a.y+=a.y*n.x+n.y,a.z+=a.z*n.x+n.y),{minimum:h,maximum:a}}function a(t,e,i,s=null,n){const h=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),o.extractMinAndMax(t,e,i,n,h,a),s&&(h.x-=h.x*s.x+s.y,h.y-=h.y*s.x+s.y,h.z-=h.z*s.x+s.y,a.x+=a.x*s.x+s.y,a.y+=a.y*s.x+s.y,a.z+=a.z*s.x+s.y),{minimum:h,maximum:a}}(0,s.gn)([n.G6.filter(((...[t,e])=>!Array.isArray(t)&&!Array.isArray(e)))],o,"extractMinAndMaxIndexed",null),(0,s.gn)([n.G6.filter(((...[t])=>!Array.isArray(t)))],o,"extractMinAndMax",null)},3321:(t,e,i)=>{i.d(e,{$:()=>s});class s{constructor(t,e){this.width=t,this.height=e}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let t=0|this.width;return t=397*t^(0|this.height),t}copyFrom(t){this.width=t.width,this.height=t.height}copyFromFloats(t,e){return this.width=t,this.height=e,this}set(t,e){return this.copyFromFloats(t,e)}multiplyByFloats(t,e){return new s(this.width*t,this.height*e)}clone(){return new s(this.width,this.height)}equals(t){return!!t&&this.width===t.width&&this.height===t.height}get surface(){return this.width*this.height}static Zero(){return new s(0,0)}add(t){return new s(this.width+t.width,this.height+t.height)}subtract(t){return new s(this.width-t.width,this.height-t.height)}static Lerp(t,e,i){const r=t.width+(e.width-t.width)*i,n=t.height+(e.height-t.height)*i;return new s(r,n)}}},7142:(t,e,i)=>{i.d(e,{x:()=>M});var s=i(8139),r=i(253),n=i(5412),o=i(2352),h=i(2186),a=i(2341),l=i(4179),_=i(318),c=i(2543),d=i(5888);class u{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new n.P(0,0,0),this._diffPositionForCollisions=new n.P(0,0,0),this._collisionResponse=!0}}var g=i(9069),f=i(7303),p=i(2922),m=i(4551),x=i(5241),b=i(646);class I{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=n.P.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class T{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new I,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new u,this._enableDistantPicking=!1}}class M extends l.Y{static get BILLBOARDMODE_NONE(){return l.Y.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return l.Y.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return l.Y.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return l.Y.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return l.Y.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return l.Y.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(t){return!!super._updateNonUniformScalingState(t)&&(this._markSubMeshesAsMiscDirty(),!0)}set onCollide(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)}set onCollisionPositionChange(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(t){if(this._internalAbstractMeshDataInfo._visibility===t)return;const e=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(1===e&&1!==t||1!==e&&1===t)&&this._markSubMeshesAsMiscDirty()}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(t){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=t}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(t){this._internalAbstractMeshDataInfo._renderingGroupId=t}get material(){return this._internalAbstractMeshDataInfo._material}set material(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(t){var e;return null===(e=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===e?void 0:e[t]}setMaterialForRenderPass(t,e){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=e}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t}get lightSources(){return this._lightSources}get _positions(){return null}set skeleton(t){const e=this._internalAbstractMeshDataInfo._skeleton;e&&e.needInitialSkinMatrix&&e._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(t,e=null){switch(super(t,e,!1),this._internalAbstractMeshDataInfo=new T,this._waitingMaterialId=null,this.cullingStrategy=M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new s.y$,this.onCollisionPositionChangeObservable=new s.y$,this.onMaterialChangedObservable=new s.y$,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this.isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=p.Wo.Red(),this.outlineWidth=.02,this.overlayColor=p.Wo.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new n.P(.5,1,.5),this.ellipsoidOffset=new n.P(0,0,0),this.edgesWidth=1,this.edgesColor=new p.HE(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new s.y$,this._onCollisionPositionChange=(t,e,i=null)=>{e.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>o.D.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i&&this.onCollideObservable.notifyObservers(i),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(e=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new d.M(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),e.performancePriority){case r.a.Aggressive:this.doNotSyncBoundingInfo=!0;case r.a.Intermediate:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(t){const e=this._uniformBuffer;e.updateMatrix("world",t),e.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),e.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(t){let e="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");e+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const i=this._internalAbstractMeshDataInfo._skeleton;return i&&(e+=", skeleton: "+i.name),t&&(e+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],e+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),e}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==l.Y.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(t,e=!0){if(this.actionManager&&(e||this.actionManager.isRecursive)){if(!t)return this.actionManager;if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_rebuild(t=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(const t of this.subMeshes)t._rebuild()}_resyncLightSources(){this._lightSources.length=0;for(const t of this.getScene().lights)t.isEnabled()&&t.canAffectMesh(this)&&this._lightSources.push(t);this._markSubMeshesAsLightDirty()}_resyncLightSource(t){const e=t.isEnabled()&&t.canAffectMesh(this),i=this._lightSources.indexOf(t);let s=!1;if(-1===i){if(!e)return;this._lightSources.push(t)}else{if(e)return;s=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(s)}_unBindEffect(){for(const t of this.subMeshes)t.setEffect(null)}_removeLightSource(t,e){const i=this._lightSources.indexOf(t);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(e))}_markSubMeshesAsDirty(t){if(this.subMeshes)for(const e of this.subMeshes)for(let i=0;i<e._drawWrappers.length;++i){const s=e._drawWrappers[i];s&&s.defines&&s.defines.markAllAsDirty&&t(s.defines)}}_markSubMeshesAsLightDirty(t=!1){this._markSubMeshesAsDirty((e=>e.markAsLightDirty(t)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((t=>t.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((t=>t.markAsMiscDirty()))}markAsDirty(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(t){if(this.subMeshes)for(const e of this.subMeshes)e.resetDrawCache(t)}get isBlocked(){return!1}getLOD(t){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(t){return null}setVerticesData(t,e,i,s){return this}updateVerticesData(t,e,i,s){return this}setIndices(t,e){return this}isVerticesDataPresent(t){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}setBoundingInfo(t){return this._boundingInfo=t,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(t,e,i){return this._boundingInfo=new c.j(t,e,i),this._boundingInfo}normalizeToUnitCube(t=!0,e=!1,i){return super.normalizeToUnitCube(t,e,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(h.o.MatricesIndicesKind)&&this.isVerticesDataPresent(h.o.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(t){}_activate(t,e){return this._renderId=t,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===l.Y.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(t,e,i){return this.position.addInPlace(this.calcMovePOV(t,e,i)),this}calcMovePOV(t,e,i){const s=new n.y3;(this.rotationQuaternion?this.rotationQuaternion:n._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);const r=n.P.Zero(),o=this.definedFacingForward?-1:1;return n.P.TransformCoordinatesFromFloatsToRef(t*o,e,i*o,s,r),r}rotatePOV(t,e,i){return this.rotation.addInPlace(this.calcRotatePOV(t,e,i)),this}calcRotatePOV(t,e,i){const s=this.definedFacingForward?1:-1;return new n.P(t*s,e,i*s)}refreshBoundingInfo(t=!1,e=!1){return this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(t,e),null),this}_refreshBoundingInfo(t,e){if(t){const i=(0,f.k)(t,0,this.getTotalVertices(),e);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new c.j(i.minimum,i.maximum)}if(this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(t);this._updateBoundingInfo()}_getData(t=!1,e=!1,i,s=h.o.PositionKind){if((i=null!=i?i:this.getVerticesData(s).slice())&&e&&this.morphTargetManager){let t=0,e=0;for(let r=0;r<i.length;r++){for(let t=0;t<this.morphTargetManager.numTargets;t++){const e=this.morphTargetManager.getTarget(t),s=e.influence;if(s>0){const t=e.getPositions();t&&(i[r]+=(t[r]-i[r])*s)}}if(t++,s===h.o.PositionKind&&this._positions&&3===t){t=0;const s=3*e;this._positions[e++].copyFromFloats(i[s],i[s+1],i[s+2])}}}if(i&&t&&this.skeleton){const t=this.getVerticesData(h.o.MatricesIndicesKind),e=this.getVerticesData(h.o.MatricesWeightsKind);if(e&&t){const r=this.numBoneInfluencers>4,o=r?this.getVerticesData(h.o.MatricesIndicesExtraKind):null,a=r?this.getVerticesData(h.o.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this),_=n.jp.Vector3[0],c=n.jp.Matrix[0],d=n.jp.Matrix[1];let u=0;for(let g=0;g<i.length;g+=3,u+=4){let f,p;for(c.reset(),f=0;f<4;f++)p=e[u+f],p>0&&(n.y3.FromFloat32ArrayToRefScaled(l,Math.floor(16*t[u+f]),p,d),c.addToSelf(d));if(r)for(f=0;f<4;f++)p=a[u+f],p>0&&(n.y3.FromFloat32ArrayToRefScaled(l,Math.floor(16*o[u+f]),p,d),c.addToSelf(d));s===h.o.NormalKind?n.P.TransformNormalFromFloatsToRef(i[g],i[g+1],i[g+2],c,_):n.P.TransformCoordinatesFromFloatsToRef(i[g],i[g+1],i[g+2],c,_),_.toArray(i,g),s===h.o.PositionKind&&this._positions&&this._positions[g/3].copyFrom(_)}}}return i}getNormalsData(t=!1,e=!1){return this._getData(t,e,null,h.o.NormalKind)}getPositionData(t=!1,e=!1,i){return this._getData(t,e,i,h.o.PositionKind)}_getPositionData(t,e){var i;let s=this.getVerticesData(h.o.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),s&&(t&&this.skeleton||e&&this.morphTargetManager)){if(s=s.slice(),this._generatePointsArray(),this._positions){const t=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(t.length);for(let e=0;e<t.length;e++)this._internalAbstractMeshDataInfo._positions[e]=(null===(i=t[e])||void 0===i?void 0:i.clone())||new n.P}return this.getPositionData(t,e,s)}return s}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new c.j(n.P.Zero(),n.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(t){if(!this.subMeshes)return this;const e=this.subMeshes.length;for(let i=0;i<e;i++){const s=this.subMeshes[i];(e>1||!s.IsGlobal)&&s.updateBoundingInfo(t)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(t){return this.getBoundingInfo().isInFrustum(t,this.cullingStrategy)}isCompletelyInFrustum(t){return this.getBoundingInfo().isCompletelyInFrustum(t)}intersectsMesh(t,e=!1,i){const s=this.getBoundingInfo(),r=t.getBoundingInfo();if(s.intersects(r,e))return!0;if(i)for(const i of this.getChildMeshes())if(i.intersectsMesh(t,e,!0))return!0;return!1}intersectsPoint(t){return this.getBoundingInfo().intersectsPoint(t)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const e=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=e.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,e.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(t,e,i){var s;if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(e)){t._lastColliderTransformMatrix=e.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];const i=t.verticesStart,s=t.verticesStart+t.verticesCount;for(let r=i;r<s;r++)t._lastColliderWorldVertices.push(n.P.TransformCoordinates(this._positions[r],e))}return i._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this,this._shouldConvertRHS(),7===(null===(s=t.getMaterial())||void 0===s?void 0:s.fillMode)),this}_processCollisionsForSubMeshes(t,e){const i=this._scene.getCollidingSubMeshCandidates(this,t),s=i.length;for(let r=0;r<s;r++){const n=i.data[r];s>1&&!n._checkCollision(t)||this._collideForSubMesh(n,e,t)}return this}_shouldConvertRHS(){return!1}_checkCollision(t){if(!this.getBoundingInfo()._checkCollision(t))return this;const e=n.jp.Matrix[0],i=n.jp.Matrix[1];return n.y3.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,e),this.worldMatrixFromCache.multiplyToRef(e,i),this._processCollisionsForSubMeshes(t,i),this}_generatePointsArray(){return!1}intersects(t,e,i,s=!1,r,o=!1){const h=new _.p,a="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,l=this.getBoundingInfo();if(!this.subMeshes)return h;if(!(o||t.intersectsSphere(l.boundingSphere,a)&&t.intersectsBox(l.boundingBox,a)))return h;if(s)return h.hit=!o,h.pickedMesh=o?null:this,h.distance=o?0:n.P.Distance(t.origin,l.boundingSphere.center),h.subMeshId=0,h;if(!this._generatePointsArray())return h;let c=null;const d=this._scene.getIntersectingSubMeshCandidates(this,t),u=d.length;let g=!1;for(let t=0;t<u;t++){const e=d.data[t].getMaterial();if(e&&(7==e.fillMode||0==e.fillMode||1==e.fillMode||2==e.fillMode||4==e.fillMode)){g=!0;break}}if(!g)return h.hit=!0,h.pickedMesh=this,h.distance=n.P.Distance(t.origin,l.boundingSphere.center),h.subMeshId=-1,h;for(let s=0;s<u;s++){const r=d.data[s];if(u>1&&!r.canIntersects(t))continue;const n=r.intersects(t,this._positions,this.getIndices(),e,i);if(n&&(e||!c||n.distance<c.distance)&&(c=n,c.subMeshId=s,e))break}if(c){const e=null!=r?r:this.getWorldMatrix(),i=n.jp.Vector3[0],s=n.jp.Vector3[1];n.P.TransformCoordinatesToRef(t.origin,e,i),t.direction.scaleToRef(c.distance,s);const o=n.P.TransformNormal(s,e).addInPlace(i);return h.hit=!0,h.distance=n.P.Distance(i,o),h.pickedPoint=o,h.pickedMesh=this,h.bu=c.bu||0,h.bv=c.bv||0,h.subMeshFaceId=c.faceId,h.faceId=c.faceId+d.data[c.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),h.subMeshId=c.subMeshId,h}return h}clone(t,e,i){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this}dispose(t,e=!1){let i;for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){const t=this._intersectionsInProgress[i],e=t._intersectionsInProgress.indexOf(this);t._intersectionsInProgress.splice(e,1)}this._intersectionsInProgress.length=0,this.getScene().lights.forEach((t=>{let e=t.includedOnlyMeshes.indexOf(this);-1!==e&&t.includedOnlyMeshes.splice(e,1),e=t.excludedMeshes.indexOf(this),-1!==e&&t.excludedMeshes.splice(e,1);const i=t.getShadowGenerators();if(i){const t=i.values();for(let i=t.next();!0!==i.done;i=t.next()){const t=i.value.getShadowMap();t&&t.renderList&&(e=t.renderList.indexOf(this),-1!==e&&t.renderList.splice(e,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const s=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){const t=this._parentContainer.meshes.indexOf(this);t>-1&&this._parentContainer.meshes.splice(t,1),this._parentContainer=null}if(e&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(t,e)}addChild(t,e=!1){return t.setParent(this,e),this}removeChild(t,e=!1){return t.setParent(null,e),this}_initFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(let e=0;e<t.facetNb;e++)t.facetNormals[e]=n.P.Zero(),t.facetPositions[e]=n.P.Zero();return t.facetDataEnabled=!0,this}updateFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();const e=this.getVerticesData(h.o.PositionKind),i=this.getIndices(),s=this.getVerticesData(h.o.NormalKind),r=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,i instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(i);else{let e=!1;for(let t=0;t<i.length;t++)if(i[t]>65535){e=!0;break}t.depthSortedIndices=e?new Uint32Array(i):new Uint16Array(i)}if(t.facetDepthSortFunction=function(t,e){return e.sqDistance-t.sqDistance},!t.facetDepthSortFrom){const e=this.getScene().activeCamera;t.facetDepthSortFrom=e?e.position:n.P.Zero()}t.depthSortedFacets=[];for(let e=0;e<t.facetNb;e++){const i={ind:3*e,sqDistance:0};t.depthSortedFacets.push(i)}t.invertedMatrix=n.y3.Identity(),t.facetDepthSortOrigin=n.P.Zero()}t.bbSize.x=r.maximum.x-r.minimum.x>m.kn?r.maximum.x-r.minimum.x:m.kn,t.bbSize.y=r.maximum.y-r.minimum.y>m.kn?r.maximum.y-r.minimum.y:m.kn,t.bbSize.z=r.maximum.z-r.minimum.z>m.kn?r.maximum.z-r.minimum.z:m.kn;let o=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(o=o>t.bbSize.z?o:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/o),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/o),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/o),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=r,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),n.P.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,s&&a.x.ComputeNormals(e,i,s,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);const e=t.depthSortedIndices.length/3|0;for(let s=0;s<e;s++){const e=t.depthSortedFacets[s].ind;t.depthSortedIndices[3*s]=i[e],t.depthSortedIndices[3*s+1]=i[e+1],t.depthSortedIndices[3*s+2]=i[e+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals}getFacetLocalPositions(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions}getFacetLocalPartitioning(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning}getFacetPosition(t){const e=n.P.Zero();return this.getFacetPositionToRef(t,e),e}getFacetPositionToRef(t,e){const i=this.getFacetLocalPositions()[t],s=this.getWorldMatrix();return n.P.TransformCoordinatesToRef(i,s,e),this}getFacetNormal(t){const e=n.P.Zero();return this.getFacetNormalToRef(t,e),e}getFacetNormalToRef(t,e){const i=this.getFacetLocalNormals()[t];return n.P.TransformNormalToRef(i,this.getWorldMatrix(),e),this}getFacetsAtLocalCoordinates(t,e,i){const s=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,n=Math.floor((t-s.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),o=Math.floor((e-s.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),h=Math.floor((i-s.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return n<0||n>r.subDiv.max||o<0||o>r.subDiv.max||h<0||h>r.subDiv.max?null:r.facetPartitioning[n+r.subDiv.max*o+r.subDiv.max*r.subDiv.max*h]}getClosestFacetAtCoordinates(t,e,i,s,r=!1,o=!0){const h=this.getWorldMatrix(),a=n.jp.Matrix[5];h.invertToRef(a);const l=n.jp.Vector3[8];n.P.TransformCoordinatesFromFloatsToRef(t,e,i,a,l);const _=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,s,r,o);return s&&n.P.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,h,s),_}getClosestFacetAtLocalCoordinates(t,e,i,s,r=!1,n=!0){let o=null,h=0,a=0,l=0,_=0,c=0,d=0,u=0,g=0;const f=this.getFacetLocalPositions(),p=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(t,e,i);if(!m)return null;let x,b,I,T=Number.MAX_VALUE,M=T;for(let C=0;C<m.length;C++)x=m[C],b=p[x],I=f[x],_=(t-I.x)*b.x+(e-I.y)*b.y+(i-I.z)*b.z,(!r||r&&n&&_>=0||r&&!n&&_<=0)&&(_=b.x*I.x+b.y*I.y+b.z*I.z,c=-(b.x*t+b.y*e+b.z*i-_)/(b.x*b.x+b.y*b.y+b.z*b.z),d=t+b.x*c,u=e+b.y*c,g=i+b.z*c,h=d-t,a=u-e,l=g-i,M=h*h+a*a+l*l,M<T&&(T=M,o=x,s&&(s.x=d,s.y=u,s.z=g)));return o}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=new Array,t.facetNormals=new Array,t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this}updateIndices(t,e,i=!1){return this}createNormals(t){const e=this.getVerticesData(h.o.PositionKind),i=this.getIndices();let s;return s=this.isVerticesDataPresent(h.o.NormalKind)?this.getVerticesData(h.o.NormalKind):[],a.x.ComputeNormals(e,i,s,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(h.o.NormalKind,s,t),this}alignWithNormal(t,e){e||(e=x.RD.Y);const i=n.jp.Vector3[0],s=n.jp.Vector3[1];return n.P.CrossToRef(e,t,s),n.P.CrossToRef(t,s,i),this.rotationQuaternion?n._f.RotationQuaternionFromAxisToRef(i,t,s,this.rotationQuaternion):n.P.RotationFromAxisToRef(i,t,s,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,g.S)("EdgesRenderer")}enableEdgesRendering(t,e,i){throw(0,g.S)("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter((t=>t.emitter===this))}}M.OCCLUSION_TYPE_NONE=0,M.OCCLUSION_TYPE_OPTIMISTIC=1,M.OCCLUSION_TYPE_STRICT=2,M.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,M.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,M.CULLINGSTRATEGY_STANDARD=0,M.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,M.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,b.H)("BABYLON.AbstractMesh",M)},2341:(t,e,i)=>{i.d(e,{x:()=>d});var s=i(1069),r=i(5412),n=i(2186),o=i(9069),h=i(2922),a=i(658),l=i(8137),_=i(140),c=i(9714);class d{constructor(){this._applyTo=(0,_.vp)(this._applyToCoroutine.bind(this))}set(t,e){switch(t.length||a.Y.Warn(`Setting vertex data kind '${e}' with an empty array`),e){case n.o.PositionKind:this.positions=t;break;case n.o.NormalKind:this.normals=t;break;case n.o.TangentKind:this.tangents=t;break;case n.o.UVKind:this.uvs=t;break;case n.o.UV2Kind:this.uvs2=t;break;case n.o.UV3Kind:this.uvs3=t;break;case n.o.UV4Kind:this.uvs4=t;break;case n.o.UV5Kind:this.uvs5=t;break;case n.o.UV6Kind:this.uvs6=t;break;case n.o.ColorKind:this.colors=t;break;case n.o.MatricesIndicesKind:this.matricesIndices=t;break;case n.o.MatricesWeightsKind:this.matricesWeights=t;break;case n.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case n.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}}applyToMesh(t,e){return this._applyTo(t,e,!1),this}applyToGeometry(t,e){return this._applyTo(t,e,!1),this}updateMesh(t){return this._update(t),this}updateGeometry(t){return this._update(t),this}*_applyToCoroutine(t,e=!1,i){return this.positions&&(t.setVerticesData(n.o.PositionKind,this.positions,e),i&&(yield)),this.normals&&(t.setVerticesData(n.o.NormalKind,this.normals,e),i&&(yield)),this.tangents&&(t.setVerticesData(n.o.TangentKind,this.tangents,e),i&&(yield)),this.uvs&&(t.setVerticesData(n.o.UVKind,this.uvs,e),i&&(yield)),this.uvs2&&(t.setVerticesData(n.o.UV2Kind,this.uvs2,e),i&&(yield)),this.uvs3&&(t.setVerticesData(n.o.UV3Kind,this.uvs3,e),i&&(yield)),this.uvs4&&(t.setVerticesData(n.o.UV4Kind,this.uvs4,e),i&&(yield)),this.uvs5&&(t.setVerticesData(n.o.UV5Kind,this.uvs5,e),i&&(yield)),this.uvs6&&(t.setVerticesData(n.o.UV6Kind,this.uvs6,e),i&&(yield)),this.colors&&(t.setVerticesData(n.o.ColorKind,this.colors,e),i&&(yield)),this.matricesIndices&&(t.setVerticesData(n.o.MatricesIndicesKind,this.matricesIndices,e),i&&(yield)),this.matricesWeights&&(t.setVerticesData(n.o.MatricesWeightsKind,this.matricesWeights,e),i&&(yield)),this.matricesIndicesExtra&&(t.setVerticesData(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e),i&&(yield)),this.matricesWeightsExtra&&(t.setVerticesData(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e),i&&(yield)),this.indices?(t.setIndices(this.indices,null,e),i&&(yield)):t.setIndices([],null),this}_update(t,e,i){return this.positions&&t.updateVerticesData(n.o.PositionKind,this.positions,e,i),this.normals&&t.updateVerticesData(n.o.NormalKind,this.normals,e,i),this.tangents&&t.updateVerticesData(n.o.TangentKind,this.tangents,e,i),this.uvs&&t.updateVerticesData(n.o.UVKind,this.uvs,e,i),this.uvs2&&t.updateVerticesData(n.o.UV2Kind,this.uvs2,e,i),this.uvs3&&t.updateVerticesData(n.o.UV3Kind,this.uvs3,e,i),this.uvs4&&t.updateVerticesData(n.o.UV4Kind,this.uvs4,e,i),this.uvs5&&t.updateVerticesData(n.o.UV5Kind,this.uvs5,e,i),this.uvs6&&t.updateVerticesData(n.o.UV6Kind,this.uvs6,e,i),this.colors&&t.updateVerticesData(n.o.ColorKind,this.colors,e,i),this.matricesIndices&&t.updateVerticesData(n.o.MatricesIndicesKind,this.matricesIndices,e,i),this.matricesWeights&&t.updateVerticesData(n.o.MatricesWeightsKind,this.matricesWeights,e,i),this.matricesIndicesExtra&&t.updateVerticesData(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,i),this.matricesWeightsExtra&&t.updateVerticesData(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,i),this.indices&&t.setIndices(this.indices,null),this}static _TransformVector3Coordinates(t,e,i=0,s=t.length){const n=r.jp.Vector3[0],o=r.jp.Vector3[1];for(let h=i;h<i+s;h+=3)r.P.FromArrayToRef(t,h,n),r.P.TransformCoordinatesToRef(n,e,o),t[h]=o.x,t[h+1]=o.y,t[h+2]=o.z}static _TransformVector3Normals(t,e,i=0,s=t.length){const n=r.jp.Vector3[0],o=r.jp.Vector3[1];for(let h=i;h<i+s;h+=3)r.P.FromArrayToRef(t,h,n),r.P.TransformNormalToRef(n,e,o),t[h]=o.x,t[h+1]=o.y,t[h+2]=o.z}static _TransformVector4Normals(t,e,i=0,s=t.length){const n=r.jp.Vector4[0],o=r.jp.Vector4[1];for(let h=i;h<i+s;h+=4)r.Lt.FromArrayToRef(t,h,n),r.Lt.TransformNormalToRef(n,e,o),t[h]=o.x,t[h+1]=o.y,t[h+2]=o.z,t[h+3]=o.w}static _FlipFaces(t,e=0,i=t.length){for(let s=e;s<e+i;s+=3){const e=t[s+1];t[s+1]=t[s+2],t[s+2]=e}}transform(t){const e=t.determinant()<0;return this.positions&&d._TransformVector3Coordinates(this.positions,t),this.normals&&d._TransformVector3Normals(this.normals,t),this.tangents&&d._TransformVector4Normals(this.tangents,t),e&&this.indices&&d._FlipFaces(this.indices),this}merge(t,e=!1,i=!1){const s=Array.isArray(t)?t.map((t=>[t,void 0])):[[t,void 0]];return(0,_.s3)(this._mergeCoroutine(void 0,s,e,!1,i))}*_mergeCoroutine(t,e,i=!1,s,r){var o,h,a,l;this._validate();const _=e.map((t=>t[0]));for(const t of _)if(t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");const c=_.reduce(((t,e)=>{var i,s;return t+(null!==(s=null===(i=e.indices)||void 0===i?void 0:i.length)&&void 0!==s?s:0)}),null!==(h=null===(o=this.indices)||void 0===o?void 0:o.length)&&void 0!==h?h:0);let u=r||_.some((t=>t.indices===this.indices))?null===(a=this.indices)||void 0===a?void 0:a.slice():this.indices;if(c>0){let r=null!==(l=null==u?void 0:u.length)&&void 0!==l?l:0;if(u||(u=new Array(c)),u.length!==c){if(Array.isArray(u))u.length=c;else{const t=i||u instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);t.set(u),u=t}t&&t.determinant()<0&&d._FlipFaces(u,0,r)}let n=this.positions?this.positions.length/3:0;for(const[t,i]of e)if(t.indices){for(let e=0;e<t.indices.length;e++)u[r+e]=t.indices[e]+n;i&&i.determinant()<0&&d._FlipFaces(u,r,t.indices.length),n+=t.positions.length/3,r+=t.indices.length,s&&(yield)}}return this.indices=u,this.positions=d._MergeElement(n.o.PositionKind,this.positions,t,e.map((t=>[t[0].positions,t[1]]))),s&&(yield),this.normals=d._MergeElement(n.o.NormalKind,this.normals,t,e.map((t=>[t[0].normals,t[1]]))),s&&(yield),this.tangents=d._MergeElement(n.o.TangentKind,this.tangents,t,e.map((t=>[t[0].tangents,t[1]]))),s&&(yield),this.uvs=d._MergeElement(n.o.UVKind,this.uvs,t,e.map((t=>[t[0].uvs,t[1]]))),s&&(yield),this.uvs2=d._MergeElement(n.o.UV2Kind,this.uvs2,t,e.map((t=>[t[0].uvs2,t[1]]))),s&&(yield),this.uvs3=d._MergeElement(n.o.UV3Kind,this.uvs3,t,e.map((t=>[t[0].uvs3,t[1]]))),s&&(yield),this.uvs4=d._MergeElement(n.o.UV4Kind,this.uvs4,t,e.map((t=>[t[0].uvs4,t[1]]))),s&&(yield),this.uvs5=d._MergeElement(n.o.UV5Kind,this.uvs5,t,e.map((t=>[t[0].uvs5,t[1]]))),s&&(yield),this.uvs6=d._MergeElement(n.o.UV6Kind,this.uvs6,t,e.map((t=>[t[0].uvs6,t[1]]))),s&&(yield),this.colors=d._MergeElement(n.o.ColorKind,this.colors,t,e.map((t=>[t[0].colors,t[1]]))),s&&(yield),this.matricesIndices=d._MergeElement(n.o.MatricesIndicesKind,this.matricesIndices,t,e.map((t=>[t[0].matricesIndices,t[1]]))),s&&(yield),this.matricesWeights=d._MergeElement(n.o.MatricesWeightsKind,this.matricesWeights,t,e.map((t=>[t[0].matricesWeights,t[1]]))),s&&(yield),this.matricesIndicesExtra=d._MergeElement(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,e.map((t=>[t[0].matricesIndicesExtra,t[1]]))),s&&(yield),this.matricesWeightsExtra=d._MergeElement(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,e.map((t=>[t[0].matricesWeightsExtra,t[1]]))),this}static _MergeElement(t,e,i,s){const r=s.filter((t=>null!==t[0]&&void 0!==t[0]));if(!e&&0==r.length)return e;if(!e)return this._MergeElement(t,r[0][0],r[0][1],r.slice(1));const o=r.reduce(((t,e)=>t+e[0].length),e.length),h=t===n.o.PositionKind?d._TransformVector3Coordinates:t===n.o.NormalKind?d._TransformVector3Normals:t===n.o.TangentKind?d._TransformVector4Normals:()=>{};if(e instanceof Float32Array){const t=new Float32Array(o);t.set(e),i&&h(t,i,0,e.length);let s=e.length;for(const[e,i]of r)t.set(e,s),i&&h(t,i,s,e.length),s+=e.length;return t}{const t=new Array(o);for(let i=0;i<e.length;i++)t[i]=e[i];i&&h(t,i,0,e.length);let s=e.length;for(const[e,i]of r){for(let i=0;i<e.length;i++)t[s+i]=e[i];i&&h(t,i,s,e.length),s+=e.length}return t}}_validate(){if(!this.positions)throw new c.LH("Positions are required",c.SM.MeshInvalidPositionsError);const t=(t,e)=>{const i=n.o.DeduceStride(t);if(e.length%i!=0)throw new Error("The "+t+"s array count must be a multiple of "+i);return e.length/i},e=t(n.o.PositionKind,this.positions),i=(i,s)=>{const r=t(i,s);if(r!==e)throw new Error("The "+i+"s element count ("+r+") does not match the positions count ("+e+")")};this.normals&&i(n.o.NormalKind,this.normals),this.tangents&&i(n.o.TangentKind,this.tangents),this.uvs&&i(n.o.UVKind,this.uvs),this.uvs2&&i(n.o.UV2Kind,this.uvs2),this.uvs3&&i(n.o.UV3Kind,this.uvs3),this.uvs4&&i(n.o.UV4Kind,this.uvs4),this.uvs5&&i(n.o.UV5Kind,this.uvs5),this.uvs6&&i(n.o.UV6Kind,this.uvs6),this.colors&&i(n.o.ColorKind,this.colors),this.matricesIndices&&i(n.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(n.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}serialize(){const t={};return this.positions&&(t.positions=this.positions),this.normals&&(t.normals=this.normals),this.tangents&&(t.tangents=this.tangents),this.uvs&&(t.uvs=this.uvs),this.uvs2&&(t.uvs2=this.uvs2),this.uvs3&&(t.uvs3=this.uvs3),this.uvs4&&(t.uvs4=this.uvs4),this.uvs5&&(t.uvs5=this.uvs5),this.uvs6&&(t.uvs6=this.uvs6),this.colors&&(t.colors=this.colors),this.matricesIndices&&(t.matricesIndices=this.matricesIndices,t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(t.matricesIndicesExtra=this.matricesIndicesExtra,t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=this.matricesWeightsExtra),t.indices=this.indices,t}static ExtractFromMesh(t,e,i){return d._ExtractFrom(t,e,i)}static ExtractFromGeometry(t,e,i){return d._ExtractFrom(t,e,i)}static _ExtractFrom(t,e,i){const s=new d;return t.isVerticesDataPresent(n.o.PositionKind)&&(s.positions=t.getVerticesData(n.o.PositionKind,e,i)),t.isVerticesDataPresent(n.o.NormalKind)&&(s.normals=t.getVerticesData(n.o.NormalKind,e,i)),t.isVerticesDataPresent(n.o.TangentKind)&&(s.tangents=t.getVerticesData(n.o.TangentKind,e,i)),t.isVerticesDataPresent(n.o.UVKind)&&(s.uvs=t.getVerticesData(n.o.UVKind,e,i)),t.isVerticesDataPresent(n.o.UV2Kind)&&(s.uvs2=t.getVerticesData(n.o.UV2Kind,e,i)),t.isVerticesDataPresent(n.o.UV3Kind)&&(s.uvs3=t.getVerticesData(n.o.UV3Kind,e,i)),t.isVerticesDataPresent(n.o.UV4Kind)&&(s.uvs4=t.getVerticesData(n.o.UV4Kind,e,i)),t.isVerticesDataPresent(n.o.UV5Kind)&&(s.uvs5=t.getVerticesData(n.o.UV5Kind,e,i)),t.isVerticesDataPresent(n.o.UV6Kind)&&(s.uvs6=t.getVerticesData(n.o.UV6Kind,e,i)),t.isVerticesDataPresent(n.o.ColorKind)&&(s.colors=t.getVerticesData(n.o.ColorKind,e,i)),t.isVerticesDataPresent(n.o.MatricesIndicesKind)&&(s.matricesIndices=t.getVerticesData(n.o.MatricesIndicesKind,e,i)),t.isVerticesDataPresent(n.o.MatricesWeightsKind)&&(s.matricesWeights=t.getVerticesData(n.o.MatricesWeightsKind,e,i)),t.isVerticesDataPresent(n.o.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=t.getVerticesData(n.o.MatricesIndicesExtraKind,e,i)),t.isVerticesDataPresent(n.o.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=t.getVerticesData(n.o.MatricesWeightsExtraKind,e,i)),s.indices=t.getIndices(e,i),s}static CreateRibbon(t){throw(0,o.S)("ribbonBuilder")}static CreateBox(t){throw(0,o.S)("boxBuilder")}static CreateTiledBox(t){throw(0,o.S)("tiledBoxBuilder")}static CreateTiledPlane(t){throw(0,o.S)("tiledPlaneBuilder")}static CreateSphere(t){throw(0,o.S)("sphereBuilder")}static CreateCylinder(t){throw(0,o.S)("cylinderBuilder")}static CreateTorus(t){throw(0,o.S)("torusBuilder")}static CreateLineSystem(t){throw(0,o.S)("linesBuilder")}static CreateDashedLines(t){throw(0,o.S)("linesBuilder")}static CreateGround(t){throw(0,o.S)("groundBuilder")}static CreateTiledGround(t){throw(0,o.S)("groundBuilder")}static CreateGroundFromHeightMap(t){throw(0,o.S)("groundBuilder")}static CreatePlane(t){throw(0,o.S)("planeBuilder")}static CreateDisc(t){throw(0,o.S)("discBuilder")}static CreatePolygon(t,e,i,s,r,n,h){throw(0,o.S)("polygonBuilder")}static CreateIcoSphere(t){throw(0,o.S)("icoSphereBuilder")}static CreatePolyhedron(t){throw(0,o.S)("polyhedronBuilder")}static CreateCapsule(t={orientation:r.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw(0,o.S)("capsuleBuilder")}static CreateTorusKnot(t){throw(0,o.S)("torusKnotBuilder")}static ComputeNormals(t,e,i,s){let n=0,o=0,h=0,a=0,l=0,_=0,c=0,d=0,u=0,g=0,f=0,p=0,m=0,x=0,b=0,I=0,T=0,M=0,C=0,y=0,A=!1,v=!1,O=!1,E=!1,S=1,D=0,w=null;s&&(A=!!s.facetNormals,v=!!s.facetPositions,O=!!s.facetPartitioning,S=!0===s.useRightHandedSystem?-1:1,D=s.ratio||0,E=!!s.depthSort,w=s.distanceTo,E&&void 0===w&&(w=r.P.Zero()));let R=0,P=0,L=0,k=0;for(O&&s&&s.bbSize&&(R=s.subDiv.X*D/s.bbSize.x,P=s.subDiv.Y*D/s.bbSize.y,L=s.subDiv.Z*D/s.bbSize.z,k=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0),n=0;n<t.length;n++)i[n]=0;const N=e.length/3|0;for(n=0;n<N;n++){if(p=3*e[3*n],m=p+1,x=p+2,b=3*e[3*n+1],I=b+1,T=b+2,M=3*e[3*n+2],C=M+1,y=M+2,o=t[p]-t[b],h=t[m]-t[I],a=t[x]-t[T],l=t[M]-t[b],_=t[C]-t[I],c=t[y]-t[T],d=S*(h*c-a*_),u=S*(a*l-o*c),g=S*(o*_-h*l),f=Math.sqrt(d*d+u*u+g*g),f=0===f?1:f,d/=f,u/=f,g/=f,A&&s&&(s.facetNormals[n].x=d,s.facetNormals[n].y=u,s.facetNormals[n].z=g),v&&s&&(s.facetPositions[n].x=(t[p]+t[b]+t[M])/3,s.facetPositions[n].y=(t[m]+t[I]+t[C])/3,s.facetPositions[n].z=(t[x]+t[T]+t[y])/3),O&&s){const e=Math.floor((s.facetPositions[n].x-s.bInfo.minimum.x*D)*R),i=Math.floor((s.facetPositions[n].y-s.bInfo.minimum.y*D)*P),r=Math.floor((s.facetPositions[n].z-s.bInfo.minimum.z*D)*L),o=Math.floor((t[p]-s.bInfo.minimum.x*D)*R),h=Math.floor((t[m]-s.bInfo.minimum.y*D)*P),a=Math.floor((t[x]-s.bInfo.minimum.z*D)*L),l=Math.floor((t[b]-s.bInfo.minimum.x*D)*R),_=Math.floor((t[I]-s.bInfo.minimum.y*D)*P),c=Math.floor((t[T]-s.bInfo.minimum.z*D)*L),d=Math.floor((t[M]-s.bInfo.minimum.x*D)*R),u=Math.floor((t[C]-s.bInfo.minimum.y*D)*P),g=Math.floor((t[y]-s.bInfo.minimum.z*D)*L),f=o+s.subDiv.max*h+k*a,A=l+s.subDiv.max*_+k*c,v=d+s.subDiv.max*u+k*g,O=e+s.subDiv.max*i+k*r;s.facetPartitioning[O]=s.facetPartitioning[O]?s.facetPartitioning[O]:new Array,s.facetPartitioning[f]=s.facetPartitioning[f]?s.facetPartitioning[f]:new Array,s.facetPartitioning[A]=s.facetPartitioning[A]?s.facetPartitioning[A]:new Array,s.facetPartitioning[v]=s.facetPartitioning[v]?s.facetPartitioning[v]:new Array,s.facetPartitioning[f].push(n),A!=f&&s.facetPartitioning[A].push(n),v!=A&&v!=f&&s.facetPartitioning[v].push(n),O!=f&&O!=A&&O!=v&&s.facetPartitioning[O].push(n)}if(E&&s&&s.facetPositions){const t=s.depthSortedFacets[n];t.ind=3*n,t.sqDistance=r.P.DistanceSquared(s.facetPositions[n],w)}i[p]+=d,i[m]+=u,i[x]+=g,i[b]+=d,i[I]+=u,i[T]+=g,i[M]+=d,i[C]+=u,i[y]+=g}for(n=0;n<i.length/3;n++)d=i[3*n],u=i[3*n+1],g=i[3*n+2],f=Math.sqrt(d*d+u*u+g*g),f=0===f?1:f,d/=f,u/=f,g/=f,i[3*n]=d,i[3*n+1]=u,i[3*n+2]=g}static _ComputeSides(t,e,i,s,n,o,h){const a=i.length,l=s.length;let _,c;switch(t=t||d.DEFAULTSIDE){case d.FRONTSIDE:break;case d.BACKSIDE:for(_=0;_<a;_+=3){const t=i[_];i[_]=i[_+2],i[_+2]=t}for(c=0;c<l;c++)s[c]=-s[c];break;case d.DOUBLESIDE:{const t=e.length,d=t/3;for(let i=0;i<t;i++)e[t+i]=e[i];for(_=0;_<a;_+=3)i[_+a]=i[_+2]+d,i[_+1+a]=i[_+1]+d,i[_+2+a]=i[_]+d;for(c=0;c<l;c++)s[l+c]=-s[c];const u=n.length;let g=0;for(g=0;g<u;g++)n[g+u]=n[g];for(o=o||new r.Lt(0,0,1,1),h=h||new r.Lt(0,0,1,1),g=0,_=0;_<u/2;_++)n[g]=o.x+(o.z-o.x)*n[g],n[g+1]=o.y+(o.w-o.y)*n[g+1],n[g+u]=h.x+(h.z-h.x)*n[g+u],n[g+u+1]=h.y+(h.w-h.y)*n[g+u+1],g+=2;break}}}static ImportVertexData(t,e){const i=new d,s=t.positions;s&&i.set(s,n.o.PositionKind);const r=t.normals;r&&i.set(r,n.o.NormalKind);const o=t.tangents;o&&i.set(o,n.o.TangentKind);const a=t.uvs;a&&i.set(a,n.o.UVKind);const l=t.uv2s;l&&i.set(l,n.o.UV2Kind);const _=t.uv3s;_&&i.set(_,n.o.UV3Kind);const c=t.uv4s;c&&i.set(c,n.o.UV4Kind);const u=t.uv5s;u&&i.set(u,n.o.UV5Kind);const g=t.uv6s;g&&i.set(g,n.o.UV6Kind);const f=t.colors;f&&i.set(h.HE.CheckColors4(f,s.length/3),n.o.ColorKind);const p=t.matricesIndices;p&&i.set(p,n.o.MatricesIndicesKind);const m=t.matricesWeights;m&&i.set(m,n.o.MatricesWeightsKind);const x=t.indices;x&&(i.indices=x),e.setAllVerticesData(i,t.updatable)}}d.FRONTSIDE=0,d.BACKSIDE=1,d.DOUBLESIDE=2,d.DEFAULTSIDE=0,(0,s.gn)([l.G6.filter(((...[t])=>!Array.isArray(t)))],d,"_TransformVector3Coordinates",null),(0,s.gn)([l.G6.filter(((...[t])=>!Array.isArray(t)))],d,"_TransformVector3Normals",null),(0,s.gn)([l.G6.filter(((...[t])=>!Array.isArray(t)))],d,"_TransformVector4Normals",null),(0,s.gn)([l.G6.filter(((...[t])=>!Array.isArray(t)))],d,"_FlipFaces",null)},4179:(t,e,i)=>{i.d(e,{Y:()=>l});var s=i(1069),r=i(8137),n=i(8139),o=i(5412),h=i(6387),a=i(5241);class l extends h.N{get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=0!=(this._billboardMode&l.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)}constructor(t,e=null,i=!0){super(t,e),this._forward=new o.P(0,0,1),this._up=new o.P(0,1,0),this._right=new o.P(1,0,0),this._position=o.P.Zero(),this._rotation=o.P.Zero(),this._rotationQuaternion=null,this._scaling=o.P.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=l.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=o.y3.Zero(),this._usePivotMatrix=!1,this._absolutePosition=o.P.Zero(),this._absoluteScaling=o.P.Zero(),this._absoluteRotationQuaternion=o._f.Identity(),this._pivotMatrix=o.y3.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new n.y$,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(t){this._position=t,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(t){this._scaling=t,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return o.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return o.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return o.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=o.y3.Identity()),this._poseMatrix}_isSynchronized(){const t=this._cache;return!(this._billboardMode!==t.billboardMode||this._billboardMode!==l.BILLBOARDMODE_NONE||t.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1,t.useBillboardPosition=!1,t.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(t){return this.setPivotMatrix(t,!1)}setPivotMatrix(t,e=!0){return this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=e,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.y3.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(t=null,e,i){const s=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);s&&i&&i(this,s);for(const t of this.getChildTransformNodes(!0))t.instantiateHierarchy(s,e,i);return s}freezeWorldMatrix(t=null,e=!1){return t?e?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||o._f.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=t,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(t){if(!t)return this;let e,i,s;if(void 0===t.x){if(arguments.length<3)return this;e=arguments[0],i=arguments[1],s=arguments[2]}else e=t.x,i=t.y,s=t.z;if(this.parent){const t=o.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),o.P.TransformCoordinatesFromFloatsToRef(e,i,s,t,this.position)}else this.position.x=e,this.position.y=i,this.position.z=s;return this._absolutePosition.copyFrom(t),this}setPositionWithLocalVector(t){return this.computeWorldMatrix(),this.position=o.P.TransformNormal(t,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const t=o.jp.Matrix[0];return this._localMatrix.invertToRef(t),o.P.TransformNormal(this.position,t)}locallyTranslate(t){return this.computeWorldMatrix(!0),this.position=o.P.TransformCoordinates(t,this._localMatrix),this}lookAt(t,e=0,i=0,s=0,r=a.T.LOCAL){const n=l._LookAtVectorCache,h=r===a.T.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(h,n),this.setDirection(n,e,i,s),r===a.T.WORLD&&this.parent)if(this.rotationQuaternion){const t=o.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(t);const e=o.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.invert(),t.multiplyToRef(e,t),this.rotationQuaternion.fromRotationMatrix(t)}else{const t=o.jp.Quaternion[0];o._f.FromEulerVectorToRef(this.rotation,t);const e=o.jp.Matrix[0];t.toRotationMatrix(e);const i=o.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),e.multiplyToRef(i,e),t.fromRotationMatrix(e),t.toEulerAnglesToRef(this.rotation)}return this}getDirection(t){const e=o.P.Zero();return this.getDirectionToRef(t,e),e}getDirectionToRef(t,e){return o.P.TransformNormalToRef(t,this.getWorldMatrix(),e),this}setDirection(t,e=0,i=0,s=0){const r=-Math.atan2(t.z,t.x)+Math.PI/2,n=Math.sqrt(t.x*t.x+t.z*t.z),h=-Math.atan2(t.y,n);return this.rotationQuaternion?o._f.RotationYawPitchRollToRef(r+e,h+i,s,this.rotationQuaternion):(this.rotation.x=h+i,this.rotation.y=r+e,this.rotation.z=s),this}setPivotPoint(t,e=a.T.LOCAL){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const i=this.getWorldMatrix();if(e==a.T.WORLD){const e=o.jp.Matrix[0];i.invertToRef(e),t=o.P.TransformCoordinates(t,e)}return this.setPivotMatrix(o.y3.Translation(-t.x,-t.y,-t.z),!0)}getPivotPoint(){const t=o.P.Zero();return this.getPivotPointToRef(t),t}getPivotPointToRef(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const t=o.P.Zero();return this.getAbsolutePivotPointToRef(t),t}getAbsolutePivotPointToRef(t){return this.getPivotPointToRef(t),o.P.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this}markAsDirty(t){if(this._isDirty)return this;if(this._children)for(const e of this._children)e.markAsDirty(t);return super.markAsDirty(t)}setParent(t,e=!1,i=!1){if(!t&&!this.parent)return this;const s=o.jp.Quaternion[0],r=o.jp.Vector3[0],n=o.jp.Vector3[1],h=o.jp.Matrix[1];o.y3.IdentityToRef(h);const a=o.jp.Matrix[0];this.computeWorldMatrix(!0);let _=this.rotationQuaternion;return _||(_=l._TmpRotation,o._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,_)),o.y3.ComposeToRef(this.scaling,_,this.position,a),this.parent&&a.multiplyToRef(this.parent.computeWorldMatrix(!0),a),t&&(t.computeWorldMatrix(!0).invertToRef(h),a.multiplyToRef(h,a)),a.decompose(n,s,r,e?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(n),this.position.copyFrom(r),this.parent=t,i&&this.setPivotMatrix(o.y3.Identity()),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)}attachToBone(t,e){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=e,this.parent=t,t.getSkeleton().prepare(),t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(t=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=t?this._currentParentWhenAttachingToBone:null,this):(t&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(t,e,i){let s;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==a.T.LOCAL){if(this.parent){const e=o.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),t=o.P.TransformNormal(t,e)}s=o._f.RotationAxisToRef(t,e,l._RotationAxisCache),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else s=o._f.RotationAxisToRef(t,e,l._RotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);return this}rotateAround(t,e,i){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const s=o.jp.Vector3[0],r=o.jp.Vector3[1],n=o.jp.Vector3[2],h=o.jp.Quaternion[0],a=o.jp.Matrix[0],l=o.jp.Matrix[1],_=o.jp.Matrix[2],c=o.jp.Matrix[3];return t.subtractToRef(this.position,s),o.y3.TranslationToRef(s.x,s.y,s.z,a),o.y3.TranslationToRef(-s.x,-s.y,-s.z,l),o.y3.RotationAxisToRef(e,i,_),l.multiplyToRef(_,c),c.multiplyToRef(a,c),c.decompose(r,h,n),this.position.addInPlace(n),h.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(t,e,i){const s=t.scale(e);if(i&&i!==a.T.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(s));else{const t=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(t)}return this}addRotation(t,e,i){let s;this.rotationQuaternion?s=this.rotationQuaternion:(s=o.jp.Quaternion[1],o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));const r=o.jp.Quaternion[0];return o._f.RotationYawPitchRollToRef(e,t,i,r),s.multiplyInPlace(r),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(t=!1,e=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const i=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;e=e||this.getScene().activeCamera,this._updateCache();const s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,s.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const r=this._getEffectiveParent(),n=l._TmpScaling;let h,a=this._position;if(this._infiniteDistance&&!this.parent&&e){const t=e.getWorldMatrix(),i=new o.P(t.m[12],t.m[13],t.m[14]);a=l._TmpTranslation,a.copyFromFloats(this._position.x+i.x,this._position.y+i.y,this._position.z+i.z)}if(n.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,h=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(o._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(h=l._TmpRotation,o._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),this._usePivotMatrix){const t=o.jp.Matrix[1];o.y3.ScalingToRef(n.x,n.y,n.z,t);const e=o.jp.Matrix[0];h.toRotationMatrix(e),this._pivotMatrix.multiplyToRef(t,o.jp.Matrix[4]),o.jp.Matrix[4].multiplyToRef(e,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(a.x,a.y,a.z)}else o.y3.ComposeToRef(n,h,a,this._localMatrix);if(r&&r.getWorldMatrix){if(t&&r.computeWorldMatrix(t),s.useBillboardPath){this._transformToBoneReferal?r.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.jp.Matrix[7]):o.jp.Matrix[7].copyFrom(r.getWorldMatrix());const t=o.jp.Vector3[5],e=o.jp.Vector3[6],i=o.jp.Quaternion[0];o.jp.Matrix[7].decompose(e,i,t),o.y3.ScalingToRef(e.x,e.y,e.z,o.jp.Matrix[7]),o.jp.Matrix[7].setTranslation(t),l.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(i,t),this._localMatrix.setTranslation(t)),this._localMatrix.multiplyToRef(o.jp.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(r.getWorldMatrix(),o.jp.Matrix[6]),o.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s.useBillboardPath&&e&&this.billboardMode&&!s.useBillboardPosition){const t=o.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(t),o.jp.Matrix[1].copyFrom(e.getViewMatrix()),o.jp.Matrix[1].setTranslationFromFloats(0,0,0),o.jp.Matrix[1].invertToRef(o.jp.Matrix[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){o.jp.Matrix[0].decompose(void 0,o.jp.Quaternion[0],void 0);const t=o.jp.Vector3[1];o.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(t.z=0),o.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,o.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.jp.Vector3[0])}else if(s.useBillboardPath&&e&&s.useBillboardPosition){const t=o.jp.Vector3[0];this._worldMatrix.getTranslationToRef(t);const i=e.globalPosition;this._worldMatrix.invertToRef(o.jp.Matrix[1]);const s=o.jp.Vector3[1];o.P.TransformCoordinatesToRef(i,o.jp.Matrix[1],s),s.normalize();const r=-Math.atan2(s.z,s.x)+Math.PI/2,n=Math.sqrt(s.x*s.x+s.z*s.z),h=-Math.atan2(s.y,n);if(o._f.RotationYawPitchRollToRef(r,h,0,o.jp.Quaternion[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){const t=o.jp.Vector3[1];o.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(t.z=0),o.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,o.jp.Matrix[0])}else o.y3.FromQuaternionToRef(o.jp.Quaternion[0],o.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):r&&r._nonUniformScaling?this._updateNonUniformScalingState(r._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(t=!0){if(this.computeWorldMatrix(),t){const t=this.getChildren();for(let e=0;e<t.length;++e){const i=t[e];if(i){i.computeWorldMatrix();const t=o.jp.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,t);const e=o.jp.Quaternion[0];t.decompose(i.scaling,e,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(e):e.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=o._f.Identity()),this._worldMatrix=o.y3.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this}unregisterAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this}getPositionInCameraSpace(t=null){return t||(t=this.getScene().activeCamera),o.P.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())}getDistanceToCamera(t=null){return t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()}clone(t,e,i){const s=r.p4.Clone((()=>new l(t,this.getScene())),this);if(s.name=t,s.id=t,e&&(s.parent=e),!i){const e=this.getDescendants(!0);for(let i=0;i<e.length;i++){const r=e[i];r.clone&&r.clone(t+"."+r.name,s)}}return s}serialize(t){const e=r.p4.Serialize(this,t);return e.type=this.getClassName(),e.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(e),e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(),e}static Parse(t,e,i){const s=r.p4.Parse((()=>new l(t.name,e)),t,e,i);return t.localMatrix?s.setPreTransformMatrix(o.y3.FromArray(t.localMatrix)):t.pivotMatrix&&s.setPivotMatrix(o.y3.FromArray(t.pivotMatrix)),s.setEnabled(t.isEnabled),s._waitingParsedUniqueId=t.uniqueId,void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),s}getChildTransformNodes(t,e){const i=[];return this._getDescendants(i,t,(t=>(!e||e(t))&&t instanceof l)),i}dispose(t,e=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const t=this._parentContainer.transformNodes.indexOf(this);t>-1&&this._parentContainer.transformNodes.splice(t,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t){const t=this.getChildTransformNodes(!0);for(const e of t)e.parent=null,e.computeWorldMatrix(!0)}super.dispose(t,e)}normalizeToUnitCube(t=!0,e=!1,i){let s=null,r=null;e&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const n=this.getHierarchyBoundingVectors(t,i),o=n.max.subtract(n.min),h=Math.max(o.x,o.y,o.z);if(0===h)return this;const a=1/h;return this.scaling.scaleInPlace(a),e&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&s&&this.rotation.copyFrom(s)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}l.BILLBOARDMODE_NONE=0,l.BILLBOARDMODE_X=1,l.BILLBOARDMODE_Y=2,l.BILLBOARDMODE_Z=4,l.BILLBOARDMODE_ALL=7,l.BILLBOARDMODE_USE_POSITION=128,l.BillboardUseParentOrientation=!1,l._TmpRotation=o._f.Zero(),l._TmpScaling=o.P.Zero(),l._TmpTranslation=o.P.Zero(),l._LookAtVectorCache=new o.P(0,0,0),l._RotationAxisCache=new o._f,(0,s.gn)([(0,r.hd)("position")],l.prototype,"_position",void 0),(0,s.gn)([(0,r.hd)("rotation")],l.prototype,"_rotation",void 0),(0,s.gn)([(0,r.mv)("rotationQuaternion")],l.prototype,"_rotationQuaternion",void 0),(0,s.gn)([(0,r.hd)("scaling")],l.prototype,"_scaling",void 0),(0,s.gn)([(0,r.qC)("billboardMode")],l.prototype,"_billboardMode",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"scalingDeterminant",void 0),(0,s.gn)([(0,r.qC)("infiniteDistance")],l.prototype,"_infiniteDistance",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"ignoreNonUniformScaling",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},140:(t,e,i)=>{function s(t,e,i){try{const s=t.next();s.done?e(s):s.value?s.value.then((()=>{s.value=void 0,e(s)}),i):e(s)}catch(t){i(t)}}function r(t=25){let e;return(i,r,n)=>{const o=performance.now();void 0===e||o-e>t?(e=o,setTimeout((()=>{s(i,r,n)}),0)):s(i,r,n)}}function n(t,e,i,s,r){const n=()=>{let o;const h=t=>{t.done?i(t.value):void 0===o?o=!0:n()};do{o=void 0,r&&r.aborted?s(new Error("Aborted")):e(t,h,s),void 0===o&&(o=!1)}while(o)};n()}function o(t,e){let i;return n(t,s,(t=>i=t),(t=>{throw t}),e),i}function h(t,e,i){return new Promise(((s,r)=>{n(t,e,s,r,i)}))}function a(t,e){return(...i)=>o(t(...i),e)}i.d(e,{KO:()=>r,s3:()=>o,sM:()=>h,vp:()=>a})},6387:(t,e,i)=>{i.d(e,{N:()=>_});var s=i(1069),r=i(5412),n=i(8137),o=i(8139),h=i(5953),a=i(9069);class l{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new o.y$,this._onClonedObservable=new o.y$}}class _{static AddNodeConstructor(t,e){this._NodeConstructors[t]=e}static Construct(t,e,i,s){const r=this._NodeConstructors[t];return r?r(e,i,s):null}set accessibilityTag(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(t){this._nodeDataStorage._doNotSerialize=t}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(t){if(this._parentNode===t)return;const e=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const e=this._parentNode._children.indexOf(this);-1!==e&&this._parentNode._children.splice(e,1),t||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=t,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),e||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(t){t.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const t=this._scene.rootNodes,e=t.length-1;t[this._nodeDataStorage._sceneRootNodesIndex]=t[e],t[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}getClassName(){return"Node"}set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(t,e=null){this._isDirty=!1,this._nodeDataStorage=new l,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new o.y$,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new o.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=e||h.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(t,e=!1){return-1!==this._behaviors.indexOf(t)||(t.init(),this._scene.isLoading&&!e?this._scene.onDataLoadedObservable.addOnce((()=>{t.attach(this)})):t.attach(this),this._behaviors.push(t)),this}removeBehavior(t){const e=this._behaviors.indexOf(t);return-1===e||(this._behaviors[e].detach(),this._behaviors.splice(e,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(t){for(const e of this._behaviors)if(e.name===t)return e;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={},this._cache.parent=void 0}updateCache(t){!t&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}_getActionManagerForTrigger(t,e=!0){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_updateCache(t){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(t=!1){return this._nodeDataStorage._isReady}markAsDirty(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(t=!0){return!1===t?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((t=>{t._syncParentEnabledState()}))}setEnabled(t){this._nodeDataStorage._isEnabled!==t&&(this._nodeDataStorage._isEnabled=t,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(t))}isDescendantOf(t){return!!this.parent&&(this.parent===t||this.parent.isDescendantOf(t))}_getDescendants(t,e=!1,i){if(this._children)for(let s=0;s<this._children.length;s++){const r=this._children[s];i&&!i(r)||t.push(r),e||r._getDescendants(t,!1,i)}}getDescendants(t,e){const i=new Array;return this._getDescendants(i,t,e),i}getChildMeshes(t,e){const i=[];return this._getDescendants(i,t,(t=>(!e||e(t))&&void 0!==t.cullingStrategy)),i}getChildren(t,e=!0){return this.getDescendants(e,t)}_setReady(t){t!==this._nodeDataStorage._isReady&&(t?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(t){for(let e=0;e<this.animations.length;e++){const i=this.animations[e];if(i.name===t)return i}return null}createAnimationRange(t,e,i){if(!this._ranges[t]){this._ranges[t]=_._AnimationRangeFactory(t,e,i);for(let s=0,r=this.animations.length;s<r;s++)this.animations[s]&&this.animations[s].createRange(t,e,i)}}deleteAnimationRange(t,e=!0){for(let i=0,s=this.animations.length;i<s;i++)this.animations[i]&&this.animations[i].deleteRange(t,e);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let e;for(e in this._ranges)t.push(this._ranges[e]);return t}beginAnimation(t,e,i,s){const r=this.getAnimationRange(t);return r?this._scene.beginAnimation(this,r.from,r.to,e,i,s):null}serializeAnimationRanges(){const t=[];for(const e in this._ranges){const i=this._ranges[e];if(!i)continue;const s={};s.name=e,s.from=i.from,s.to=i.to,t.push(s)}return t}computeWorldMatrix(t){return this._worldMatrix||(this._worldMatrix=r.y3.Identity()),this._worldMatrix}dispose(t,e=!1){if(this._nodeDataStorage._isDisposed=!0,!t){const i=this.getDescendants(!0);for(const s of i)s.dispose(t,e)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const t of this._behaviors)t.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(t,e,i){if(e.ranges)for(let i=0;i<e.ranges.length;i++){const s=e.ranges[i];t.createAnimationRange(s.name,s.from,s.to)}}getHierarchyBoundingVectors(t=!0,e=null){let i,s;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const n=this;if(n.getBoundingInfo&&n.subMeshes){const t=n.getBoundingInfo();i=t.boundingBox.minimumWorld.clone(),s=t.boundingBox.maximumWorld.clone()}else i=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t){const t=this.getDescendants(!1);for(const n of t){const t=n;if(t.computeWorldMatrix(!0),e&&!e(t))continue;if(!t.getBoundingInfo||0===t.getTotalVertices())continue;const o=t.getBoundingInfo().boundingBox,h=o.minimumWorld,a=o.maximumWorld;r.P.CheckExtends(h,i,s),r.P.CheckExtends(a,i,s)}}return{min:i,max:s}}}_._AnimationRangeFactory=(t,e,i)=>{throw(0,a.S)("AnimationRange")},_._NodeConstructors={},(0,s.gn)([(0,n.qC)()],_.prototype,"name",void 0),(0,s.gn)([(0,n.qC)()],_.prototype,"id",void 0),(0,s.gn)([(0,n.qC)()],_.prototype,"uniqueId",void 0),(0,s.gn)([(0,n.qC)()],_.prototype,"state",void 0),(0,s.gn)([(0,n.qC)()],_.prototype,"metadata",void 0)},8062:(t,e,i)=>{i.d(e,{z:()=>a});var s=i(5767),r=i(7003),n=i(2701),o=i(9286),h=i(646);class a extends s.A{get image(){return this._image}get textBlock(){return this._textBlock}constructor(t){super(t),this.name=t,this.delegatePickingToChildren=!1,this.thickness=1,this.isPointerBlocker=!0;let e=null;this.pointerEnterAnimation=()=>{e=this.alpha,this.alpha-=.1},this.pointerOutAnimation=()=>{null!==e&&(this.alpha=e)},this.pointerDownAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"Button"}_processPicking(t,e,i,s,r,n,o,h){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!super.contains(t,e))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){const r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(t,e)){i=!0;break}}if(!i)return!1}return this._processObservables(s,t,e,i,r,n,o,h),!0}_onPointerEnter(t,e){return!!super._onPointerEnter(t,e)&&(!this.isReadOnly&&this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)}_onPointerOut(t,e,i=!1){!this.isReadOnly&&this.pointerOutAnimation&&this.pointerOutAnimation(),super._onPointerOut(t,e,i)}_onPointerDown(t,e,i,s,r){return!!super._onPointerDown(t,e,i,s,r)&&(!this.isReadOnly&&this.pointerDownAnimation&&this.pointerDownAnimation(),!0)}_getRectangleFill(t){return this.isEnabled?this._getBackgroundColor(t):this._disabledColor}_onPointerUp(t,e,i,s,r,n){!this.isReadOnly&&this.pointerUpAnimation&&this.pointerUpAnimation(),super._onPointerUp(t,e,i,s,r,n)}serialize(t){super.serialize(t),this._textBlock&&(t.textBlockName=this._textBlock.name),this._image&&(t.imageName=this._image.name)}_parseFromContent(t,e){super._parseFromContent(t,e),t.textBlockName&&(this._textBlock=this.getChildByName(t.textBlockName)),t.imageName&&(this._image=this.getChildByName(t.imageName))}static CreateImageButton(t,e,i){const s=new this(t),h=new n.a(t+"_button",e);h.textWrapping=!0,h.textHorizontalAlignment=r.o.HORIZONTAL_ALIGNMENT_CENTER,h.paddingLeft="20%",s.addControl(h);const a=new o.E(t+"_icon",i);return a.width="20%",a.stretch=o.E.STRETCH_UNIFORM,a.horizontalAlignment=r.o.HORIZONTAL_ALIGNMENT_LEFT,s.addControl(a),s._image=a,s._textBlock=h,s}static CreateImageOnlyButton(t,e){const i=new this(t),s=new o.E(t+"_icon",e);return s.stretch=o.E.STRETCH_FILL,s.horizontalAlignment=r.o.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(s),i._image=s,i}static CreateSimpleButton(t,e){const i=new this(t),s=new n.a(t+"_button",e);return s.textWrapping=!0,s.textHorizontalAlignment=r.o.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(s),i._textBlock=s,i}static CreateImageWithCenterTextButton(t,e,i){const s=new this(t),h=new o.E(t+"_icon",i);h.stretch=o.E.STRETCH_FILL,s.addControl(h);const a=new n.a(t+"_button",e);return a.textWrapping=!0,a.textHorizontalAlignment=r.o.HORIZONTAL_ALIGNMENT_CENTER,s.addControl(a),s._image=h,s._textBlock=a,s}}(0,h.H)("BABYLON.GUI.Button",a)},7034:(t,e,i)=>{i.d(e,{W:()=>g});var s=i(1069),r=i(658),n=i(7003),o=i(8147),h=i(646),a=i(8137),l=i(554),_=i(5356),c=i(8494),d=i(8139),u=i(8658);class g extends n.o{get renderToIntermediateTexture(){return this._renderToIntermediateTexture}set renderToIntermediateTexture(t){this._renderToIntermediateTexture!==t&&(this._renderToIntermediateTexture=t,this._markAsDirty())}get adaptHeightToChildren(){return this._adaptHeightToChildren}set adaptHeightToChildren(t){this._adaptHeightToChildren!==t&&(this._adaptHeightToChildren=t,t&&(this.height="100%"),this._markAsDirty())}get adaptWidthToChildren(){return this._adaptWidthToChildren}set adaptWidthToChildren(t){this._adaptWidthToChildren!==t&&(this._adaptWidthToChildren=t,t&&(this.width="100%"),this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get children(){return this._children}get isReadOnly(){return this._isReadOnly}set isReadOnly(t){this._isReadOnly=t;for(const e of this._children)e.isReadOnly=t}constructor(t){super(t),this.name=t,this._children=new Array,this._measureForChildren=o.U.Empty(),this._background="",this._backgroundGradient=null,this._adaptWidthToChildren=!1,this._adaptHeightToChildren=!1,this._renderToIntermediateTexture=!1,this._intermediateTexture=null,this.logLayoutCycleErrors=!1,this.maxLayoutCycle=3,this.onControlAddedObservable=new d.y$,this.onControlRemovedObservable=new d.y$}_getTypeName(){return"Container"}_flagDescendantsAsMatrixDirty(){for(const t of this.children)t._isClipped=!1,t._markMatrixAsDirty()}getChildByName(t){for(const e of this.children)if(e.name===t)return e;return null}getChildByType(t,e){for(const t of this.children)if(t.typeName===e)return t;return null}containsControl(t){return-1!==this.children.indexOf(t)}addControl(t){return t?(-1!==this._children.indexOf(t)||(t._link(this._host),t._markAllAsDirty(),this._reOrderControl(t),this._markAsDirty(),this.onControlAddedObservable.notifyObservers(t)),this):this}clearControls(){const t=this.children.slice();for(const e of t)this.removeControl(e);return this}removeControl(t){const e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null),t.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(t),this._markAsDirty(),this.onControlRemovedObservable.notifyObservers(t),this}_reOrderControl(t){const e=t.linkedMesh;this.removeControl(t);let i=!1;for(let e=0;e<this._children.length;e++)if(this._children[e].zIndex>t.zIndex){this._children.splice(e,0,t),i=!0;break}i||this._children.push(t),t.parent=this,e&&t.linkWithMesh(e),this._markAsDirty()}_offsetLeft(t){super._offsetLeft(t);for(const e of this._children)e._offsetLeft(t)}_offsetTop(t){super._offsetTop(t);for(const e of this._children)e._offsetTop(t)}_markAllAsDirty(){super._markAllAsDirty();for(let t=0;t<this._children.length;t++)this._children[t]._markAllAsDirty()}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_localDraw(t){(this._background||this._backgroundGradient)&&(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._getBackgroundColor(t),t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.restore())}_link(t){super._link(t);for(const e of this._children)e._link(t)}_beforeLayout(){}_processMeasures(t,e){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(t)||(super._processMeasures(t,e),this._evaluateClippingState(t),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new l.c("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,_.x.NEAREST_SAMPLINGMODE,c.g.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))}_layout(t,e){var i,s;if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);let n=0;e.save(),this._applyStates(e),this._beforeLayout();do{let r=-1,o=-1;if(this._rebuildLayout=!1,this._processMeasures(t,e),!this._isClipped){for(const t of this._children)t._tempParentMeasure.copyFrom(this._measureForChildren),t._layout(this._measureForChildren,e)&&t.isVisible&&!t.notRenderable&&(this.adaptWidthToChildren&&t._width.isPixel&&(r=Math.max(r,t._currentMeasure.width+t._paddingLeftInPixels+t._paddingRightInPixels)),this.adaptHeightToChildren&&t._height.isPixel&&(o=Math.max(o,t._currentMeasure.height+t._paddingTopInPixels+t._paddingBottomInPixels)));this.adaptWidthToChildren&&r>=0&&(r+=this.paddingLeftInPixels+this.paddingRightInPixels,this.width!==r+"px"&&(null===(i=this.parent)||void 0===i||i._markAsDirty(),this.width=r+"px",this._width.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)),this.adaptHeightToChildren&&o>=0&&(o+=this.paddingTopInPixels+this.paddingBottomInPixels,this.height!==o+"px"&&(null===(s=this.parent)||void 0===s||s._markAsDirty(),this.height=o+"px",this._height.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)),this._postMeasure()}n++}while(this._rebuildLayout&&n<this.maxLayoutCycle);return n>=3&&this.logLayoutCycleErrors&&r.Y.Error(`Layout cycle detected in GUI (Container name=${this.name}, uniqueId=${this.uniqueId})`),e.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0}_postMeasure(){}_draw(t,e){const i=this._renderToIntermediateTexture&&this._intermediateTexture,s=i?this._intermediateTexture.getContext():t;i&&(s.save(),s.translate(-this._currentMeasure.left,-this._currentMeasure.top),e?s.clearRect(e.left,e.top,e.width,e.height):s.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(s),t.save(),this.clipChildren&&this._clipForChildren(s);for(const t of this._children)e&&!t._intersectsRect(e)||t._render(s,e);i&&(s.restore(),t.save(),t.globalAlpha=this.alpha,t.drawImage(s.canvas,this._currentMeasure.left,this._currentMeasure.top),t.restore()),t.restore()}getDescendantsToRef(t,e=!1,i){if(this.children)for(let s=0;s<this.children.length;s++){const r=this.children[s];i&&!i(r)||t.push(r),e||r.getDescendantsToRef(t,!1,i)}}_processPicking(t,e,i,s,r,n,o,h){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;const a=super.contains(t,e);if(!a&&this.clipChildren)return!1;for(let a=this._children.length-1;a>=0;a--){const l=this._children[a];if(l._processPicking(t,e,i,s,r,n,o,h))return l.hoverCursor&&this._host._changeCursor(l.hoverCursor),!0}return!!a&&!!this.isHitTestVisible&&this._processObservables(s,t,e,i,r,n,o,h)}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.copyFrom(this._currentMeasure)}serialize(t){if(super.serialize(t),this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient)),this.children.length){t.children=[];for(const e of this.children){const i={};e.serialize(i),t.children.push(i)}}}dispose(){var t;super.dispose();for(let t=this.children.length-1;t>=0;t--)this.children[t].dispose();null===(t=this._intermediateTexture)||void 0===t||t.dispose()}_parseFromContent(t,e){var i;if(super._parseFromContent(t,e),this._link(e),t.backgroundGradient){const e=u.w1.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this._backgroundGradient=new e,null===(i=this._backgroundGradient)||void 0===i||i.parse(t.backgroundGradient)}if(t.children)for(const i of t.children)this.addControl(n.o.Parse(i,e))}isReady(){for(const t of this.children)if(!t.isReady())return!1;return!0}}(0,s.gn)([(0,a.qC)()],g.prototype,"renderToIntermediateTexture",null),(0,s.gn)([(0,a.qC)()],g.prototype,"maxLayoutCycle",void 0),(0,s.gn)([(0,a.qC)()],g.prototype,"adaptHeightToChildren",null),(0,s.gn)([(0,a.qC)()],g.prototype,"adaptWidthToChildren",null),(0,s.gn)([(0,a.qC)()],g.prototype,"background",null),(0,s.gn)([(0,a.qC)()],g.prototype,"backgroundGradient",null),(0,h.H)("BABYLON.GUI.Container",g)},7003:(t,e,i)=>{i.d(e,{o:()=>x});var s=i(1069),r=i(8139),n=i(5412),o=i(27),h=i(658),a=i(8658),l=i(5151),_=i(8147),c=i(4551);class d extends n.FM{constructor(t,e=0){super(t.x,t.y),this.buttonIndex=e}}class u{constructor(t,e,i,s,r,n){this.m=new Float32Array(6),this.fromValues(t,e,i,s,r,n)}fromValues(t,e,i,s,r,n){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=s,this.m[4]=r,this.m[5]=n,this}determinant(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]}invertToRef(t){const e=this.m[0],i=this.m[1],s=this.m[2],r=this.m[3],n=this.m[4],o=this.m[5],h=this.determinant();if(h<c.kn*c.kn)return t.m[0]=0,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[5]=0,this;const a=1/h,l=s*o-r*n,_=i*n-e*o;return t.m[0]=r*a,t.m[1]=-i*a,t.m[2]=-s*a,t.m[3]=e*a,t.m[4]=l*a,t.m[5]=_*a,this}multiplyToRef(t,e){const i=this.m[0],s=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],h=this.m[5],a=t.m[0],l=t.m[1],_=t.m[2],c=t.m[3],d=t.m[4],u=t.m[5];return e.m[0]=i*a+s*_,e.m[1]=i*l+s*c,e.m[2]=r*a+n*_,e.m[3]=r*l+n*c,e.m[4]=o*a+h*_+d,e.m[5]=o*l+h*c+u,this}transformCoordinates(t,e,i){return i.x=t*this.m[0]+e*this.m[2]+this.m[4],i.y=t*this.m[1]+e*this.m[3]+this.m[5],this}static Identity(){return new u(1,0,0,1,0,0)}static IdentityToRef(t){t.m[0]=1,t.m[1]=0,t.m[2]=0,t.m[3]=1,t.m[4]=0,t.m[5]=0}static TranslationToRef(t,e,i){i.fromValues(1,0,0,1,t,e)}static ScalingToRef(t,e,i){i.fromValues(t,0,0,e,0,0)}static RotationToRef(t,e){const i=Math.sin(t),s=Math.cos(t);e.fromValues(s,i,-i,s,0,0)}static ComposeToRef(t,e,i,s,r,n,o){u.TranslationToRef(t,e,u._TempPreTranslationMatrix),u.ScalingToRef(s,r,u._TempScalingMatrix),u.RotationToRef(i,u._TempRotationMatrix),u.TranslationToRef(-t,-e,u._TempPostTranslationMatrix),u._TempPreTranslationMatrix.multiplyToRef(u._TempScalingMatrix,u._TempCompose0),u._TempCompose0.multiplyToRef(u._TempRotationMatrix,u._TempCompose1),n?(u._TempCompose1.multiplyToRef(u._TempPostTranslationMatrix,u._TempCompose2),u._TempCompose2.multiplyToRef(n,o)):u._TempCompose1.multiplyToRef(u._TempPostTranslationMatrix,o)}}u._TempPreTranslationMatrix=u.Identity(),u._TempPostTranslationMatrix=u.Identity(),u._TempRotationMatrix=u.Identity(),u._TempScalingMatrix=u.Identity(),u._TempCompose0=u.Identity(),u._TempCompose1=u.Identity(),u._TempCompose2=u.Identity();class g{static Round(t,e=g.DefaultRoundingPrecision){return Math.round(t*e)/e}}g.DefaultRoundingPrecision=100;var f=i(646),p=i(8137),m=i(5953);class x{get isReadOnly(){return this._isReadOnly}set isReadOnly(t){this._isReadOnly=t}get transformedMeasure(){return this._evaluatedMeasure}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._markAsDirty())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._markAsDirty())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=t,this._markAsDirty())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._markAsDirty())}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}set accessibilityTag(t){this._accessibilityTag=t,this.onAccessibilityTagChangedObservable.notifyObservers(t)}get accessibilityTag(){return this._accessibilityTag}get host(){return this._host}get fontOffset(){return this._fontOffset}set fontOffset(t){this._fontOffset=t}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alphaSet=!0,this._alpha=t,this._markAsDirty())}get highlightLineWidth(){return this._highlightLineWidth}set highlightLineWidth(t){this._highlightLineWidth!==t&&(this._highlightLineWidth=t,this._markAsDirty())}get isHighlighted(){return this._isHighlighted}set isHighlighted(t){this._isHighlighted!==t&&(this._isHighlighted=t,this._markAsDirty())}get highlightColor(){return this._highlightColor}set highlightColor(t){this._highlightColor!==t&&(this._highlightColor=t,this._markAsDirty())}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this._markAsDirty(),this._markMatrixAsDirty())}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this._markAsDirty(),this._markMatrixAsDirty())}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterY(){return this._transformCenterY}set transformCenterY(t){this._transformCenterY!==t&&(this._transformCenterY=t,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterX(){return this._transformCenterX}set transformCenterX(t){this._transformCenterX!==t&&(this._transformCenterX=t,this._markAsDirty(),this._markMatrixAsDirty())}get horizontalAlignment(){return this._horizontalAlignment}set horizontalAlignment(t){this._horizontalAlignment!==t&&(this._horizontalAlignment=t,this._markAsDirty())}get verticalAlignment(){return this._verticalAlignment}set verticalAlignment(t){this._verticalAlignment!==t&&(this._verticalAlignment=t,this._markAsDirty())}get width(){return this._width.toString(this._host)}set width(t){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()}get widthInPixels(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)}set widthInPixels(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!0,this.width=t+"px")}get height(){return this._height.toString(this._host)}set height(t){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()}get heightInPixels(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)}set heightInPixels(t){isNaN(t)||(this._fixedRatioMasterIsWidth=!1,this.height=t+"px")}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this._resetFontCache())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this._resetFontCache())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this._resetFontCache())}get style(){return this._style}set style(t){this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=t,this._style&&(this._styleObserver=this._style.onChangedObservable.add((()=>{this._markAsDirty(),this._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()}get _isFontSizeInPercentage(){return this._fontSize.isPercentage}get fontSizeInPixels(){const t=this._style?this._style._fontSize:this._fontSize;return t.isPixel?t.getValue(this._host):t.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)}set fontSizeInPixels(t){isNaN(t)||(this.fontSize=t+"px")}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&(this._markAsDirty(),this._resetFontCache())}get color(){return this._color}set color(t){this._color!==t&&(this._color=t,this._markAsDirty())}get gradient(){return this._gradient}set gradient(t){this._gradient!==t&&(this._gradient=t,this._markAsDirty())}get zIndex(){return this._zIndex}set zIndex(t){this.zIndex!==t&&(this._zIndex=t,this.parent&&this.parent._reOrderControl(this))}get notRenderable(){return this._doNotRender}set notRenderable(t){this._doNotRender!==t&&(this._doNotRender=t,this._markAsDirty())}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible!==t&&(this._isVisible=t,this._markAsDirty(!0),this.onIsVisibleChangedObservable.notifyObservers(t))}get isDirty(){return this._isDirty}get linkedMesh(){return this._linkedMesh}get descendantsOnlyPadding(){return this._descendantsOnlyPadding}set descendantsOnlyPadding(t){this._descendantsOnlyPadding!==t&&(this._descendantsOnlyPadding=t,this._markAsDirty())}get paddingLeft(){return this._paddingLeft.toString(this._host)}set paddingLeft(t){this._paddingLeft.fromString(t)&&this._markAsDirty()}get paddingLeftInPixels(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingLeftInPixels(t){isNaN(t)||(this.paddingLeft=t+"px")}get _paddingLeftInPixels(){return this._descendantsOnlyPadding?0:this.paddingLeftInPixels}get paddingRight(){return this._paddingRight.toString(this._host)}set paddingRight(t){this._paddingRight.fromString(t)&&this._markAsDirty()}get paddingRightInPixels(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingRightInPixels(t){isNaN(t)||(this.paddingRight=t+"px")}get _paddingRightInPixels(){return this._descendantsOnlyPadding?0:this.paddingRightInPixels}get paddingTop(){return this._paddingTop.toString(this._host)}set paddingTop(t){this._paddingTop.fromString(t)&&this._markAsDirty()}get paddingTopInPixels(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingTopInPixels(t){isNaN(t)||(this.paddingTop=t+"px")}get _paddingTopInPixels(){return this._descendantsOnlyPadding?0:this.paddingTopInPixels}get paddingBottom(){return this._paddingBottom.toString(this._host)}set paddingBottom(t){this._paddingBottom.fromString(t)&&this._markAsDirty()}get paddingBottomInPixels(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingBottomInPixels(t){isNaN(t)||(this.paddingBottom=t+"px")}get _paddingBottomInPixels(){return this._descendantsOnlyPadding?0:this.paddingBottomInPixels}get left(){return this._left.toString(this._host)}set left(t){this._left.fromString(t)&&this._markAsDirty()}get leftInPixels(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)}set leftInPixels(t){isNaN(t)||(this.left=t+"px")}get top(){return this._top.toString(this._host)}set top(t){this._top.fromString(t)&&this._markAsDirty()}get topInPixels(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)}set topInPixels(t){isNaN(t)||(this.top=t+"px")}get linkOffsetX(){return this._linkOffsetX.toString(this._host)}set linkOffsetX(t){this._linkOffsetX.fromString(t)&&this._markAsDirty()}get linkOffsetXInPixels(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)}set linkOffsetXInPixels(t){isNaN(t)||(this.linkOffsetX=t+"px")}get linkOffsetY(){return this._linkOffsetY.toString(this._host)}set linkOffsetY(t){this._linkOffsetY.fromString(t)&&this._markAsDirty()}get linkOffsetYInPixels(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)}set linkOffsetYInPixels(t){isNaN(t)||(this.linkOffsetY=t+"px")}get centerX(){return this._currentMeasure.left+this._currentMeasure.width/2}get centerY(){return this._currentMeasure.top+this._currentMeasure.height/2}get isEnabled(){return this._isEnabled}set isEnabled(t){if(this._isEnabled===t)return;this._isEnabled=t,this._markAsDirty();const e=t=>{if(t.host){for(const e in t.host._lastControlOver)t===this.host._lastControlOver[e]&&(t._onPointerOut(t,null,!0),delete t.host._lastControlOver[e]);void 0!==t.children&&t.children.forEach(e)}};e(this)}get disabledColor(){return this._disabledColor}set disabledColor(t){this._disabledColor!==t&&(this._disabledColor=t,this._markAsDirty())}get disabledColorItem(){return this._disabledColorItem}set disabledColorItem(t){this._disabledColorItem!==t&&(this._disabledColorItem=t,this._markAsDirty())}constructor(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=_.U.Empty(),this._tempPaddingMeasure=_.U.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new l.s(18,l.s.UNITMODE_PIXEL,!1),this._width=new l.s(1,l.s.UNITMODE_PERCENTAGE,!1),this._height=new l.s(1,l.s.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=_.U.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=_.U.Empty(),this._cachedParentMeasure=_.U.Empty(),this._descendantsOnlyPadding=!1,this._paddingLeft=new l.s(0),this._paddingRight=new l.s(0),this._paddingTop=new l.s(0),this._paddingBottom=new l.s(0),this._left=new l.s(0),this._top=new l.s(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=u.Identity(),this._invertTransformMatrix=u.Identity(),this._transformedPosition=n.FM.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightColor="#4affff",this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=n.FM.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._evaluatedMeasure=new _.U(0,0,0,0),this._evaluatedParentMeasure=new _.U(0,0,0,0),this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._isReadOnly=!1,this._gradient=null,this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new l.s(0),this._linkOffsetY=new l.s(0),this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new r.y$,this.onWheelObservable=new r.y$,this.onPointerMoveObservable=new r.y$,this.onPointerOutObservable=new r.y$,this.onPointerDownObservable=new r.y$,this.onPointerUpObservable=new r.y$,this.onPointerClickObservable=new r.y$,this.onPointerEnterObservable=new r.y$,this.onDirtyObservable=new r.y$,this.onBeforeDrawObservable=new r.y$,this.onAfterDrawObservable=new r.y$,this.onDisposeObservable=new r.y$,this.onIsVisibleChangedObservable=new r.y$,this.fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this.animations=null,this._tmpMeasureA=new _.U(0,0,0,0)}_getTypeName(){return"Control"}getAscendantOfClass(t){return this.parent?this.parent.getClassName()===t?this.parent:this.parent.getAscendantOfClass(t):null}markAsDirty(t=!1){this._markAsDirty(t)}markAllAsDirty(){this._markAllAsDirty()}_resetFontCache(){this._fontSet=!0,this._markAsDirty()}isAscendant(t){return!!this.parent&&(this.parent===t||this.parent.isAscendant(t))}getLocalCoordinates(t){const e=n.FM.Zero();return this.getLocalCoordinatesToRef(t,e),e}getLocalCoordinatesToRef(t,e){return e.x=t.x-this._currentMeasure.left,e.y=t.y-this._currentMeasure.top,this}getParentLocalCoordinates(t){const e=n.FM.Zero();return e.x=t.x-this._cachedParentMeasure.left,e.y=t.y-this._cachedParentMeasure.top,e}moveToVector3(t,e){if(!this._host||this.parent!==this._host._rootContainer)return void a.w1.Error("Cannot move a control to a vector3 if the control is not at root level");this.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP;const i=this._host._getGlobalViewport(),s=n.P.Project(t,n.y3.Identity(),e.getTransformMatrix(),i);this._moveToProjectedPosition(s),s.z<0||s.z>1?this.notRenderable=!0:this.notRenderable=!1}getDescendantsToRef(t,e=!1,i){}getDescendants(t,e){const i=new Array;return this.getDescendantsToRef(i,t,e),i}linkWithMesh(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)return void(t&&a.w1.Error("Cannot link a control to a mesh if the control is not at root level"));const e=this._host._linkedControls.indexOf(this);if(-1!==e)return this._linkedMesh=t,void(t||this._host._linkedControls.splice(e,1));t&&(this.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this))}setPadding(t,e,i,s){const r=t,n=null!=e?e:r,o=null!=i?i:r,h=null!=s?s:n;this.paddingTop=r,this.paddingRight=n,this.paddingBottom=o,this.paddingLeft=h}setPaddingInPixels(t,e,i,s){const r=t,n=null!=e?e:r,o=null!=i?i:r,h=null!=s?s:n;this.paddingTopInPixels=r,this.paddingRightInPixels=n,this.paddingBottomInPixels=o,this.paddingLeftInPixels=h}_moveToProjectedPosition(t){var e;const i=this._left.getValue(this._host),s=this._top.getValue(this._host),r=null===(e=this.parent)||void 0===e?void 0:e._currentMeasure;r&&this._processMeasures(r,this._host.getContext());let n=t.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,o=t.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(n-i)<.5&&(n=i),Math.abs(o-s)<.5&&(o=s)),i===n&&s===o||(this.left=n+"px",this.top=o+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty())}_offsetLeft(t){this._isDirty=!0,this._currentMeasure.left+=t}_offsetTop(t){this._isDirty=!0,this._currentMeasure.top+=t}_markMatrixAsDirty(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()}_flagDescendantsAsMatrixDirty(){}_intersectsRect(t,e){return this._transform(e),!(this._evaluatedMeasure.left>=t.left+t.width||this._evaluatedMeasure.top>=t.top+t.height||this._evaluatedMeasure.left+this._evaluatedMeasure.width<=t.left||this._evaluatedMeasure.top+this._evaluatedMeasure.height<=t.top)}_computeAdditionnalOffsetX(){return 0}_computeAdditionnalOffsetY(){return 0}invalidateRect(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),_.U.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);const t=this.shadowOffsetX,e=this.shadowOffsetY,i=Math.max(this._previousShadowBlur,this.shadowBlur),s=Math.min(Math.min(t,0)-2*i,0),r=Math.max(Math.max(t,0)+2*i,0),n=Math.min(Math.min(e,0)-2*i,0),o=Math.max(Math.max(e,0)+2*i,0),h=this._computeAdditionnalOffsetX(),a=this._computeAdditionnalOffsetY();this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+s-h),Math.floor(this._tmpMeasureA.top+n-a),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r+h),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+o+a))}}_markAsDirty(t=!1){(this._isVisible||t)&&(this._isDirty=!0,this._markMatrixAsDirty(),this._host&&this._host.markAsDirty())}_markAllAsDirty(){this._markAsDirty(),this._font&&this._prepareFont()}_link(t){this._host=t,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())}_transform(t){if(!this._isMatrixDirty&&1===this._scaleX&&1===this._scaleY&&0===this._rotation)return;const e=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;t&&(t.translate(e,i),t.rotate(this._rotation),t.scale(this._scaleX,this._scaleY),t.translate(-e,-i)),(this._isMatrixDirty||this._cachedOffsetX!==e||this._cachedOffsetY!==i)&&(this._cachedOffsetX=e,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),u.ComposeToRef(-e,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure))}_renderHighlight(t){this.isHighlighted&&(t.save(),t.strokeStyle=this._highlightColor,t.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(t),t.restore())}_renderHighlightSpecific(t){t.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)}_getColor(t){return this.gradient?this.gradient.getCanvasGradient(t):this.color}_applyStates(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._host&&this._host.useSmallestIdeal&&!this._font&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),(this._color||this.gradient)&&(t.fillStyle=this._getColor(t)),x.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)}_layout(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(t)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this._paddingLeftInPixels,0|-this._paddingTopInPixels,0|this._paddingRightInPixels,0|this._paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),e.save(),this._applyStates(e);let i=0;do{this._rebuildLayout=!1,this._processMeasures(t,e),i++}while(this._rebuildLayout&&i<3);i>=3&&h.Y.Error(`Layout cycle detected in GUI (Control name=${this.name}, uniqueId=${this.uniqueId})`),e.restore(),this.invalidateRect(),this._evaluateClippingState(t)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0}_processMeasures(t,e){this._tempPaddingMeasure.copyFrom(t),this.parent&&this.parent.descendantsOnlyPadding&&(this._tempPaddingMeasure.left+=this.parent.paddingLeftInPixels,this._tempPaddingMeasure.top+=this.parent.paddingTopInPixels,this._tempPaddingMeasure.width-=this.parent.paddingLeftInPixels+this.parent.paddingRightInPixels,this._tempPaddingMeasure.height-=this.parent.paddingTopInPixels+this.parent.paddingBottomInPixels),this._currentMeasure.copyFrom(this._tempPaddingMeasure),this._preMeasure(this._tempPaddingMeasure,e),this._measure(),this._computeAlignment(this._tempPaddingMeasure,e),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(this._tempPaddingMeasure,e),this._cachedParentMeasure.copyFrom(this._tempPaddingMeasure),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)}_evaluateClippingState(t){if(this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.parent&&this.parent.clipChildren){if(t.transformToRef(this.parent._transformMatrix,this._evaluatedParentMeasure),this._evaluatedMeasure.left>this._evaluatedParentMeasure.left+this._evaluatedParentMeasure.width)return void(this._isClipped=!0);if(this._evaluatedMeasure.left+this._evaluatedMeasure.width<this._evaluatedParentMeasure.left)return void(this._isClipped=!0);if(this._evaluatedMeasure.top>this._evaluatedParentMeasure.top+this._evaluatedParentMeasure.height)return void(this._isClipped=!0);if(this._evaluatedMeasure.top+this._evaluatedMeasure.height<this._evaluatedParentMeasure.top)return void(this._isClipped=!0)}this._isClipped=!1}_measure(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this.fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this.fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this.fixedRatio)}_computeAlignment(t,e){const i=this._currentMeasure.width,s=this._currentMeasure.height,r=t.width,n=t.height;let o=0,h=0;switch(this.horizontalAlignment){case x.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case x.HORIZONTAL_ALIGNMENT_RIGHT:o=r-i;break;case x.HORIZONTAL_ALIGNMENT_CENTER:o=(r-i)/2}switch(this.verticalAlignment){case x.VERTICAL_ALIGNMENT_TOP:h=0;break;case x.VERTICAL_ALIGNMENT_BOTTOM:h=n-s;break;case x.VERTICAL_ALIGNMENT_CENTER:h=(n-s)/2}this.descendantsOnlyPadding||(this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=r*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=r*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=r*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=n*this._paddingTop.getValue(this._host),this._currentMeasure.height-=n*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=n*this._paddingBottom.getValue(this._host)),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=r*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=n*this._top.getValue(this._host),this._currentMeasure.left+=o,this._currentMeasure.top+=h}_preMeasure(t,e){}_additionalProcessing(t,e){}_clipForChildren(t){}_clip(t,e){if(t.beginPath(),x._ClipMeasure.copyFrom(this._currentMeasure),e){e.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);const t=new _.U(0,0,0,0);t.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),t.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),t.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-t.left,t.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-t.top,x._ClipMeasure.copyFrom(t)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){const e=this.shadowOffsetX,i=this.shadowOffsetY,s=this.shadowBlur,r=Math.min(Math.min(e,0)-2*s,0),n=Math.max(Math.max(e,0)+2*s,0),o=Math.min(Math.min(i,0)-2*s,0),h=Math.max(Math.max(i,0)+2*s,0);t.rect(x._ClipMeasure.left+r,x._ClipMeasure.top+o,x._ClipMeasure.width+n-r,x._ClipMeasure.height+h-o)}else t.rect(x._ClipMeasure.left,x._ClipMeasure.top,x._ClipMeasure.width,x._ClipMeasure.height);t.clip()}_render(t,e){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,t.save(),this._applyStates(t),this._transform(t),this.clipContent&&this._clip(t,e),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?t.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(t,e),this.useBitmapCache&&this._wasDirty&&(this._cacheData=t.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(t),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),t.restore(),!0)}_draw(t,e){}contains(t,e){return this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y,!(t<this._currentMeasure.left||t>this._currentMeasure.left+this._currentMeasure.width||e<this._currentMeasure.top||e>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))}_processPicking(t,e,i,s,r,n,o,h){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(t,e)||(this._processObservables(s,t,e,i,r,n,o,h),0))}_onPointerMove(t,e,i,s){this.onPointerMoveObservable.notifyObservers(e,-1,t,this,s)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerMove(t,e,i,s)}_onPointerEnter(t,e){return!!this._isEnabled&&(!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this,e)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerEnter(t,e),!0))}_onPointerOut(t,e,i=!1){if(!(i||this._isEnabled&&t!==this))return;this._enterCount=0;let s=!0;t.isAscendant(this)||(s=this.onPointerOutObservable.notifyObservers(this,-1,t,this,e)),s&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerOut(t,e,i)}_onPointerDown(t,e,i,s,r){return this._onPointerEnter(this,r),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new d(e,s),-1,t,this,r)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerDown(t,e,i,s,r),r&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.add(r.event.pointerId),!0)}_onPointerUp(t,e,i,s,r,n){if(!this._isEnabled)return;this._downCount=0,delete this._downPointerIds[i];let o=r;r&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new d(e,s),-1,t,this,n)),this.onPointerUpObservable.notifyObservers(new d(e,s),-1,t,this,n)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerUp(t,e,i,s,o,n),n&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.delete(n.event.pointerId)}_forcePointerUp(t=null){if(null!==t)this._onPointerUp(this,n.FM.Zero(),t,0,!0);else for(const t in this._downPointerIds)this._onPointerUp(this,n.FM.Zero(),+t,0,!0)}_onWheelScroll(t,e){this._isEnabled&&this.onWheelObservable.notifyObservers(new n.FM(t,e))&&null!=this.parent&&this.parent._onWheelScroll(t,e)}_onCanvasBlur(){}_processObservables(t,e,i,s,r,n,h,a){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(e,i),t===o.kD.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r,s);const t=this._host._lastControlOver[r];return t&&t!==this&&t._onPointerOut(this,s),t!==this&&this._onPointerEnter(this,s),this._host._lastControlOver[r]=this,!0}return t===o.kD.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n,s),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):t===o.kD.POINTERUP?(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0,s),delete this._host._lastControlDown[r],!0):!(t!==o.kD.POINTERWHEEL||!this._host._lastControlOver[r]||(this._host._lastControlOver[r]._onWheelScroll(h,a),0))}_prepareFont(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=x._GetFontOffset(this._font),this.getDescendants().forEach((t=>t._markAllAsDirty())))}clone(t){const e={};this.serialize(e);const i=new(a.w1.Instantiate("BABYLON.GUI."+e.className));return i.parse(e,t),i}parse(t,e){return p.p4.Parse((()=>this),t,null),this.name=t.name,this._parseFromContent(t,null!=e?e:this._host),this}serialize(t){p.p4.Serialize(this,t),t.name=this.name,t.className=this.getClassName(),this._font&&(t.fontFamily=this._fontFamily,t.fontSize=this.fontSize,t.fontWeight=this.fontWeight,t.fontStyle=this.fontStyle),this._gradient&&(t.gradient={},this._gradient.serialize(t.gradient)),p.p4.AppendSerializedAnimations(this,t)}_parseFromContent(t,e){var i;if(t.fontFamily&&(this.fontFamily=t.fontFamily),t.fontSize&&(this.fontSize=t.fontSize),t.fontWeight&&(this.fontWeight=t.fontWeight),t.fontStyle&&(this.fontStyle=t.fontStyle),t.gradient){const e=a.w1.Instantiate("BABYLON.GUI."+t.gradient.className);this._gradient=new e,null===(i=this._gradient)||void 0===i||i.parse(t.gradient)}if(t.animations){this.animations=[];for(let e=0;e<t.animations.length;e++){const i=t.animations[e],s=(0,f.q)("BABYLON.Animation");s&&this.animations.push(s.Parse(i))}t.autoAnimate&&this._host&&this._host.getScene()&&this._host.getScene().beginAnimation(this,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1)}}dispose(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}static get HORIZONTAL_ALIGNMENT_LEFT(){return x._HORIZONTAL_ALIGNMENT_LEFT}static get HORIZONTAL_ALIGNMENT_RIGHT(){return x._HORIZONTAL_ALIGNMENT_RIGHT}static get HORIZONTAL_ALIGNMENT_CENTER(){return x._HORIZONTAL_ALIGNMENT_CENTER}static get VERTICAL_ALIGNMENT_TOP(){return x._VERTICAL_ALIGNMENT_TOP}static get VERTICAL_ALIGNMENT_BOTTOM(){return x._VERTICAL_ALIGNMENT_BOTTOM}static get VERTICAL_ALIGNMENT_CENTER(){return x._VERTICAL_ALIGNMENT_CENTER}static _GetFontOffset(t){if(x._FontHeightSizes[t])return x._FontHeightSizes[t];const e=m.l.LastCreatedEngine;if(!e)throw new Error("Invalid engine. Unable to create a canvas.");const i=e.getFontOffset(t);return x._FontHeightSizes[t]=i,i}static Parse(t,e){const i=a.w1.Instantiate("BABYLON.GUI."+t.className),s=p.p4.Parse((()=>new i),t,null);return s.name=t.name,s._parseFromContent(t,e),s}static drawEllipse(t,e,i,s,r){r.translate(t,e),r.scale(i,s),r.beginPath(),r.arc(0,0,1,0,2*Math.PI),r.closePath(),r.scale(1/i,1/s),r.translate(-t,-e)}isReady(){return!0}}x.AllowAlphaInheritance=!1,x._ClipMeasure=new _.U(0,0,0,0),x._HORIZONTAL_ALIGNMENT_LEFT=0,x._HORIZONTAL_ALIGNMENT_RIGHT=1,x._HORIZONTAL_ALIGNMENT_CENTER=2,x._VERTICAL_ALIGNMENT_TOP=0,x._VERTICAL_ALIGNMENT_BOTTOM=1,x._VERTICAL_ALIGNMENT_CENTER=2,x._FontHeightSizes={},x.AddHeader=()=>{},(0,s.gn)([(0,p.qC)()],x.prototype,"metadata",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"isHitTestVisible",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"isPointerBlocker",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"isFocusInvisible",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"clipChildren",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"clipContent",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"useBitmapCache",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"shadowOffsetX",null),(0,s.gn)([(0,p.qC)()],x.prototype,"shadowOffsetY",null),(0,s.gn)([(0,p.qC)()],x.prototype,"shadowBlur",null),(0,s.gn)([(0,p.qC)()],x.prototype,"shadowColor",null),(0,s.gn)([(0,p.qC)()],x.prototype,"hoverCursor",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"fontOffset",null),(0,s.gn)([(0,p.qC)()],x.prototype,"alpha",null),(0,s.gn)([(0,p.qC)()],x.prototype,"scaleX",null),(0,s.gn)([(0,p.qC)()],x.prototype,"scaleY",null),(0,s.gn)([(0,p.qC)()],x.prototype,"rotation",null),(0,s.gn)([(0,p.qC)()],x.prototype,"transformCenterY",null),(0,s.gn)([(0,p.qC)()],x.prototype,"transformCenterX",null),(0,s.gn)([(0,p.qC)()],x.prototype,"horizontalAlignment",null),(0,s.gn)([(0,p.qC)()],x.prototype,"verticalAlignment",null),(0,s.gn)([(0,p.qC)()],x.prototype,"fixedRatio",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"width",null),(0,s.gn)([(0,p.qC)()],x.prototype,"height",null),(0,s.gn)([(0,p.qC)()],x.prototype,"style",null),(0,s.gn)([(0,p.qC)()],x.prototype,"color",null),(0,s.gn)([(0,p.qC)()],x.prototype,"gradient",null),(0,s.gn)([(0,p.qC)()],x.prototype,"zIndex",null),(0,s.gn)([(0,p.qC)()],x.prototype,"notRenderable",null),(0,s.gn)([(0,p.qC)()],x.prototype,"isVisible",null),(0,s.gn)([(0,p.qC)()],x.prototype,"descendantsOnlyPadding",null),(0,s.gn)([(0,p.qC)()],x.prototype,"paddingLeft",null),(0,s.gn)([(0,p.qC)()],x.prototype,"paddingRight",null),(0,s.gn)([(0,p.qC)()],x.prototype,"paddingTop",null),(0,s.gn)([(0,p.qC)()],x.prototype,"paddingBottom",null),(0,s.gn)([(0,p.qC)()],x.prototype,"left",null),(0,s.gn)([(0,p.qC)()],x.prototype,"top",null),(0,s.gn)([(0,p.qC)()],x.prototype,"linkOffsetX",null),(0,s.gn)([(0,p.qC)()],x.prototype,"linkOffsetY",null),(0,s.gn)([(0,p.qC)()],x.prototype,"isEnabled",null),(0,s.gn)([(0,p.qC)()],x.prototype,"disabledColor",null),(0,s.gn)([(0,p.qC)()],x.prototype,"disabledColorItem",null),(0,s.gn)([(0,p.qC)()],x.prototype,"overlapGroup",void 0),(0,s.gn)([(0,p.qC)()],x.prototype,"overlapDeltaMultiplier",void 0),(0,f.H)("BABYLON.GUI.Control",x)},9286:(t,e,i)=>{i.d(e,{E:()=>_});var s=i(1069),r=i(8139),n=i(8658),o=i(7003),h=i(646),a=i(8137),l=i(5953);class _ extends o.o{get isLoaded(){return this._loaded}isReady(){return this.isLoaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(t){this._detectPointerOnOpaqueOnly!==t&&(this._detectPointerOnOpaqueOnly=t)}get sliceLeft(){return this._sliceLeft}set sliceLeft(t){this._sliceLeft!==t&&(this._sliceLeft=t,this._markAsDirty())}get sliceRight(){return this._sliceRight}set sliceRight(t){this._sliceRight!==t&&(this._sliceRight=t,this._markAsDirty())}get sliceTop(){return this._sliceTop}set sliceTop(t){this._sliceTop!==t&&(this._sliceTop=t,this._markAsDirty())}get sliceBottom(){return this._sliceBottom}set sliceBottom(t){this._sliceBottom!==t&&(this._sliceBottom=t,this._markAsDirty())}get sourceLeft(){return this._sourceLeft}set sourceLeft(t){this._sourceLeft!==t&&(this._sourceLeft=t,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(t){this._sourceTop!==t&&(this._sourceTop=t,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(t){this._sourceWidth!==t&&(this._sourceWidth=t,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(t){this._sourceHeight!==t&&(this._sourceHeight=t,this._markAsDirty())}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get populateNinePatchSlicesFromImage(){return this._populateNinePatchSlicesFromImage}set populateNinePatchSlicesFromImage(t){this._populateNinePatchSlicesFromImage!==t&&(this._populateNinePatchSlicesFromImage=t,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())}get isSVG(){return this._isSVG}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(t){this._autoScale!==t&&(this._autoScale=t,t&&this._loaded&&this.synchronizeSizeWithContent())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this._markAsDirty())}_rotate90(t,e=!1){var i,s;const r=this._domImage.width,n=this._domImage.height,o=(null===(s=null===(i=this._host)||void 0===i?void 0:i.getScene())||void 0===s?void 0:s.getEngine())||l.l.LastCreatedEngine;if(!o)throw new Error("Invalid engine. Unable to create a canvas.");const h=o.createCanvas(n,r),a=h.getContext("2d");a.translate(h.width/2,h.height/2),a.rotate(t*Math.PI/2),a.drawImage(this._domImage,0,0,r,n,-r/2,-n/2,r,n);const c=h.toDataURL("image/jpg"),d=new _(this.name+"rotated",c);return e&&(d._stretch=this._stretch,d._autoScale=this._autoScale,d._cellId=this._cellId,d._cellWidth=t%1?this._cellHeight:this._cellWidth,d._cellHeight=t%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,d,t),this._imageDataCache.data=null,d}_handleRotationForSVGImage(t,e,i){t._isSVG&&(t._svgAttributesComputationCompleted?(this._rotate90SourceProperties(t,e,i),this._markAsDirty()):t.onSVGAttributesComputedObservable.addOnce((()=>{this._rotate90SourceProperties(t,e,i),this._markAsDirty()})))}_rotate90SourceProperties(t,e,i){let s=t.sourceLeft,r=t.sourceTop,n=t.domImage.width,o=t.domImage.height,h=s,a=r,l=t.sourceWidth,_=t.sourceHeight;if(0!=i){const t=i<0?-1:1;i%=4;for(let e=0;e<Math.abs(i);++e)h=-(r-o/2)*t+o/2,a=(s-n/2)*t+n/2,[l,_]=[_,l],i<0?a-=_:h-=l,s=h,r=a,[n,o]=[o,n]}e.sourceLeft=h,e.sourceTop=a,e.sourceWidth=l,e.sourceHeight=_}_extractNinePatchSliceDataFromImage(){var t,e;const i=this._domImage.width,s=this._domImage.height;if(!this._workingCanvas){const r=(null===(e=null===(t=this._host)||void 0===t?void 0:t.getScene())||void 0===e?void 0:e.getEngine())||l.l.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(i,s)}const r=this._workingCanvas.getContext("2d");r.drawImage(this._domImage,0,0,i,s);const n=r.getImageData(0,0,i,s);this._sliceLeft=-1,this._sliceRight=-1;for(let t=0;t<i;t++){const e=n.data[4*t+3];if(e>127&&-1===this._sliceLeft)this._sliceLeft=t;else if(e<127&&this._sliceLeft>-1){this._sliceRight=t;break}}this._sliceTop=-1,this._sliceBottom=-1;for(let t=0;t<s;t++){const e=n.data[t*i*4+3];if(e>127&&-1===this._sliceTop)this._sliceTop=t;else if(e<127&&this._sliceTop>-1){this._sliceBottom=t;break}}}set domImage(t){this._domImage=t,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=()=>{this._onImageLoaded()}}get domImage(){return this._domImage}_onImageLoaded(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get source(){return this._source}static ResetImageCache(){_.SourceImgCache.clear()}_removeCacheUsage(t){const e=t&&_.SourceImgCache.get(t);e&&(e.timesUsed-=1,0===e.timesUsed&&_.SourceImgCache.delete(t))}set source(t){var e,i;if(this._source===t)return;this._removeCacheUsage(this._source),this._loaded=!1,this._source=t,this._imageDataCache.data=null,t&&(t=this._svgCheck(t));const s=(null===(i=null===(e=this._host)||void 0===e?void 0:e.getScene())||void 0===i?void 0:i.getEngine())||l.l.LastCreatedEngine;if(!s)throw new Error("Invalid engine. Unable to create a canvas.");if(t&&_.SourceImgCache.has(t)){const e=_.SourceImgCache.get(t);return this._domImage=e.img,e.timesUsed+=1,void(e.loaded?this._onImageLoaded():e.waitingForLoadCallback.push(this._onImageLoaded.bind(this)))}this._domImage=s.createCanvasImage(),t&&_.SourceImgCache.set(t,{img:this._domImage,timesUsed:1,loaded:!1,waitingForLoadCallback:[this._onImageLoaded.bind(this)]}),this._domImage.onload=()=>{if(t){const e=_.SourceImgCache.get(t);if(e){e.loaded=!0;for(const t of e.waitingForLoadCallback)t();return void(e.waitingForLoadCallback.length=0)}}this._onImageLoaded()},t&&(n.w1.SetCorsBehavior(t,this._domImage),n.w1.SetReferrerPolicyBehavior(this.referrerPolicy,this._domImage),this._domImage.src=t)}_svgCheck(t){if(window.SVGSVGElement&&-1!==t.search(/.svg#/gi)&&t.indexOf("#")===t.lastIndexOf("#")){this._isSVG=!0;const e=t.split("#")[0],i=t.split("#")[1],s=document.body.querySelector('object[data="'+e+'"]');if(s){const e=s.contentDocument;if(e&&e.documentElement){const r=e.documentElement.getAttribute("viewBox"),n=Number(e.documentElement.getAttribute("width")),o=Number(e.documentElement.getAttribute("height"));if(e.getElementById(i)&&r&&n&&o)return this._getSVGAttribs(s,i),t}s.addEventListener("load",(()=>{this._getSVGAttribs(s,i)}))}else{const t=document.createElement("object");t.data=e,t.type="image/svg+xml",t.width="0%",t.height="0%",document.body.appendChild(t),t.onload=()=>{const t=document.body.querySelector('object[data="'+e+'"]');t&&this._getSVGAttribs(t,i)}}return e}return t}_getSVGAttribs(t,e){const i=t.contentDocument;if(i&&i.documentElement){const t=i.documentElement.getAttribute("viewBox"),s=Number(i.documentElement.getAttribute("width")),r=Number(i.documentElement.getAttribute("height")),n=i.getElementById(e);if(t&&s&&r&&n){const e=Number(t.split(" ")[2]),i=Number(t.split(" ")[3]),o=n.getBBox();let h=1,a=1,l=0,_=0;const c=n.transform.baseVal.consolidate().matrix;n.transform&&n.transform.baseVal.consolidate()&&(h=c.a,a=c.d,l=c.e,_=c.f),this.sourceLeft=(h*o.x+l)*s/e,this.sourceTop=(a*o.y+_)*r/i,this.sourceWidth=o.width*h*(s/e),this.sourceHeight=o.height*a*(r/i),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}}get cellWidth(){return this._cellWidth}set cellWidth(t){this._cellWidth!==t&&(this._cellWidth=t,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(t){this._cellHeight!==t&&(this._cellHeight=t,this._markAsDirty())}get cellId(){return this._cellId}set cellId(t){this._cellId!==t&&(this._cellId=t,this._markAsDirty())}constructor(t,e=null){super(t),this.name=t,this._workingCanvas=null,this._loaded=!1,this._stretch=_.STRETCH_FILL,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._isSVG=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._populateNinePatchSlicesFromImage=!1,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new r.y$,this.onSVGAttributesComputedObservable=new r.y$,this.source=e}contains(t,e){if(!super.contains(t,e))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;const i=0|this._currentMeasure.width,s=0|this._currentMeasure.height,r=i+"_"+s;let n=this._imageDataCache.data;if(!n||this._imageDataCache.key!==r){const t=this._workingCanvas.getContext("2d");this._imageDataCache.data=n=t.getImageData(0,0,i,s).data,this._imageDataCache.key=r}return n[4*((t=t-this._currentMeasure.left|0)+(e=e-this._currentMeasure.top|0)*i)+3]>0}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")}_processMeasures(t,e){if(this._loaded)switch(this._stretch){case _.STRETCH_NONE:case _.STRETCH_FILL:case _.STRETCH_UNIFORM:case _.STRETCH_NINE_PATCH:break;case _.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}super._processMeasures(t,e)}_prepareWorkingCanvasForOpaqueDetection(){var t,e;if(!this._detectPointerOnOpaqueOnly)return;const i=this._currentMeasure.width,s=this._currentMeasure.height;if(!this._workingCanvas){const r=(null===(e=null===(t=this._host)||void 0===t?void 0:t.getScene())||void 0===e?void 0:e.getEngine())||l.l.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(i,s)}this._workingCanvas.getContext("2d").clearRect(0,0,i,s)}_drawImage(t,e,i,s,r,n,o,h,a){t.drawImage(this._domImage,e,i,s,r,n,o,h,a),this._detectPointerOnOpaqueOnly&&(t=this._workingCanvas.getContext("2d")).drawImage(this._domImage,e,i,s,r,n-this._currentMeasure.left,o-this._currentMeasure.top,h,a)}_draw(t){let e,i,s,r;if(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)e=this._sourceLeft,i=this._sourceTop,s=this._sourceWidth?this._sourceWidth:this._imageWidth,r=this._sourceHeight?this._sourceHeight:this._imageHeight;else{const t=this._domImage.naturalWidth/this.cellWidth,n=this.cellId/t>>0,o=this.cellId%t;e=this.cellWidth*o,i=this.cellHeight*n,s=this.cellWidth,r=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(t),this._loaded)switch(this._stretch){case _.STRETCH_NONE:case _.STRETCH_FILL:this._drawImage(t,e,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case _.STRETCH_UNIFORM:{const n=this._currentMeasure.width/s,o=this._currentMeasure.height/r,h=Math.min(n,o),a=(this._currentMeasure.width-s*h)/2,l=(this._currentMeasure.height-r*h)/2;this._drawImage(t,e,i,s,r,this._currentMeasure.left+a,this._currentMeasure.top+l,s*h,r*h);break}case _.STRETCH_EXTEND:this._drawImage(t,e,i,s,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case _.STRETCH_NINE_PATCH:this._renderNinePatch(t)}t.restore()}_renderNinePatch(t){const e=this._sliceLeft,i=this._sliceTop,s=this._imageHeight-this._sliceBottom,r=this._imageWidth-this._sliceRight,n=this._sliceRight-this._sliceLeft,o=this._sliceBottom-this._sliceTop,h=this._currentMeasure.width-r-e+2,a=this._currentMeasure.height-s-i+2,l=this._currentMeasure.left+e-1,_=this._currentMeasure.top+i-1,c=this._currentMeasure.left+this._currentMeasure.width-r,d=this._currentMeasure.top+this._currentMeasure.height-s;this._drawImage(t,0,0,e,i,this._currentMeasure.left,this._currentMeasure.top,e,i),t.clearRect(l,this._currentMeasure.top,h,i),this._drawImage(t,this._sliceLeft,0,n,i,l,this._currentMeasure.top,h,i),t.clearRect(c,this._currentMeasure.top,r,i),this._drawImage(t,this._sliceRight,0,r,i,c,this._currentMeasure.top,r,i),t.clearRect(this._currentMeasure.left,_,e,a),this._drawImage(t,0,this._sliceTop,e,o,this._currentMeasure.left,_,e,a),t.clearRect(l,_,h,a),this._drawImage(t,this._sliceLeft,this._sliceTop,n,o,l,_,h,a),t.clearRect(c,_,r,a),this._drawImage(t,this._sliceRight,this._sliceTop,r,o,c,_,r,a),t.clearRect(this._currentMeasure.left,d,e,s),this._drawImage(t,0,this._sliceBottom,e,s,this._currentMeasure.left,d,e,s),t.clearRect(l,d,h,s),this._drawImage(t,this.sliceLeft,this._sliceBottom,n,s,l,d,h,s),t.clearRect(c,d,r,s),this._drawImage(t,this._sliceRight,this._sliceBottom,r,s,c,d,r,s)}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this._removeCacheUsage(this._source)}}_.SourceImgCache=new Map,_.STRETCH_NONE=0,_.STRETCH_FILL=1,_.STRETCH_UNIFORM=2,_.STRETCH_EXTEND=3,_.STRETCH_NINE_PATCH=4,(0,s.gn)([(0,a.qC)()],_.prototype,"detectPointerOnOpaqueOnly",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sliceLeft",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sliceRight",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sliceTop",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sliceBottom",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sourceLeft",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sourceTop",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sourceWidth",null),(0,s.gn)([(0,a.qC)()],_.prototype,"sourceHeight",null),(0,s.gn)([(0,a.qC)()],_.prototype,"populateNinePatchSlicesFromImage",null),(0,s.gn)([(0,a.qC)()],_.prototype,"autoScale",null),(0,s.gn)([(0,a.qC)()],_.prototype,"stretch",null),(0,s.gn)([(0,a.qC)()],_.prototype,"source",null),(0,s.gn)([(0,a.qC)()],_.prototype,"cellWidth",null),(0,s.gn)([(0,a.qC)()],_.prototype,"cellHeight",null),(0,s.gn)([(0,a.qC)()],_.prototype,"cellId",null),(0,h.H)("BABYLON.GUI.Image",_)},4188:(t,e,i)=>{var s=i(8062),r=i(1069),n=i(8139),o=i(7003),h=i(5817),a=i(2701),l=i(646),_=i(8137);class c extends o.o{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t))}constructor(t){super(t),this.name=t,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.onIsCheckedChangedObservable=new n.y$,this.isPointerBlocker=!0}_getTypeName(){return"Checkbox"}_draw(t){t.save(),this._applyStates(t);const e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColorItem;const s=e*this._checkSizeRatio,r=i*this._checkSizeRatio;t.fillRect(this._currentMeasure.left+this._thickness/2+(e-s)/2,this._currentMeasure.top+this._thickness/2+(i-r)/2,s,r)}t.strokeStyle=this.color,t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),t.restore()}_onPointerDown(t,e,i,s,r){return!!super._onPointerDown(t,e,i,s,r)&&(this.isReadOnly||(this.isChecked=!this.isChecked),!0)}static AddCheckBoxWithHeader(t,e){const i=new h.e;i.isVertical=!1,i.height="30px";const s=new c;s.width="20px",s.height="20px",s.isChecked=!0,s.color="green",s.onIsCheckedChangedObservable.add(e),i.addControl(s);const r=new a.a;return r.text=t,r.width="180px",r.paddingLeft="5px",r.textHorizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,r.color="white",i.addControl(r),i}}(0,r.gn)([(0,_.qC)()],c.prototype,"thickness",null),(0,r.gn)([(0,_.qC)()],c.prototype,"checkSizeRatio",null),(0,r.gn)([(0,_.qC)()],c.prototype,"background",null),(0,r.gn)([(0,_.qC)()],c.prototype,"isChecked",null),(0,l.H)("BABYLON.GUI.Checkbox",c);var d=i(5194),u=i(27),g=i(5151);class f{get text(){return this._characters?this._characters.join(""):this._text}set text(t){this._text=t,this._characters=Array.from&&Array.from(t)}get length(){return this._characters?this._characters.length:this._text.length}removePart(t,e,i){if(this._text=this._text.slice(0,t)+(i||"")+this._text.slice(e),this._characters){const s=i?Array.from(i):[];this._characters.splice(t,e-t,...s)}}charAt(t){return this._characters?this._characters[t]:this._text.charAt(t)}substr(t,e){if(this._characters){t=isNaN(t)?0:t>=0?Math.min(t,this._characters.length):this._characters.length+Math.max(t,-this._characters.length),void 0===e?e=this._characters.length-t:(isNaN(e)||e<0)&&(e=0);const i=[];for(;--e>=0;)i[e]=this._characters[t+e];return i.join("")}return this._text.substr(t,e)}substring(t,e){if(this._characters){isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0),void 0===e?e=this._characters.length:isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0);const i=[];let s=0;for(;t<e;)i[s++]=this._characters[t++];return i.join("")}return this._text.substring(t,e)}isWord(t){const e=/\w/g;return this._characters?-1!==this._characters[t].search(e):-1!==this._text.search(e)}}class p extends o.o{get maxWidth(){return this._maxWidth.toString(this._host)}get maxWidthInPixels(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set maxWidth(t){this._maxWidth.toString(this._host)!==t&&this._maxWidth.fromString(t)&&this._markAsDirty()}get highligherOpacity(){return this._highligherOpacity}set highligherOpacity(t){this._highligherOpacity!==t&&(this._highligherOpacity=t,this._markAsDirty())}get onFocusSelectAll(){return this._onFocusSelectAll}set onFocusSelectAll(t){this._onFocusSelectAll!==t&&(this._onFocusSelectAll=t,this._markAsDirty())}get textHighlightColor(){return this._textHighlightColor}set textHighlightColor(t){this._textHighlightColor!==t&&(this._textHighlightColor=t,this._markAsDirty())}get margin(){return this._margin.toString(this._host)}get marginInPixels(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)}set margin(t){this._margin.toString(this._host)!==t&&this._margin.fromString(t)&&this._markAsDirty()}get autoStretchWidth(){return this._autoStretchWidth}set autoStretchWidth(t){this._autoStretchWidth!==t&&(this._autoStretchWidth=t,this._markAsDirty())}get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get focusedBackground(){return this._focusedBackground}set focusedBackground(t){this._focusedBackground!==t&&(this._focusedBackground=t,this._markAsDirty())}get focusedColor(){return this._focusedColor}set focusedColor(t){this._focusedColor!==t&&(this._focusedColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get placeholderColor(){return this._placeholderColor}set placeholderColor(t){this._placeholderColor!==t&&(this._placeholderColor=t,this._markAsDirty())}get placeholderText(){return this._placeholderText}set placeholderText(t){this._placeholderText!==t&&(this._placeholderText=t,this._markAsDirty())}get deadKey(){return this._deadKey}set deadKey(t){this._deadKey=t}get highlightedText(){return this._highlightedText}set highlightedText(t){this._highlightedText!==t&&(this._highlightedText=t,this._markAsDirty())}get addKey(){return this._addKey}set addKey(t){this._addKey=t}get currentKey(){return this._currentKey}set currentKey(t){this._currentKey=t}get text(){return this._textWrapper.text}set text(t){const e=t.toString();this._textWrapper||(this._textWrapper=new f),this._textWrapper.text!==e&&(this._textWrapper.text=e,this._textHasChanged())}_textHasChanged(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)}get width(){return this._width.toString(this._host)}set width(t){this._width.toString(this._host)!==t&&(this._width.fromString(t)&&this._markAsDirty(),this.autoStretchWidth=!1)}constructor(t,e=""){super(t),this.name=t,this._placeholderText="",this._background="#222222",this._focusedBackground="#000000",this._focusedColor="white",this._placeholderColor="gray",this._thickness=1,this._margin=new g.s(10,g.s.UNITMODE_PIXEL),this._autoStretchWidth=!0,this._maxWidth=new g.s(1,g.s.UNITMODE_PERCENTAGE,!1),this._isFocused=!1,this._blinkIsEven=!1,this._cursorOffset=0,this._deadKey=!1,this._addKey=!0,this._currentKey="",this._isTextHighlightOn=!1,this._textHighlightColor="#d5e0ff",this._highligherOpacity=.4,this._highlightedText="",this._startHighlightIndex=0,this._endHighlightIndex=0,this._cursorIndex=-1,this._onFocusSelectAll=!1,this._isPointerDown=!1,this.promptMessage="Please enter text:",this.disableMobilePrompt=!1,this.onTextChangedObservable=new n.y$,this.onBeforeKeyAddObservable=new n.y$,this.onFocusObservable=new n.y$,this.onBlurObservable=new n.y$,this.onTextHighlightObservable=new n.y$,this.onTextCopyObservable=new n.y$,this.onTextCutObservable=new n.y$,this.onTextPasteObservable=new n.y$,this.onKeyboardEventProcessedObservable=new n.y$,this.text=e,this.isPointerBlocker=!0}onBlur(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);const t=this._host.getScene();this._onPointerDblTapObserver&&t&&t.onPointerObservable.remove(this._onPointerDblTapObserver)}onFocus(){if(!this._isEnabled)return;if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),"touch"===this._focusedBy&&!this.disableMobilePrompt){const t=prompt(this.promptMessage);return null!==t&&(this.text=t),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add((t=>{switch(t.type){case d.p.COPY:this._onCopyText(t.event),this.onTextCopyObservable.notifyObservers(this);break;case d.p.CUT:this._onCutText(t.event),this.onTextCutObservable.notifyObservers(this);break;case d.p.PASTE:this._onPasteText(t.event),this.onTextPasteObservable.notifyObservers(this);break;default:return}}));const t=this._host.getScene();t&&(this._onPointerDblTapObserver=t.onPointerObservable.add((t=>{this._isFocused&&t.type===u.kD.POINTERDOUBLETAP&&this._processDblClick(t)}))),this._onFocusSelectAll&&this._selectAllText()}focus(){this._host.moveFocusToControl(this)}blur(){this._host.focusedControl=null}_getTypeName(){return"InputText"}keepsFocusWith(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null}processKey(t,e,i){var s;if(!this.isReadOnly&&(!i||!i.ctrlKey&&!i.metaKey||67!==t&&86!==t&&88!==t)){if(i&&(i.ctrlKey||i.metaKey)&&65===t)return this._selectAllText(),void i.preventDefault();switch(t){case 32:e=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this.isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());if(0===this._cursorOffset)this.text=this._textWrapper.substr(0,this._textWrapper.length-1);else{const t=this._textWrapper.length-this._cursorOffset;t>0&&(this._textWrapper.removePart(t-1,t),this._textHasChanged())}}return void(i&&i.preventDefault());case 46:if(this.isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,void(i&&i.preventDefault());if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){const t=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(t,t+1),this._textHasChanged(),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this.isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this.isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this.isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(this._textWrapper.length===this._cursorOffset)return;this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this.isTextHighlightOn=!0,void this._markAsDirty()}return this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,void this._markAsDirty()}return this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this.isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1}return this._endHighlightIndex=this._textWrapper.length,this.isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this.isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this.isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this.isTextHighlightOn=!1,void this._markAsDirty()}return this.isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this.isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this.isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty()}if(32===t&&(e=null!==(s=null==i?void 0:i.key)&&void 0!==s?s:" "),this._deadKey="Dead"===e,e&&(-1===t||32===t||34===t||39===t||t>47&&t<64||t>64&&t<91||t>159&&t<193||t>218&&t<223||t>95&&t<112)&&(this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey&&!this._deadKey))if(this.isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,e),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this.isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=this._deadKey&&(null==i?void 0:i.key)?i.key:e;else{const t=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(t,t,e),this._textHasChanged()}}}_updateValueFromCursorIndex(t){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=t;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this.isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex}this.isTextHighlightOn=!0,this._markAsDirty()}_processDblClick(t){let e,i;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;do{i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,e=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0}while(e||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()}_selectAllText(){this._blinkIsEven=!0,this.isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()}processKeyboard(t){this.processKey(t.keyCode,t.key,t),this.onKeyboardEventProcessedObservable.notifyObservers(t)}_onCopyText(t){this.isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText}_onCutText(t){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this.isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}}_onPasteText(t){let e="";e=t.clipboardData&&-1!==t.clipboardData.types.indexOf("text/plain")?t.clipboardData.getData("text/plain"):this._host.clipboardData;const i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,e),this._textHasChanged()}_draw(t){t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._fontOffset&&!this._wasDirty||(this._fontOffset=o.o._GetFontOffset(t.font));const e=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(t.fillStyle=this.color);let i=this._beforeRenderText(this._textWrapper);this._isFocused||this._textWrapper.text||!this._placeholderText||(i=new f,i.text=this._placeholderText,this._placeholderColor&&(t.fillStyle=this._placeholderColor)),this._textWidth=t.measureText(i.text).width;const s=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+s)+"px",this._autoStretchWidth=!0);const r=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,n=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-s;if(t.save(),t.beginPath(),t.rect(e,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,n+2,this._currentMeasure.height),t.clip(),this._isFocused&&this._textWidth>n){const t=e-this._textWidth+n;this._scrollLeft||(this._scrollLeft=t)}else this._scrollLeft=e;if(t.fillText(i.text,this._scrollLeft,this._currentMeasure.top+r),this._isFocused){if(this._clickedCoordinate){const e=this._scrollLeft+this._textWidth-this._clickedCoordinate;let s=0;this._cursorOffset=0;let r=0;do{this._cursorOffset&&(r=Math.abs(e-s)),this._cursorOffset++,s=t.measureText(i.substr(i.length-this._cursorOffset,this._cursorOffset)).width}while(s<e&&i.length>=this._cursorOffset);Math.abs(e-s)>r&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){const s=i.substr(i.length-this._cursorOffset),r=t.measureText(s).width;let o=this._scrollLeft+this._textWidth-r;o<e?(this._scrollLeft+=e-o,o=e,this._markAsDirty()):o>e+n&&(this._scrollLeft+=e+n-o,o=e+n,this._markAsDirty()),this.isTextHighlightOn||t.fillRect(o,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()}),500),this.isTextHighlightOn){clearTimeout(this._blinkTimeout);const s=t.measureText(i.substring(this._startHighlightIndex)).width;let r=this._scrollLeft+this._textWidth-s;this._highlightedText=i.substring(this._startHighlightIndex,this._endHighlightIndex);let n=t.measureText(i.substring(this._startHighlightIndex,this._endHighlightIndex)).width;r<e&&(n-=e-r,n||(n=t.measureText(i.charAt(i.length-this._cursorOffset)).width),r=e),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor,t.fillRect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,n,this._fontOffset.height),t.globalAlpha=1}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()}_onPointerDown(t,e,i,s,r){return!(!super._onPointerDown(t,e,i,s,r)||!this.isReadOnly&&(this._clickedCoordinate=e.x,this.isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[i]=this,this._focusedBy=r.event.pointerType,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))}_onPointerMove(t,e,i,s){this._host.focusedControl===this&&this._isPointerDown&&!this.isReadOnly&&(this._clickedCoordinate=e.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),super._onPointerMove(t,e,i,s)}_onPointerUp(t,e,i,s,r){this._isPointerDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,s,r)}_beforeRenderText(t){return t}set isTextHighlightOn(t){this._isTextHighlightOn!==t&&(t&&this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=t)}get isTextHighlightOn(){return this._isTextHighlightOn}dispose(){super.dispose(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()}}(0,r.gn)([(0,_.qC)()],p.prototype,"promptMessage",void 0),(0,r.gn)([(0,_.qC)()],p.prototype,"disableMobilePrompt",void 0),(0,r.gn)([(0,_.qC)()],p.prototype,"maxWidth",null),(0,r.gn)([(0,_.qC)()],p.prototype,"highligherOpacity",null),(0,r.gn)([(0,_.qC)()],p.prototype,"onFocusSelectAll",null),(0,r.gn)([(0,_.qC)()],p.prototype,"textHighlightColor",null),(0,r.gn)([(0,_.qC)()],p.prototype,"margin",null),(0,r.gn)([(0,_.qC)()],p.prototype,"autoStretchWidth",null),(0,r.gn)([(0,_.qC)()],p.prototype,"thickness",null),(0,r.gn)([(0,_.qC)()],p.prototype,"focusedBackground",null),(0,r.gn)([(0,_.qC)()],p.prototype,"focusedColor",null),(0,r.gn)([(0,_.qC)()],p.prototype,"background",null),(0,r.gn)([(0,_.qC)()],p.prototype,"placeholderColor",null),(0,r.gn)([(0,_.qC)()],p.prototype,"placeholderText",null),(0,r.gn)([(0,_.qC)()],p.prototype,"deadKey",null),(0,r.gn)([(0,_.qC)()],p.prototype,"text",null),(0,r.gn)([(0,_.qC)()],p.prototype,"width",null),(0,l.H)("BABYLON.GUI.InputText",p);var m=i(5767),x=i(7034),b=i(8658);class I extends x.W{get columnCount(){return this._columnDefinitions.length}get rowCount(){return this._rowDefinitions.length}get children(){return this._childControls}get cells(){return this._cells}getRowDefinition(t){return t<0||t>=this._rowDefinitions.length?null:this._rowDefinitions[t]}getColumnDefinition(t){return t<0||t>=this._columnDefinitions.length?null:this._columnDefinitions[t]}addRowDefinition(t,e=!1){return this._rowDefinitions.push(new g.s(t,e?g.s.UNITMODE_PIXEL:g.s.UNITMODE_PERCENTAGE)),this._rowDefinitionObservers.push(this._rowDefinitions[this.rowCount-1].onChangedObservable.add((()=>this._markAsDirty()))),this._markAsDirty(),this}addColumnDefinition(t,e=!1){return this._columnDefinitions.push(new g.s(t,e?g.s.UNITMODE_PIXEL:g.s.UNITMODE_PERCENTAGE)),this._columnDefinitionObservers.push(this._columnDefinitions[this.columnCount-1].onChangedObservable.add((()=>this._markAsDirty()))),this._markAsDirty(),this}setRowDefinition(t,e,i=!1){if(t<0||t>=this._rowDefinitions.length)return this;const s=this._rowDefinitions[t];return s&&s.isPixel===i&&s.value===e||(this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]),this._rowDefinitions[t]=new g.s(e,i?g.s.UNITMODE_PIXEL:g.s.UNITMODE_PERCENTAGE),this._rowDefinitionObservers[t]=this._rowDefinitions[t].onChangedObservable.add((()=>this._markAsDirty())),this._markAsDirty()),this}setColumnDefinition(t,e,i=!1){if(t<0||t>=this._columnDefinitions.length)return this;const s=this._columnDefinitions[t];return s&&s.isPixel===i&&s.value===e||(this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]),this._columnDefinitions[t]=new g.s(e,i?g.s.UNITMODE_PIXEL:g.s.UNITMODE_PERCENTAGE),this._columnDefinitionObservers[t]=this._columnDefinitions[t].onChangedObservable.add((()=>this._markAsDirty())),this._markAsDirty()),this}getChildrenAt(t,e){const i=this._cells[`${t}:${e}`];return i?i.children:null}getChildCellInfo(t){return t._tag}_removeCell(t,e){if(t){super.removeControl(t);for(const e of t.children){const t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1)}delete this._cells[e]}}_offsetCell(t,e){if(this._cells[e]){this._cells[t]=this._cells[e];for(const e of this._cells[t].children)e._tag=t;delete this._cells[e]}}removeColumnDefinition(t){if(t<0||t>=this._columnDefinitions.length)return this;for(let e=0;e<this._rowDefinitions.length;e++){const i=`${e}:${t}`,s=this._cells[i];this._removeCell(s,i)}for(let e=0;e<this._rowDefinitions.length;e++)for(let i=t+1;i<this._columnDefinitions.length;i++){const t=`${e}:${i-1}`,s=`${e}:${i}`;this._offsetCell(t,s)}return this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]),this._columnDefinitions.splice(t,1),this._columnDefinitionObservers.splice(t,1),this._markAsDirty(),this}removeRowDefinition(t){if(t<0||t>=this._rowDefinitions.length)return this;for(let e=0;e<this._columnDefinitions.length;e++){const i=`${t}:${e}`,s=this._cells[i];this._removeCell(s,i)}for(let e=0;e<this._columnDefinitions.length;e++)for(let i=t+1;i<this._rowDefinitions.length;i++){const t=`${i-1}:${e}`,s=`${i}:${e}`;this._offsetCell(t,s)}return this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]),this._rowDefinitions.splice(t,1),this._rowDefinitionObservers.splice(t,1),this._markAsDirty(),this}addControl(t,e=0,i=0){if(0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(t))return b.w1.Warn(`Control (Name:${t.name}, UniqueId:${t.uniqueId}) is already associated with this grid. You must remove it before reattaching it`),this;const s=`${Math.min(e,this._rowDefinitions.length-1)}:${Math.min(i,this._columnDefinitions.length-1)}`;let r=this._cells[s];return r||(r=new x.W(s),this._cells[s]=r,r.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,r.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,super.addControl(r)),r.addControl(t),this._childControls.push(t),t._tag=s,t.parent=this,this._markAsDirty(),this}removeControl(t){const e=this._childControls.indexOf(t);-1!==e&&this._childControls.splice(e,1);const i=this._cells[t._tag];return i&&(i.removeControl(t),t._tag=null),this._markAsDirty(),this}constructor(t){super(t),this.name=t,this._rowDefinitions=new Array,this._rowDefinitionObservers=[],this._columnDefinitions=new Array,this._columnDefinitionObservers=[],this._cells={},this._childControls=new Array}_getTypeName(){return"Grid"}_getGridDefinitions(t){const e=[],i=[],s=[],r=[];let n=this._currentMeasure.width,o=0,h=this._currentMeasure.height,a=0,l=0;for(const t of this._rowDefinitions){if(t.isPixel){const e=t.getValue(this._host);h-=e,i[l]=e}else a+=t.value;l++}let _=0;l=0;for(const t of this._rowDefinitions){if(r.push(_),t.isPixel)_+=t.getValue(this._host);else{const e=t.value/a*h;_+=e,i[l]=e}l++}l=0;for(const t of this._columnDefinitions){if(t.isPixel){const i=t.getValue(this._host);n-=i,e[l]=i}else o+=t.value;l++}let c=0;l=0;for(const t of this._columnDefinitions){if(s.push(c),t.isPixel)c+=t.getValue(this._host);else{const i=t.value/o*n;c+=i,e[l]=i}l++}t(s,r,e,i)}_additionalProcessing(t,e){this._getGridDefinitions(((t,e,i,s)=>{for(const r in this._cells){if(!Object.prototype.hasOwnProperty.call(this._cells,r))continue;const n=r.split(":"),o=parseInt(n[0]),h=parseInt(n[1]),a=this._cells[r];a.left=t[h]+"px",a.top=e[o]+"px",a.width=i[h]+"px",a.height=s[o]+"px",a._left.ignoreAdaptiveScaling=!0,a._top.ignoreAdaptiveScaling=!0,a._width.ignoreAdaptiveScaling=!0,a._height.ignoreAdaptiveScaling=!0}})),super._additionalProcessing(t,e)}_flagDescendantsAsMatrixDirty(){for(const t in this._cells)Object.prototype.hasOwnProperty.call(this._cells,t)&&this._cells[t]._markMatrixAsDirty()}_renderHighlightSpecific(t){super._renderHighlightSpecific(t),this._getGridDefinitions(((e,i,s,r)=>{for(let i=0;i<e.length;i++){const r=this._currentMeasure.left+e[i]+s[i];t.beginPath(),t.moveTo(r,this._currentMeasure.top),t.lineTo(r,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let e=0;e<i.length;e++){const s=this._currentMeasure.top+i[e]+r[e];t.beginPath(),t.moveTo(this._currentMeasure.left,s),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,s),t.stroke()}})),t.restore()}dispose(){super.dispose();for(const t of this._childControls)t.dispose();for(let t=0;t<this._rowDefinitions.length;t++)this._rowDefinitions[t].onChangedObservable.remove(this._rowDefinitionObservers[t]);for(let t=0;t<this._columnDefinitions.length;t++)this._columnDefinitions[t].onChangedObservable.remove(this._columnDefinitionObservers[t]);this._rowDefinitionObservers.length=0,this._rowDefinitions.length=0,this._columnDefinitionObservers.length=0,this._columnDefinitions.length=0,this._cells={},this._childControls.length=0}serialize(t){super.serialize(t),t.columnCount=this.columnCount,t.rowCount=this.rowCount,t.columns=[],t.rows=[],t.tags=[];for(let e=0;e<this.columnCount;++e){const i=this.getColumnDefinition(e),s={value:null==i?void 0:i.getValue(this.host),unit:null==i?void 0:i.unit};t.columns.push(s)}for(let e=0;e<this.rowCount;++e){const i=this.getRowDefinition(e),s={value:null==i?void 0:i.getValue(this.host),unit:null==i?void 0:i.unit};t.rows.push(s)}this.children.forEach((e=>{t.tags.push(e._tag)}))}_parseFromContent(t,e){super._parseFromContent(t,e);const i=[];this.children.forEach((t=>{i.push(t)})),this.removeRowDefinition(0),this.removeColumnDefinition(0);for(let e=0;e<t.columnCount;++e){const i=t.columns[e].value,s=t.columns[e].unit;this.addColumnDefinition(i,1===s)}for(let e=0;e<t.rowCount;++e){const i=t.rows[e].value,s=t.rows[e].unit;this.addRowDefinition(i,1===s)}for(let e=0;e<i.length;++e){const s=t.tags[e];let r=parseInt(s.substring(0,s.search(":")));isNaN(r)&&(r=0);let n=parseInt(s.substring(s.search(":")+1));isNaN(n)&&(n=0),this.addControl(i[e],r,n)}}}(0,l.H)("BABYLON.GUI.Grid",I);var T=i(2922),M=i(5953);class C extends o.o{get value(){return this._value}set value(t){this._value.equals(t)||(this._value.copyFrom(t),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=C._Epsilon&&(this._value.r=0),this._value.g<=C._Epsilon&&(this._value.g=0),this._value.b<=C._Epsilon&&(this._value.b=0),this._value.r>=1-C._Epsilon&&(this._value.r=1),this._value.g>=1-C._Epsilon&&(this._value.g=1),this._value.b>=1-C._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))}get width(){return this._width.toString(this._host)}set width(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&(0===this._width.getValue(this._host)&&(t="1px",this._width.fromString(t)),this._height.fromString(t),this._markAsDirty())}get height(){return this._height.toString(this._host)}set height(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&(0===this._height.getValue(this._host)&&(t="1px",this._height.fromString(t)),this._width.fromString(t),this._markAsDirty())}get size(){return this.width}set size(t){this.width=t}constructor(t){super(t),this.name=t,this._value=T.Wo.Red(),this._tmpColor=new T.Wo,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._squareLeft=0,this._squareTop=0,this._squareSize=0,this._h=360,this._s=1,this._v=1,this._lastPointerDownId=-1,this.onValueChangedObservable=new n.y$,this._pointerIsDown=!1,this.value=new T.Wo(.88,.1,.1),this.size="200px",this.isPointerBlocker=!0}_getTypeName(){return"ColorPicker"}_preMeasure(t){t.width<t.height?this._currentMeasure.height=t.width:this._currentMeasure.width=t.height}_updateSquareProps(){const t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),e=2*(t-.2*t)/Math.sqrt(2),i=t-.5*e;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=e}_drawGradientSquare(t,e,i,s,r,n){const o=n.createLinearGradient(e,i,s+e,i);o.addColorStop(0,"#fff"),o.addColorStop(1,"hsl("+t+", 100%, 50%)"),n.fillStyle=o,n.fillRect(e,i,s,r);const h=n.createLinearGradient(e,i,e,r+i);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(1,"#000"),n.fillStyle=h,n.fillRect(e,i,s,r)}_drawCircle(t,e,i,s){s.beginPath(),s.arc(t,e,i+1,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#333333",s.stroke(),s.beginPath(),s.arc(t,e,i,0,2*Math.PI,!1),s.lineWidth=3,s.strokeStyle="#ffffff",s.stroke()}_createColorWheelCanvas(t,e){const i=M.l.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");const s=i.createCanvas(2*t,2*t),r=s.getContext("2d"),n=r.getImageData(0,0,2*t,2*t),o=n.data,h=this._tmpColor,a=t*t,l=t-e,_=l*l;for(let e=-t;e<t;e++)for(let i=-t;i<t;i++){const s=e*e+i*i;if(s>a||s<_)continue;const r=Math.sqrt(s),n=Math.atan2(i,e);T.Wo.HSVtoRGBToRef(180*n/Math.PI+180,r/t,1,h);const c=4*(e+t+2*(i+t)*t);o[c]=255*h.r,o[c+1]=255*h.g,o[c+2]=255*h.b;let d=(r-l)/(t-l),u=.2;const g=.2,f=.04,p=50,m=150;u=t<p?g:t>m?f:(f-g)*(t-p)/(m-p)+g,d=(r-l)/(t-l),o[c+3]=d<u?d/u*255:d>1-u?255*(1-(d-(1-u))/u):255}return r.putImageData(n,0,0),s}_draw(t){t.save(),this._applyStates(t);const e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*e,s=this._currentMeasure.left,r=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*e||(this._colorWheelCanvas=this._createColorWheelCanvas(e,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),t.drawImage(this._colorWheelCanvas,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,t);let n=this._squareLeft+this._squareSize*this._s,o=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(n,o,.04*e,t);const h=e-.5*i;n=s+e+Math.cos((this._h-180)*Math.PI/180)*h,o=r+e+Math.sin((this._h-180)*Math.PI/180)*h,this._drawCircle(n,o,.35*i,t),t.restore()}_updateValueFromPointer(t,e){if(this._pointerStartedOnWheel){const i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i+this._currentMeasure.left,r=i+this._currentMeasure.top;this._h=180*Math.atan2(e-r,t-s)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(t-this._squareLeft)/this._squareSize,this._v=1-(e-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,C._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,C._Epsilon));T.Wo.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor}_isPointOnSquare(t,e){this._updateSquareProps();const i=this._squareLeft,s=this._squareTop,r=this._squareSize;return t>=i&&t<=i+r&&e>=s&&e<=s+r}_isPointOnWheel(t,e){const i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),s=i-.2*i,r=t-(i+this._currentMeasure.left),n=e-(i+this._currentMeasure.top),o=r*r+n*n;return o<=i*i&&o>=s*s}_onPointerDown(t,e,i,s,r){if(!super._onPointerDown(t,e,i,s,r))return!1;if(this.isReadOnly)return!0;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(e.x,e.y,this._transformedPosition);const n=this._transformedPosition.x,o=this._transformedPosition.y;return this._isPointOnSquare(n,o)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(n,o)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(n,o),this._host._capturingControl[i]=this,this._lastPointerDownId=i,!0}_onPointerMove(t,e,i,s){if(i==this._lastPointerDownId){if(!this.isReadOnly){this._invertTransformMatrix.transformCoordinates(e.x,e.y,this._transformedPosition);const t=this._transformedPosition.x,i=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(t,i)}super._onPointerMove(t,e,i,s)}}_onPointerUp(t,e,i,s,r,n){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,s,r,n)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}static ShowPickerDialogAsync(t,e){return new Promise((i=>{e.pickerWidth=e.pickerWidth||"640px",e.pickerHeight=e.pickerHeight||"400px",e.headerHeight=e.headerHeight||"35px",e.lastColor=e.lastColor||"#000000",e.swatchLimit=e.swatchLimit||20,e.numSwatchesPerLine=e.numSwatchesPerLine||10;const r=e.swatchLimit/e.numSwatchesPerLine,n=parseFloat(e.pickerWidth)/e.numSwatchesPerLine,h=Math.floor(.25*n),l=h*(e.numSwatchesPerLine+1),_=Math.floor((parseFloat(e.pickerWidth)-l)/e.numSwatchesPerLine),c=_*r+h*(r+1),d=(parseInt(e.pickerHeight)+c+Math.floor(.25*_)).toString()+"px",u="#c0c0c0",g="#535353",f="#414141",x="515151",b="#555555",M="#454545",y=T.Wo.FromHexString("#dddddd"),A=y.r+y.g+y.b,v="#aaaaaa",O="#ffffff";let E,S;const D=["R","G","B"],w="#454545",R="#f0f0f0";let P,L,k,N,B,F=!1;const W=new I;if(W.name="Dialog Container",W.width=e.pickerWidth,e.savedColors){W.height=d;const t=parseInt(e.pickerHeight)/parseInt(d);W.addRowDefinition(t,!1),W.addRowDefinition(1-t,!1)}else W.height=e.pickerHeight,W.addRowDefinition(1,!1);if(t.addControl(W),e.savedColors){L=new I,L.name="Swatch Drawer",L.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,L.background=g,L.width=e.pickerWidth;const t=e.savedColors.length/e.numSwatchesPerLine;let i;i=0==t?0:t+1,L.height=(_*t+i*h).toString()+"px",L.top=Math.floor(.25*_).toString()+"px";for(let t=0;t<2*Math.ceil(e.savedColors.length/e.numSwatchesPerLine)+1;t++)t%2!=0?L.addRowDefinition(_,!0):L.addRowDefinition(h,!0);for(let t=0;t<2*e.numSwatchesPerLine+1;t++)t%2!=0?L.addColumnDefinition(_,!0):L.addColumnDefinition(h,!0);W.addControl(L,1,0)}const V=new I;V.name="Picker Panel",V.height=e.pickerHeight;const H=parseInt(e.headerHeight)/parseInt(e.pickerHeight),U=[H,1-H];V.addRowDefinition(U[0],!1),V.addRowDefinition(U[1],!1),W.addControl(V,0,0);const z=new m.A;z.name="Dialogue Header Bar",z.background="#cccccc",z.thickness=0,V.addControl(z,0,0);const G=s.z.CreateSimpleButton("closeButton","a");G.fontFamily="coreglyphs";const X=T.Wo.FromHexString(z.background),Y=new T.Wo(1-X.r,1-X.g,1-X.b);G.color=Y.toHexString(),G.fontSize=Math.floor(.6*parseInt(e.headerHeight)),G.textBlock.textVerticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,G.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_RIGHT,G.height=G.width=e.headerHeight,G.background=z.background,G.thickness=0,G.pointerDownAnimation=()=>{},G.pointerUpAnimation=()=>{G.background=z.background},G.pointerEnterAnimation=()=>{G.color=z.background,G.background="red"},G.pointerOutAnimation=()=>{G.color=Y.toHexString(),G.background=z.background},G.onPointerClickObservable.add((()=>{Wt(lt.background)})),V.addControl(G,0,0);const q=new I;q.name="Dialogue Body",q.background=g;const K=[.4375,.5625];q.addRowDefinition(1,!1),q.addColumnDefinition(K[0],!1),q.addColumnDefinition(K[1],!1),V.addControl(q,1,0);const j=new I;j.name="Picker Grid",j.addRowDefinition(.85,!1),j.addRowDefinition(.15,!1),q.addControl(j,0,0);const Z=new C;Z.name="GUI Color Picker",e.pickerHeight<e.pickerWidth?Z.width=.89:Z.height=.89,Z.value=T.Wo.FromHexString(e.lastColor),Z.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_CENTER,Z.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,Z.onPointerDownObservable.add((()=>{B=Z.name,N="",kt(!1)})),Z.onValueChangedObservable.add((function(t){B==Z.name&&wt(t,Z.name)})),j.addControl(Z,0,0);const Q=new I;Q.name="Dialogue Right Half",Q.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT;const $=[.514,.486];Q.addRowDefinition($[0],!1),Q.addRowDefinition($[1],!1),q.addControl(Q,1,1);const J=new I;J.name="Swatches and Buttons";const tt=[.417,.583];J.addRowDefinition(1,!1),J.addColumnDefinition(tt[0],!1),J.addColumnDefinition(tt[1],!1),Q.addControl(J,0,0);const et=new I;et.name="New and Current Swatches";const it=[.04,.16,.64,.16];et.addRowDefinition(it[0],!1),et.addRowDefinition(it[1],!1),et.addRowDefinition(it[2],!1),et.addRowDefinition(it[3],!1),J.addControl(et,0,0);const st=new I;st.name="Active Swatches",st.width=.67,st.addRowDefinition(.5,!1),st.addRowDefinition(.5,!1),et.addControl(st,2,0);const rt=Math.floor(parseInt(e.pickerWidth)*K[1]*tt[0]*.11),nt=Math.floor(parseInt(e.pickerHeight)*U[1]*$[0]*it[1]*.5);let ot;ot=e.pickerWidth>e.pickerHeight?nt:rt;const ht=new a.a;ht.text="new",ht.name="New Color Label",ht.color=u,ht.fontSize=ot,et.addControl(ht,1,0);const at=new m.A;at.name="New Color Swatch",at.background=e.lastColor,at.thickness=0,st.addControl(at,0,0);const lt=s.z.CreateSimpleButton("currentSwatch","");lt.background=e.lastColor,lt.thickness=0,lt.onPointerClickObservable.add((()=>{wt(T.Wo.FromHexString(lt.background),lt.name),kt(!1)})),lt.pointerDownAnimation=()=>{},lt.pointerUpAnimation=()=>{},lt.pointerEnterAnimation=()=>{},lt.pointerOutAnimation=()=>{},st.addControl(lt,1,0);const _t=new m.A;_t.name="Swatch Outline",_t.width=.67,_t.thickness=2,_t.color="#404040",_t.isHitTestVisible=!1,et.addControl(_t,2,0);const ct=new a.a;ct.name="Current Color Label",ct.text="current",ct.color=u,ct.fontSize=ot,et.addControl(ct,3,0);const dt=new I;dt.name="Button Grid",dt.height=.8;const ut=1/3;dt.addRowDefinition(ut,!1),dt.addRowDefinition(ut,!1),dt.addRowDefinition(ut,!1),J.addControl(dt,0,1);const gt=Math.floor(parseInt(e.pickerWidth)*K[1]*tt[1]*.67).toString()+"px",ft=Math.floor(parseInt(e.pickerHeight)*U[1]*$[0]*(parseFloat(dt.height.toString())/100)*ut*.7).toString()+"px";E=parseFloat(gt)>parseFloat(ft)?Math.floor(.45*parseFloat(ft)):Math.floor(.11*parseFloat(gt));const pt=s.z.CreateSimpleButton("butOK","OK");pt.width=gt,pt.height=ft,pt.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,pt.thickness=2,pt.color=u,pt.fontSize=E,pt.background=g,pt.onPointerEnterObservable.add((()=>{pt.background=f})),pt.onPointerOutObservable.add((()=>{pt.background=g})),pt.pointerDownAnimation=()=>{pt.background=x},pt.pointerUpAnimation=()=>{pt.background=f},pt.onPointerClickObservable.add((()=>{kt(!1),Wt(at.background)})),dt.addControl(pt,0,0);const mt=s.z.CreateSimpleButton("butCancel","Cancel");mt.width=gt,mt.height=ft,mt.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,mt.thickness=2,mt.color=u,mt.fontSize=E,mt.background=g,mt.onPointerEnterObservable.add((()=>{mt.background=f})),mt.onPointerOutObservable.add((()=>{mt.background=g})),mt.pointerDownAnimation=()=>{mt.background=x},mt.pointerUpAnimation=()=>{mt.background=f},mt.onPointerClickObservable.add((()=>{kt(!1),Wt(lt.background)})),dt.addControl(mt,1,0),e.savedColors&&(k=s.z.CreateSimpleButton("butSave","Save"),k.width=gt,k.height=ft,k.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,k.thickness=2,k.fontSize=E,e.savedColors.length<e.swatchLimit?(k.color=u,k.background=g):Ft(k,!0),k.onPointerEnterObservable.add((()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(k.background=f)})),k.onPointerOutObservable.add((()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(k.background=g)})),k.pointerDownAnimation=()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(k.background=x)},k.pointerUpAnimation=()=>{e.savedColors&&e.savedColors.length<e.swatchLimit&&(k.background=f)},k.onPointerClickObservable.add((()=>{e.savedColors&&(0==e.savedColors.length&&Bt(!0),e.savedColors.length<e.swatchLimit&&Nt(at.background,k),kt(!1))})),e.savedColors.length>0&&Bt(!0),dt.addControl(k,2,0));const xt=new I;xt.name="Dialog Lower Right",xt.addRowDefinition(.02,!1),xt.addRowDefinition(.63,!1),xt.addRowDefinition(.21,!1),xt.addRowDefinition(.14,!1),Q.addControl(xt,1,0);const bt=T.Wo.FromHexString(e.lastColor),It=new I;It.name="RGB Values",It.width=.82,It.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,It.addRowDefinition(1/3,!1),It.addRowDefinition(1/3,!1),It.addRowDefinition(1/3,!1),It.addColumnDefinition(.1,!1),It.addColumnDefinition(.2,!1),It.addColumnDefinition(.7,!1),xt.addControl(It,1,0);for(let t=0;t<D.length;t++){const e=new a.a;e.text=D[t],e.color=u,e.fontSize=E,It.addControl(e,t,0)}const Tt=new p;Tt.width=.83,Tt.height=.72,Tt.name="rIntField",Tt.fontSize=E,Tt.text=(255*bt.r).toString(),Tt.color=R,Tt.background=w,Tt.onFocusObservable.add((()=>{B=Tt.name,N=Tt.text,kt(!1)})),Tt.onBlurObservable.add((()=>{""==Tt.text&&(Tt.text="0"),Rt(Tt,"r"),B==Tt.name&&(B="")})),Tt.onTextChangedObservable.add((()=>{B==Tt.name&&Rt(Tt,"r")})),It.addControl(Tt,0,1);const Mt=new p;Mt.width=.83,Mt.height=.72,Mt.name="gIntField",Mt.fontSize=E,Mt.text=(255*bt.g).toString(),Mt.color=R,Mt.background=w,Mt.onFocusObservable.add((()=>{B=Mt.name,N=Mt.text,kt(!1)})),Mt.onBlurObservable.add((()=>{""==Mt.text&&(Mt.text="0"),Rt(Mt,"g"),B==Mt.name&&(B="")})),Mt.onTextChangedObservable.add((()=>{B==Mt.name&&Rt(Mt,"g")})),It.addControl(Mt,1,1);const Ct=new p;Ct.width=.83,Ct.height=.72,Ct.name="bIntField",Ct.fontSize=E,Ct.text=(255*bt.b).toString(),Ct.color=R,Ct.background=w,Ct.onFocusObservable.add((()=>{B=Ct.name,N=Ct.text,kt(!1)})),Ct.onBlurObservable.add((()=>{""==Ct.text&&(Ct.text="0"),Rt(Ct,"b"),B==Ct.name&&(B="")})),Ct.onTextChangedObservable.add((()=>{B==Ct.name&&Rt(Ct,"b")})),It.addControl(Ct,2,1);const yt=new p;yt.width=.95,yt.height=.72,yt.name="rDecField",yt.fontSize=E,yt.text=bt.r.toString(),yt.color=R,yt.background=w,yt.onFocusObservable.add((()=>{B=yt.name,N=yt.text,kt(!1)})),yt.onBlurObservable.add((()=>{0!=parseFloat(yt.text)&&""!=yt.text||(yt.text="0",Pt(yt,"r")),B==yt.name&&(B="")})),yt.onTextChangedObservable.add((()=>{B==yt.name&&Pt(yt,"r")})),It.addControl(yt,0,2);const At=new p;At.width=.95,At.height=.72,At.name="gDecField",At.fontSize=E,At.text=bt.g.toString(),At.color=R,At.background=w,At.onFocusObservable.add((()=>{B=At.name,N=At.text,kt(!1)})),At.onBlurObservable.add((()=>{0!=parseFloat(At.text)&&""!=At.text||(At.text="0",Pt(At,"g")),B==At.name&&(B="")})),At.onTextChangedObservable.add((()=>{B==At.name&&Pt(At,"g")})),It.addControl(At,1,2);const vt=new p;vt.width=.95,vt.height=.72,vt.name="bDecField",vt.fontSize=E,vt.text=bt.b.toString(),vt.color=R,vt.background=w,vt.onFocusObservable.add((()=>{B=vt.name,N=vt.text,kt(!1)})),vt.onBlurObservable.add((()=>{0!=parseFloat(vt.text)&&""!=vt.text||(vt.text="0",Pt(vt,"b")),B==vt.name&&(B="")})),vt.onTextChangedObservable.add((()=>{B==vt.name&&Pt(vt,"b")})),It.addControl(vt,2,2);const Ot=new I;Ot.name="Hex Value",Ot.width=.82,Ot.addRowDefinition(1,!1),Ot.addColumnDefinition(.1,!1),Ot.addColumnDefinition(.9,!1),xt.addControl(Ot,2,0);const Et=new a.a;Et.text="#",Et.color=u,Et.fontSize=E,Ot.addControl(Et,0,0);const St=new p;St.width=.96,St.height=.72,St.name="hexField",St.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_CENTER,St.fontSize=E;const Dt=e.lastColor.split("#");function wt(t,e){B=e;const i=t.toHexString();if(at.background=i,Tt.name!=B&&(Tt.text=Math.floor(255*t.r).toString()),Mt.name!=B&&(Mt.text=Math.floor(255*t.g).toString()),Ct.name!=B&&(Ct.text=Math.floor(255*t.b).toString()),yt.name!=B&&(yt.text=t.r.toString()),At.name!=B&&(At.text=t.g.toString()),vt.name!=B&&(vt.text=t.b.toString()),St.name!=B){const t=i.split("#");St.text=t[1]}Z.name!=B&&(Z.value=t)}function Rt(t,e){let i=t.text;if(/[^0-9]/g.test(i))t.text=N;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),B==t.name&&(N=i),""!=i){i=parseInt(i).toString(),t.text=i;const s=T.Wo.FromHexString(at.background);B==t.name&&wt("r"==e?new T.Wo(parseInt(i)/255,s.g,s.b):"g"==e?new T.Wo(s.r,parseInt(i)/255,s.b):new T.Wo(s.r,s.g,parseInt(i)/255),t.name)}}function Pt(t,e){let i=t.text;if(/[^0-9.]/g.test(i))return void(t.text=N);""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),B==t.name&&(N=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),t.text=i):i="0.0";const s=T.Wo.FromHexString(at.background);B==t.name&&wt("r"==e?new T.Wo(parseFloat(i),s.g,s.b):"g"==e?new T.Wo(s.r,parseFloat(i),s.b):new T.Wo(s.r,s.g,parseFloat(i)),t.name)}function Lt(){if(e.savedColors&&e.savedColors[P]){let t;t=F?"b":"";const i=s.z.CreateSimpleButton("Swatch_"+P,t);i.fontFamily="coreglyphs";const r=T.Wo.FromHexString(e.savedColors[P]),n=r.r+r.g+r.b;i.color=n>A?v:O,i.fontSize=Math.floor(.7*_),i.textBlock.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,i.height=i.width=_.toString()+"px",i.background=e.savedColors[P],i.thickness=2;const h=P;return i.pointerDownAnimation=()=>{i.thickness=4},i.pointerUpAnimation=()=>{i.thickness=3},i.pointerEnterAnimation=()=>{i.thickness=3},i.pointerOutAnimation=()=>{i.thickness=2},i.onPointerClickObservable.add((()=>{var t;F?(t=h,e.savedColors&&e.savedColors.splice(t,1),e.savedColors&&0==e.savedColors.length&&(Bt(!1),F=!1),Nt("",k)):e.savedColors&&wt(T.Wo.FromHexString(e.savedColors[h]),i.name)})),i}return null}function kt(t){let e;if(void 0!==t&&(F=t),F){for(let t=0;t<L.children.length;t++)e=L.children[t],e.textBlock.text="b";void 0!==S&&(S.textBlock.text="Done")}else{for(let t=0;t<L.children.length;t++)e=L.children[t],e.textBlock.text="";void 0!==S&&(S.textBlock.text="Edit")}}function Nt(t,i){if(e.savedColors){""!=t&&e.savedColors.push(t),P=0,L.clearControls();const s=Math.ceil(e.savedColors.length/e.numSwatchesPerLine);let r;if(r=0==s?0:s+1,L.rowCount!=s+r){const t=L.rowCount;for(let e=0;e<t;e++)L.removeRowDefinition(0);for(let t=0;t<s+r;t++)t%2?L.addRowDefinition(_,!0):L.addRowDefinition(h,!0)}L.height=(_*s+r*h).toString()+"px";for(let t=1,i=1;t<s+r;t+=2,i++){let s;s=e.savedColors.length>i*e.numSwatchesPerLine?e.numSwatchesPerLine:e.savedColors.length-(i-1)*e.numSwatchesPerLine;const r=Math.min(Math.max(s,0),e.numSwatchesPerLine);for(let i=0,s=1;i<r;i++){if(i>e.numSwatchesPerLine)continue;const r=Lt();null!=r&&(L.addControl(r,t,s),s+=2,P++)}}e.savedColors.length>=e.swatchLimit?Ft(i,!0):Ft(i,!1)}}function Bt(t){t?(S=s.z.CreateSimpleButton("butEdit","Edit"),S.width=gt,S.height=ft,S.left=Math.floor(.1*parseInt(gt)).toString()+"px",S.top=(-1*parseFloat(S.left)).toString()+"px",S.verticalAlignment=o.o.VERTICAL_ALIGNMENT_BOTTOM,S.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,S.thickness=2,S.color=u,S.fontSize=E,S.background=g,S.onPointerEnterObservable.add((()=>{S.background=f})),S.onPointerOutObservable.add((()=>{S.background=g})),S.pointerDownAnimation=()=>{S.background=x},S.pointerUpAnimation=()=>{S.background=f},S.onPointerClickObservable.add((()=>{F=!F,kt()})),j.addControl(S,1,0)):j.removeControl(S)}function Ft(t,e){e?(t.color=b,t.background=M):(t.color=u,t.background=g)}function Wt(s){e.savedColors&&e.savedColors.length>0?i({savedColors:e.savedColors,pickedColor:s}):i({pickedColor:s}),t.removeControl(W)}St.text=Dt[1],St.color=R,St.background=w,St.onFocusObservable.add((()=>{B=St.name,N=St.text,kt(!1)})),St.onBlurObservable.add((()=>{if(3==St.text.length){const t=St.text.split("");St.text=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}""==St.text&&(St.text="000000",wt(T.Wo.FromHexString(St.text),"b")),B==St.name&&(B="")})),St.onTextChangedObservable.add((()=>{let t=St.text;const e=/[^0-9A-F]/i.test(t);if((St.text.length>6||e)&&B==St.name)St.text=N;else{if(St.text.length<6){const e=6-St.text.length;for(let i=0;i<e;i++)t="0"+t}if(3==St.text.length){const e=St.text.split("");t=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}t="#"+t,B==St.name&&(N=St.text,wt(T.Wo.FromHexString(t),St.name))}})),Ot.addControl(St,0,1),e.savedColors&&e.savedColors.length>0&&Nt("",k)}))}}C._Epsilon=1e-6,(0,r.gn)([(0,_.qC)()],C.prototype,"value",null),(0,r.gn)([(0,_.qC)()],C.prototype,"width",null),(0,r.gn)([(0,_.qC)()],C.prototype,"height",null),(0,r.gn)([(0,_.qC)()],C.prototype,"size",null),(0,l.H)("BABYLON.GUI.ColorPicker",C);class y extends x.W{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thickness=1}_getTypeName(){return"Ellipse"}_localDraw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),o.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),(this._backgroundGradient||this._background)&&(t.fillStyle=this._getBackgroundColor(t),t.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._thickness&&(this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.stroke()),t.restore()}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_clipForChildren(t){o.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,t),t.clip()}_renderHighlightSpecific(t){o.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._highlightLineWidth/2,this._currentMeasure.height/2-this._highlightLineWidth/2,t),t.stroke()}}(0,r.gn)([(0,_.qC)()],y.prototype,"thickness",null),(0,l.H)("BABYLON.GUI.Ellipse",y);class A extends s.z{constructor(t){super(t),this.name=t,this.focusedColor=null,this._isFocused=!1,this._unfocusedColor=null,this.onFocusObservable=new n.y$,this.onBlurObservable=new n.y$,this.onKeyboardEventProcessedObservable=new n.y$,this._unfocusedColor=this.color}onBlur(){this._isFocused&&(this._isFocused=!1,this.focusedColor&&null!=this._unfocusedColor&&(this.color=this._unfocusedColor),this.onBlurObservable.notifyObservers(this))}onFocus(){this._isFocused=!0,this.focusedColor&&(this._unfocusedColor=this.color,this.color=this.focusedColor),this.onFocusObservable.notifyObservers(this)}keepsFocusWith(){return null}focus(){this._host.moveFocusToControl(this)}blur(){this._host.focusedControl=null}processKeyboard(t){this.onKeyboardEventProcessedObservable.notifyObservers(t,-1,this)}_onPointerDown(t,e,i,s,r){return this.isReadOnly||this.focus(),super._onPointerDown(t,e,i,s,r)}displose(){super.dispose(),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onKeyboardEventProcessedObservable.clear()}}(0,l.H)("BABYLON.GUI.FocusableButton",A);var v=i(9286);class O extends p{get outlineWidth(){return this._outlineWidth}set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())}get autoStretchHeight(){return this._autoStretchHeight}set autoStretchHeight(t){this._autoStretchHeight!==t&&(this._autoStretchHeight=t,this._markAsDirty())}set height(t){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==t&&(this._height.fromString(t)&&this._markAsDirty(),this._autoStretchHeight=!1)}get maxHeight(){return this._maxHeight.toString(this._host)}get maxHeightInPixels(){return this._maxHeight.getValueInPixel(this._host,this._cachedParentMeasure.height)}set maxHeight(t){this._maxHeight.toString(this._host)!==t&&this._maxHeight.fromString(t)&&this._markAsDirty()}constructor(t,e=""){super(t),this.name=t,this._textHorizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._textVerticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,this._lineSpacing=new g.s(0),this._outlineWidth=0,this._outlineColor="white",this._maxHeight=new g.s(1,g.s.UNITMODE_PERCENTAGE,!1),this.onLinesReadyObservable=new n.y$,this.text=e,this.isPointerBlocker=!0,this.onLinesReadyObservable.add((()=>this._updateCursorPosition())),this._highlightCursorInfo={initialStartIndex:-1,initialRelativeStartIndex:-1,initialLineIndex:-1},this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeEndIndex:0,relativeStartIndex:0,currentLineIndex:0}}_getTypeName(){return"InputTextArea"}processKeyboard(t){this.alternativeProcessKey(t.code,t.key,t),this.onKeyboardEventProcessedObservable.notifyObservers(t)}alternativeProcessKey(t,e,i){if(!i||!i.ctrlKey&&!i.metaKey||"KeyC"!==t&&"KeyV"!==t&&"KeyX"!==t){switch(t){case"KeyA":if(i&&(i.ctrlKey||i.metaKey))return this._selectAllText(),void i.preventDefault();break;case"Period":i&&i.shiftKey&&i.preventDefault();break;case"Backspace":!this._isTextHighlightOn&&this._cursorInfo.globalStartIndex>0&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--),this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"Delete":!this._isTextHighlightOn&&this._cursorInfo.globalEndIndex<this.text.length&&(this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex+1),this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,i&&i.preventDefault(),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._textHasChanged();break;case"Enter":return this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,"\n"),this._cursorInfo.globalStartIndex++,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._textHasChanged();case"End":return this._cursorInfo.globalStartIndex=this.text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case"Home":return this._cursorInfo.globalStartIndex=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case"ArrowLeft":return this._markAsDirty(),i&&i.shiftKey?((i.ctrlKey||i.metaKey)&&(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex),this._isTextHighlightOn?this._cursorInfo.globalEndIndex>this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalEndIndex--:this._cursorInfo.globalStartIndex--:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex--,this._isTextHighlightOn=!0),this._blinkIsEven=!0,void i.preventDefault()):(this._isTextHighlightOn?this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex:i&&(i.ctrlKey||i.metaKey)?(this._cursorInfo.globalStartIndex-=this._cursorInfo.relativeStartIndex,i.preventDefault()):this._cursorInfo.globalStartIndex>0&&this._cursorInfo.globalStartIndex--,this._blinkIsEven=!1,void(this._isTextHighlightOn=!1));case"ArrowRight":if(this._markAsDirty(),i&&i.shiftKey){if(i.ctrlKey||i.metaKey){const t=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex-1;this._cursorInfo.globalEndIndex+=t,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex}return this._isTextHighlightOn?this._cursorInfo.globalStartIndex<this._highlightCursorInfo.initialStartIndex?this._cursorInfo.globalStartIndex++:this._cursorInfo.globalEndIndex++:(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex++,this._isTextHighlightOn=!0),this._blinkIsEven=!0,void i.preventDefault()}if(this._isTextHighlightOn)this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex;else if(i&&(i.ctrlKey||i.metaKey)){const t=this._lines[this._cursorInfo.currentLineIndex].text.length-this._cursorInfo.relativeEndIndex;this._cursorInfo.globalStartIndex+=t}else this._cursorInfo.globalStartIndex<this.text.length&&this._cursorInfo.globalStartIndex++;return this._blinkIsEven=!1,void(this._isTextHighlightOn=!1);case"ArrowUp":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),0===this._cursorInfo.currentLineIndex)this._cursorInfo.globalStartIndex=0;else{const t=this._lines[this._cursorInfo.currentLineIndex],e=this._lines[this._cursorInfo.currentLineIndex-1];let i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);const r=t.text.substr(0,s),n=this._contextForBreakLines.measureText(r).width;let o=0,h=0;i-=s,i-=e.text.length+e.lineEnding.length;let a=0;for(;o<n&&a<e.text.length;)i++,a++,h=Math.abs(n-o),o=this._contextForBreakLines.measureText(e.text.substr(0,a)).width;Math.abs(n-o)>h&&a>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<=this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):this._cursorInfo.globalEndIndex=i:this._cursorInfo.globalStartIndex=i}return void this._markAsDirty();case"ArrowDown":if(this._blinkIsEven=!1,i&&(i.shiftKey?(this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex),this._isTextHighlightOn=!0,this._blinkIsEven=!0):this._isTextHighlightOn=!1,i.preventDefault()),this._cursorInfo.currentLineIndex===this._lines.length-1)this._cursorInfo.globalStartIndex=this.text.length;else{const t=this._lines[this._cursorInfo.currentLineIndex],e=this._lines[this._cursorInfo.currentLineIndex+1];let i=0,s=0;!this._isTextHighlightOn||this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(i=this._cursorInfo.globalStartIndex,s=this._cursorInfo.relativeStartIndex):(i=this._cursorInfo.globalEndIndex,s=this._cursorInfo.relativeEndIndex);const r=t.text.substr(0,s),n=this._contextForBreakLines.measureText(r).width;let o=0,h=0;i+=t.text.length-s+t.lineEnding.length;let a=0;for(;o<n&&a<e.text.length;)i++,a++,h=Math.abs(n-o),o=this._contextForBreakLines.measureText(e.text.substr(0,a)).width;Math.abs(n-o)>h&&a>0&&i--,this._isTextHighlightOn?this._cursorInfo.currentLineIndex<this._highlightCursorInfo.initialLineIndex?(this._cursorInfo.globalStartIndex=i,this._cursorInfo.globalStartIndex>this._cursorInfo.globalEndIndex&&(this._cursorInfo.globalEndIndex+=this._cursorInfo.globalStartIndex,this._cursorInfo.globalStartIndex=this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex-=this._cursorInfo.globalStartIndex)):(this._cursorInfo.globalEndIndex=i,this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex):this._cursorInfo.globalStartIndex=i}return void this._markAsDirty()}1===(null==e?void 0:e.length)&&(null==i||i.preventDefault(),this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey&&(this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,e),this._cursorInfo.globalStartIndex+=e.length,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._textHasChanged()))}}_parseLineWordWrap(t="",e,i){const s=[],r=t.split(" ");let n=0;for(let o=0;o<r.length;o++){const h=o>0?t+" "+r[o]:r[0],a=i.measureText(h).width;if(a>e){o>0&&(n=i.measureText(t).width,s.push({text:t,width:n,lineEnding:" "})),t=r[o];let h="";t.split("").map((t=>{i.measureText(h+t).width>e&&(s.push({text:h,width:i.measureText(h).width,lineEnding:"\n"}),h=""),h+=t})),t=h,n=i.measureText(t).width}else n=a,t=h}return s.push({text:t,width:n,lineEnding:" "}),s}_breakLines(t,e){const i=[],s=this.text.split("\n");if(this.clipContent)for(const r of s)i.push(...this._parseLineWordWrap(r,t,e));else for(const t of s)i.push(this._parseLine(t,e));return i[i.length-1].lineEnding="\n",i}_parseLine(t="",e){return{text:t,width:e.measureText(t).width,lineEnding:" "}}_preMeasure(t,e){this._fontOffset&&!this._wasDirty||(this._fontOffset=o.o._GetFontOffset(e.font));let i=this._beforeRenderText(this._textWrapper).text;this._isFocused||this.text||!this._placeholderText||(i=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(i).width;const s=2*this._margin.getValueInPixel(this._host,t.width);if(this._autoStretchWidth){const r=i.split("\n").reduce(((t,i)=>e.measureText(i).width>e.measureText(t).width?i:t),""),n=e.measureText(r).width;this.width=Math.min(this._maxWidth.getValueInPixel(this._host,t.width),n+s)+"px",this.autoStretchWidth=!0}if(this._availableWidth=this._width.getValueInPixel(this._host,t.width)-s,this._lines=this._breakLines(this._availableWidth,e),this._contextForBreakLines=e,this._autoStretchHeight){const e=this._lines.length*this._fontOffset.height+2*this._margin.getValueInPixel(this._host,t.height);this.height=Math.min(this._maxHeight.getValueInPixel(this._host,t.height),e)+"px",this._autoStretchHeight=!0}if(this._availableHeight=this._height.getValueInPixel(this._host,t.height)-s,this._isFocused){this._cursorInfo.currentLineIndex=0;let t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,e=0;for(;e+t<=this._cursorInfo.globalStartIndex;)e+=t,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length)}}_computeScroll(){if(this._clipTextLeft=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width),this._clipTextTop=this._currentMeasure.top+this._margin.getValueInPixel(this._host,this._cachedParentMeasure.height),this._isFocused&&this._lines[this._cursorInfo.currentLineIndex].width>this._availableWidth){const t=this._clipTextLeft-this._lines[this._cursorInfo.currentLineIndex].width+this._availableWidth;this._scrollLeft||(this._scrollLeft=t)}else this._scrollLeft=this._clipTextLeft;if(this._isFocused&&!this._autoStretchHeight){const t=(this._cursorInfo.currentLineIndex+1)*this._fontOffset.height,e=this._clipTextTop-t;this._scrollTop||(this._scrollTop=e)}else this._scrollTop=this._clipTextTop}_additionalProcessing(){this.highlightedText="",this.onLinesReadyObservable.notifyObservers(this)}_drawText(t,e,i,s){const r=this._currentMeasure.width;let n=this._scrollLeft;switch(this._textHorizontalAlignment){case o.o.HORIZONTAL_ALIGNMENT_LEFT:n+=0;break;case o.o.HORIZONTAL_ALIGNMENT_RIGHT:n+=r-e;break;case o.o.HORIZONTAL_ALIGNMENT_CENTER:n+=(r-e)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(t,this._currentMeasure.left+n,i),s.fillText(t,n,i)}_onCopyText(t){this._isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText}_onCutText(t){if(this._highlightedText){try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),this._textHasChanged()}}_onPasteText(t){let e="";e=t.clipboardData&&-1!==t.clipboardData.types.indexOf("text/plain")?t.clipboardData.getData("text/plain"):this._host.clipboardData,this._isTextHighlightOn=!1,this._textWrapper.removePart(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex,e);const i=e.length-(this._cursorInfo.globalEndIndex-this._cursorInfo.globalStartIndex);this._cursorInfo.globalStartIndex+=i,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._textHasChanged()}_draw(t){var e,i;this._computeScroll(),this._scrollLeft=null!==(e=this._scrollLeft)&&void 0!==e?e:0,this._scrollTop=null!==(i=this._scrollTop)&&void 0!==i?i:0,t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this.color&&(t.fillStyle=this.color);const s=this._currentMeasure.height,r=this._currentMeasure.width;let n=0;switch(this._textVerticalAlignment){case o.o.VERTICAL_ALIGNMENT_TOP:n=this._fontOffset.ascent;break;case o.o.VERTICAL_ALIGNMENT_BOTTOM:n=s-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case o.o.VERTICAL_ALIGNMENT_CENTER:n=this._fontOffset.ascent+(s-this._fontOffset.height*this._lines.length)/2}t.save(),t.beginPath(),t.fillStyle=this.fontStyle,t.rect(this._clipTextLeft,this._clipTextTop,this._availableWidth+2,this._availableHeight+2),t.clip(),n+=this._scrollTop;for(let e=0;e<this._lines.length;e++){const i=this._lines[e];0!==e&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?n+=this._lineSpacing.getValue(this._host):n+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(i.text,i.width,n,t),n+=this._fontOffset.height}if(t.restore(),this._isFocused){if(!this._blinkIsEven||this._isTextHighlightOn){let e=this._scrollLeft+t.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substr(0,this._cursorInfo.relativeStartIndex)).width;e<this._clipTextLeft?(this._scrollLeft+=this._clipTextLeft-e,e=this._clipTextLeft,this._markAsDirty()):e>this._clipTextLeft+this._availableWidth&&(this._scrollLeft+=this._clipTextLeft+this._availableWidth-e,e=this._clipTextLeft+this._availableWidth,this._markAsDirty());let i=this._scrollTop+this._cursorInfo.currentLineIndex*this._fontOffset.height;i<this._clipTextTop?(this._scrollTop+=this._clipTextTop-i,i=this._clipTextTop,this._markAsDirty()):i+this._fontOffset.height>this._clipTextTop+this._availableHeight&&(this._scrollTop+=this._clipTextTop+this._availableHeight-i-this._fontOffset.height,i=this._clipTextTop+this._availableHeight-this._fontOffset.height,this._markAsDirty()),this._isTextHighlightOn||t.fillRect(e,i,2,this._fontOffset.height)}if(this._resetBlinking(),this._isTextHighlightOn){clearTimeout(this._blinkTimeout),this._highlightedText=this.text.substring(this._cursorInfo.globalStartIndex,this._cursorInfo.globalEndIndex),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor;const e=Math.min(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex),i=Math.max(this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialLineIndex);let s=this._scrollTop+e*this._fontOffset.height;for(let n=e;n<=i;n++){const h=this._lines[n];let a=this._scrollLeft;switch(this._textHorizontalAlignment){case o.o.HORIZONTAL_ALIGNMENT_LEFT:a+=0;break;case o.o.HORIZONTAL_ALIGNMENT_RIGHT:a+=r-h.width;break;case o.o.HORIZONTAL_ALIGNMENT_CENTER:a+=(r-h.width)/2}const l=n===e?this._cursorInfo.relativeStartIndex:0,_=n===i?this._cursorInfo.relativeEndIndex:h.text.length,c=t.measureText(h.text.substr(0,l)).width,d=h.text.substring(l,_),u=t.measureText(d).width;t.fillRect(a+c,s,u,this._fontOffset.height),s+=this._fontOffset.height}this._cursorInfo.globalEndIndex===this._cursorInfo.globalStartIndex&&this._resetBlinking()}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness))}_resetBlinking(){clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((()=>{this._blinkIsEven=!this._blinkIsEven,this._markAsDirty()}),500)}_applyStates(t){super._applyStates(t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor)}_onPointerDown(t,e,i,s,r){return!(!super._onPointerDown(t,e,i,s,r)||(this._clickedCoordinateX=e.x,this._clickedCoordinateY=e.y,this._isTextHighlightOn=!1,this._highlightedText="",this._isPointerDown=!0,this._host._capturingControl[i]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))}_onPointerMove(t,e,i,s){0===s.event.movementX&&0===s.event.movementY||(this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinateX=e.x,this._clickedCoordinateY=e.y,this._isTextHighlightOn||(this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this._highlightCursorInfo.initialRelativeStartIndex=this._cursorInfo.relativeStartIndex,this._isTextHighlightOn=!0),this._markAsDirty()),super._onPointerMove(t,e,i,s))}_updateCursorPosition(){var t;if(this._isFocused)if(this._clickedCoordinateX&&this._clickedCoordinateY){this._isTextHighlightOn||(this._cursorInfo={globalStartIndex:0,globalEndIndex:0,relativeStartIndex:0,relativeEndIndex:0,currentLineIndex:0});let e=0,i=0;const s=this._clickedCoordinateY-this._scrollTop,r=Math.floor(s/this._fontOffset.height);this._cursorInfo.currentLineIndex=Math.min(Math.max(r,0),this._lines.length-1);let n=0;const o=this._clickedCoordinateX-(null!==(t=this._scrollLeft)&&void 0!==t?t:0);let h=0;for(let t=0;t<this._cursorInfo.currentLineIndex;t++){const i=this._lines[t];e+=i.text.length+i.lineEnding.length}for(;n<o&&this._lines[this._cursorInfo.currentLineIndex].text.length>i;)i++,h=Math.abs(o-n),n=this._contextForBreakLines.measureText(this._lines[this._cursorInfo.currentLineIndex].text.substr(0,i)).width;Math.abs(o-n)>h&&i>0&&i--,e+=i,this._isTextHighlightOn?e<this._highlightCursorInfo.initialStartIndex?(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=i,this._cursorInfo.globalEndIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeEndIndex=this._highlightCursorInfo.initialRelativeStartIndex):(this._cursorInfo.globalStartIndex=this._highlightCursorInfo.initialStartIndex,this._cursorInfo.relativeStartIndex=this._highlightCursorInfo.initialRelativeStartIndex,this._cursorInfo.globalEndIndex=e,this._cursorInfo.relativeEndIndex=i):(this._cursorInfo.globalStartIndex=e,this._cursorInfo.relativeStartIndex=i,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex,this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex),this._blinkIsEven=this._isTextHighlightOn,this._clickedCoordinateX=null,this._clickedCoordinateY=null}else{this._cursorInfo.relativeStartIndex=0,this._cursorInfo.currentLineIndex=0;let t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length,e=0;for(;e+t<=this._cursorInfo.globalStartIndex;)e+=t,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);if(this._cursorInfo.relativeStartIndex=this._cursorInfo.globalStartIndex-e,-1!==this._highlightCursorInfo.initialStartIndex&&this._cursorInfo.globalStartIndex>=this._highlightCursorInfo.initialStartIndex){for(;e+t<=this._cursorInfo.globalEndIndex;)e+=t,this._cursorInfo.currentLineIndex<this._lines.length-1&&(this._cursorInfo.currentLineIndex++,t=this._lines[this._cursorInfo.currentLineIndex].text.length+this._lines[this._cursorInfo.currentLineIndex].lineEnding.length);this._cursorInfo.relativeEndIndex=this._cursorInfo.globalEndIndex-e}else this._isTextHighlightOn||(this._cursorInfo.relativeEndIndex=this._cursorInfo.relativeStartIndex,this._cursorInfo.globalEndIndex=this._cursorInfo.globalStartIndex)}}_updateValueFromCursorIndex(t){}_processDblClick(t){let e,i;do{e=this._cursorInfo.globalStartIndex>0&&this._textWrapper.isWord(this._cursorInfo.globalStartIndex-1)?--this._cursorInfo.globalStartIndex:0,i=this._cursorInfo.globalEndIndex<this._textWrapper.length&&this._textWrapper.isWord(this._cursorInfo.globalEndIndex)?++this._cursorInfo.globalEndIndex:0}while(e||i);this._highlightCursorInfo.initialLineIndex=this._cursorInfo.currentLineIndex,this._highlightCursorInfo.initialStartIndex=this._cursorInfo.globalStartIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._markAsDirty()}_selectAllText(){this._isTextHighlightOn=!0,this._blinkIsEven=!0,this._highlightCursorInfo={initialStartIndex:0,initialRelativeStartIndex:0,initialLineIndex:0},this._cursorInfo={globalStartIndex:0,globalEndIndex:this._textWrapper.length,relativeEndIndex:this._lines[this._lines.length-1].text.length,relativeStartIndex:0,currentLineIndex:this._lines.length-1},this._markAsDirty()}dipose(){super.dispose(),this.onLinesReadyObservable.clear()}}(0,r.gn)([(0,_.qC)()],O.prototype,"autoStretchHeight",null),(0,r.gn)([(0,_.qC)()],O.prototype,"maxHeight",null),(0,l.H)("BABYLON.GUI.InputTextArea",O),(0,l.H)("BABYLON.GUI.InputPassword",class extends p{_getTypeName(){return"InputPassword"}_beforeRenderText(t){const e=new f;let i="";for(let e=0;e<t.length;e++)i+="";return e.text=i,e}});var E=i(5412);class S extends o.o{get dash(){return this._dash}set dash(t){this._dash!==t&&(this._dash=t,this._markAsDirty())}get connectedControl(){return this._connectedControl}set connectedControl(t){this._connectedControl!==t&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),t&&(this._connectedControlDirtyObserver=t.onDirtyObservable.add((()=>this._markAsDirty()))),this._connectedControl=t,this._markAsDirty())}get x1(){return this._x1.toString(this._host)}set x1(t){this._x1.toString(this._host)!==t&&this._x1.fromString(t)&&this._markAsDirty()}get y1(){return this._y1.toString(this._host)}set y1(t){this._y1.toString(this._host)!==t&&this._y1.fromString(t)&&this._markAsDirty()}get x2(){return this._x2.toString(this._host)}set x2(t){this._x2.toString(this._host)!==t&&this._x2.fromString(t)&&this._markAsDirty()}get y2(){return this._y2.toString(this._host)}set y2(t){this._y2.toString(this._host)!==t&&this._y2.fromString(t)&&this._markAsDirty()}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())}set horizontalAlignment(t){}set verticalAlignment(t){}get _effectiveX2(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)}get _effectiveY2(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)}constructor(t){super(t),this.name=t,this._lineWidth=1,this._x1=new g.s(0),this._y1=new g.s(0),this._x2=new g.s(0),this._y2=new g.s(0),this._dash=new Array,this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP}_getTypeName(){return"Line"}_draw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this._getColor(t),t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath(),t.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),t.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),t.stroke(),t.restore()}_measure(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth}_computeAlignment(t){this._currentMeasure.left=t.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=t.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2}moveToVector3(t,e,i=!1){if(!this._host||this.parent!==this._host._rootContainer)return void b.w1.Error("Cannot move a control to a vector3 if the control is not at root level");const s=this._host._getGlobalViewport(),r=E.P.Project(t,E.y3.Identity(),e.getTransformMatrix(),s);this._moveToProjectedPosition(r,i),r.z<0||r.z>1?this.notRenderable=!0:this.notRenderable=!1}_moveToProjectedPosition(t,e=!1){const i=t.x+this._linkOffsetX.getValue(this._host)+"px",s=t.y+this._linkOffsetY.getValue(this._host)+"px";e?(this.x2=i,this.y2=s,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=s,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)}}(0,r.gn)([(0,_.qC)()],S.prototype,"dash",null),(0,r.gn)([(0,_.qC)()],S.prototype,"x1",null),(0,r.gn)([(0,_.qC)()],S.prototype,"y1",null),(0,r.gn)([(0,_.qC)()],S.prototype,"x2",null),(0,r.gn)([(0,_.qC)()],S.prototype,"y2",null),(0,r.gn)([(0,_.qC)()],S.prototype,"lineWidth",null),(0,l.H)("BABYLON.GUI.Line",S);var D=i(7142),w=i(4551);class R{constructor(t){this._multiLine=t,this._x=new g.s(0),this._y=new g.s(0),this._point=new E.P(0,0,0)}get x(){return this._x.toString(this._multiLine._host)}set x(t){this._x.toString(this._multiLine._host)!==t&&this._x.fromString(t)&&this._multiLine._markAsDirty()}get y(){return this._y.toString(this._multiLine._host)}set y(t){this._y.toString(this._multiLine._host)!==t&&this._y.fromString(t)&&this._multiLine._markAsDirty()}get control(){return this._control}set control(t){this._control!==t&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=t,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=t,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}resetLinks(){this.control=null,this.mesh=null}translate(){return this._point=this._translatePoint(),this._point}_translatePoint(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new E.P(this._control.centerX,this._control.centerY,1-w.kn);{const t=this._multiLine._host,e=this._x.getValueInPixel(t,Number(t._canvas.width)),i=this._y.getValueInPixel(t,Number(t._canvas.height));return new E.P(e,i,1-w.kn)}}dispose(){this.resetLinks()}}class P extends o.o{constructor(t){super(t),this.name=t,this._lineWidth=1,this.onPointUpdate=()=>{this._markAsDirty()},this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,this._dash=[],this._points=[]}get dash(){return this._dash}set dash(t){this._dash!==t&&(this._dash=t,this._markAsDirty())}getAt(t){return this._points[t]||(this._points[t]=new R(this)),this._points[t]}add(...t){return t.map((t=>this.push(t)))}push(t){const e=this.getAt(this._points.length);return null==t||(t instanceof D.x?e.mesh=t:t instanceof o.o?e.control=t:null!=t.x&&null!=t.y&&(e.x=t.x,e.y=t.y)),e}remove(t){let e;if(t instanceof R){if(e=this._points.indexOf(t),-1===e)return}else e=t;const i=this._points[e];i&&(i.dispose(),this._points.splice(e,1))}reset(){for(;this._points.length>0;)this.remove(this._points.length-1)}resetLinks(){this._points.forEach((t=>{null!=t&&t.resetLinks()}))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())}set horizontalAlignment(t){}set verticalAlignment(t){}_getTypeName(){return"MultiLine"}_draw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();let e,i=!0;this._points.forEach((s=>{s&&(i?(t.moveTo(s._point.x,s._point.y),i=!1):s._point.z<1&&e.z<1?t.lineTo(s._point.x,s._point.y):t.moveTo(s._point.x,s._point.y),e=s._point)})),t.stroke(),t.restore()}_additionalProcessing(){this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((t=>{t&&(t.translate(),(null==this._minX||t._point.x<this._minX)&&(this._minX=t._point.x),(null==this._minY||t._point.y<this._minY)&&(this._minY=t._point.y),(null==this._maxX||t._point.x>this._maxX)&&(this._maxX=t._point.x),(null==this._maxY||t._point.y>this._maxY)&&(this._maxY=t._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)}_measure(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)}_computeAlignment(){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)}dispose(){this.reset(),super.dispose()}}(0,r.gn)([(0,_.qC)()],P.prototype,"dash",null),(0,l.H)("BABYLON.GUI.MultiLine",P);class L extends o.o{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get checkSizeRatio(){return this._checkSizeRatio}set checkSizeRatio(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get isChecked(){return this._isChecked}set isChecked(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t),this._isChecked&&this._host&&this._host.executeOnAllControls((t=>{if(t===this)return;if(void 0===t.group)return;const e=t;e.group===this.group&&(e.isChecked=!1)})))}constructor(t){super(t),this.name=t,this._isChecked=!1,this._background="black",this._checkSizeRatio=.8,this._thickness=1,this.group="",this.onIsCheckedChangedObservable=new n.y$,this.isPointerBlocker=!0}_getTypeName(){return"RadioButton"}_draw(t){t.save(),this._applyStates(t);const e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),o.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this.color,t.lineWidth=this._thickness,t.stroke(),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;const s=e*this._checkSizeRatio,r=i*this._checkSizeRatio;o.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,s/2-this._thickness/2,r/2-this._thickness/2,t),t.fill()}t.restore()}_onPointerDown(t,e,i,s,r){return!!super._onPointerDown(t,e,i,s,r)&&(this.isReadOnly||this.isChecked||(this.isChecked=!0),!0)}static AddRadioButtonWithHeader(t,e,i,s){const r=new h.e;r.isVertical=!1,r.height="30px";const n=new L;n.width="20px",n.height="20px",n.isChecked=i,n.color="green",n.group=e,n.onIsCheckedChangedObservable.add((t=>s(n,t))),r.addControl(n);const l=new a.a;return l.text=t,l.width="180px",l.paddingLeft="5px",l.textHorizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,l.color="white",r.addControl(l),r}}(0,r.gn)([(0,_.qC)()],L.prototype,"thickness",null),(0,r.gn)([(0,_.qC)()],L.prototype,"group",void 0),(0,r.gn)([(0,_.qC)()],L.prototype,"checkSizeRatio",null),(0,r.gn)([(0,_.qC)()],L.prototype,"background",null),(0,r.gn)([(0,_.qC)()],L.prototype,"isChecked",null),(0,l.H)("BABYLON.GUI.RadioButton",L);class k extends o.o{get displayThumb(){return this._displayThumb}set displayThumb(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())}get step(){return this._step}set step(t){this._step!==t&&(this._step=t,this._markAsDirty())}get barOffset(){return this._barOffset.toString(this._host)}get barOffsetInPixels(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)}set barOffset(t){this._barOffset.toString(this._host)!==t&&this._barOffset.fromString(t)&&this._markAsDirty()}get thumbWidth(){return this._thumbWidth.toString(this._host)}get thumbWidthInPixels(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)}set thumbWidth(t){this._thumbWidth.toString(this._host)!==t&&this._thumbWidth.fromString(t)&&this._markAsDirty()}get minimum(){return this._minimum}set minimum(t){this._minimum!==t&&(this._minimum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get maximum(){return this._maximum}set maximum(t){this._maximum!==t&&(this._maximum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))}get value(){return this._value}set value(t){t=Math.max(Math.min(t,this._maximum),this._minimum),this._value!==t&&(this._value=t,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))}get isVertical(){return this._isVertical}set isVertical(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())}get isThumbClamped(){return this._isThumbClamped}set isThumbClamped(t){this._isThumbClamped!==t&&(this._isThumbClamped=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thumbWidth=new g.s(20,g.s.UNITMODE_PIXEL,!1),this._minimum=0,this._maximum=100,this._value=50,this._isVertical=!1,this._barOffset=new g.s(5,g.s.UNITMODE_PIXEL,!1),this._isThumbClamped=!1,this._displayThumb=!0,this._step=0,this._lastPointerDownId=-1,this._effectiveBarOffset=0,this.onValueChangedObservable=new n.y$,this._pointerIsDown=!1,this.isPointerBlocker=!0}_getTypeName(){return"BaseSlider"}_getThumbPosition(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength}_getThumbThickness(t){let e=0;switch(t){case"circle":e=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":e=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return e}_prepareRenderingData(t){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(t),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))}_updateValueFromPointer(t,e){let i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum),this.value=this._step?Math.round(i/this._step)*this._step:i}_onPointerDown(t,e,i,s,r){return!!super._onPointerDown(t,e,i,s,r)&&(this.isReadOnly||(this._pointerIsDown=!0,this._updateValueFromPointer(e.x,e.y),this._host._capturingControl[i]=this,this._lastPointerDownId=i),!0)}_onPointerMove(t,e,i,s){i==this._lastPointerDownId&&(this._pointerIsDown&&!this.isReadOnly&&this._updateValueFromPointer(e.x,e.y),super._onPointerMove(t,e,i,s))}_onPointerUp(t,e,i,s,r){this._pointerIsDown=!1,delete this._host._capturingControl[i],super._onPointerUp(t,e,i,s,r)}_onCanvasBlur(){this._forcePointerUp(),super._onCanvasBlur()}}(0,r.gn)([(0,_.qC)()],k.prototype,"displayThumb",null),(0,r.gn)([(0,_.qC)()],k.prototype,"step",null),(0,r.gn)([(0,_.qC)()],k.prototype,"barOffset",null),(0,r.gn)([(0,_.qC)()],k.prototype,"thumbWidth",null),(0,r.gn)([(0,_.qC)()],k.prototype,"minimum",null),(0,r.gn)([(0,_.qC)()],k.prototype,"maximum",null),(0,r.gn)([(0,_.qC)()],k.prototype,"value",null),(0,r.gn)([(0,_.qC)()],k.prototype,"isVertical",null),(0,r.gn)([(0,_.qC)()],k.prototype,"isThumbClamped",null);class N extends k{get displayValueBar(){return this._displayValueBar}set displayValueBar(t){this._displayValueBar!==t&&(this._displayValueBar=t,this._markAsDirty())}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get thumbColor(){return this._thumbColor}set thumbColor(t){this._thumbColor!==t&&(this._thumbColor=t,this._markAsDirty())}get isThumbCircle(){return this._isThumbCircle}set isThumbCircle(t){this._isThumbCircle!==t&&(this._isThumbCircle=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._background="black",this._borderColor="white",this._thumbColor="",this._isThumbCircle=!1,this._displayValueBar=!0,this._backgroundGradient=null}_getTypeName(){return"Slider"}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");let e=this._renderLeft,i=this._renderTop;const s=this._renderWidth,r=this._renderHeight;let n=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?i+=this._effectiveThumbThickness/2:e+=this._effectiveThumbThickness/2,n=this._backgroundBoxThickness/2):n=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY);const o=this._getThumbPosition();t.fillStyle=this._getBackgroundColor(t),this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i,n,Math.PI,2*Math.PI),t.fill(),t.fillRect(e,i,s,r)):t.fillRect(e,i,s,r+this._effectiveThumbThickness):t.fillRect(e,i,s,r):this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxLength,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill(),t.fillRect(e,i,s,r)):t.fillRect(e,i,s+this._effectiveThumbThickness,r):t.fillRect(e,i,s,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillStyle=this._getColor(t),this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i+this._backgroundBoxLength,n,0,2*Math.PI),t.fill(),t.fillRect(e,i+o,s,r-o)):t.fillRect(e,i+o,s,r-o+this._effectiveThumbThickness):t.fillRect(e,i+o,s,r-o):this.isThumbClamped&&this.isThumbCircle?(t.beginPath(),t.arc(e,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill(),t.fillRect(e,i,o,r)):t.fillRect(e,i,o,r)),t.fillStyle=this._thumbColor||this._getColor(t),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(t.beginPath(),this.isVertical?t.arc(e+this._backgroundBoxThickness/2,i+o,n,0,2*Math.PI):t.arc(e+o,i+this._backgroundBoxThickness/2,n,0,2*Math.PI),t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,t.stroke()):(this.isVertical?t.fillRect(e-this._effectiveBarOffset,this._currentMeasure.top+o,this._currentMeasure.width,this._effectiveThumbThickness):t.fillRect(this._currentMeasure.left+o,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,this.isVertical?t.strokeRect(e-this._effectiveBarOffset,this._currentMeasure.top+o,this._currentMeasure.width,this._effectiveThumbThickness):t.strokeRect(this._currentMeasure.left+o,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),t.restore()}serialize(t){super.serialize(t),this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient))}_parseFromContent(t,e){if(super._parseFromContent(t,e),t.backgroundGradient){const e=b.w1.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this.backgroundGradient=new e,this.backgroundGradient.parse(t.backgroundGradient)}}}(0,r.gn)([(0,_.qC)()],N.prototype,"displayValueBar",null),(0,r.gn)([(0,_.qC)()],N.prototype,"borderColor",null),(0,r.gn)([(0,_.qC)()],N.prototype,"background",null),(0,r.gn)([(0,_.qC)()],N.prototype,"thumbColor",null),(0,r.gn)([(0,_.qC)()],N.prototype,"isThumbCircle",null),(0,l.H)("BABYLON.GUI.Slider",N);var B=i(8147);class F extends x.W{get freezeControls(){return this._freezeControls}set freezeControls(t){if(this._freezeControls===t)return;t||this._restoreMeasures(),this._freezeControls=!1;const e=this.host.getSize(),i=e.width,s=e.height,r=this.host.getContext(),n=new B.U(0,0,i,s);this.host._numLayoutCalls=0,this.host._rootContainer._layout(n,r),t&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=t,this.host.markAsDirty()}get bucketWidth(){return this._bucketWidth}get bucketHeight(){return this._bucketHeight}setBucketSizes(t,e){this._bucketWidth=t,this._bucketHeight=e,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}}_useBuckets(){return this._bucketWidth>0&&this._bucketHeight>0}_makeBuckets(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null}_dispatchInBuckets(t){for(let e=0;e<t.length;++e){const i=t[e],s=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),r=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),n=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight);let o=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight));for(;o<=n;){for(let t=s;t<=r;++t){const e=o*this._bucketLen+t;let s=this._buckets[e];s||(s=[],this._buckets[e]=s),s.push(i)}o++}i instanceof x.W&&i._children.length>0&&this._dispatchInBuckets(i._children)}}_updateMeasures(){const t=0|this.leftInPixels,e=0|this.topInPixels;this._measureForChildren.left-=t,this._measureForChildren.top-=e,this._currentMeasure.left-=t,this._currentMeasure.top-=e,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,t,e)}_updateChildrenMeasures(t,e,i){for(let s=0;s<t.length;++s){const r=t[s];r._currentMeasure.left-=e,r._currentMeasure.top-=i,r._customData._origLeft=r._currentMeasure.left,r._customData._origTop=r._currentMeasure.top,r instanceof x.W&&r._children.length>0&&this._updateChildrenMeasures(r._children,e,i)}}_restoreMeasures(){const t=0|this.leftInPixels,e=0|this.topInPixels;this._measureForChildren.left=this._customData.origLeftForChildren+t,this._measureForChildren.top=this._customData.origTopForChildren+e,this._currentMeasure.left=this._customData.origLeft+t,this._currentMeasure.top=this._customData.origTop+e}constructor(t){super(t),this._freezeControls=!1,this._bucketWidth=0,this._bucketHeight=0,this._buckets={}}_getTypeName(){return"ScrollViewerWindow"}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._parentMeasure=t,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=t.width,this._measureForChildren.height=t.height}_layout(t,e){return this._freezeControls?(this.invalidateRect(),!1):super._layout(t,e)}_scrollChildren(t,e,i){for(let s=0;s<t.length;++s){const r=t[s];r._currentMeasure.left=r._customData._origLeft+e,r._currentMeasure.top=r._customData._origTop+i,r._isClipped=!1,r instanceof x.W&&r._children.length>0&&this._scrollChildren(r._children,e,i)}}_scrollChildrenWithBuckets(t,e,i,s){const r=Math.max(0,Math.floor(-t/this._bucketWidth)),n=Math.floor((-t+this._parentMeasure.width-1)/this._bucketWidth),o=Math.floor((-e+this._parentMeasure.height-1)/this._bucketHeight);let h=Math.max(0,Math.floor(-e/this._bucketHeight));for(;h<=o;){for(let t=r;t<=n;++t){const e=h*this._bucketLen+t,r=this._buckets[e];if(r)for(let t=0;t<r.length;++t){const e=r[t];e._currentMeasure.left=e._customData._origLeft+i,e._currentMeasure.top=e._customData._origTop+s,e._isClipped=!1}}h++}}_draw(t,e){if(!this._freezeControls)return void super._draw(t,e);this._localDraw(t),this.clipChildren&&this._clipForChildren(t);const i=0|this.leftInPixels,s=0|this.topInPixels;this._useBuckets()&&null!==this._oldLeft&&null!==this._oldTop?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,i,s),this._scrollChildrenWithBuckets(i,s,i,s)):this._scrollChildren(this._children,i,s),this._oldLeft=i,this._oldTop=s;for(const e of this._children)e._intersectsRect(this._parentMeasure)&&e._render(t,this._parentMeasure)}_postMeasure(){if(this._freezeControls)return void super._postMeasure();let t=this.parentClientWidth,e=this.parentClientHeight;for(const i of this.children)i.isVisible&&!i.notRenderable&&(i.horizontalAlignment===o.o.HORIZONTAL_ALIGNMENT_CENTER&&i._offsetLeft(this._currentMeasure.left-i._currentMeasure.left),i.verticalAlignment===o.o.VERTICAL_ALIGNMENT_CENTER&&i._offsetTop(this._currentMeasure.top-i._currentMeasure.top),t=Math.max(t,i._currentMeasure.left-this._currentMeasure.left+i._currentMeasure.width+i.paddingRightInPixels),e=Math.max(e,i._currentMeasure.top-this._currentMeasure.top+i._currentMeasure.height+i.paddingBottomInPixels));this._currentMeasure.width!==t&&(this._width.updateInPlace(t,g.s.UNITMODE_PIXEL),this._currentMeasure.width=t,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==e&&(this._height.updateInPlace(e,g.s.UNITMODE_PIXEL),this._currentMeasure.height=e,this._rebuildLayout=!0,this._isDirty=!0),super._postMeasure()}}class W extends k{get borderColor(){return this._borderColor}set borderColor(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(t){this._backgroundGradient!==t&&(this._backgroundGradient=t,this._markAsDirty())}get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(t){this._invertScrollDirection=t}constructor(t){super(t),this.name=t,this._background="black",this._borderColor="white",this._tempMeasure=new B.U(0,0,0,0),this._invertScrollDirection=!1,this._backgroundGradient=null}_getTypeName(){return"Scrollbar"}_getThumbThickness(){let t=0;return t=this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),t}_getBackgroundColor(t){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(t):this._background}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._renderLeft,i=this._getThumbPosition();t.fillStyle=this._getBackgroundColor(t),t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.fillStyle=this._getColor(t),this.isVertical?(this._tempMeasure.left=e-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),t.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),t.restore()}_updateValueFromPointer(t,e){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-(e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=t,this._originY=e}_onPointerDown(t,e,i,s,r){return this._first=!0,super._onPointerDown(t,e,i,s,r)}serialize(t){super.serialize(t),this.backgroundGradient&&(t.backgroundGradient={},this.backgroundGradient.serialize(t.backgroundGradient))}_parseFromContent(t,e){if(super._parseFromContent(t,e),t.backgroundGradient){const e=b.w1.Instantiate("BABYLON.GUI."+t.backgroundGradient.className);this.backgroundGradient=new e,this.backgroundGradient.parse(t.backgroundGradient)}}}(0,r.gn)([(0,_.qC)()],W.prototype,"borderColor",null),(0,r.gn)([(0,_.qC)()],W.prototype,"background",null),(0,r.gn)([(0,_.qC)()],W.prototype,"invertScrollDirection",null),(0,l.H)("BABYLON.GUI.Scrollbar",W);class V extends k{get invertScrollDirection(){return this._invertScrollDirection}set invertScrollDirection(t){this._invertScrollDirection=t}get backgroundImage(){return this._backgroundBaseImage}set backgroundImage(t){this._backgroundBaseImage!==t&&(this._backgroundBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._backgroundImage=t._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce((()=>{const e=t._rotate90(this.num90RotationInVerticalMode,!0);this._backgroundImage=e,e.isLoaded||e.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()})):(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()))}get thumbImage(){return this._thumbBaseImage}set thumbImage(t){this._thumbBaseImage!==t&&(this._thumbBaseImage=t,this.isVertical&&0!==this.num90RotationInVerticalMode?t.isLoaded?(this._thumbImage=t._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):t.onImageLoadedObservable.addOnce((()=>{const e=t._rotate90(-this.num90RotationInVerticalMode,!0);this._thumbImage=e,e.isLoaded||e.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()})):(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((()=>{this._markAsDirty()})),this._markAsDirty()))}get thumbLength(){return this._thumbLength}set thumbLength(t){this._thumbLength!==t&&(this._thumbLength=t,this._markAsDirty())}get thumbHeight(){return this._thumbHeight}set thumbHeight(t){this._thumbLength!==t&&(this._thumbHeight=t,this._markAsDirty())}get barImageHeight(){return this._barImageHeight}set barImageHeight(t){this._barImageHeight!==t&&(this._barImageHeight=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._tempMeasure=new B.U(0,0,0,0),this._invertScrollDirection=!1,this.num90RotationInVerticalMode=1}_getTypeName(){return"ImageScrollBar"}_getThumbThickness(){let t=0;return t=this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host),t}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,n),this.isVertical?(this._tempMeasure.copyFromFloats(i+r*(1-this._barImageHeight)*.5,this._currentMeasure.top,r*this._barImageHeight,n),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,s+n*(1-this._barImageHeight)*.5,r,n*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(t)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+e,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()}_updateValueFromPointer(t,e){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y);const i=this._invertScrollDirection?-1:1;this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));let s=0;s=this.isVertical?-(e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*s*(this.maximum-this.minimum),this._originX=t,this._originY=e}_onPointerDown(t,e,i,s,r){return this._first=!0,super._onPointerDown(t,e,i,s,r)}}(0,r.gn)([(0,_.qC)()],V.prototype,"num90RotationInVerticalMode",void 0),(0,r.gn)([(0,_.qC)()],V.prototype,"invertScrollDirection",null);class H extends m.A{get horizontalBar(){return this._horizontalBar}get verticalBar(){return this._verticalBar}addControl(t){return t?(this._window.addControl(t),this):this}removeControl(t){return this._window.removeControl(t),this}get children(){return this._window.children}_flagDescendantsAsMatrixDirty(){for(const t of this._children)t._markMatrixAsDirty()}get freezeControls(){return this._window.freezeControls}set freezeControls(t){this._window.freezeControls=t}get bucketWidth(){return this._window.bucketWidth}get bucketHeight(){return this._window.bucketHeight}setBucketSizes(t,e){this._window.setBucketSizes(t,e)}get forceHorizontalBar(){return this._forceHorizontalBar}set forceHorizontalBar(t){this._grid.setRowDefinition(1,t?this._barSize:0,!0),this._horizontalBar.isVisible=t,this._forceHorizontalBar=t}get forceVerticalBar(){return this._forceVerticalBar}set forceVerticalBar(t){this._grid.setColumnDefinition(1,t?this._barSize:0,!0),this._verticalBar.isVisible=t,this._forceVerticalBar=t}constructor(t,e){super(t),this._barSize=20,this._pointerIsOver=!1,this._wheelPrecision=.05,this._thumbLength=.5,this._thumbHeight=1,this._barImageHeight=1,this._horizontalBarImageHeight=1,this._verticalBarImageHeight=1,this._oldWindowContentsWidth=0,this._oldWindowContentsHeight=0,this._forceHorizontalBar=!1,this._forceVerticalBar=!1,this._useImageBar=e||!1,this.onDirtyObservable.add((()=>{this._horizontalBarSpace.color=this.color,this._verticalBarSpace.color=this.color,this._dragSpace.color=this.color})),this.onPointerEnterObservable.add((()=>{this._pointerIsOver=!0})),this.onPointerOutObservable.add((()=>{this._pointerIsOver=!1})),this._grid=new I,this._useImageBar?(this._horizontalBar=new V,this._verticalBar=new V):(this._horizontalBar=new W,this._verticalBar=new W),this._window=new F("scrollViewer_window"),this._window.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._window.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,this._grid.addColumnDefinition(1),this._grid.addColumnDefinition(0,!0),this._grid.addRowDefinition(1),this._grid.addRowDefinition(0,!0),super.addControl(this._grid),this._grid.addControl(this._window,0,0),this._verticalBarSpace=new m.A,this._verticalBarSpace.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._verticalBarSpace.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,this._verticalBarSpace.thickness=1,this._grid.addControl(this._verticalBarSpace,0,1),this._addBar(this._verticalBar,this._verticalBarSpace,!0,Math.PI),this._horizontalBarSpace=new m.A,this._horizontalBarSpace.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,this._horizontalBarSpace.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP,this._horizontalBarSpace.thickness=1,this._grid.addControl(this._horizontalBarSpace,1,0),this._addBar(this._horizontalBar,this._horizontalBarSpace,!1,0),this._dragSpace=new m.A,this._dragSpace.thickness=1,this._grid.addControl(this._dragSpace,1,1),this._useImageBar||(this.barColor="grey",this.barBackground="transparent")}resetWindow(){this._window.width="100%",this._window.height="100%"}_getTypeName(){return"ScrollViewer"}_buildClientSizes(){const t=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*t:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*t:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._buildClientSizes()}_postMeasure(){super._postMeasure(),this._updateScroller(),this._setWindowPosition(!1)}get wheelPrecision(){return this._wheelPrecision}set wheelPrecision(t){this._wheelPrecision!==t&&(t<0&&(t=0),t>1&&(t=1),this._wheelPrecision=t)}get scrollBackground(){return this._horizontalBarSpace.background}set scrollBackground(t){this._horizontalBarSpace.background!==t&&(this._horizontalBarSpace.background=t,this._verticalBarSpace.background=t)}get barColor(){return this._barColor}set barColor(t){this._barColor!==t&&(this._barColor=t,this._horizontalBar.color=t,this._verticalBar.color=t)}get thumbImage(){return this._barImage}set thumbImage(t){if(this._barImage===t)return;this._barImage=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbImage=t,i.thumbImage=t}get horizontalThumbImage(){return this._horizontalBarImage}set horizontalThumbImage(t){this._horizontalBarImage!==t&&(this._horizontalBarImage=t,this._horizontalBar.thumbImage=t)}get verticalThumbImage(){return this._verticalBarImage}set verticalThumbImage(t){this._verticalBarImage!==t&&(this._verticalBarImage=t,this._verticalBar.thumbImage=t)}get barSize(){return this._barSize}set barSize(t){this._barSize!==t&&(this._barSize=t,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))}get thumbLength(){return this._thumbLength}set thumbLength(t){if(this._thumbLength===t)return;t<=0&&(t=.1),t>1&&(t=1),this._thumbLength=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbLength=t,i.thumbLength=t,this._markAsDirty()}get thumbHeight(){return this._thumbHeight}set thumbHeight(t){if(this._thumbHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._thumbHeight=t;const e=this._horizontalBar,i=this._verticalBar;e.thumbHeight=t,i.thumbHeight=t,this._markAsDirty()}get barImageHeight(){return this._barImageHeight}set barImageHeight(t){if(this._barImageHeight===t)return;t<=0&&(t=.1),t>1&&(t=1),this._barImageHeight=t;const e=this._horizontalBar,i=this._verticalBar;e.barImageHeight=t,i.barImageHeight=t,this._markAsDirty()}get horizontalBarImageHeight(){return this._horizontalBarImageHeight}set horizontalBarImageHeight(t){this._horizontalBarImageHeight!==t&&(t<=0&&(t=.1),t>1&&(t=1),this._horizontalBarImageHeight=t,this._horizontalBar.barImageHeight=t,this._markAsDirty())}get verticalBarImageHeight(){return this._verticalBarImageHeight}set verticalBarImageHeight(t){this._verticalBarImageHeight!==t&&(t<=0&&(t=.1),t>1&&(t=1),this._verticalBarImageHeight=t,this._verticalBar.barImageHeight=t,this._markAsDirty())}get barBackground(){return this._barBackground}set barBackground(t){if(this._barBackground===t)return;this._barBackground=t;const e=this._horizontalBar,i=this._verticalBar;e.background=t,i.background=t,this._dragSpace.background=t}get barImage(){return this._barBackgroundImage}set barImage(t){this._barBackgroundImage=t;const e=this._horizontalBar,i=this._verticalBar;e.backgroundImage=t,i.backgroundImage=t}get horizontalBarImage(){return this._horizontalBarBackgroundImage}set horizontalBarImage(t){this._horizontalBarBackgroundImage=t,this._horizontalBar.backgroundImage=t}get verticalBarImage(){return this._verticalBarBackgroundImage}set verticalBarImage(t){this._verticalBarBackgroundImage=t,this._verticalBar.backgroundImage=t}_setWindowPosition(t=!0){const e=this.host.idealRatio,i=this._window._currentMeasure.width,s=this._window._currentMeasure.height;if(!t&&this._oldWindowContentsWidth===i&&this._oldWindowContentsHeight===s)return;this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=s;const r=this._clientWidth-i,n=this._clientHeight-s,o=this._horizontalBar.value/e*r+"px",h=this._verticalBar.value/e*n+"px";o!==this._window.left&&(this._window.left=o,this.freezeControls||(this._rebuildLayout=!0)),h!==this._window.top&&(this._window.top=h,this.freezeControls||(this._rebuildLayout=!0))}_updateScroller(){const t=this._window._currentMeasure.width,e=this._window._currentMeasure.height;this._horizontalBar.isVisible&&t<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(t>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&e<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(e>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();const i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"}_link(t){super._link(t),this._attachWheel()}_addBar(t,e,i,s){t.paddingLeft=0,t.width="100%",t.height="100%",t.barOffset=0,t.value=0,t.maximum=1,t.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,t.isVertical=i,t.rotation=s,t.isVisible=!1,e.addControl(t),t.onValueChangedObservable.add((()=>{this._setWindowPosition()}))}_attachWheel(){this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add((t=>{this._pointerIsOver&&!this.isReadOnly&&(1==this._verticalBar.isVisible&&(t.y<0&&this._verticalBar.value>0?this._verticalBar.value-=this._wheelPrecision:t.y>0&&this._verticalBar.value<this._verticalBar.maximum&&(this._verticalBar.value+=this._wheelPrecision)),1==this._horizontalBar.isVisible&&(t.x<0&&this._horizontalBar.value<this._horizontalBar.maximum?this._horizontalBar.value+=this._wheelPrecision:t.x>0&&this._horizontalBar.value>0&&(this._horizontalBar.value-=this._wheelPrecision)))})))}_renderHighlightSpecific(t){this.isHighlighted&&(super._renderHighlightSpecific(t),this._grid._renderHighlightSpecific(t),t.restore())}dispose(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,super.dispose()}}(0,r.gn)([(0,_.qC)()],H.prototype,"wheelPrecision",null),(0,r.gn)([(0,_.qC)()],H.prototype,"scrollBackground",null),(0,r.gn)([(0,_.qC)()],H.prototype,"barColor",null),(0,r.gn)([(0,_.qC)()],H.prototype,"barSize",null),(0,r.gn)([(0,_.qC)()],H.prototype,"barBackground",null),(0,l.H)("BABYLON.GUI.ScrollViewer",H);class U extends m.A{get group(){return this._group}set group(t){this._group!==t&&(this._group=t)}get isActive(){return this._isActive}set isActive(t){var e,i;this._isActive!==t&&(this._isActive=t,this._isActive?null===(e=this.toActiveAnimation)||void 0===e||e.call(this):null===(i=this.toInactiveAnimation)||void 0===i||i.call(this),this._markAsDirty(),this.onIsActiveChangedObservable.notifyObservers(t),this._isActive&&this._host&&this._group&&this._host.executeOnAllControls((t=>{if("ToggleButton"===t.typeName){if(t===this)return;const e=t;e.group===this.group&&(e.isActive=!1)}})))}constructor(t,e){super(t),this.name=t,this.onIsActiveChangedObservable=new n.y$,this.delegatePickingToChildren=!1,this._isActive=!1,this.group=null!=e?e:"",this.thickness=0,this.isPointerBlocker=!0;let i=null;this.toActiveAnimation=()=>{this.thickness=1},this.toInactiveAnimation=()=>{this.thickness=0},this.pointerEnterActiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutActiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownActiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpActiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05},this.pointerEnterInactiveAnimation=()=>{i=this.alpha,this.alpha-=.1},this.pointerOutInactiveAnimation=()=>{null!==i&&(this.alpha=i)},this.pointerDownInactiveAnimation=()=>{this.scaleX-=.05,this.scaleY-=.05},this.pointerUpInactiveAnimation=()=>{this.scaleX+=.05,this.scaleY+=.05}}_getTypeName(){return"ToggleButton"}_processPicking(t,e,i,s,r,n,o,h){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!super.contains(t,e))return!1;if(this.delegatePickingToChildren){let i=!1;for(let s=this._children.length-1;s>=0;s--){const r=this._children[s];if(r.isEnabled&&r.isHitTestVisible&&r.isVisible&&!r.notRenderable&&r.contains(t,e)){i=!0;break}}if(!i)return!1}return this._processObservables(s,t,e,i,r,n,o,h),!0}_onPointerEnter(t,e){return!!super._onPointerEnter(t,e)&&(this.isReadOnly||(this._isActive?this.pointerEnterActiveAnimation&&this.pointerEnterActiveAnimation():this.pointerEnterInactiveAnimation&&this.pointerEnterInactiveAnimation()),!0)}_onPointerOut(t,e,i=!1){this.isReadOnly||(this._isActive?this.pointerOutActiveAnimation&&this.pointerOutActiveAnimation():this.pointerOutInactiveAnimation&&this.pointerOutInactiveAnimation()),super._onPointerOut(t,e,i)}_onPointerDown(t,e,i,s,r){return!!super._onPointerDown(t,e,i,s,r)&&(this.isReadOnly||(this._isActive?this.pointerDownActiveAnimation&&this.pointerDownActiveAnimation():this.pointerDownInactiveAnimation&&this.pointerDownInactiveAnimation()),!0)}_onPointerUp(t,e,i,s,r,n){this.isReadOnly||(this._isActive?this.pointerUpActiveAnimation&&this.pointerUpActiveAnimation():this.pointerUpInactiveAnimation&&this.pointerUpInactiveAnimation()),super._onPointerUp(t,e,i,s,r,n)}}(0,l.H)("BABYLON.GUI.ToggleButton",U);class z extends h.e{constructor(){super(...arguments),this.onKeyPressObservable=new n.y$,this.defaultButtonWidth="40px",this.defaultButtonHeight="40px",this.defaultButtonPaddingLeft="2px",this.defaultButtonPaddingRight="2px",this.defaultButtonPaddingTop="2px",this.defaultButtonPaddingBottom="2px",this.defaultButtonColor="#DDD",this.defaultButtonBackground="#070707",this.shiftButtonColor="#7799FF",this.selectedShiftThickness=1,this.shiftState=0,this._currentlyConnectedInputText=null,this._connectedInputTexts=[],this._onKeyPressObserver=null}_getTypeName(){return"VirtualKeyboard"}_createKey(t,e){const i=s.z.CreateSimpleButton(t,t);return i.width=e&&e.width?e.width:this.defaultButtonWidth,i.height=e&&e.height?e.height:this.defaultButtonHeight,i.color=e&&e.color?e.color:this.defaultButtonColor,i.background=e&&e.background?e.background:this.defaultButtonBackground,i.paddingLeft=e&&e.paddingLeft?e.paddingLeft:this.defaultButtonPaddingLeft,i.paddingRight=e&&e.paddingRight?e.paddingRight:this.defaultButtonPaddingRight,i.paddingTop=e&&e.paddingTop?e.paddingTop:this.defaultButtonPaddingTop,i.paddingBottom=e&&e.paddingBottom?e.paddingBottom:this.defaultButtonPaddingBottom,i.thickness=0,i.isFocusInvisible=!0,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.onPointerUpObservable.add((()=>{this.onKeyPressObservable.notifyObservers(t)})),i}addKeysRow(t,e){const i=new h.e;i.isVertical=!1,i.isFocusInvisible=!0;let s=null;for(let r=0;r<t.length;r++){let n=null;e&&e.length===t.length&&(n=e[r]);const o=this._createKey(t[r],n);(!s||o.heightInPixels>s.heightInPixels)&&(s=o),i.addControl(o)}i.height=s?s.height:this.defaultButtonHeight,this.addControl(i)}applyShiftState(t){if(this.children)for(let e=0;e<this.children.length;e++){const i=this.children[e];if(!i||!i.children)continue;const s=i;for(let e=0;e<s.children.length;e++){const i=s.children[e];if(!i||!i.children[0])continue;const r=i.children[0];""===r.text&&(i.color=t?this.shiftButtonColor:this.defaultButtonColor,i.thickness=t>1?this.selectedShiftThickness:0),r.text=t>0?r.text.toUpperCase():r.text.toLowerCase()}}}get connectedInputText(){return this._currentlyConnectedInputText}connect(t){if(this._connectedInputTexts.some((e=>e.input===t)))return;null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add((t=>{if(this._currentlyConnectedInputText){switch(this._currentlyConnectedInputText._host.focusedControl=this._currentlyConnectedInputText,t){case"":return this.shiftState++,this.shiftState>2&&(this.shiftState=0),void this.applyShiftState(this.shiftState);case"":return void(this._currentlyConnectedInputText instanceof O?this._currentlyConnectedInputText.alternativeProcessKey("Backspace"):this._currentlyConnectedInputText.processKey(8));case"":return void(this._currentlyConnectedInputText instanceof O?this._currentlyConnectedInputText.alternativeProcessKey("Enter"):this._currentlyConnectedInputText.processKey(13))}this._currentlyConnectedInputText instanceof O?this._currentlyConnectedInputText.alternativeProcessKey("",this.shiftState?t.toUpperCase():t):this._currentlyConnectedInputText.processKey(-1,this.shiftState?t.toUpperCase():t),1===this.shiftState&&(this.shiftState=0,this.applyShiftState(this.shiftState))}}))),this.isVisible=!1,this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this;const e=t.onFocusObservable.add((()=>{this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this,this.isVisible=!0})),i=t.onBlurObservable.add((()=>{t._connectedVirtualKeyboard=null,this._currentlyConnectedInputText=null,this.isVisible=!1}));this._connectedInputTexts.push({input:t,onBlurObserver:i,onFocusObserver:e})}disconnect(t){if(t){const e=this._connectedInputTexts.filter((e=>e.input===t));1===e.length&&(this._removeConnectedInputObservables(e[0]),this._connectedInputTexts=this._connectedInputTexts.filter((e=>e.input!==t)),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach((t=>{this._removeConnectedInputObservables(t)})),this._connectedInputTexts.length=0;0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)}_removeConnectedInputObservables(t){t.input._connectedVirtualKeyboard=null,t.input.onFocusObservable.remove(t.onFocusObserver),t.input.onBlurObservable.remove(t.onBlurObserver)}dispose(){super.dispose(),this.disconnect()}static CreateDefaultLayout(t){const e=new z(t);return e.addKeysRow(["1","2","3","4","5","6","7","8","9","0",""]),e.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),e.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'",""]),e.addKeysRow(["","z","x","c","v","b","n","m",",",".","/"]),e.addKeysRow([" "],[{width:"200px"}]),e}_parseFromContent(t,e){super._parseFromContent(t,e);for(const t of this.children)if("StackPanel"===t.getClassName()){const e=t;for(const t of e.children)"Button"===t.getClassName()&&t.name&&t.onPointerUpObservable.add((()=>{this.onKeyPressObservable.notifyObservers(t.name)}))}}}(0,l.H)("BABYLON.GUI.VirtualKeyboard",z);class G extends o.o{get displayMinorLines(){return this._displayMinorLines}set displayMinorLines(t){this._displayMinorLines!==t&&(this._displayMinorLines=t,this._markAsDirty())}get displayMajorLines(){return this._displayMajorLines}set displayMajorLines(t){this._displayMajorLines!==t&&(this._displayMajorLines=t,this._markAsDirty())}get background(){return this._background}set background(t){this._background!==t&&(this._background=t,this._markAsDirty())}get cellWidth(){return this._cellWidth}set cellWidth(t){this._cellWidth=t,this._markAsDirty()}get cellHeight(){return this._cellHeight}set cellHeight(t){this._cellHeight=t,this._markAsDirty()}get minorLineTickness(){return this._minorLineTickness}set minorLineTickness(t){this._minorLineTickness=t,this._markAsDirty()}get minorLineColor(){return this._minorLineColor}set minorLineColor(t){this._minorLineColor=t,this._markAsDirty()}get majorLineTickness(){return this._majorLineTickness}set majorLineTickness(t){this._majorLineTickness=t,this._markAsDirty()}get majorLineColor(){return this._majorLineColor}set majorLineColor(t){this._majorLineColor=t,this._markAsDirty()}get majorLineFrequency(){return this._majorLineFrequency}set majorLineFrequency(t){this._majorLineFrequency=t,this._markAsDirty()}constructor(t){super(t),this.name=t,this._cellWidth=20,this._cellHeight=20,this._minorLineTickness=1,this._minorLineColor="DarkGray",this._majorLineTickness=2,this._majorLineColor="White",this._majorLineFrequency=5,this._background="Black",this._displayMajorLines=!0,this._displayMinorLines=!0}_draw(t){if(t.save(),this._applyStates(t),this._isEnabled){this._background&&(t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));const e=this._currentMeasure.width/this._cellWidth,i=this._currentMeasure.height/this._cellHeight,s=this._currentMeasure.left+this._currentMeasure.width/2,r=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){t.strokeStyle=this._minorLineColor,t.lineWidth=this._minorLineTickness;for(let i=-e/2+1;i<e/2;i++){const e=s+i*this.cellWidth;t.beginPath(),t.moveTo(e,this._currentMeasure.top),t.lineTo(e,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let e=-i/2+1;e<i/2;e++){const i=r+e*this.cellHeight;t.beginPath(),t.moveTo(this._currentMeasure.left,i),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),t.stroke()}}if(this._displayMajorLines){t.strokeStyle=this._majorLineColor,t.lineWidth=this._majorLineTickness;for(let i=-e/2+this._majorLineFrequency;i<e/2;i+=this._majorLineFrequency){const e=s+i*this.cellWidth;t.beginPath(),t.moveTo(e,this._currentMeasure.top),t.lineTo(e,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(let e=-i/2+this._majorLineFrequency;e<i/2;e+=this._majorLineFrequency){const i=r+e*this.cellHeight;t.moveTo(this._currentMeasure.left,i),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,i),t.closePath(),t.stroke()}}}t.restore()}_getTypeName(){return"DisplayGrid"}}(0,r.gn)([(0,_.qC)()],G.prototype,"displayMinorLines",null),(0,r.gn)([(0,_.qC)()],G.prototype,"displayMajorLines",null),(0,r.gn)([(0,_.qC)()],G.prototype,"background",null),(0,r.gn)([(0,_.qC)()],G.prototype,"cellWidth",null),(0,r.gn)([(0,_.qC)()],G.prototype,"cellHeight",null),(0,r.gn)([(0,_.qC)()],G.prototype,"minorLineTickness",null),(0,r.gn)([(0,_.qC)()],G.prototype,"minorLineColor",null),(0,r.gn)([(0,_.qC)()],G.prototype,"majorLineTickness",null),(0,r.gn)([(0,_.qC)()],G.prototype,"majorLineColor",null),(0,r.gn)([(0,_.qC)()],G.prototype,"majorLineFrequency",null),(0,l.H)("BABYLON.GUI.DisplayGrid",G);class X extends k{get displayThumb(){return this._displayThumb&&null!=this.thumbImage}set displayThumb(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())}get backgroundImage(){return this._backgroundImage}set backgroundImage(t){this._backgroundImage!==t&&(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}get valueBarImage(){return this._valueBarImage}set valueBarImage(t){this._valueBarImage!==t&&(this._valueBarImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}get thumbImage(){return this._thumbImage}set thumbImage(t){this._thumbImage!==t&&(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((()=>this._markAsDirty())),this._markAsDirty())}constructor(t){super(t),this.name=t,this._tempMeasure=new B.U(0,0,0,0)}_getTypeName(){return"ImageBasedSlider"}_draw(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");const e=this._getThumbPosition(),i=this._renderLeft,s=this._renderTop,r=this._renderWidth,n=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,s,r,n),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(t)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s+e,r,n-e+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(i,s+e,r,n-e):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,s,e+this._effectiveThumbThickness/2,n):this._tempMeasure.copyFromFloats(i,s,e,n),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(t)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset,this._currentMeasure.top+e,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()}serialize(t){super.serialize(t);const e={},i={},s={};this.backgroundImage.serialize(e),this.thumbImage.serialize(i),this.valueBarImage.serialize(s),t.backgroundImage=e,t.thumbImage=i,t.valueBarImage=s}_parseFromContent(t,e){super._parseFromContent(t,e),this.backgroundImage=v.E.Parse(t.backgroundImage,e),this.thumbImage=v.E.Parse(t.thumbImage,e),this.valueBarImage=v.E.Parse(t.valueBarImage,e)}}(0,r.gn)([(0,_.qC)()],X.prototype,"displayThumb",null),(0,l.H)("BABYLON.GUI.ImageBasedSlider",X),o.o.AddHeader=function(t,e,i,s){const r=new h.e("panel"),n=!s||s.isHorizontal,l=!s||s.controlFirst;r.isVertical=!n;const _=new a.a("header");return _.text=e,_.textHorizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT,n?_.width=i:_.height=i,l?(r.addControl(t),r.addControl(_),_.paddingLeft="5px"):(r.addControl(_),r.addControl(t),_.paddingRight="5px"),_.shadowBlur=t.shadowBlur,_.shadowColor=t.shadowColor,_.shadowOffsetX=t.shadowOffsetX,_.shadowOffsetY=t.shadowOffsetY,r};class Y{constructor(){this._colorStops=[],this._gradientDirty=!0}_addColorStopsToCanvasGradient(){for(const t of this._colorStops)this._canvasGradient.addColorStop(t.offset,t.color)}getCanvasGradient(t){return(this._gradientDirty||this._context!==t)&&(this._context=t,this._canvasGradient=this._createCanvasGradient(t),this._addColorStopsToCanvasGradient(),this._gradientDirty=!1),this._canvasGradient}addColorStop(t,e){this._colorStops.push({offset:t,color:e}),this._gradientDirty=!0}removeColorStop(t){this._colorStops=this._colorStops.filter((e=>e.offset!==t)),this._gradientDirty=!0}clearColorStops(){this._colorStops=[],this._gradientDirty=!0}get colorStops(){return this._colorStops}getClassName(){return"BaseGradient"}serialize(t){t.colorStops=this._colorStops,t.className=this.getClassName()}parse(t){this._colorStops=t.colorStops}}(0,l.H)("BABYLON.GUI.LinearGradient",class extends Y{constructor(t,e,i,s){super(),this._x0=null!=t?t:0,this._y0=null!=e?e:0,this._x1=null!=i?i:0,this._y1=null!=s?s:0}_createCanvasGradient(t){return t.createLinearGradient(this._x0,this._y0,this._x1,this._y1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}getClassName(){return"LinearGradient"}serialize(t){super.serialize(t),t.x0=this._x0,t.y0=this._y0,t.x1=this._x1,t.y1=this._y1}parse(t){super.parse(t),this._x0=t.x0,this._y0=t.y0,this._x1=t.x1,this._y1=t.y1}}),(0,l.H)("BABYLON.GUI.RadialGradient",class extends Y{constructor(t,e,i,s,r,n){super(),this._x0=null!=t?t:0,this._y0=null!=e?e:0,this._r0=null!=i?i:0,this._x1=null!=s?s:0,this._y1=null!=r?r:0,this._r1=null!=n?n:0}_createCanvasGradient(t){return t.createRadialGradient(this._x0,this._y0,this._r0,this._x1,this._y1,this._r1)}get x0(){return this._x0}get x1(){return this._x1}get y0(){return this._y0}get y1(){return this._y1}get r0(){return this._r0}get r1(){return this._r1}getClassName(){return"RadialGradient"}serialize(t){super.serialize(t),t.x0=this._x0,t.y0=this._y0,t.r0=this._r0,t.x1=this._x1,t.y1=this._y1,t.r1=this._r1}parse(t){super.parse(t),this._x0=t.x0,this._y0=t.y0,this._r0=t.r0,this._x1=t.x1,this._y1=t.y1,this._r1=t.r1}})},5767:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(1069),r=i(7034),n=i(646),o=i(8137);class h extends r.W{get thickness(){return this._thickness}set thickness(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())}get cornerRadius(){return this._cornerRadius}set cornerRadius(t){t<0&&(t=0),this._cornerRadius!==t&&(this._cornerRadius=t,this._markAsDirty())}constructor(t){super(t),this.name=t,this._thickness=1,this._cornerRadius=0}_getTypeName(){return"Rectangle"}_computeAdditionnalOffsetX(){return this._cornerRadius?1:0}_computeAdditionnalOffsetY(){return this._cornerRadius?1:0}_getRectangleFill(t){return this._getBackgroundColor(t)}_localDraw(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),(this._background||this._backgroundGradient)&&(t.fillStyle=this._getRectangleFill(t),this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.fill()):t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),(this.color||this.gradient)&&(t.strokeStyle=this.gradient?this.gradient.getCanvasGradient(t):this.color),t.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.stroke()):t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_drawRoundedRect(t,e=0){const i=this._currentMeasure.left+e,s=this._currentMeasure.top+e,r=this._currentMeasure.width-2*e,n=this._currentMeasure.height-2*e;let o=Math.min(n/2,Math.min(r/2,this._cornerRadius));o=Math.abs(o),t.beginPath(),t.moveTo(i+o,s),t.lineTo(i+r-o,s),t.arc(i+r-o,s+o,o,3*Math.PI/2,2*Math.PI),t.lineTo(i+r,s+n-o),t.arc(i+r-o,s+n-o,o,0,Math.PI/2),t.lineTo(i+o,s+n),t.arc(i+o,s+n-o,o,Math.PI/2,Math.PI),t.lineTo(i,s+o),t.arc(i+o,s+o,o,Math.PI,3*Math.PI/2),t.closePath()}_clipForChildren(t){this._cornerRadius&&(this._drawRoundedRect(t,this._thickness),t.clip())}}(0,s.gn)([(0,o.qC)()],h.prototype,"thickness",null),(0,s.gn)([(0,o.qC)()],h.prototype,"cornerRadius",null),(0,n.H)("BABYLON.GUI.Rectangle",h)},5817:(t,e,i)=>{i.d(e,{e:()=>_});var s=i(1069),r=i(8658),n=i(7034),o=i(7003),h=i(646),a=i(8137),l=i(2701);class _ extends n.W{get isVertical(){return this._isVertical}set isVertical(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())}get spacing(){return this._spacing}set spacing(t){this._spacing!==t&&(this._spacing=t,this._markAsDirty())}set width(t){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()}get width(){return this._width.toString(this._host)}set height(t){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()}get height(){return this._height.toString(this._host)}constructor(t){super(t),this.name=t,this._isVertical=!0,this._manualWidth=!1,this._manualHeight=!1,this._doNotTrackManualChanges=!1,this._spacing=0,this.ignoreLayoutWarnings=!1}_getTypeName(){return"StackPanel"}_preMeasure(t,e){for(const t of this._children)this._isVertical?t.verticalAlignment=o.o.VERTICAL_ALIGNMENT_TOP:t.horizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_LEFT;super._preMeasure(t,e)}_additionalProcessing(t,e){super._additionalProcessing(t,e),this._measureForChildren.copyFrom(t),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)}_postMeasure(){let t=0,e=0;const i=this._children.length;for(let s=0;s<i;s++){const n=this._children[s];n.isVisible&&!n.notRenderable&&(this._isVertical?(n.top!==e+"px"&&(n.top=e+"px",this._rebuildLayout=!0,n._top.ignoreAdaptiveScaling=!0),n._height.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||r.w1.Warn(`Control (Name:${n.name}, UniqueId:${n.uniqueId}) is using height in percentage mode inside a vertical StackPanel`):e+=n._currentMeasure.height+n._paddingTopInPixels+n._paddingBottomInPixels+(s<i-1?this._spacing:0)):(n.left!==t+"px"&&(n.left=t+"px",this._rebuildLayout=!0,n._left.ignoreAdaptiveScaling=!0),!n._width.isPercentage||n._automaticSize||"TextBlock"!==n.getClassName()||n.textWrapping===l.i.Clip||n.forceResizeWidth?t+=n._currentMeasure.width+n._paddingLeftInPixels+n._paddingRightInPixels+(s<i-1?this._spacing:0):this.ignoreLayoutWarnings||r.w1.Warn(`Control (Name:${n.name}, UniqueId:${n.uniqueId}) is using width in percentage mode inside a horizontal StackPanel`)))}t+=this._paddingLeftInPixels+this._paddingRightInPixels,e+=this._paddingTopInPixels+this._paddingBottomInPixels,this._doNotTrackManualChanges=!0;let s=!1,n=!1;if((!this._manualHeight||this.adaptHeightToChildren)&&this._isVertical){const t=this.height;this.height=e+"px",n=t!==this.height||!this._height.ignoreAdaptiveScaling}if((!this._manualWidth||this.adaptWidthToChildren)&&!this._isVertical){const e=this.width;this.width=t+"px",s=e!==this.width||!this._width.ignoreAdaptiveScaling}n&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||n)&&(this._rebuildLayout=!0),super._postMeasure()}serialize(t){super.serialize(t),t.manualWidth=this._manualWidth,t.manualHeight=this._manualHeight}_parseFromContent(t,e){this._manualWidth=t.manualWidth,this._manualHeight=t.manualHeight,super._parseFromContent(t,e)}}(0,s.gn)([(0,a.qC)()],_.prototype,"ignoreLayoutWarnings",void 0),(0,s.gn)([(0,a.qC)()],_.prototype,"isVertical",null),(0,s.gn)([(0,a.qC)()],_.prototype,"spacing",null),(0,s.gn)([(0,a.qC)()],_.prototype,"width",null),(0,s.gn)([(0,a.qC)()],_.prototype,"height",null),(0,h.H)("BABYLON.GUI.StackPanel",_)},2701:(t,e,i)=>{i.d(e,{a:()=>c,i:()=>s});var s,r=i(1069),n=i(8139),o=i(5151),h=i(7003),a=i(646),l=i(8137),_=i(5953);!function(t){t[t.Clip=0]="Clip",t[t.WordWrap=1]="WordWrap",t[t.Ellipsis=2]="Ellipsis",t[t.WordWrapEllipsis=3]="WordWrapEllipsis"}(s||(s={}));class c extends h.o{get lines(){return this._lines}get resizeToFit(){return this._resizeToFit}set resizeToFit(t){this._resizeToFit!==t&&(this._resizeToFit=t,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())}get textWrapping(){return this._textWrapping}set textWrapping(t){this._textWrapping!==t&&(this._textWrapping=+t,this._markAsDirty())}get text(){return this._text}set text(t){this._text!==t&&(this._text=t+"",this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))}get textHorizontalAlignment(){return this._textHorizontalAlignment}set textHorizontalAlignment(t){this._textHorizontalAlignment!==t&&(this._textHorizontalAlignment=t,this._markAsDirty())}get textVerticalAlignment(){return this._textVerticalAlignment}set textVerticalAlignment(t){this._textVerticalAlignment!==t&&(this._textVerticalAlignment=t,this._markAsDirty())}set lineSpacing(t){this._lineSpacing.fromString(t)&&this._markAsDirty()}get lineSpacing(){return this._lineSpacing.toString(this._host)}get outlineWidth(){return this._outlineWidth}set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())}get underline(){return this._underline}set underline(t){this._underline!==t&&(this._underline=t,this._markAsDirty())}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough!==t&&(this._lineThrough=t,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())}get wordDivider(){return this._wordDivider}set wordDivider(t){this._wordDivider!==t&&(this._wordDivider=t,this._markAsDirty())}get forceResizeWidth(){return this._forceResizeWidth}set forceResizeWidth(t){this._forceResizeWidth!==t&&(this._forceResizeWidth=t,this._markAsDirty())}constructor(t,e=""){super(t),this.name=t,this._text="",this._textWrapping=s.Clip,this._textHorizontalAlignment=h.o.HORIZONTAL_ALIGNMENT_CENTER,this._textVerticalAlignment=h.o.VERTICAL_ALIGNMENT_CENTER,this._resizeToFit=!1,this._lineSpacing=new o.s(0),this._outlineWidth=0,this._outlineColor="white",this._underline=!1,this._lineThrough=!1,this._wordDivider=" ",this._forceResizeWidth=!1,this.onTextChangedObservable=new n.y$,this.onLinesReadyObservable=new n.y$,this._linesTemp=[],this.text=e}_getTypeName(){return"TextBlock"}_processMeasures(t,e){this._fontOffset&&!this.isDirty||(this._fontOffset=h.o._GetFontOffset(e.font)),super._processMeasures(t,e),this._lines=this._breakLines(this._currentMeasure.width,this._currentMeasure.height,e),this.onLinesReadyObservable.notifyObservers(this);let i=0;for(let t=0;t<this._lines.length;t++){const e=this._lines[t];e.width>i&&(i=e.width)}if(this._resizeToFit){if(this._textWrapping===s.Clip||this._forceResizeWidth){const t=Math.ceil(this._paddingLeftInPixels)+Math.ceil(this._paddingRightInPixels)+Math.ceil(i);t!==this._width.getValueInPixel(this._host,this._tempParentMeasure.width)&&(this._width.updateInPlace(t,o.s.UNITMODE_PIXEL),this._rebuildLayout=!0)}let t=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){let e=0;e=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),t+=(this._lines.length-1)*e}t!==this._height.internalValue&&(this._height.updateInPlace(t,o.s.UNITMODE_PIXEL),this._rebuildLayout=!0)}}_drawText(t,e,i,s){const r=this._currentMeasure.width;let n=0;switch(this._textHorizontalAlignment){case h.o.HORIZONTAL_ALIGNMENT_LEFT:n=0;break;case h.o.HORIZONTAL_ALIGNMENT_RIGHT:n=r-e;break;case h.o.HORIZONTAL_ALIGNMENT_CENTER:n=(r-e)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(s.shadowColor=this.shadowColor,s.shadowBlur=this.shadowBlur,s.shadowOffsetX=this.shadowOffsetX,s.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&s.strokeText(t,this._currentMeasure.left+n,i),s.fillText(t,this._currentMeasure.left+n,i),this._underline&&(s.beginPath(),s.lineWidth=Math.round(.05*this.fontSizeInPixels),s.moveTo(this._currentMeasure.left+n,i+3),s.lineTo(this._currentMeasure.left+n+e,i+3),s.stroke(),s.closePath()),this._lineThrough&&(s.beginPath(),s.lineWidth=Math.round(.05*this.fontSizeInPixels),s.moveTo(this._currentMeasure.left+n,i-this.fontSizeInPixels/3),s.lineTo(this._currentMeasure.left+n+e,i-this.fontSizeInPixels/3),s.stroke(),s.closePath())}_draw(t){t.save(),this._applyStates(t),this._renderLines(t),t.restore()}_applyStates(t){super._applyStates(t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor,t.lineJoin="miter",t.miterLimit=2)}_breakLines(t,e,i){this._linesTemp.length=0;const r=this.text.split("\n");if(this._textWrapping===s.Ellipsis)for(const e of r)this._linesTemp.push(this._parseLineEllipsis(e,t,i));else if(this._textWrapping===s.WordWrap)for(const e of r)this._linesTemp.push(...this._parseLineWordWrap(e,t,i));else if(this._textWrapping===s.WordWrapEllipsis)for(const s of r)this._linesTemp.push(...this._parseLineWordWrapEllipsis(s,t,e,i));else for(const t of r)this._linesTemp.push(this._parseLine(t,i));return this._linesTemp}_parseLine(t="",e){return{text:t,width:this._getTextMetricsWidth(e.measureText(t))}}_getCharsToRemove(t,e,i){const s=t>e?t-e:0,r=t/i;return Math.max(Math.floor(s/r),1)}_parseLineEllipsis(t="",e,i){let s=this._getTextMetricsWidth(i.measureText(t)),r=this._getCharsToRemove(s,e,t.length);const n=Array.from&&Array.from(t);if(n)for(;n.length&&s>e;)n.splice(n.length-r,r),t=`${n.join("")}`,s=this._getTextMetricsWidth(i.measureText(t)),r=this._getCharsToRemove(s,e,t.length);else{for(;t.length>2&&s>e;)t=t.slice(0,-r),s=this._getTextMetricsWidth(i.measureText(t+"")),r=this._getCharsToRemove(s,e,t.length);t+=""}return{text:t,width:s}}_getTextMetricsWidth(t){return void 0!==t.actualBoundingBoxLeft?Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight):t.width}_parseLineWordWrap(t="",e,i){const s=[],r=this.wordSplittingFunction?this.wordSplittingFunction(t):t.split(this._wordDivider);let n=this._getTextMetricsWidth(i.measureText(t));for(let o=0;o<r.length;o++){const h=o>0?t+this._wordDivider+r[o]:r[0],a=this._getTextMetricsWidth(i.measureText(h));a>e&&o>0?(s.push({text:t,width:n}),t=r[o],n=this._getTextMetricsWidth(i.measureText(t))):(n=a,t=h)}return s.push({text:t,width:n}),s}_parseLineWordWrapEllipsis(t="",e,i,s){const r=this._parseLineWordWrap(t,e,s);for(let t=1;t<=r.length;t++)if(this._computeHeightForLinesOf(t)>i&&t>1){const i=r[t-2],n=r[t-1];r[t-2]=this._parseLineEllipsis(`${i.text+n.text}`,e,s);const o=r.length-t+1;for(let t=0;t<o;t++)r.pop();return r}return r}_renderLines(t){if(!this._fontOffset||!this._lines)return;const e=this._currentMeasure.height;let i=0;switch(this._textVerticalAlignment){case h.o.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case h.o.VERTICAL_ALIGNMENT_BOTTOM:i=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case h.o.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(let e=0;e<this._lines.length;e++){const s=this._lines[e];0!==e&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(s.text,s.width,i,t),i+=this._fontOffset.height}}_computeHeightForLinesOf(t){let e=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*t;if(t>0&&0!==this._lineSpacing.internalValue){let i=0;i=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),e+=(t-1)*i}return e}computeExpectedHeight(){var t;if(this.text&&this.widthInPixels){const e=null===(t=_.l.LastCreatedEngine)||void 0===t?void 0:t.createCanvas(0,0).getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=h.o._GetFontOffset(e.font));const t=this._lines?this._lines:this._breakLines(this.widthInPixels-this._paddingLeftInPixels-this._paddingRightInPixels,this.heightInPixels-this._paddingTopInPixels-this._paddingBottomInPixels,e);return this._computeHeightForLinesOf(t.length)}}return 0}dispose(){super.dispose(),this.onTextChangedObservable.clear()}}(0,r.gn)([(0,l.qC)()],c.prototype,"resizeToFit",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textWrapping",null),(0,r.gn)([(0,l.qC)()],c.prototype,"text",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textHorizontalAlignment",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textVerticalAlignment",null),(0,r.gn)([(0,l.qC)()],c.prototype,"lineSpacing",null),(0,r.gn)([(0,l.qC)()],c.prototype,"outlineWidth",null),(0,r.gn)([(0,l.qC)()],c.prototype,"underline",null),(0,r.gn)([(0,l.qC)()],c.prototype,"lineThrough",null),(0,r.gn)([(0,l.qC)()],c.prototype,"outlineColor",null),(0,r.gn)([(0,l.qC)()],c.prototype,"wordDivider",null),(0,r.gn)([(0,l.qC)()],c.prototype,"forceResizeWidth",null),(0,a.H)("BABYLON.GUI.TextBlock",c)},8147:(t,e,i)=>{i.d(e,{U:()=>a});var s=i(5412);const r=[new s.FM(0,0),new s.FM(0,0),new s.FM(0,0),new s.FM(0,0)],n=[new s.FM(0,0),new s.FM(0,0),new s.FM(0,0),new s.FM(0,0)],o=new s.FM(0,0),h=new s.FM(0,0);class a{constructor(t,e,i,s){this.left=t,this.top=e,this.width=i,this.height=s}copyFrom(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height}copyFromFloats(t,e,i,s){this.left=t,this.top=e,this.width=i,this.height=s}static CombineToRef(t,e,i){const s=Math.min(t.left,e.left),r=Math.min(t.top,e.top),n=Math.max(t.left+t.width,e.left+e.width),o=Math.max(t.top+t.height,e.top+e.height);i.left=s,i.top=r,i.width=n-s,i.height=o-r}addAndTransformToRef(t,e,i,s,a,l){const _=this.left+e,c=this.top+i,d=this.width+s,u=this.height+a;r[0].copyFromFloats(_,c),r[1].copyFromFloats(_+d,c),r[2].copyFromFloats(_+d,c+u),r[3].copyFromFloats(_,c+u),o.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),h.copyFromFloats(0,0);for(let e=0;e<4;e++)t.transformCoordinates(r[e].x,r[e].y,n[e]),o.x=Math.floor(Math.min(o.x,n[e].x)),o.y=Math.floor(Math.min(o.y,n[e].y)),h.x=Math.ceil(Math.max(h.x,n[e].x)),h.y=Math.ceil(Math.max(h.y,n[e].y));l.left=o.x,l.top=o.y,l.width=h.x-o.x,l.height=h.y-o.y}transformToRef(t,e){this.addAndTransformToRef(t,0,0,0,0,e)}isEqualsTo(t){return this.left===t.left&&this.top===t.top&&this.width===t.width&&this.height===t.height}static Empty(){return new a(0,0,0,0)}}},5151:(t,e,i)=>{i.d(e,{s:()=>r});var s=i(8139);class r{constructor(t,e=r.UNITMODE_PIXEL,i=!0){this.negativeValueAllowed=i,this._value=1,this._unit=r.UNITMODE_PIXEL,this.ignoreAdaptiveScaling=!1,this.onChangedObservable=new s.y$,this._value=t,this._unit=e,this._originalUnit=e}get isPercentage(){return this._unit===r.UNITMODE_PERCENTAGE}get isPixel(){return this._unit===r.UNITMODE_PIXEL}get internalValue(){return this._value}get value(){return this._value}set value(t){t!==this._value&&(this._value=t,this.onChangedObservable.notifyObservers())}get unit(){return this._unit}set unit(t){t!==this._unit&&(this._unit=t,this.onChangedObservable.notifyObservers())}getValueInPixel(t,e){return this.isPixel?this.getValue(t):this.getValue(t)*e}updateInPlace(t,e=r.UNITMODE_PIXEL){return this.value===t&&this.unit===e||(this._value=t,this._unit=e,this.onChangedObservable.notifyObservers()),this}getValue(t){if(t&&!this.ignoreAdaptiveScaling&&this.unit!==r.UNITMODE_PERCENTAGE){let e=0,i=0;if(t.idealWidth&&(e=this._value*t.getSize().width/t.idealWidth),t.idealHeight&&(i=this._value*t.getSize().height/t.idealHeight),t.useSmallestIdeal&&t.idealWidth&&t.idealHeight)return window.innerWidth<window.innerHeight?e:i;if(t.idealWidth)return e;if(t.idealHeight)return i}return this._value}toString(t,e){switch(this._unit){case r.UNITMODE_PERCENTAGE:{const i=100*this.getValue(t);return(e?i.toFixed(e):i)+"%"}case r.UNITMODE_PIXEL:{const i=this.getValue(t);return(e?i.toFixed(e):i)+"px"}}return this._unit.toString()}fromString(t){const e=r._Regex.exec(t.toString());if(!e||0===e.length)return!1;let i=parseFloat(e[1]),s=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),4===e.length)switch(e[3]){case"px":s=r.UNITMODE_PIXEL;break;case"%":s=r.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||s!==this._unit)&&(this._value=i,this._unit=s,this.onChangedObservable.notifyObservers(),!0)}static get UNITMODE_PERCENTAGE(){return r._UNITMODE_PERCENTAGE}static get UNITMODE_PIXEL(){return r._UNITMODE_PIXEL}}r._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,r._UNITMODE_PERCENTAGE=0,r._UNITMODE_PIXEL=1}},t=>{t(t.s=4188)}]);