"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[404],{9759:(t,e,i)=>{i.d(e,{p:()=>r,u:()=>a});var s=i(658),n=i(8137),o=i(4515),a={};class r{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const e=t.getSimpleName();this.attached[e]?s.Y.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const e in this.attached){const i=this.attached[e];if(i===t)return i.detachControl(),i.camera=null,delete this.attached[e],void this.rebuildInputCheck()}}removeByType(t){for(const e in this.attached){const i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}}_addCheckInputs(t){const e=this.checkInputs;return()=>{e(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(t=!1){if(!this.attachedToElement){t=!o.V.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const e in this.attached)this.attached[e].attachControl(t)}}detachElement(t=!1){for(const e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const e={};for(const t in this.attached){const i=this.attached[t],s=n.p4.Serialize(i);e[i.getClassName()]=s}t.inputsmgr=e}parse(t){const e=t.inputsmgr;if(e){this.clear();for(const t in e){const i=a[t];if(i){const s=e[t],o=n.p4.Parse((()=>new i),s,null);this.add(o)}}}else for(const e in this.attached){const i=a[this.attached[e].getClassName()];if(i){const s=n.p4.Parse((()=>new i),t,null);this.remove(this.attached[e]),this.add(s)}}}}},7136:(t,e,i)=>{i.d(e,{c:()=>p});var s=i(1069),n=i(8137),o=i(5412),a=i(2352),r=i(4515),h=i(4551),c=i(5241);class l extends r.V{constructor(t,e,i,s=!0){super(t,e,i,s),this._tmpUpVector=o.P.Zero(),this._tmpTargetVector=o.P.Zero(),this.cameraDirection=new o.P(0,0,0),this.cameraRotation=new o.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new o._f,this.rotation=new o.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=o.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=o.y3.Zero(),this._camMatrix=o.y3.Zero(),this._cameraTransformMatrix=o.y3.Zero(),this._cameraRotationMatrix=o.y3.Zero(),this._referencePoint=new o.P(0,0,1),this._transformedReferencePoint=o.P.Zero(),this._defaultUp=o.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(t){this.getWorldMatrix();const e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)}_getLockedTargetPosition(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(t){t||super._updateCache();const e=this._getLockedTargetPosition();e?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(e):this._cache.lockedTarget=e.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}setTarget(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=h.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),o.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.jp.Matrix[0]),o.P.TransformNormalToRef(this.cameraDirection,o.jp.Matrix[0],o.jp.Vector3[0]),void this.position.addInPlace(o.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}_checkInputs(){const t=this.invertRotation?-this.inverseRotationSpeed:1,e=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(e&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*t,this.rotation.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t)}this.rotationQuaternion&&this.rotation.lengthSquared()&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}e&&(Math.abs(this.cameraDirection.x)<this.speed*h.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*h.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*h.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*h.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*h.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return o.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?c.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),c.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(t,e,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();o.P.TransformCoordinatesToRef(t,s,this._globalPosition),o.P.TransformCoordinatesToRef(e,s,this._tmpTargetVector),o.P.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(e),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):o.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(t,e,i,this._viewMatrix):o.y3.LookAtLHToRef(t,e,i,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)}createRigCamera(t,e){if(this.cameraRigMode!==r.V.RIG_MODE_NONE){const e=new l(t,this.position.clone(),this.getScene());return e.isRigCamera=!0,e.rigParent=this,this.cameraRigMode!==r.V.RIG_MODE_VR&&this.cameraRigMode!==r.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new o._f),e._cameraRigParams={},e.rotationQuaternion=new o._f),e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoTop=this.orthoTop,e.orthoBottom=this.orthoBottom,e}return null}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case r.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.V.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,e);break}case r.V.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),e.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),e.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),e.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(t,e){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=l._TargetFocalPoint.addInPlace(this.position);o.y3.TranslationToRef(-i.x,-i.y,-i.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(o.y3.RotationAxis(e.upVector,t),l._RigCamTransformMatrix),o.y3.TranslationToRef(i.x,i.y,i.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),o.P.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,e.position),e.setTarget(i)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new o.y3,l._TargetTransformMatrix=new o.y3,l._TargetFocalPoint=new o.P,(0,s.gn)([(0,n.hd)()],l.prototype,"rotation",void 0),(0,s.gn)([(0,n.qC)()],l.prototype,"speed",void 0),(0,s.gn)([(0,n.RR)("lockedTargetId")],l.prototype,"lockedTarget",void 0);var d=i(653),u=i(8658);class p extends l{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const e=this.inputs.attached.keyboard;e&&(e.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const e=this.inputs.attached.keyboard;e&&(e.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateRight=t)}constructor(t,e,i,s=!0){super(t,e,i,s),this.ellipsoid=new o.P(.5,1,.5),this.ellipsoidOffset=new o.P(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=o.P.Zero(),this._diffPosition=o.P.Zero(),this._newPosition=o.P.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(t,e,i=null)=>{(t=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>a.D.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&i&&this.onCollide(i))})(e)},this.inputs=new d.a(this),this.inputs.addKeyboard().addMouse()}attachControl(t,e){e=u.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new o.P(0,0,0),this.cameraRotation=new o.FM(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let e;e=this.parent?o.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,e.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=t;this.applyGravity&&(s=t.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=o.P.Zero(),this._transformedDirection=o.P.Zero()),this.inputs.checkInputs(),super._checkInputs()}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,s.gn)([(0,n.hd)()],p.prototype,"ellipsoid",void 0),(0,s.gn)([(0,n.hd)()],p.prototype,"ellipsoidOffset",void 0),(0,s.gn)([(0,n.qC)()],p.prototype,"checkCollisions",void 0),(0,s.gn)([(0,n.qC)()],p.prototype,"applyGravity",void 0)},653:(t,e,i)=>{i.d(e,{a:()=>b});var s=i(9759),n=i(1069),o=i(8137),a=i(6081),r=i(5412),h=i(8658);class c{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===a.OG.KEYDOWN)-1===this.keysUp.indexOf(i.keyCode)&&-1===this.keysDown.indexOf(i.keyCode)&&-1===this.keysLeft.indexOf(i.keyCode)&&-1===this.keysRight.indexOf(i.keyCode)&&-1===this.keysUpward.indexOf(i.keyCode)&&-1===this.keysDownward.indexOf(i.keyCode)&&-1===this.keysRotateLeft.indexOf(i.keyCode)&&-1===this.keysRotateRight.indexOf(i.keyCode)||(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),t||i.preventDefault());else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),t||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e],s=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?t._localDirection.copyFromFloats(-s,0,0):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,0,s):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(s,0,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,0,-s):-1!==this.keysUpward.indexOf(i)?t._localDirection.copyFromFloats(0,s,0):-1!==this.keysDownward.indexOf(i)?t._localDirection.copyFromFloats(0,-s,0):-1!==this.keysRotateLeft.indexOf(i)?(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)&&(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y+=this._getLocalRotation()),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),r.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){let t=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t}}(0,n.gn)([(0,o.qC)()],c.prototype,"keysUp",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysUpward",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysDown",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysDownward",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysLeft",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysRight",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"rotationSpeed",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysRotateLeft",void 0),(0,n.gn)([(0,o.qC)()],c.prototype,"keysRotateRight",void 0),s.u.FreeCameraKeyboardMoveInput=c;var l=i(8139),d=i(27);class u{constructor(t=!0){this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new l.y$,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();this._pointerInput||(this._pointerInput=s=>{const n=s.event,o="touch"===n.pointerType;if(e.isInVRExclusivePointerMode)return;if(!this.touchEnabled&&o)return;if(s.type!==d.kD.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const a=n.target;if(s.type===d.kD.POINTERDOWN){if(o&&-1!==this._activePointerId||!o&&-1!==this._currentActiveButton)return;this._activePointerId=n.pointerId;try{null==a||a.setPointerCapture(n.pointerId)}catch(t){}-1===this._currentActiveButton&&(this._currentActiveButton=n.button),this._previousPosition={x:n.clientX,y:n.clientY},t||(n.preventDefault(),i&&i.focus()),e.isPointerLock&&this._onMouseMove&&this._onMouseMove(s.event)}else if(s.type===d.kD.POINTERUP){if(o&&this._activePointerId!==n.pointerId||!o&&this._currentActiveButton!==n.button)return;try{null==a||a.releasePointerCapture(n.pointerId)}catch(t){}this._currentActiveButton=-1,this._previousPosition=null,t||n.preventDefault(),this._activePointerId=-1}else if(s.type===d.kD.POINTERMOVE&&(this._activePointerId===n.pointerId||!o))if(e.isPointerLock&&this._onMouseMove)this._onMouseMove(s.event);else if(this._previousPosition){let e=n.clientX-this._previousPosition.x;const i=n.clientY-this._previousPosition.y;this.camera.getScene().useRightHandedSystem&&(e*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=i/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:i}),this._previousPosition={x:n.clientX,y:n.clientY},t||n.preventDefault()}}),this._onMouseMove=i=>{if(!e.isPointerLock)return;if(e.isInVRExclusivePointerMode)return;let s=i.movementX;this.camera.getScene().useRightHandedSystem&&(s*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),this.camera.cameraRotation.y+=s/this.angularSensibility;const n=i.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,t||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,d.kD.POINTERDOWN|d.kD.POINTERUP|d.kD.POINTERMOVE),i&&(this._contextMenuBind=this.onContextMenu.bind(this),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,n.gn)([(0,o.qC)()],u.prototype,"buttons",void 0),(0,n.gn)([(0,o.qC)()],u.prototype,"angularSensibility",void 0),s.u.FreeCameraMouseInput=u;var p=i(1318);class _{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new l.y$,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==d.kD.POINTERWHEEL)return;const i=e.event,s=i.deltaMode===p.G.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*s*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*s*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*s*i.deltaZ/this._normalize,i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,d.kD.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,n.gn)([(0,o.qC)()],_.prototype,"wheelPrecisionX",void 0),(0,n.gn)([(0,o.qC)()],_.prototype,"wheelPrecisionY",void 0),(0,n.gn)([(0,o.qC)()],_.prototype,"wheelPrecisionZ",void 0);var g,m=i(5241);!function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(g||(g={}));class y extends _{constructor(){super(...arguments),this._moveRelative=r.P.Zero(),this._rotateRelative=r.P.Zero(),this._moveScene=r.P.Zero(),this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=m.c7.X,this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=m.c7.Z,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==g.MoveRelative||(this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==g.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==g.MoveRelative||(this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==g.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==g.MoveRelative||(this._wheelZAction=g.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==g.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==g.RotateRelative||(this._wheelXAction=g.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==g.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==g.RotateRelative||(this._wheelYAction=g.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==g.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==g.RotateRelative||(this._wheelZAction=g.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==g.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==g.MoveScene||(this._wheelXAction=g.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==g.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==g.MoveScene||(this._wheelYAction=g.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==g.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==g.MoveScene||(this._wheelZAction=g.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==g.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=r.y3.Zero();this.camera.getViewMatrix().invertToRef(t);const e=r.P.Zero();r.P.TransformNormalToRef(this._moveRelative,t,e),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(e),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,e,i){if(0===t)return;if(null===e||null===i)return;let s=null;switch(e){case g.MoveRelative:s=this._moveRelative;break;case g.RotateRelative:s=this._rotateRelative;break;case g.MoveScene:s=this._moveScene}switch(i){case m.c7.X:s.set(t,0,0);break;case m.c7.Y:s.set(0,t,0);break;case m.c7.Z:s.set(0,0,t)}}}(0,n.gn)([(0,o.qC)()],y.prototype,"wheelXMoveRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelYMoveRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelZMoveRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelXRotateRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelYRotateRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelZRotateRelative",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelXMoveScene",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelYMoveScene",null),(0,n.gn)([(0,o.qC)()],y.prototype,"wheelZMoveScene",null),s.u.FreeCameraMouseWheelInput=y;class f{constructor(t=!1){this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=h.w1.IsSafari()}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments);let e=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const s=i.event,n="mouse"===s.pointerType||this._isSafari&&void 0===s.pointerType;if(this.allowMouse||!n)if(i.type===d.kD.POINTERDOWN){if(t||s.preventDefault(),this._pointerPressed.push(s.pointerId),1!==this._pointerPressed.length)return;e={x:s.clientX,y:s.clientY}}else if(i.type===d.kD.POINTERUP){t||s.preventDefault();const i=this._pointerPressed.indexOf(s.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;e=null,this._offsetX=null,this._offsetY=null}else if(i.type===d.kD.POINTERMOVE){if(t||s.preventDefault(),!e)return;if(0!=this._pointerPressed.indexOf(s.pointerId))return;this._offsetX=s.clientX-e.x,this._offsetY=-(s.clientY-e.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,d.kD.POINTERDOWN|d.kD.POINTERUP|d.kD.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const e=t._computeLocalCameraSpeed(),i=new r.P(0,0,0!==this.touchMoveSensibility?e*this._offsetY/this.touchMoveSensibility:0);r.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(r.P.TransformCoordinates(i,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,n.gn)([(0,o.qC)()],f.prototype,"touchAngularSensibility",void 0),(0,n.gn)([(0,o.qC)()],f.prototype,"touchMoveSensibility",void 0),s.u.FreeCameraTouchInput=f;class b extends s.p{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new c),this}addMouse(t=!0){return this._mouseInput||(this._mouseInput=new u(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}},4571:(t,e,i)=>{i.d(e,{x:()=>q});var s=i(7136),n=i(5412),o=i(6387);o.N.AddNodeConstructor("TouchCamera",((t,e)=>()=>new a(t,n.P.Zero(),e)));class a extends s.c{get touchAngularSensibility(){const t=this.inputs.attached.touch;return t?t.touchAngularSensibility:0}set touchAngularSensibility(t){const e=this.inputs.attached.touch;e&&(e.touchAngularSensibility=t)}get touchMoveSensibility(){const t=this.inputs.attached.touch;return t?t.touchMoveSensibility:0}set touchMoveSensibility(t){const e=this.inputs.attached.touch;e&&(e.touchMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addTouch(),this._setupInputs()}getClassName(){return"TouchCamera"}_setupInputs(){const t=this.inputs.attached.touch,e=this.inputs.attached.mouse;e?e.touchEnabled=!1:t.allowMouse=!0}}var r,h,c,l=i(4515),d=i(253),u=i(4559),p=i(8139),_=i(1102),g=i(2554),m=i(318),y=i(3573),f=i(5953);class b{constructor(t,e,i=Number.MAX_VALUE){this.origin=t,this.direction=e,this.length=i}clone(){return new b(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,e,i=0){const s=b._TmpVector3[0].copyFromFloats(t.x-i,t.y-i,t.z-i),n=b._TmpVector3[1].copyFromFloats(e.x+i,e.y+i,e.z+i);let o,a,r,h,c=0,l=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<s.x||this.origin.x>n.x)return!1}else if(o=1/this.direction.x,a=(s.x-this.origin.x)*o,r=(n.x-this.origin.x)*o,r===-1/0&&(r=1/0),a>r&&(h=a,a=r,r=h),c=Math.max(a,c),l=Math.min(r,l),c>l)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<s.y||this.origin.y>n.y)return!1}else if(o=1/this.direction.y,a=(s.y-this.origin.y)*o,r=(n.y-this.origin.y)*o,r===-1/0&&(r=1/0),a>r&&(h=a,a=r,r=h),c=Math.max(a,c),l=Math.min(r,l),c>l)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<s.z||this.origin.z>n.z)return!1}else if(o=1/this.direction.z,a=(s.z-this.origin.z)*o,r=(n.z-this.origin.z)*o,r===-1/0&&(r=1/0),a>r&&(h=a,a=r,r=h),c=Math.max(a,c),l=Math.min(r,l),c>l)return!1;return!0}intersectsBox(t,e=0){return this.intersectsBoxMinMax(t.minimum,t.maximum,e)}intersectsSphere(t,e=0){const i=t.center.x-this.origin.x,s=t.center.y-this.origin.y,n=t.center.z-this.origin.z,o=i*i+s*s+n*n,a=t.radius+e,r=a*a;if(o<=r)return!0;const h=i*this.direction.x+s*this.direction.y+n*this.direction.z;return!(h<0)&&o-h*h<=r}intersectsTriangle(t,e,i){const s=b._TmpVector3[0],o=b._TmpVector3[1],a=b._TmpVector3[2],r=b._TmpVector3[3],h=b._TmpVector3[4];e.subtractToRef(t,s),i.subtractToRef(t,o),n.P.CrossToRef(this.direction,o,a);const c=n.P.Dot(s,a);if(0===c)return null;const l=1/c;this.origin.subtractToRef(t,r);const d=n.P.Dot(r,a)*l;if(d<0||d>1)return null;n.P.CrossToRef(r,s,h);const u=n.P.Dot(this.direction,h)*l;if(u<0||d+u>1)return null;const p=n.P.Dot(o,h)*l;return p>this.length?null:new y.c(1-d-u,d,p)}intersectsPlane(t){let e;const i=n.P.Dot(t.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const s=n.P.Dot(t.normal,this.origin);return e=(-t.d-s)/i,e<0?e<-9.99999997475243e-7?null:0:e}}intersectsAxis(t,e=0){switch(t){case"y":{const t=(this.origin.y-e)/this.direction.y;return t>0?null:new n.P(this.origin.x+this.direction.x*-t,e,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-e)/this.direction.x;return t>0?null:new n.P(e,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-e)/this.direction.z;return t>0?null:new n.P(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,e)}default:return null}}intersectsMesh(t,e){const i=n.jp.Matrix[0];return t.getWorldMatrix().invertToRef(i),this._tmpRay?b.TransformToRef(this,i,this._tmpRay):this._tmpRay=b.Transform(this,i),t.intersects(this._tmpRay,e)}intersectsMeshes(t,e,i){i?i.length=0:i=[];for(let s=0;s<t.length;s++){const n=this.intersectsMesh(t[s],e);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0}intersectionSegment(t,e,i){const s=this.origin,o=n.jp.Vector3[0],a=n.jp.Vector3[1],r=n.jp.Vector3[2],h=n.jp.Vector3[3];e.subtractToRef(t,o),this.direction.scaleToRef(b._Rayl,r),s.addToRef(r,a),t.subtractToRef(s,h);const c=n.P.Dot(o,o),l=n.P.Dot(o,r),d=n.P.Dot(r,r),u=n.P.Dot(o,h),p=n.P.Dot(r,h),_=c*d-l*l;let g,m,y=_,f=_;_<b._Smallnum?(g=0,y=1,m=p,f=d):(g=l*p-d*u,m=c*p-l*u,g<0?(g=0,m=p,f=d):g>y&&(g=y,m=p+l,f=d)),m<0?(m=0,-u<0?g=0:-u>c?g=y:(g=-u,y=c)):m>f&&(m=f,-u+l<0?g=0:-u+l>c?g=y:(g=-u+l,y=c));const v=Math.abs(g)<b._Smallnum?0:g/y,P=Math.abs(m)<b._Smallnum?0:m/f,R=n.jp.Vector3[4];r.scaleToRef(P,R);const M=n.jp.Vector3[5];o.scaleToRef(v,M),M.addInPlace(h);const T=n.jp.Vector3[6];return M.subtractToRef(R,T),P>0&&P<=this.length&&T.lengthSquared()<i*i?M.length():-1}update(t,e,i,s,o,a,r,h=!1){if(h){b._RayDistant||(b._RayDistant=b.Zero()),b._RayDistant.unprojectRayToRef(t,e,i,s,n.y3.IdentityReadOnly,a,r);const h=n.jp.Matrix[0];o.invertToRef(h),b.TransformToRef(b._RayDistant,h,this)}else this.unprojectRayToRef(t,e,i,s,o,a,r);return this}static Zero(){return new b(n.P.Zero(),n.P.Zero())}static CreateNew(t,e,i,s,n,o,a){return b.Zero().update(t,e,i,s,n,o,a)}static CreateNewFromTo(t,e,i=n.y3.IdentityReadOnly){const s=e.subtract(t),o=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return s.normalize(),b.Transform(new b(t,s,o),i)}static Transform(t,e){const i=new b(new n.P(0,0,0),new n.P(0,0,0));return b.TransformToRef(t,e,i),i}static TransformToRef(t,e,i){n.P.TransformCoordinatesToRef(t.origin,e,i.origin),n.P.TransformNormalToRef(t.direction,e,i.direction),i.length=t.length;const s=i.direction,o=s.length();if(0!==o&&1!==o){const t=1/o;s.x*=t,s.y*=t,s.z*=t,i.length*=o}}unprojectRayToRef(t,e,i,s,o,a,r){var h;const c=n.jp.Matrix[0];o.multiplyToRef(a,c),c.multiplyToRef(r,c),c.invert();const l=n.jp.Vector3[0];l.x=t/i*2-1,l.y=-(e/s*2-1),l.z=(null===(h=f.l.LastCreatedEngine)||void 0===h?void 0:h.isNDCHalfZRange)?0:-1;const d=n.jp.Vector3[1].copyFromFloats(l.x,l.y,1-1e-8),u=n.jp.Vector3[2],p=n.jp.Vector3[3];n.P._UnprojectFromInvertedMatrixToRef(l,c,u),n.P._UnprojectFromInvertedMatrixToRef(d,c,p),this.origin.copyFrom(u),p.subtractToRef(u,this.direction),this.direction.normalize()}}b._TmpVector3=g.B.BuildArray(6,n.P.Zero),b._RayDistant=b.Zero(),b._Smallnum=1e-8,b._Rayl=1e9,d.x.prototype.createPickingRay=function(t,e,i,s,n=!1){const o=b.Zero();return this.createPickingRayToRef(t,e,i,o,s,n),o},d.x.prototype.createPickingRayToRef=function(t,e,i,s,o,a=!1,r=!1){const h=this.getEngine();if(!o){if(!this.activeCamera)return this;o=this.activeCamera}const c=o.viewport.toGlobal(h.getRenderWidth(),h.getRenderHeight());return t=t/h.getHardwareScalingLevel()-c.x,e=e/h.getHardwareScalingLevel()-(h.getRenderHeight()-c.y-c.height),s.update(t,e,c.width,c.height,i||n.y3.IdentityReadOnly,a?n.y3.IdentityReadOnly:o.getViewMatrix(),o.getProjectionMatrix(),r),this},d.x.prototype.createPickingRayInCameraSpace=function(t,e,i){const s=b.Zero();return this.createPickingRayInCameraSpaceToRef(t,e,s,i),s},d.x.prototype.createPickingRayInCameraSpaceToRef=function(t,e,i,s){if(!m.p)return this;const o=this.getEngine();if(!s){if(!this.activeCamera)throw new Error("Active camera not set");s=this.activeCamera}const a=s.viewport.toGlobal(o.getRenderWidth(),o.getRenderHeight()),r=n.y3.Identity();return t=t/o.getHardwareScalingLevel()-a.x,e=e/o.getHardwareScalingLevel()-(o.getRenderHeight()-a.y-a.height),i.update(t,e,a.width,a.height,r,r,s.getProjectionMatrix()),this},d.x.prototype._internalPickForMesh=function(t,e,i,s,n,o,a,r){const h=e(s,i.enableDistantPicking),c=i.intersects(h,n,a,o,s,r);return c&&c.hit?!n&&null!=t&&c.distance>=t.distance?null:c:null},d.x.prototype._internalPick=function(t,e,i,s,o){let a=null;const r=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),h=this.cameraToUseForPointers||this.activeCamera;for(let c=0;c<this.meshes.length;c++){const l=this.meshes[c];if(e){if(!e(l))continue}else if(!l.isEnabled()||!l.isVisible||!l.isPickable)continue;const d=r&&l.isWorldMatrixCameraDependent(),u=l.computeWorldMatrix(d,h);if(l.hasThinInstances&&l.thinInstanceEnablePicking){const e=this._internalPickForMesh(a,t,l,u,!0,!0,o);if(e){if(s)return e;const r=n.jp.Matrix[1],h=l.thinInstanceGetWorldMatrices();for(let e=0;e<h.length;e++){h[e].multiplyToRef(u,r);const n=this._internalPickForMesh(a,t,l,r,i,s,o,!0);if(n&&(a=n,a.thinInstanceIndex=e,i))return a}}}else{const e=this._internalPickForMesh(a,t,l,u,i,s,o);if(e&&(a=e,i))return a}}return a||new m.p},d.x.prototype._internalMultiPick=function(t,e,i){if(!m.p)return null;const s=new Array,o=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),a=this.cameraToUseForPointers||this.activeCamera;for(let r=0;r<this.meshes.length;r++){const h=this.meshes[r];if(e){if(!e(h))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;const c=o&&h.isWorldMatrixCameraDependent(),l=h.computeWorldMatrix(c,a);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(this._internalPickForMesh(null,t,h,l,!0,!0,i)){const e=n.jp.Matrix[1],o=h.thinInstanceGetWorldMatrices();for(let n=0;n<o.length;n++){o[n].multiplyToRef(l,e);const a=this._internalPickForMesh(null,t,h,e,!1,!1,i,!0);a&&(a.thinInstanceIndex=n,s.push(a))}}}else{const e=this._internalPickForMesh(null,t,h,l,!1,!1,i);e&&s.push(e)}}return s},d.x.prototype.pickWithBoundingInfo=function(t,e,i,s,o){if(!m.p)return null;const a=this._internalPick((i=>(this._tempPickingRay||(this._tempPickingRay=b.Zero()),this.createPickingRayToRef(t,e,i,this._tempPickingRay,o||null),this._tempPickingRay)),i,s,!0);return a&&(a.ray=this.createPickingRay(t,e,n.y3.Identity(),o||null)),a},Object.defineProperty(d.x.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),d.x.prototype.pick=function(t,e,i,s,o,a,r=!1){const h=this._internalPick(((i,s)=>(this._tempPickingRay||(this._tempPickingRay=b.Zero()),this.createPickingRayToRef(t,e,i,this._tempPickingRay,o||null,!1,s),this._tempPickingRay)),i,s,!1,a);return h&&(h.ray=this.createPickingRay(t,e,n.y3.Identity(),o||null)),h},d.x.prototype.pickWithRay=function(t,e,i,s){const o=this._internalPick((e=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=n.y3.Identity()),e.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=b.Zero()),b.TransformToRef(t,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),e,i,!1,s);return o&&(o.ray=t),o},d.x.prototype.multiPick=function(t,e,i,s,n){return this._internalMultiPick((i=>this.createPickingRay(t,e,i,s||null)),i,n)},d.x.prototype.multiPickWithRay=function(t,e,i){return this._internalMultiPick((e=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=n.y3.Identity()),e.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=b.Zero()),b.TransformToRef(t,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),e,i)},l.V.prototype.getForwardRay=function(t=100,e,i){return this.getForwardRayToRef(new b(n.P.Zero(),n.P.Zero(),t),t,e,i)},l.V.prototype.getForwardRayToRef=function(t,e=100,i,s){return i||(i=this.getWorldMatrix()),t.length=e,s?t.origin.copyFrom(s):t.origin.copyFrom(this.position),n.jp.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),n.P.TransformNormalToRef(n.jp.Vector3[2],i,n.jp.Vector3[3]),n.P.NormalizeToRef(n.jp.Vector3[3],t.direction),t};class v{get isConnected(){return this._isConnected}constructor(t,e,i,s=0,n=1,o=2,a=3){this.id=t,this.index=e,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=v.GAMEPAD,this._leftStickAxisX=s,this._leftStickAxisY=n,this._rightStickAxisX=o,this._rightStickAxisY=a,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}onleftstickchanged(t){this._onleftstickchanged=t}onrightstickchanged(t){this._onrightstickchanged=t}get leftStick(){return this._leftStick}set leftStick(t){!this._onleftstickchanged||this._leftStick.x===t.x&&this._leftStick.y===t.y||this._onleftstickchanged(t),this._leftStick=t}get rightStick(){return this._rightStick}set rightStick(t){!this._onrightstickchanged||this._rightStick.x===t.x&&this._rightStick.y===t.y||this._onrightstickchanged(t),this._rightStick=t}update(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}dispose(){}}v.GAMEPAD=0,v.GENERIC=1,v.XBOX=2,v.POSE_ENABLED=3,v.DUALSHOCK=4;class P extends v{onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}constructor(t,e,i){super(t,e,i),this.onButtonDownObservable=new p.y$,this.onButtonUpObservable=new p.y$,this.type=v.GENERIC,this._buttons=new Array(i.buttons.length)}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}update(){super.update();for(let t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()}}!function(t){t[t.VIVE=0]="VIVE",t[t.OCULUS=1]="OCULUS",t[t.WINDOWS=2]="WINDOWS",t[t.GEAR_VR=3]="GEAR_VR",t[t.DAYDREAM=4]="DAYDREAM",t[t.GENERIC=5]="GENERIC"}(r||(r={}));class R{static InitiateController(t){for(const e of this._ControllerFactories)if(e.canCreate(t))return e.create(t);if(this._DefaultControllerFactory)return this._DefaultControllerFactory(t);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."}}R._ControllerFactories=[],R._DefaultControllerFactory=null,class extends v{_disableTrackPosition(t){this._trackPosition&&(this._calculatedPosition.copyFrom(t),this._trackPosition=!1)}constructor(t){super(t.id,t.index,t),this.isXR=!1,this._deviceRoomPosition=n.P.Zero(),this._deviceRoomRotationQuaternion=new n._f,this.devicePosition=n.P.Zero(),this.deviceRotationQuaternion=new n._f,this.deviceScaleFactor=1,this._trackPosition=!0,this._maxRotationDistFromHeadset=Math.PI/5,this._draggedRoomRotation=0,this._leftHandSystemQuaternion=new n._f,this._deviceToWorld=n.y3.Identity(),this._pointingPoseNode=null,this._workingMatrix=n.y3.Identity(),this._meshAttachedObservable=new p.y$,this.type=v.POSE_ENABLED,this.controllerType=r.GENERIC,this.position=n.P.Zero(),this.rotationQuaternion=new n._f,this._calculatedPosition=n.P.Zero(),this._calculatedRotation=new n._f,n._f.RotationYawPitchRollToRef(Math.PI,0,0,this._leftHandSystemQuaternion)}update(){super.update(),this._updatePoseAndMesh()}_updatePoseAndMesh(){if(this.isXR)return;const t=this.browserGamepad.pose;if(this.updateFromDevice(t),!this._trackPosition&&f.l.LastCreatedScene&&f.l.LastCreatedScene.activeCamera&&f.l.LastCreatedScene.activeCamera.devicePosition){const t=f.l.LastCreatedScene.activeCamera;if(t._computeDevicePosition(),this._deviceToWorld.setTranslation(t.devicePosition),t.deviceRotationQuaternion){t._deviceRoomRotationQuaternion.toEulerAnglesToRef(n.jp.Vector3[0]);const e=Math.atan2(Math.sin(n.jp.Vector3[0].y-this._draggedRoomRotation),Math.cos(n.jp.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(e)>this._maxRotationDistFromHeadset){const t=e-(e<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=t;const i=Math.sin(-t),s=Math.cos(-t);this._calculatedPosition.x=this._calculatedPosition.x*s-this._calculatedPosition.z*i,this._calculatedPosition.z=this._calculatedPosition.x*i+this._calculatedPosition.z*s}}}n.P.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),n._f.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}updateFromDevice(t){if(!this.isXR&&t){this.rawPose=t,t.position&&(this._deviceRoomPosition.copyFromFloats(t.position[0],t.position[1],-t.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));const e=this.rawPose;t.orientation&&e.orientation&&4===e.orientation.length&&(this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}}attachToMesh(t){if(this._mesh&&(this._mesh.parent=null),this._mesh=t,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new n._f),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){const t=[];let e=this._pointingPoseNode;for(;e.parent;)t.push(e.parent),e=e.parent;t.reverse().forEach((t=>{t.computeWorldMatrix(!0)}))}this._meshAttachedObservable.notifyObservers(t)}attachToPoseControlledCamera(t){this._poseControlledCamera=t,this._mesh&&(this._mesh.parent=this._poseControlledCamera)}dispose(){this._mesh&&this._mesh.dispose(),this._mesh=null,super.dispose()}get mesh(){return this._mesh}getForwardRay(t=100){if(!this.mesh)return new b(n.P.Zero(),new n.P(0,0,1),t);const e=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),i=e.getTranslation(),s=new n.P(0,0,-1),o=n.P.TransformNormal(s,e),a=n.P.Normalize(o);return new b(i,a,t)}}.POINTING_POSE="POINTING_POSE",function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.LB=4]="LB",t[t.RB=5]="RB",t[t.Back=8]="Back",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick"}(h||(h={})),function(t){t[t.Up=12]="Up",t[t.Down=13]="Down",t[t.Left=14]="Left",t[t.Right=15]="Right"}(c||(c={}));class M extends v{constructor(t,e,i,s=!1){super(t,e,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new p.y$,this.onButtonUpObservable=new p.y$,this.onPadDownObservable=new p.y$,this.onPadUpObservable=new p.y$,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this._isXboxOnePad=!1,this.type=v.XBOX,this._isXboxOnePad=s}onlefttriggerchanged(t){this._onlefttriggerchanged=t}onrighttriggerchanged(t){this._onrighttriggerchanged=t}get leftTrigger(){return this._leftTrigger}set leftTrigger(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t}get rightTrigger(){return this._rightTrigger}set rightTrigger(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t}onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}ondpaddown(t){this._ondpaddown=t}ondpadup(t){this._ondpadup=t}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}_setDPadValue(t,e,i){return t!==e&&(1===t&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===t&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),t}get buttonA(){return this._buttonA}set buttonA(t){this._buttonA=this._setButtonValue(t,this._buttonA,h.A)}get buttonB(){return this._buttonB}set buttonB(t){this._buttonB=this._setButtonValue(t,this._buttonB,h.B)}get buttonX(){return this._buttonX}set buttonX(t){this._buttonX=this._setButtonValue(t,this._buttonX,h.X)}get buttonY(){return this._buttonY}set buttonY(t){this._buttonY=this._setButtonValue(t,this._buttonY,h.Y)}get buttonStart(){return this._buttonStart}set buttonStart(t){this._buttonStart=this._setButtonValue(t,this._buttonStart,h.Start)}get buttonBack(){return this._buttonBack}set buttonBack(t){this._buttonBack=this._setButtonValue(t,this._buttonBack,h.Back)}get buttonLB(){return this._buttonLB}set buttonLB(t){this._buttonLB=this._setButtonValue(t,this._buttonLB,h.LB)}get buttonRB(){return this._buttonRB}set buttonRB(t){this._buttonRB=this._setButtonValue(t,this._buttonRB,h.RB)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,h.LeftStick)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,h.RightStick)}get dPadUp(){return this._dPadUp}set dPadUp(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,c.Up)}get dPadDown(){return this._dPadDown}set dPadDown(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,c.Down)}get dPadLeft(){return this._dPadLeft}set dPadLeft(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,c.Left)}get dPadRight(){return this._dPadRight}set dPadRight(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,c.Right)}update(){super.update(),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}var T,C,w=i(2352);!function(t){t[t.Cross=0]="Cross",t[t.Circle=1]="Circle",t[t.Square=2]="Square",t[t.Triangle=3]="Triangle",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.Share=8]="Share",t[t.Options=9]="Options",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick"}(T||(T={})),function(t){t[t.Up=12]="Up",t[t.Down=13]="Down",t[t.Left=14]="Left",t[t.Right=15]="Right"}(C||(C={}));class k extends v{constructor(t,e,i){super(t.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),e,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new p.y$,this.onButtonUpObservable=new p.y$,this.onPadDownObservable=new p.y$,this.onPadUpObservable=new p.y$,this._buttonCross=0,this._buttonCircle=0,this._buttonSquare=0,this._buttonTriangle=0,this._buttonShare=0,this._buttonOptions=0,this._buttonL1=0,this._buttonR1=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this.type=v.DUALSHOCK}onlefttriggerchanged(t){this._onlefttriggerchanged=t}onrighttriggerchanged(t){this._onrighttriggerchanged=t}get leftTrigger(){return this._leftTrigger}set leftTrigger(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t}get rightTrigger(){return this._rightTrigger}set rightTrigger(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t}onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}ondpaddown(t){this._ondpaddown=t}ondpadup(t){this._ondpadup=t}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}_setDPadValue(t,e,i){return t!==e&&(1===t&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===t&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),t}get buttonCross(){return this._buttonCross}set buttonCross(t){this._buttonCross=this._setButtonValue(t,this._buttonCross,T.Cross)}get buttonCircle(){return this._buttonCircle}set buttonCircle(t){this._buttonCircle=this._setButtonValue(t,this._buttonCircle,T.Circle)}get buttonSquare(){return this._buttonSquare}set buttonSquare(t){this._buttonSquare=this._setButtonValue(t,this._buttonSquare,T.Square)}get buttonTriangle(){return this._buttonTriangle}set buttonTriangle(t){this._buttonTriangle=this._setButtonValue(t,this._buttonTriangle,T.Triangle)}get buttonOptions(){return this._buttonOptions}set buttonOptions(t){this._buttonOptions=this._setButtonValue(t,this._buttonOptions,T.Options)}get buttonShare(){return this._buttonShare}set buttonShare(t){this._buttonShare=this._setButtonValue(t,this._buttonShare,T.Share)}get buttonL1(){return this._buttonL1}set buttonL1(t){this._buttonL1=this._setButtonValue(t,this._buttonL1,T.L1)}get buttonR1(){return this._buttonR1}set buttonR1(t){this._buttonR1=this._setButtonValue(t,this._buttonR1,T.R1)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,T.LeftStick)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,T.RightStick)}get dPadUp(){return this._dPadUp}set dPadUp(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,C.Up)}get dPadDown(){return this._dPadDown}set dPadDown(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,C.Down)}get dPadLeft(){return this._dPadLeft}set dPadLeft(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,C.Left)}get dPadRight(){return this._dPadRight}set dPadRight(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,C.Right)}update(){super.update(),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}var S=i(8658);class I{constructor(t){if(this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new p.y$,(0,_.CG)()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&navigator.getGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new p.y$((t=>{for(const e in this._babylonGamepads){const i=this._babylonGamepads[e];i&&i._isConnected&&this.onGamepadConnectedObservable.notifyObserver(t,i)}})),this._onGamepadConnectedEvent=t=>{const e=t.gamepad;if(e.index in this._babylonGamepads&&this._babylonGamepads[e.index].isConnected)return;let i;this._babylonGamepads[e.index]?(i=this._babylonGamepads[e.index],i.browserGamepad=e,i._isConnected=!0):i=this._addNewGamepad(e),this.onGamepadConnectedObservable.notifyObservers(i),this._startMonitoringGamepads()},this._onGamepadDisconnectedEvent=t=>{const e=t.gamepad;for(const t in this._babylonGamepads)if(this._babylonGamepads[t].index===e.index){const e=this._babylonGamepads[t];e._isConnected=!1,this.onGamepadDisconnectedObservable.notifyObservers(e),e.dispose&&e.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){const t=this._scene?this._scene.getEngine().getHostWindow():window;t&&(t.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),t.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}get gamepads(){return this._babylonGamepads}getGamepadByType(t=v.XBOX){for(const e of this._babylonGamepads)if(e&&e.type===t)return e;return null}dispose(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((t=>{t.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]}_addNewGamepad(t){let e;this._oneGamepadConnected||(this._oneGamepadConnected=!0);const i=-1!==t.id.search("054c")&&-1===t.id.search("0ce6"),s=-1!==t.id.search("Xbox One");return e=s||-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")||-1!==t.id.search("045e")&&-1===t.id.search("Surface Dock")?new M(t.id,t.index,t,s):i?new k(t.id,t.index,t):t.pose?R.InitiateController(t):new P(t.id,t.index,t),this._babylonGamepads[e.index]=e,e}_startMonitoringGamepads(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())}_stopMonitoringGamepads(){this._isMonitoring=!1}_checkGamepadsStatus(){this._updateGamepadObjects();for(const t in this._babylonGamepads){const e=this._babylonGamepads[t];if(e&&e.isConnected)try{e.update()}catch(t){-1===this._loggedErrors.indexOf(e.index)&&(S.w1.Warn(`Error updating gamepad ${e.id}`),this._loggedErrors.push(e.index))}}this._isMonitoring&&!this._scene&&w.D.QueueNewFrame((()=>{this._checkGamepadsStatus()}))}_updateGamepadObjects(){const t=navigator.getGamepads?navigator.getGamepads():[];for(let e=0;e<t.length;e++){const i=t[e];if(i)if(this._babylonGamepads[i.index])this._babylonGamepads[e].browserGamepad=i,this._babylonGamepads[e].isConnected||(this._babylonGamepads[e]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[e]));else{const t=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(t)}}}}var O=i(653),x=i(1069),D=i(8137),A=i(9759);class E{constructor(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=n.y3.Identity(),this._deltaTransform=n.P.Zero(),this._vector3=n.P.Zero(),this._vector2=n.FM.Zero()}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){const t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add((t=>{t.type!==v.POSE_ENABLED&&(this.gamepad&&t.type!==v.XBOX||(this.gamepad=t))})),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add((t=>{this.gamepad===t&&(this.gamepad=null)})),this.gamepad=t.getGamepadByType(v.XBOX),!this.gamepad&&t.gamepads.length&&(this.gamepad=t.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad&&this.gamepad.leftStick){const t=this.camera,e=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(e.x=Math.abs(e.x)>this.deadzoneDelta?e.x/this.gamepadMoveSensibility:0,e.y=Math.abs(e.y)>this.deadzoneDelta?e.y/this.gamepadMoveSensibility:0);let i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):n.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);const s=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*s,0,-e.y*s),n.P.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),t.cameraRotation.addInPlace(this._vector2)}}getClassName(){return"FreeCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,x.gn)([(0,D.qC)()],E.prototype,"gamepadAngularSensibility",void 0),(0,x.gn)([(0,D.qC)()],E.prototype,"gamepadMoveSensibility",void 0),A.u.FreeCameraGamepadInput=E;var L=i(27);class N{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=S.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();let s=0,n=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=o=>{var a,r;const h=o.event,c="touch"===h.pointerType;if(e.isInVRExclusivePointerMode)return;if(o.type!==L.kD.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const l=h.target;if(this._altKey=h.altKey,this._ctrlKey=h.ctrlKey,this._metaKey=h.metaKey,this._shiftKey=h.shiftKey,this._buttonsPressed=h.buttons,e.isPointerLock){const t=h.movementX,e=h.movementY;this.onTouch(null,t,e),this._pointA=null,this._pointB=null}else{if(o.type!==L.kD.POINTERDOWN&&c&&(null===(a=this._pointA)||void 0===a?void 0:a.pointerId)!==h.pointerId&&(null===(r=this._pointB)||void 0===r?void 0:r.pointerId)!==h.pointerId)return;if(o.type!==L.kD.POINTERDOWN||-1!==this._currentActiveButton&&!c)if(o.type===L.kD.POINTERDOUBLETAP)this.onDoubleTap(h.pointerType);else if(o.type!==L.kD.POINTERUP||this._currentActiveButton!==h.button&&!c){if(o.type===L.kD.POINTERMOVE)if(t||h.preventDefault(),this._pointA&&null===this._pointB){const t=h.clientX-this._pointA.x,e=h.clientY-this._pointA.y;this.onTouch(this._pointA,t,e),this._pointA.x=h.clientX,this._pointA.y=h.clientY}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===h.pointerId?this._pointA:this._pointB;t.x=h.clientX,t.y=h.clientY;const e=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,a=e*e+i*i,r={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:h.pointerId,type:o.type};this.onMultiTouch(this._pointA,this._pointB,s,a,n,r),n=r,s=a}}else{try{null==l||l.releasePointerCapture(h.pointerId)}catch(t){}c||(this._pointB=null),e._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==h.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==h.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||n)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,n,null),s=0,n=null),this._currentActiveButton=-1,this.onButtonUp(h),t||h.preventDefault()}else{try{null==l||l.setPointerCapture(h.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType};else{if(null!==this._pointB)return;this._pointB={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType}}-1!==this._currentActiveButton||c||(this._currentActiveButton=h.button),this.onButtonDown(h),t||(h.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,L.kD.POINTERDOWN|L.kD.POINTERUP|L.kD.POINTERMOVE|L.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,n=null,this.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const o=this.camera.getScene().getEngine().getHostWindow();o&&S.w1.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const t=this.camera.getScene().getEngine().getHostWindow();t&&S.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,e,i){}onMultiTouch(t,e,i,s,n,o){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,x.gn)([(0,D.qC)()],N.prototype,"buttons",void 0);class G extends N{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,e){if(0!==this.panningSensibility&&t&&e){const i=e.x-t.x,s=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(t,e){const i=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(t)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-t)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,e,i,s,n,o){0===i&&null===n||0===s&&null===o||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(n,o)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(n,o)):this.multiTouchPanning?this._computeMultiTouchPanning(n,o):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,x.gn)([(0,D.qC)()],G.prototype,"buttons",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"angularSensibilityX",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"angularSensibilityY",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"pinchPrecision",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"pinchDeltaPercentage",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"useNaturalPinchZoom",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"pinchZoom",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"panningSensibility",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"multiTouchPanning",void 0),(0,x.gn)([(0,D.qC)()],G.prototype,"multiTouchPanAndZoom",void 0),A.u.ArcRotateCameraPointersInput=G;var B=i(6081);class F{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=S.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===B.OG.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode))&&(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault()));else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&(t||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,x.gn)([(0,D.qC)()],F.prototype,"keysUp",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"keysDown",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"keysLeft",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"keysRight",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"keysReset",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"panningSensibility",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"zoomingSensibility",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"useAltToZoom",void 0),(0,x.gn)([(0,D.qC)()],F.prototype,"angularSpeed",void 0),A.u.ArcRotateCameraKeyboardMoveInput=F;var U=i(6504),Y=i(4551),V=i(1318),X=i(1226);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=n.P.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,e){let i=0;const s=.01*t*this.wheelDeltaPercentage*e;return i=t>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),i}attachControl(t){t=S.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==L.kD.POINTERWHEEL)return;const i=e.event;let s=0;const n=i.deltaMode===V.G.DOM_DELTA_LINE?40:1,o=-i.deltaY*n;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(o,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(o,this.camera.radius),s>0){let t=this.camera.radius,e=this.camera.inertialRadiusOffset+s;for(let i=0;i<20&&Math.abs(e)>.001;i++)t-=e,e*=this.camera.inertia;t=X.R.Clamp(t,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(o,t)}}else s=o/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation&&this._hitPlane?this._zoomToMouse(s):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,L.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,e=t.target.subtract(t.position);this._hitPlane=U.J.FromPositionAndNormal(t.target,e)}_getPosition(){var t;const e=this.camera,i=e.getScene(),s=i.createPickingRay(i.pointerX,i.pointerY,n.y3.Identity(),e,!1);let o=0;return this._hitPlane&&(o=null!==(t=s.intersectsPlane(this._hitPlane))&&void 0!==t?t:0),s.origin.addInPlace(s.direction.scaleInPlace(o))}_zoomToMouse(t){var e,i;const s=this.camera,o=1-s.inertia;if(s.lowerRadiusLimit){const i=null!==(e=s.lowerRadiusLimit)&&void 0!==e?e:0;s.radius-(s.inertialRadiusOffset+t)/o<i&&(t=(s.radius-i)*o-s.inertialRadiusOffset)}if(s.upperRadiusLimit){const e=null!==(i=s.upperRadiusLimit)&&void 0!==i?i:0;s.radius-(s.inertialRadiusOffset+t)/o>e&&(t=(s.radius-e)*o-s.inertialRadiusOffset)}const a=t/o/s.radius,r=this._getPosition(),h=n.jp.Vector3[6];r.subtractToRef(s.target,h),h.scaleInPlace(a),h.scaleInPlace(o),this._inertialPanning.addInPlace(h),s.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<Y.kn&&(t.x=0),Math.abs(t.y)<Y.kn&&(t.y=0),Math.abs(t.z)<Y.kn&&(t.z=0)}}(0,x.gn)([(0,D.qC)()],Z.prototype,"wheelPrecision",void 0),(0,x.gn)([(0,D.qC)()],Z.prototype,"zoomToMouseLocation",void 0),(0,x.gn)([(0,D.qC)()],Z.prototype,"wheelDeltaPercentage",void 0),A.u.ArcRotateCameraMouseWheelInput=Z;class W extends A.p{constructor(t){super(t)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new F),this}}class z{constructor(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){const t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add((t=>{t.type!==v.POSE_ENABLED&&(this.gamepad&&t.type!==v.XBOX||(this.gamepad=t))})),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add((t=>{this.gamepad===t&&(this.gamepad=null)})),this.gamepad=t.getGamepadByType(v.XBOX)}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad){const t=this.camera,e=this.gamepad.rightStick;if(e){if(0!=e.x){const i=e.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(0!=e.y){const i=e.y/this.gamepadRotationSensibility*this._yAxisScale;0!=i&&Math.abs(i)>.005&&(t.inertialBetaOffset+=i)}}const i=this.gamepad.leftStick;if(i&&0!=i.y){const t=i.y/this.gamepadMoveSensibility;0!=t&&Math.abs(t)>.005&&(this.camera.inertialRadiusOffset-=t)}}}getClassName(){return"ArcRotateCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,x.gn)([(0,D.qC)()],z.prototype,"gamepadRotationSensibility",void 0),(0,x.gn)([(0,D.qC)()],z.prototype,"gamepadMoveSensibility",void 0),A.u.ArcRotateCameraGamepadInput=z,Object.defineProperty(d.x.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new I(this);let t=this._getComponent(u.l.NAME_GAMEPAD);t||(t=new H(this),this._addComponent(t))}return this._gamepadManager},enumerable:!0,configurable:!0}),O.a.prototype.addGamepad=function(){return this.add(new E),this},W.prototype.addGamepad=function(){return this.add(new z),this};class H{constructor(t){this.name=u.l.NAME_GAMEPAD,this.scene=t}register(){this.scene._beforeCameraUpdateStage.registerStep(u.l.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)}rebuild(){}dispose(){const t=this.scene._gamepadManager;t&&(t.dispose(),this.scene._gamepadManager=null)}_beforeCameraUpdate(){const t=this.scene._gamepadManager;t&&t._isMonitoring&&t._checkGamepadsStatus()}}o.N.AddNodeConstructor("FreeCamera",((t,e)=>()=>new q(t,n.P.Zero(),e)));class q extends a{get gamepadAngularSensibility(){const t=this.inputs.attached.gamepad;return t?t.gamepadAngularSensibility:0}set gamepadAngularSensibility(t){const e=this.inputs.attached.gamepad;e&&(e.gamepadAngularSensibility=t)}get gamepadMoveSensibility(){const t=this.inputs.attached.gamepad;return t?t.gamepadMoveSensibility:0}set gamepadMoveSensibility(t){const e=this.inputs.attached.gamepad;e&&(e.gamepadMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addGamepad()}getClassName(){return"UniversalCamera"}}l.V._CreateDefaultParsedCamera=(t,e)=>new q(t,n.P.Zero(),e)},4468:(t,e,i)=>{i.d(e,{e:()=>u});var s=i(1069),n=i(8137),o=i(5412),a=i(2922),r=i(6387),h=i(5888),c=i(646),l=i(183);class d extends r.N{get range(){return this._range}set range(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(t){this._intensityMode=t,this._computePhotometricScale()}get radius(){return this._radius}set radius(t){this._radius=t,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}constructor(t,e){super(t,e),this.diffuse=new a.Wo(1,1,1),this.specular=new a.Wo(1,1,1),this.falloffType=d.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=d.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new h.M(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this._resyncMeshes()}transferTexturesToEffect(t,e){return this}_bindLight(t,e,i,s,n=!0){var o;const r=t.toString();let h=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+r),this._renderId!==e.getRenderId()||this._lastUseSpecular!==s||!this._uniformBuffer.useUbo){this._renderId=e.getRenderId(),this._lastUseSpecular=s;const t=this.getScaledIntensity();this.transferToEffect(i,r),this.diffuse.scaleToRef(t,a.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.zZ.Color3[0],this.range,r),s&&(this.specular.scaleToRef(t,a.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.zZ.Color3[1],this.radius,r)),h=!0}if(this.transferTexturesToEffect(i,r),e.shadowsEnabled&&this.shadowEnabled&&n){const t=null!==(o=this.getShadowGenerator(e.activeCamera))&&void 0!==o?o:this.getShadowGenerator();t&&(t.bindShadowLight(r,i),h=!0)}h?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(t){let e="Name: "+this.name;if(e+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(t){super.setEnabled(t),this._resyncMeshes()}getShadowGenerator(t=null){var e;return null===this._shadowGenerators?null:null!==(e=this._shadowGenerators.get(t))&&void 0!==e?e:null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return o.P.Zero()}canAffectMesh(t){return!(t&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&t.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask))}dispose(t,e=!1){if(this._shadowGenerators){const t=this._shadowGenerators.values();for(let e=t.next();!0!==e.done;e=t.next())e.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(const t of this.getScene().meshes)t._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(t,e)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(t,e=null){const i=d.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!i)return null;const s=n.p4.Clone(i,this);return t&&(s.name=t),e&&(s.parent=e),s.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(s),s}serialize(){const t=n.p4.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((e=>{t.excludedMeshesIds.push(e.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((e=>{t.includedOnlyMeshesIds.push(e.id)}))),n.p4.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static GetConstructorFromName(t,e,i){return r.N.Construct("Light_Type_"+t,e,i)||null}static Parse(t,e){const i=d.GetConstructorFromName(t.type,t.name,e);if(!i)return null;const s=n.p4.Parse(i,t,e);if(t.excludedMeshesIds&&(s._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(s.falloffType=t.falloffType),void 0!==t.lightmapMode&&(s.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=(0,c.q)("BABYLON.Animation");n&&s.animations.push(n.Parse(i))}r.N.ParseAnimationRanges(s,t,e)}return t.autoAnimate&&e.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s}_hookArrayForExcluded(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);for(const t of i)t._resyncLightSource(this);return s};const i=t.splice;t.splice=(e,s)=>{const n=i.apply(t,[e,s]);for(const t of n)t._resyncLightSource(this);return n};for(const e of t)e._resyncLightSource(this)}_hookArrayForIncludedOnly(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);return this._resyncMeshes(),s};const i=t.splice;t.splice=(e,s)=>{const n=i.apply(t,[e,s]);return this._resyncMeshes(),n},this._resyncMeshes()}_resyncMeshes(){for(const t of this.getScene().meshes)t._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const t of this.getScene().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let t=0;const e=this.getTypeID();let i=this.intensityMode;switch(i===d.INTENSITYMODE_AUTOMATIC&&(i=e===d.LIGHTTYPEID_DIRECTIONALLIGHT?d.INTENSITYMODE_ILLUMINANCE:d.INTENSITYMODE_LUMINOUSINTENSITY),e){case d.LIGHTTYPEID_POINTLIGHT:case d.LIGHTTYPEID_SPOTLIGHT:switch(i){case d.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case d.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case d.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case d.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case d.INTENSITYMODE_ILLUMINANCE:t=1;break;case d.INTENSITYMODE_LUMINANCE:{let e=this.radius;e=Math.max(e,.001),t=2*Math.PI*(1-Math.cos(e));break}}break;case d.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}_reorderLightsInScene(){const t=this.getScene();0!=this._renderPriority&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}d.FALLOFF_DEFAULT=l.m.FALLOFF_DEFAULT,d.FALLOFF_PHYSICAL=l.m.FALLOFF_PHYSICAL,d.FALLOFF_GLTF=l.m.FALLOFF_GLTF,d.FALLOFF_STANDARD=l.m.FALLOFF_STANDARD,d.LIGHTMAP_DEFAULT=l.m.LIGHTMAP_DEFAULT,d.LIGHTMAP_SPECULAR=l.m.LIGHTMAP_SPECULAR,d.LIGHTMAP_SHADOWSONLY=l.m.LIGHTMAP_SHADOWSONLY,d.INTENSITYMODE_AUTOMATIC=l.m.INTENSITYMODE_AUTOMATIC,d.INTENSITYMODE_LUMINOUSPOWER=l.m.INTENSITYMODE_LUMINOUSPOWER,d.INTENSITYMODE_LUMINOUSINTENSITY=l.m.INTENSITYMODE_LUMINOUSINTENSITY,d.INTENSITYMODE_ILLUMINANCE=l.m.INTENSITYMODE_ILLUMINANCE,d.INTENSITYMODE_LUMINANCE=l.m.INTENSITYMODE_LUMINANCE,d.LIGHTTYPEID_POINTLIGHT=l.m.LIGHTTYPEID_POINTLIGHT,d.LIGHTTYPEID_DIRECTIONALLIGHT=l.m.LIGHTTYPEID_DIRECTIONALLIGHT,d.LIGHTTYPEID_SPOTLIGHT=l.m.LIGHTTYPEID_SPOTLIGHT,d.LIGHTTYPEID_HEMISPHERICLIGHT=l.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,s.gn)([(0,n.n9)()],d.prototype,"diffuse",void 0),(0,s.gn)([(0,n.n9)()],d.prototype,"specular",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"falloffType",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"intensity",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"range",null),(0,s.gn)([(0,n.qC)()],d.prototype,"intensityMode",null),(0,s.gn)([(0,n.qC)()],d.prototype,"radius",null),(0,s.gn)([(0,n.qC)()],d.prototype,"_renderPriority",void 0),(0,s.gn)([(0,n.wz)("_reorderLightsInScene")],d.prototype,"renderPriority",void 0),(0,s.gn)([(0,n.qC)("shadowEnabled")],d.prototype,"_shadowEnabled",void 0),(0,s.gn)([(0,n.qC)("excludeWithLayerMask")],d.prototype,"_excludeWithLayerMask",void 0),(0,s.gn)([(0,n.qC)("includeOnlyWithLayerMask")],d.prototype,"_includeOnlyWithLayerMask",void 0),(0,s.gn)([(0,n.qC)("lightmapMode")],d.prototype,"_lightmapMode",void 0),r.N.AddNodeConstructor("Light_Type_3",((t,e)=>()=>new u(t,o.P.Zero(),e)));class u extends d{constructor(t,e,i){super(t,i),this.groundColor=new a.Wo(0,0,0),this.direction=e||o.P.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(t){return this.direction=o.P.Normalize(t.subtract(o.P.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,e){const i=o.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,e),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),e),this}transferToNodeMaterialEffect(t,e){const i=o.P.Normalize(this.direction);return t.setFloat3(e,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=o.y3.Identity()),this._worldMatrix}getTypeID(){return d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,e){t["HEMILIGHT"+e]=!0}}(0,s.gn)([(0,n.n9)()],u.prototype,"groundColor",void 0),(0,s.gn)([(0,n.hd)()],u.prototype,"direction",void 0)}},t=>{var e=e=>t(t.s=e);t.O(0,[58,340],(()=>(e(4571),e(7136),e(4468)))),t.O()}]);