"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[404],{635:(t,e,i)=>{i.d(e,{Y:()=>x});var s=i(1069),n=i(8137),a=i(8139),o=i(5412),r=i(6387),h=i(6791),l=i(27),c=i(9665),u=i(4551);class d{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver=e.onPrePointerObservable.add((t=>{t.type!==l.kD.POINTERDOWN?t.type===l.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=c.F.Now;let e=0;null!=this._lastFrameTime&&(e=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const i=t-this._lastInteractionTime-this._idleRotationWaitTime,s=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*s,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(e/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}resetLastInteractionTime(t){this._lastInteractionTime=null!=t?t:c.F.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<u.kn}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=c.F.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}i(3118);class _{constructor(){this._easingMode=_.EASINGMODE_EASEIN}setEasingMode(t){const e=Math.min(Math.max(t,0),2);this._easingMode=e}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case _.EASINGMODE_EASEIN:return this.easeInCore(t);case _.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}_.EASINGMODE_EASEIN=0,_.EASINGMODE_EASEOUT=1,_.EASINGMODE_EASEINOUT=2;var p,m=i(2922),g=i(1226),f=i(646);!function(t){t[t.NONE=0]="NONE",t[t.STEP=1]="STEP"}(p||(p={}));class y{constructor(t,e,i){this.name=t,this.from=e,this.to=i}clone(){return new y(this.name,this.from,this.to)}}var T=i(3321),v=i(4910);class I{static _PrepareAnimation(t,e,i,s,n,a,r,h){let l;if(!isNaN(parseFloat(n))&&isFinite(n)?l=I.ANIMATIONTYPE_FLOAT:n instanceof o._f?l=I.ANIMATIONTYPE_QUATERNION:n instanceof o.P?l=I.ANIMATIONTYPE_VECTOR3:n instanceof o.FM?l=I.ANIMATIONTYPE_VECTOR2:n instanceof m.Wo?l=I.ANIMATIONTYPE_COLOR3:n instanceof m.HE?l=I.ANIMATIONTYPE_COLOR4:n instanceof T.$&&(l=I.ANIMATIONTYPE_SIZE),null==l)return null;const c=new I(t,e,i,l,r),u=[{frame:0,value:n},{frame:s,value:a}];return c.setKeys(u),void 0!==h&&c.setEasingFunction(h),c}static CreateAnimation(t,e,i,s){const n=new I(t+"Animation",t,i,e,I.ANIMATIONLOOPMODE_CONSTANT);return n.setEasingFunction(s),n}static CreateAndStartAnimation(t,e,i,s,n,a,o,r,h,l,c){const u=I._PrepareAnimation(t,i,s,n,a,o,r,h);return u?(e.getScene&&(c=e.getScene()),c?c.beginDirectAnimation(e,[u],0,n,1===u.loopMode,1,l):null):null}static CreateAndStartHierarchyAnimation(t,e,i,s,n,a,o,r,h,l,c){const u=I._PrepareAnimation(t,s,n,a,o,r,h,l);return u?e.getScene().beginDirectHierarchyAnimation(e,i,[u],0,a,1===u.loopMode,1,c):null}static CreateMergeAndStartAnimation(t,e,i,s,n,a,o,r,h,l){const c=I._PrepareAnimation(t,i,s,n,a,o,r,h);return c?(e.animations.push(c),e.getScene().beginAnimation(e,0,n,1===c.loopMode,1,l)):null}static MakeAnimationAdditive(t,e=0,i,s=!1,n){let a=t;if(s&&(a=t.clone(),a.name=n||a.name),!a._keys.length)return a;e=e>=0?e:0;let r=0;const h=a._keys[0];let l=a._keys.length-1;const c=a._keys[l],u={referenceValue:h.value,referencePosition:o.jp.Vector3[0],referenceQuaternion:o.jp.Quaternion[0],referenceScaling:o.jp.Vector3[1],keyPosition:o.jp.Vector3[2],keyQuaternion:o.jp.Quaternion[1],keyScaling:o.jp.Vector3[3]};let d=!1,_=h.frame,p=c.frame;if(i){const t=a.getRange(i);t&&(_=t.from,p=t.to)}let m=h.frame===_,g=c.frame===p;if(1===a._keys.length){const t=a._getKeyValue(a._keys[0]);u.referenceValue=t.clone?t.clone():t,d=!0}else if(e<=h.frame){const t=a._getKeyValue(h.value);u.referenceValue=t.clone?t.clone():t,d=!0}else if(e>=c.frame){const t=a._getKeyValue(c.value);u.referenceValue=t.clone?t.clone():t,d=!0}let f=0;for(;!d||!m||!g&&f<a._keys.length-1;){const t=a._keys[f],i=a._keys[f+1];if(!d&&e>=t.frame&&e<=i.frame){let s;if(e===t.frame)s=a._getKeyValue(t.value);else if(e===i.frame)s=a._getKeyValue(i.value);else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};s=a._interpolate(e,t)}u.referenceValue=s.clone?s.clone():s,d=!0}if(!m&&_>=t.frame&&_<=i.frame){if(_===t.frame)r=f;else if(_===i.frame)r=f+1;else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},e=a._interpolate(_,t),i={frame:_,value:e.clone?e.clone():e};a._keys.splice(f+1,0,i),r=f+1}m=!0}if(!g&&p>=t.frame&&p<=i.frame){if(p===t.frame)l=f;else if(p===i.frame)l=f+1;else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},e=a._interpolate(p,t),i={frame:p,value:e.clone?e.clone():e};a._keys.splice(f+1,0,i),l=f+1}g=!0}f++}for(a.dataType===I.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():a.dataType===I.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace()),f=r;f<=l;f++){const t=a._keys[f];if(!f||a.dataType===I.ANIMATIONTYPE_FLOAT||t.value!==h.value)switch(a.dataType){case I.ANIMATIONTYPE_MATRIX:t.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.subtractInPlace(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),o.y3.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,t.value);break;case I.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(t.value,t.value);break;case I.ANIMATIONTYPE_VECTOR2:case I.ANIMATIONTYPE_VECTOR3:case I.ANIMATIONTYPE_COLOR3:case I.ANIMATIONTYPE_COLOR4:t.value.subtractToRef(u.referenceValue,t.value);break;case I.ANIMATIONTYPE_SIZE:t.value.width-=u.referenceValue.width,t.value.height-=u.referenceValue.height;break;default:t.value-=u.referenceValue}}return a}static TransitionTo(t,e,i,s,n,a,o,r=null){if(o<=0)return i[t]=e,r&&r(),null;const h=n*(o/1e3);a.setKeys([{frame:0,value:i[t].clone?i[t].clone():i[t]},{frame:h,value:e}]),i.animations||(i.animations=[]),i.animations.push(a);const l=s.beginAnimation(i,0,h,!1);return l.onAnimationEnd=r,l}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const t of this._runtimeAnimations)if(!t.isStopped())return!0;return!1}constructor(t,e,i,s,n,a){this.name=t,this.targetProperty=e,this.framePerSecond=i,this.dataType=s,this.loopMode=n,this.enableBlending=a,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=s,this.loopMode=void 0===n?I.ANIMATIONLOOPMODE_CYCLE:n,this.uniqueId=I._UniqueIdGenerator++}toString(t){let e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";let t=!0;for(const i in this._ranges)t&&(e+=", ",t=!1),e+=i;e+="}"}return e}addEvent(t){this._events.push(t),this._events.sort(((t,e)=>t.frame-e.frame))}removeEvents(t){for(let e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)}getEvents(){return this._events}createRange(t,e,i){this._ranges[t]||(this._ranges[t]=new y(t,e,i))}deleteRange(t,e=!0){const i=this._ranges[t];if(i){if(e){const t=i.from,e=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=t&&this._keys[i].frame<=e&&this._keys.splice(i,1)}this._ranges[t]=null}}getRange(t){return this._ranges[t]}getKeys(){return this._keys}getHighestFrame(){let t=0;for(let e=0,i=this._keys.length;e<i;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t}getEasingFunction(){return this._easingFunction}setEasingFunction(t){this._easingFunction=t}floatInterpolateFunction(t,e,i){return g.R.Lerp(t,e,i)}floatInterpolateFunctionWithTangents(t,e,i,s,n){return g.R.Hermite(t,e,i,s,n)}quaternionInterpolateFunction(t,e,i){return o._f.Slerp(t,e,i)}quaternionInterpolateFunctionWithTangents(t,e,i,s,n){return o._f.Hermite(t,e,i,s,n).normalize()}vector3InterpolateFunction(t,e,i){return o.P.Lerp(t,e,i)}vector3InterpolateFunctionWithTangents(t,e,i,s,n){return o.P.Hermite(t,e,i,s,n)}vector2InterpolateFunction(t,e,i){return o.FM.Lerp(t,e,i)}vector2InterpolateFunctionWithTangents(t,e,i,s,n){return o.FM.Hermite(t,e,i,s,n)}sizeInterpolateFunction(t,e,i){return T.$.Lerp(t,e,i)}color3InterpolateFunction(t,e,i){return m.Wo.Lerp(t,e,i)}color3InterpolateFunctionWithTangents(t,e,i,s,n){return m.Wo.Hermite(t,e,i,s,n)}color4InterpolateFunction(t,e,i){return m.HE.Lerp(t,e,i)}color4InterpolateFunctionWithTangents(t,e,i,s,n){return m.HE.Hermite(t,e,i,s,n)}_getKeyValue(t){return"function"==typeof t?t():t}evaluate(t){return this._interpolate(t,{key:0,repeatCount:0,loopMode:I.ANIMATIONLOOPMODE_CONSTANT})}_interpolate(t,e){if(e.loopMode===I.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;const i=this._keys,s=i.length;let n=e.key;for(;n>=0&&t<i[n].frame;)--n;for(;n+1<=s-1&&t>=i[n+1].frame;)++n;if(e.key=n,n<0)return this._getKeyValue(i[0].value);if(n+1>s-1)return this._getKeyValue(i[s-1].value);const a=i[n],o=i[n+1],r=this._getKeyValue(a.value),h=this._getKeyValue(o.value);if(a.interpolation===p.STEP)return o.frame>t?r:h;const l=void 0!==a.outTangent&&void 0!==o.inTangent,c=o.frame-a.frame;let u=(t-a.frame)/c;const d=this.getEasingFunction();switch(null!==d&&(u=d.ease(u)),this.dataType){case I.ANIMATIONTYPE_FLOAT:{const t=l?this.floatInterpolateFunctionWithTangents(r,a.outTangent*c,h,o.inTangent*c,u):this.floatInterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+t}break}case I.ANIMATIONTYPE_QUATERNION:{const t=l?this.quaternionInterpolateFunctionWithTangents(r,a.outTangent.scale(c),h,o.inTangent.scale(c),u):this.quaternionInterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return t.addInPlace(e.offsetValue.scale(e.repeatCount))}return t}case I.ANIMATIONTYPE_VECTOR3:{const t=l?this.vector3InterpolateFunctionWithTangents(r,a.outTangent.scale(c),h,o.inTangent.scale(c),u):this.vector3InterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case I.ANIMATIONTYPE_VECTOR2:{const t=l?this.vector2InterpolateFunctionWithTangents(r,a.outTangent.scale(c),h,o.inTangent.scale(c),u):this.vector2InterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case I.ANIMATIONTYPE_SIZE:switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(r,h,u);case I.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(r,h,u).add(e.offsetValue.scale(e.repeatCount))}break;case I.ANIMATIONTYPE_COLOR3:{const t=l?this.color3InterpolateFunctionWithTangents(r,a.outTangent.scale(c),h,o.inTangent.scale(c),u):this.color3InterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case I.ANIMATIONTYPE_COLOR4:{const t=l?this.color4InterpolateFunctionWithTangents(r,a.outTangent.scale(c),h,o.inTangent.scale(c),u):this.color4InterpolateFunction(r,h,u);switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return t;case I.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case I.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:return I.AllowMatricesInterpolation?this.matrixInterpolateFunction(r,h,u,e.workValue):r;case I.ANIMATIONLOOPMODE_RELATIVE:return r}}return 0}matrixInterpolateFunction(t,e,i,s){return I.AllowMatrixDecomposeForInterpolation?s?(o.y3.DecomposeLerpToRef(t,e,i,s),s):o.y3.DecomposeLerp(t,e,i):s?(o.y3.LerpToRef(t,e,i,s),s):o.y3.Lerp(t,e,i)}clone(){const t=new I(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const e in this._ranges){const i=this._ranges[e];i&&(t._ranges[e]=i.clone())}}return t}setKeys(t){this._keys=t.slice(0)}serialize(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const e=this.dataType;t.keys=[];const i=this.getKeys();for(let s=0;s<i.length;s++){const n=i[s],a={};switch(a.frame=n.frame,e){case I.ANIMATIONTYPE_FLOAT:a.values=[n.value],void 0!==n.inTangent&&a.values.push(n.inTangent),void 0!==n.outTangent&&(void 0===n.inTangent&&a.values.push(void 0),a.values.push(n.outTangent)),void 0!==n.interpolation&&(void 0===n.inTangent&&a.values.push(void 0),void 0===n.outTangent&&a.values.push(void 0),a.values.push(n.interpolation));break;case I.ANIMATIONTYPE_QUATERNION:case I.ANIMATIONTYPE_MATRIX:case I.ANIMATIONTYPE_VECTOR3:case I.ANIMATIONTYPE_COLOR3:case I.ANIMATIONTYPE_COLOR4:a.values=n.value.asArray(),null!=n.inTangent&&a.values.push(n.inTangent.asArray()),null!=n.outTangent&&(void 0===n.inTangent&&a.values.push(void 0),a.values.push(n.outTangent.asArray())),void 0!==n.interpolation&&(void 0===n.inTangent&&a.values.push(void 0),void 0===n.outTangent&&a.values.push(void 0),a.values.push(n.interpolation))}t.keys.push(a)}t.ranges=[];for(const e in this._ranges){const i=this._ranges[e];if(!i)continue;const s={};s.name=e,s.from=i.from,s.to=i.to,t.ranges.push(s)}return t}static _UniversalLerp(t,e,i){const s=t.constructor;return s.Lerp?s.Lerp(t,e,i):s.Slerp?s.Slerp(t,e,i):t.toFixed?t*(1-i)+i*e:e}static Parse(t){const e=new I(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),i=t.dataType,s=[];let n,a;for(t.enableBlending&&(e.enableBlending=t.enableBlending),t.blendingSpeed&&(e.blendingSpeed=t.blendingSpeed),a=0;a<t.keys.length;a++){const e=t.keys[a];let r,h,l;switch(i){case I.ANIMATIONTYPE_FLOAT:n=e.values[0],e.values.length>=2&&(r=e.values[1]),e.values.length>=3&&(h=e.values[2]),e.values.length>=4&&(l=e.values[3]);break;case I.ANIMATIONTYPE_QUATERNION:if(n=o._f.FromArray(e.values),e.values.length>=8){const t=o._f.FromArray(e.values.slice(4,8));t.equals(o._f.Zero())||(r=t)}if(e.values.length>=12){const t=o._f.FromArray(e.values.slice(8,12));t.equals(o._f.Zero())||(h=t)}e.values.length>=13&&(l=e.values[12]);break;case I.ANIMATIONTYPE_MATRIX:n=o.y3.FromArray(e.values),e.values.length>=17&&(l=e.values[16]);break;case I.ANIMATIONTYPE_COLOR3:n=m.Wo.FromArray(e.values),e.values[3]&&(r=m.Wo.FromArray(e.values[3])),e.values[4]&&(h=m.Wo.FromArray(e.values[4])),e.values[5]&&(l=e.values[5]);break;case I.ANIMATIONTYPE_COLOR4:n=m.HE.FromArray(e.values),e.values[4]&&(r=m.HE.FromArray(e.values[4])),e.values[5]&&(h=m.HE.FromArray(e.values[5])),e.values[6]&&(l=m.HE.FromArray(e.values[6]));break;case I.ANIMATIONTYPE_VECTOR3:default:n=o.P.FromArray(e.values),e.values[3]&&(r=o.P.FromArray(e.values[3])),e.values[4]&&(h=o.P.FromArray(e.values[4])),e.values[5]&&(l=e.values[5])}const c={};c.frame=e.frame,c.value=n,null!=r&&(c.inTangent=r),null!=h&&(c.outTangent=h),null!=l&&(c.interpolation=l),s.push(c)}if(e.setKeys(s),t.ranges)for(a=0;a<t.ranges.length;a++)n=t.ranges[a],e.createRange(n.name,n.from,n.to);return e}static AppendSerializedAnimations(t,e){n.p4.AppendSerializedAnimations(t,e)}static ParseFromFileAsync(t,e){return new Promise(((i,s)=>{const n=new v.g;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){let e=JSON.parse(n.responseText);if(e.animations&&(e=e.animations),e.length){const t=new Array;for(const i of e)t.push(this.Parse(i));i(t)}else{const s=this.Parse(e);t&&(s.name=t),i(s)}}else s("Unable to load the animation")})),n.open("GET",e),n.send()}))}static ParseFromSnippetAsync(t){return new Promise(((e,i)=>{const s=new v.g;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const i=JSON.parse(JSON.parse(s.responseText).jsonPayload);if(i.animations){const s=JSON.parse(i.animations),n=new Array;for(const e of s.animations){const i=this.Parse(e);i.snippetId=t,n.push(i)}e(n)}else{const s=JSON.parse(i.animation),n=this.Parse(s);n.snippetId=t,e(n)}}else i("Unable to load the snippet "+t)})),s.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),s.send()}))}}I._UniqueIdGenerator=0,I.AllowMatricesInterpolation=!1,I.AllowMatrixDecomposeForInterpolation=!0,I.SnippetUrl="https://snippet.babylonjs.com",I.ANIMATIONTYPE_FLOAT=0,I.ANIMATIONTYPE_VECTOR3=1,I.ANIMATIONTYPE_QUATERNION=2,I.ANIMATIONTYPE_MATRIX=3,I.ANIMATIONTYPE_COLOR3=4,I.ANIMATIONTYPE_COLOR4=7,I.ANIMATIONTYPE_VECTOR2=5,I.ANIMATIONTYPE_SIZE=6,I.ANIMATIONLOOPMODE_RELATIVE=0,I.ANIMATIONLOOPMODE_CYCLE=1,I.ANIMATIONLOOPMODE_CONSTANT=2,I.CreateFromSnippetAsync=I.ParseFromSnippetAsync,(0,f.H)("BABYLON.Animation",I),r.N._AnimationRangeFactory=(t,e,i)=>new y(t,e,i);class M{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const e=this._attachedCamera;e&&(t?this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((t=>{if(!t)return;t.computeWorldMatrix(!0);const e=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*e,this.upperRadiusTransitionRange=.05*e})):this._onMeshTargetChangedObserver&&e.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&this._attachedCamera.radius===t&&!this._radiusIsAnimating}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(M.EasingFunction.setEasingMode(M.EasingMode),this._radiusBounceTransition=I.CreateAnimation("radius",I.ANIMATIONTYPE_FLOAT,60,M.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const e=I.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));e&&this._animatables.push(e)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}M.EasingFunction=new class extends _{constructor(t=1){super(),this.amplitude=t}easeInCore(t){const e=Math.max(0,this.amplitude);return Math.pow(t,3)-t*e*Math.sin(3.141592653589793*t)}}(.3),M.EasingMode=_.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new a.y$,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const e=this._attachedCamera.getScene();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=e.onPrePointerObservable.add((t=>{t.type!==l.kD.POINTERDOWN?t.type===l.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t,e=!1,i=null){t.computeWorldMatrix(!0);const s=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(s.minimumWorld,s.maximumWorld,e,i)}zoomOnMeshHierarchy(t,e=!1,i=null){t.computeWorldMatrix(!0);const s=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(s.min,s.max,e,i)}zoomOnMeshesHierarchy(t,e=!1,i=null){const s=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let e=0;e<t.length;e++){const i=t[e].getHierarchyBoundingVectors(!0);o.P.CheckExtends(i.min,s,n),o.P.CheckExtends(i.max,s,n)}this.zoomOnBoundingInfo(s,n,e,i)}zoomOnBoundingInfo(t,e,i=!1,s=null){let n;if(!this._attachedCamera)return;const a=t.y,r=a+(e.y-a)*this._positionScale,h=e.subtract(t).scale(.5);if(i)n=new o.P(0,r,0);else{const e=t.add(h);n=new o.P(e.x,r,e.z)}this._vectorTransition||(this._vectorTransition=I.CreateAnimation("target",I.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let l=I.TransitionTo("target",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);let c=0;if(this._mode===O.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=h.length()+this._attachedCamera.minZ),c=i}else this._mode===O.IgnoreBoundsSizeMode&&(c=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const i=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/c}this._radiusTransition||(this._radiusTransition=I.CreateAnimation("radius",I.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),l=I.TransitionTo("radius",c,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),s&&s(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),l&&this._animatables.push(l)}_calculateLowerRadiusFromModelBoundingSphere(t,e){const i=e.subtract(t).length(),s=this._getFrustumSlope(),n=.5*i*this._radiusScale,a=n*Math.sqrt(1+1/(s.x*s.x)),o=n*Math.sqrt(1+1/(s.y*s.y));let r=Math.max(a,o);const h=this._attachedCamera;return h?(h.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(r=r<h.lowerRadiusLimit?h.lowerRadiusLimit:r),h.upperRadiusLimit&&(r=r>h.upperRadiusLimit?h.upperRadiusLimit:r),r):0}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=c.F.Now-this._lastInteractionTime,e=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=I.CreateAnimation("beta",I.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const t=I.TransitionTo("beta",e,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_getFrustumSlope(){const t=this._attachedCamera;if(!t)return o.FM.Zero();const e=t.getScene().getEngine().getAspectRatio(t),i=Math.tan(t.fov/2),s=i*e;return new o.FM(s,i)}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.F.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new class extends _{constructor(t=2){super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}},O.EasingMode=_.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var A=i(4515),P=i(2490),C=i(9759),R=i(8658);class E{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=R.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();let s=0,n=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=a=>{var o,r;const h=a.event,c="touch"===h.pointerType;if(e.isInVRExclusivePointerMode)return;if(a.type!==l.kD.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const u=h.target;if(this._altKey=h.altKey,this._ctrlKey=h.ctrlKey,this._metaKey=h.metaKey,this._shiftKey=h.shiftKey,this._buttonsPressed=h.buttons,e.isPointerLock){const t=h.movementX,e=h.movementY;this.onTouch(null,t,e),this._pointA=null,this._pointB=null}else{if(a.type!==l.kD.POINTERDOWN&&c&&(null===(o=this._pointA)||void 0===o?void 0:o.pointerId)!==h.pointerId&&(null===(r=this._pointB)||void 0===r?void 0:r.pointerId)!==h.pointerId)return;if(a.type!==l.kD.POINTERDOWN||-1!==this._currentActiveButton&&!c)if(a.type===l.kD.POINTERDOUBLETAP)this.onDoubleTap(h.pointerType);else if(a.type!==l.kD.POINTERUP||this._currentActiveButton!==h.button&&!c){if(a.type===l.kD.POINTERMOVE)if(t||h.preventDefault(),this._pointA&&null===this._pointB){const t=h.clientX-this._pointA.x,e=h.clientY-this._pointA.y;this.onTouch(this._pointA,t,e),this._pointA.x=h.clientX,this._pointA.y=h.clientY}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===h.pointerId?this._pointA:this._pointB;t.x=h.clientX,t.y=h.clientY;const e=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,o=e*e+i*i,r={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:h.pointerId,type:a.type};this.onMultiTouch(this._pointA,this._pointB,s,o,n,r),n=r,s=o}}else{try{null==u||u.releasePointerCapture(h.pointerId)}catch(t){}c||(this._pointB=null),e._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==h.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==h.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||n)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,n,null),s=0,n=null),this._currentActiveButton=-1,this.onButtonUp(h),t||h.preventDefault()}else{try{null==u||u.setPointerCapture(h.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType};else{if(null!==this._pointB)return;this._pointB={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType}}-1!==this._currentActiveButton||c||(this._currentActiveButton=h.button),this.onButtonDown(h),t||(h.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,l.kD.POINTERDOWN|l.kD.POINTERUP|l.kD.POINTERMOVE|l.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,n=null,this.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const a=this.camera.getScene().getEngine().getHostWindow();a&&R.w1.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const t=this.camera.getScene().getEngine().getHostWindow();t&&R.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,e,i){}onMultiTouch(t,e,i,s,n,a){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,s.gn)([(0,n.qC)()],E.prototype,"buttons",void 0);class b extends E{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,e){if(0!==this.panningSensibility&&t&&e){const i=e.x-t.x,s=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(t,e){const i=this.camera.radius||b.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(t)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-t)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,e,i,s,n,a){0===i&&null===n||0===s&&null===a||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(n,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(n,a)):this.multiTouchPanning?this._computeMultiTouchPanning(n,a):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}b.MinimumRadiusForPinch=.001,(0,s.gn)([(0,n.qC)()],b.prototype,"buttons",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"angularSensibilityX",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"angularSensibilityY",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"pinchPrecision",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"pinchDeltaPercentage",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"useNaturalPinchZoom",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"pinchZoom",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"panningSensibility",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"multiTouchPanning",void 0),(0,s.gn)([(0,n.qC)()],b.prototype,"multiTouchPanAndZoom",void 0),C.u.ArcRotateCameraPointersInput=b;var S=i(6081);class N{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=R.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===S.OG.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode))&&(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault()));else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&(t||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,s.gn)([(0,n.qC)()],N.prototype,"keysUp",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"keysDown",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"keysLeft",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"keysRight",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"keysReset",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"panningSensibility",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"zoomingSensibility",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"useAltToZoom",void 0),(0,s.gn)([(0,n.qC)()],N.prototype,"angularSpeed",void 0),C.u.ArcRotateCameraKeyboardMoveInput=N;var w=i(6504),k=i(1318);class L{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=o.P.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,e){let i=0;const s=.01*t*this.wheelDeltaPercentage*e;return i=t>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),i}attachControl(t){t=R.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==l.kD.POINTERWHEEL)return;const i=e.event;let s=0;const n=i.deltaMode===k.G.DOM_DELTA_LINE?40:1,a=-i.deltaY*n;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(a,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(a,this.camera.radius),s>0){let t=this.camera.radius,e=this.camera.inertialRadiusOffset+s;for(let i=0;i<20&&Math.abs(e)>.001;i++)t-=e,e*=this.camera.inertia;t=g.R.Clamp(t,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(a,t)}}else s=a/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation&&this._hitPlane?this._zoomToMouse(s):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,l.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,e=t.target.subtract(t.position);this._hitPlane=w.J.FromPositionAndNormal(t.target,e)}_getPosition(){var t;const e=this.camera,i=e.getScene(),s=i.createPickingRay(i.pointerX,i.pointerY,o.y3.Identity(),e,!1);let n=0;return this._hitPlane&&(n=null!==(t=s.intersectsPlane(this._hitPlane))&&void 0!==t?t:0),s.origin.addInPlace(s.direction.scaleInPlace(n))}_zoomToMouse(t){var e,i;const s=this.camera,n=1-s.inertia;if(s.lowerRadiusLimit){const i=null!==(e=s.lowerRadiusLimit)&&void 0!==e?e:0;s.radius-(s.inertialRadiusOffset+t)/n<i&&(t=(s.radius-i)*n-s.inertialRadiusOffset)}if(s.upperRadiusLimit){const e=null!==(i=s.upperRadiusLimit)&&void 0!==i?i:0;s.radius-(s.inertialRadiusOffset+t)/n>e&&(t=(s.radius-e)*n-s.inertialRadiusOffset)}const a=t/n/s.radius,r=this._getPosition(),h=o.jp.Vector3[6];r.subtractToRef(s.target,h),h.scaleInPlace(a),h.scaleInPlace(n),this._inertialPanning.addInPlace(h),s.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<u.kn&&(t.x=0),Math.abs(t.y)<u.kn&&(t.y=0),Math.abs(t.z)<u.kn&&(t.z=0)}}(0,s.gn)([(0,n.qC)()],L.prototype,"wheelPrecision",void 0),(0,s.gn)([(0,n.qC)()],L.prototype,"zoomToMouseLocation",void 0),(0,s.gn)([(0,n.qC)()],L.prototype,"wheelDeltaPercentage",void 0),C.u.ArcRotateCameraMouseWheelInput=L;class D extends C.p{constructor(t){super(t)}addMouseWheel(){return this.add(new L),this}addPointers(){return this.add(new b),this}addKeyboard(){return this.add(new N),this}}r.N.AddNodeConstructor("ArcRotateCamera",((t,e)=>()=>new x(t,0,0,1,o.P.Zero(),e)));class x extends P.C{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new o.y3,this._upToYMatrix=new o.y3,this._upVector=o.P.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){o.y3.RotationAlignToRef(o.P.UpReadOnly,this._upVector,this._yToUpMatrix),o.y3.RotationAlignToRef(this._upVector,o.P.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const e=this.inputs.attached.pointers;e&&(e.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const e=this.inputs.attached.mousewheel;e&&(e.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new M,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new d,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,e,i,s,n,r,h=!0){super(t,o.P.Zero(),r,h),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=o.P.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=o.FM.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this._viewMatrix=new o.y3,this.panningAxis=new o.P(1,1,0),this._transformedDirection=new o.P,this.mapPanning=!1,this.onMeshTargetChangedObservable=new a.y$,this.checkCollisions=!1,this.collisionRadius=new o.P(.5,.5,.5),this._previousPosition=o.P.Zero(),this._collisionVelocity=o.P.Zero(),this._newPosition=o.P.Zero(),this._computationVector=o.P.Zero(),this._onCollisionPositionChange=(t,e,i=null)=>{i?(this.setPosition(e),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const s=Math.cos(this.alpha),n=Math.sin(this.alpha),a=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4);const r=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*s*o,this.radius*a,this.radius*n*o),r.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let h=this.upVector;this.allowUpsideDown&&this.beta<0&&(h=h.clone(),h=h.negate()),this._computeViewMatrix(this._position,r,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=o.P.Zero(),n&&this.setTarget(n),this.alpha=e,this.beta=i,this.radius=s,this.getViewMatrix(),this.inputs=new D(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=o.FM.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}return this._getLockedTargetPosition()||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)}attachControl(t,e,i=!0,s=2){const n=arguments;e=R.w1.BackCompatCameraNoPreventDefault(n),this._useCtrlForPanning=i,this._panningMouseButton=s,"boolean"==typeof n[0]&&(n.length>1&&(this._useCtrlForPanning=n[1]),n.length>2&&(this._panningMouseButton=n[2])),this.inputs.attachElement(e),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const t=this.invertRotation?-1:1;let e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e*t,this.beta+=this.inertialBetaOffset*t,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<u.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<u.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*u.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const t=new o.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),o.P.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),o.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*u.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*u.kn&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const e=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())}setTarget(t,e=!1,i=!1,s=!1){var n;if(s=null!==(n=this.overrideCloneAlphaBetaRadius)&&void 0!==n?n:s,t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const e=t,s=this._getTargetPosition();if(s&&!i&&s.equals(e))return;this._targetHost=null,this._target=e,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta);let s=Math.sin(this.beta);0===s&&(s=1e-4),0===this.radius&&(this.radius=1e-4);const n=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*s,this.radius*i,this.radius*e*s),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),n.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let t=this.upVector;this.allowUpsideDown&&s<0&&(t=t.negate()),this._computeViewMatrix(this._position,n,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=n,this._viewMatrix}zoomOn(t,e=!1){t=t||this.getScene().meshes;const i=h.Kj.MinMax(t),s=o.P.Distance(i.min,i.max);this.radius=s*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:s},e)}focusOn(t,e=!1){let i,s;if(void 0===t.min){const e=t||this.getScene().meshes;i=h.Kj.MinMax(e),s=o.P.Distance(i.min,i.max)}else i=t,s=t.distance;this._target=h.Kj.Center(i),e||(this.maxZ=2*s)}createRigCamera(t,e){let i=0;switch(this.cameraRigMode){case A.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case A.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case A.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case A.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case A.V.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===e?1:-1);break;case A.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===e?-1:1)}const s=new x(t,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(t.beta=e.beta=this.beta,this.cameraRigMode){case A.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case A.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case A.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case A.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case A.V.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case A.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,s.gn)([(0,n.qC)()],x.prototype,"alpha",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"beta",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"radius",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,s.gn)([(0,n.hd)("target")],x.prototype,"_target",void 0),(0,s.gn)([(0,n.RR)("targetHost")],x.prototype,"_targetHost",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"inertialAlphaOffset",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"inertialBetaOffset",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"inertialRadiusOffset",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"lowerAlphaLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"upperAlphaLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"lowerBetaLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"upperBetaLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"lowerRadiusLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"upperRadiusLimit",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"inertialPanningX",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"inertialPanningY",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"panningDistanceLimit",void 0),(0,s.gn)([(0,n.hd)()],x.prototype,"panningOriginTarget",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"panningInertia",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"zoomToMouseLocation",null),(0,s.gn)([(0,n.qC)()],x.prototype,"zoomOnFactor",void 0),(0,s.gn)([(0,n.QC)()],x.prototype,"targetScreenOffset",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"allowUpsideDown",void 0),(0,s.gn)([(0,n.qC)()],x.prototype,"useInputToRestoreState",void 0)},9759:(t,e,i)=>{i.d(e,{p:()=>r,u:()=>o});var s=i(658),n=i(8137),a=i(4515),o={};class r{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const e=t.getSimpleName();this.attached[e]?s.Y.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const e in this.attached){const i=this.attached[e];if(i===t)return i.detachControl(),i.camera=null,delete this.attached[e],void this.rebuildInputCheck()}}removeByType(t){for(const e in this.attached){const i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}}_addCheckInputs(t){const e=this.checkInputs;return()=>{e(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(t=!1){if(!this.attachedToElement){t=!a.V.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const e in this.attached)this.attached[e].attachControl(t)}}detachElement(t=!1){for(const e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const e={};for(const t in this.attached){const i=this.attached[t],s=n.p4.Serialize(i);e[i.getClassName()]=s}t.inputsmgr=e}parse(t){const e=t.inputsmgr;if(e){this.clear();for(const t in e){const i=o[t];if(i){const s=e[t],a=n.p4.Parse((()=>new i),s,null);this.add(a)}}}else for(const e in this.attached){const i=o[this.attached[e].getClassName()];if(i){const s=n.p4.Parse((()=>new i),t,null);this.remove(this.attached[e]),this.add(s)}}}}},2988:(t,e,i)=>{i.d(e,{c:()=>M});var s=i(1069),n=i(8137),a=i(5412),o=i(2352),r=i(2490),h=i(9759),l=i(6081),c=i(8658);class u{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}attachControl(t){t=c.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===l.OG.KEYDOWN)-1===this.keysUp.indexOf(i.keyCode)&&-1===this.keysDown.indexOf(i.keyCode)&&-1===this.keysLeft.indexOf(i.keyCode)&&-1===this.keysRight.indexOf(i.keyCode)&&-1===this.keysUpward.indexOf(i.keyCode)&&-1===this.keysDownward.indexOf(i.keyCode)&&-1===this.keysRotateLeft.indexOf(i.keyCode)&&-1===this.keysRotateRight.indexOf(i.keyCode)||(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),t||i.preventDefault());else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),t||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e],s=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?t._localDirection.copyFromFloats(-s,0,0):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,0,s):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(s,0,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,0,-s):-1!==this.keysUpward.indexOf(i)?t._localDirection.copyFromFloats(0,s,0):-1!==this.keysDownward.indexOf(i)?t._localDirection.copyFromFloats(0,-s,0):-1!==this.keysRotateLeft.indexOf(i)?(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)&&(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y+=this._getLocalRotation()),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),a.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){let t=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t}}(0,s.gn)([(0,n.qC)()],u.prototype,"keysUp",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysUpward",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysDown",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysDownward",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysLeft",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysRight",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"rotationSpeed",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysRotateLeft",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"keysRotateRight",void 0),h.u.FreeCameraKeyboardMoveInput=u;var d=i(8139),_=i(27);class p{constructor(t=!0){this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new d.y$,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=c.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();this._pointerInput||(this._pointerInput=s=>{const n=s.event,a="touch"===n.pointerType;if(e.isInVRExclusivePointerMode)return;if(!this.touchEnabled&&a)return;if(s.type!==_.kD.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const o=n.target;if(s.type===_.kD.POINTERDOWN){if(a&&-1!==this._activePointerId||!a&&-1!==this._currentActiveButton)return;this._activePointerId=n.pointerId;try{null==o||o.setPointerCapture(n.pointerId)}catch(t){}-1===this._currentActiveButton&&(this._currentActiveButton=n.button),this._previousPosition={x:n.clientX,y:n.clientY},t||(n.preventDefault(),i&&i.focus()),e.isPointerLock&&this._onMouseMove&&this._onMouseMove(s.event)}else if(s.type===_.kD.POINTERUP){if(a&&this._activePointerId!==n.pointerId||!a&&this._currentActiveButton!==n.button)return;try{null==o||o.releasePointerCapture(n.pointerId)}catch(t){}this._currentActiveButton=-1,this._previousPosition=null,t||n.preventDefault(),this._activePointerId=-1}else if(s.type===_.kD.POINTERMOVE&&(this._activePointerId===n.pointerId||!a))if(e.isPointerLock&&this._onMouseMove)this._onMouseMove(s.event);else if(this._previousPosition){let e=n.clientX-this._previousPosition.x;const i=n.clientY-this._previousPosition.y;this.camera.getScene().useRightHandedSystem&&(e*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=i/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:i}),this._previousPosition={x:n.clientX,y:n.clientY},t||n.preventDefault()}}),this._onMouseMove=i=>{if(!e.isPointerLock)return;if(e.isInVRExclusivePointerMode)return;let s=i.movementX;this.camera.getScene().useRightHandedSystem&&(s*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),this.camera.cameraRotation.y+=s/this.angularSensibility;const n=i.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,t||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,_.kD.POINTERDOWN|_.kD.POINTERUP|_.kD.POINTERMOVE),i&&(this._contextMenuBind=this.onContextMenu.bind(this),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,s.gn)([(0,n.qC)()],p.prototype,"buttons",void 0),(0,s.gn)([(0,n.qC)()],p.prototype,"angularSensibility",void 0),h.u.FreeCameraMouseInput=p;var m=i(1318);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new d.y$,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=c.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==_.kD.POINTERWHEEL)return;const i=e.event,s=i.deltaMode===m.G.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*s*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*s*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*s*i.deltaZ/this._normalize,i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,_.kD.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,s.gn)([(0,n.qC)()],g.prototype,"wheelPrecisionX",void 0),(0,s.gn)([(0,n.qC)()],g.prototype,"wheelPrecisionY",void 0),(0,s.gn)([(0,n.qC)()],g.prototype,"wheelPrecisionZ",void 0);var f,y=i(5241);!function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(f||(f={}));class T extends g{constructor(){super(...arguments),this._moveRelative=a.P.Zero(),this._rotateRelative=a.P.Zero(),this._moveScene=a.P.Zero(),this._wheelXAction=f.MoveRelative,this._wheelXActionCoordinate=y.c7.X,this._wheelYAction=f.MoveRelative,this._wheelYActionCoordinate=y.c7.Z,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==f.MoveRelative||(this._wheelXAction=f.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==f.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==f.MoveRelative||(this._wheelYAction=f.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==f.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==f.MoveRelative||(this._wheelZAction=f.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==f.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==f.RotateRelative||(this._wheelXAction=f.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==f.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==f.RotateRelative||(this._wheelYAction=f.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==f.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==f.RotateRelative||(this._wheelZAction=f.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==f.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==f.MoveScene||(this._wheelXAction=f.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==f.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==f.MoveScene||(this._wheelYAction=f.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==f.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==f.MoveScene||(this._wheelZAction=f.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==f.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=a.y3.Zero();this.camera.getViewMatrix().invertToRef(t);const e=a.P.Zero();a.P.TransformNormalToRef(this._moveRelative,t,e),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(e),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,e,i){if(0===t)return;if(null===e||null===i)return;let s=null;switch(e){case f.MoveRelative:s=this._moveRelative;break;case f.RotateRelative:s=this._rotateRelative;break;case f.MoveScene:s=this._moveScene}switch(i){case y.c7.X:s.set(t,0,0);break;case y.c7.Y:s.set(0,t,0);break;case y.c7.Z:s.set(0,0,t)}}}(0,s.gn)([(0,n.qC)()],T.prototype,"wheelXMoveRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelYMoveRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelZMoveRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelXRotateRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelYRotateRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelZRotateRelative",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelXMoveScene",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelYMoveScene",null),(0,s.gn)([(0,n.qC)()],T.prototype,"wheelZMoveScene",null),h.u.FreeCameraMouseWheelInput=T;class v{constructor(t=!1){this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=c.w1.IsSafari()}attachControl(t){t=c.w1.BackCompatCameraNoPreventDefault(arguments);let e=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const s=i.event,n="mouse"===s.pointerType||this._isSafari&&void 0===s.pointerType;if(this.allowMouse||!n)if(i.type===_.kD.POINTERDOWN){if(t||s.preventDefault(),this._pointerPressed.push(s.pointerId),1!==this._pointerPressed.length)return;e={x:s.clientX,y:s.clientY}}else if(i.type===_.kD.POINTERUP){t||s.preventDefault();const i=this._pointerPressed.indexOf(s.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;e=null,this._offsetX=null,this._offsetY=null}else if(i.type===_.kD.POINTERMOVE){if(t||s.preventDefault(),!e)return;if(0!=this._pointerPressed.indexOf(s.pointerId))return;this._offsetX=s.clientX-e.x,this._offsetY=-(s.clientY-e.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,_.kD.POINTERDOWN|_.kD.POINTERUP|_.kD.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const e=t._computeLocalCameraSpeed(),i=new a.P(0,0,0!==this.touchMoveSensibility?e*this._offsetY/this.touchMoveSensibility:0);a.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(a.P.TransformCoordinates(i,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,s.gn)([(0,n.qC)()],v.prototype,"touchAngularSensibility",void 0),(0,s.gn)([(0,n.qC)()],v.prototype,"touchMoveSensibility",void 0),h.u.FreeCameraTouchInput=v;class I extends h.p{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new u),this}addMouse(t=!0){return this._mouseInput||(this._mouseInput=new p(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new T,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new v),this}clear(){super.clear(),this._mouseInput=null}}class M extends r.C{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const e=this.inputs.attached.keyboard;e&&(e.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const e=this.inputs.attached.keyboard;e&&(e.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateRight=t)}constructor(t,e,i,s=!0){super(t,e,i,s),this.ellipsoid=new a.P(.5,1,.5),this.ellipsoidOffset=new a.P(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=a.P.Zero(),this._diffPosition=a.P.Zero(),this._newPosition=a.P.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(t,e,i=null)=>{(t=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>o.D.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&i&&this.onCollide(i))})(e)},this.inputs=new I(this),this.inputs.addKeyboard().addMouse()}attachControl(t,e){e=c.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new a.P(0,0,0),this.cameraRotation=new a.FM(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let e;e=this.parent?a.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,e.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=t;this.applyGravity&&(s=t.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=a.P.Zero(),this._transformedDirection=a.P.Zero()),this.inputs.checkInputs(),super._checkInputs()}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,s.gn)([(0,n.hd)()],M.prototype,"ellipsoid",void 0),(0,s.gn)([(0,n.hd)()],M.prototype,"ellipsoidOffset",void 0),(0,s.gn)([(0,n.qC)()],M.prototype,"checkCollisions",void 0),(0,s.gn)([(0,n.qC)()],M.prototype,"applyGravity",void 0)},2490:(t,e,i)=>{i.d(e,{C:()=>l});var s=i(1069),n=i(8137),a=i(4515),o=i(5412),r=i(4551),h=i(5241);class l extends a.V{constructor(t,e,i,s=!0){super(t,e,i,s),this._tmpUpVector=o.P.Zero(),this._tmpTargetVector=o.P.Zero(),this.cameraDirection=new o.P(0,0,0),this.cameraRotation=new o.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new o._f,this.rotation=new o.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=o.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=o.y3.Zero(),this._camMatrix=o.y3.Zero(),this._cameraTransformMatrix=o.y3.Zero(),this._cameraRotationMatrix=o.y3.Zero(),this._referencePoint=new o.P(0,0,1),this._transformedReferencePoint=o.P.Zero(),this._defaultUp=o.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(t){this.getWorldMatrix();const e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)}_getLockedTargetPosition(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(t){t||super._updateCache();const e=this._getLockedTargetPosition();e?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(e):this._cache.lockedTarget=e.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}setTarget(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=r.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),o.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.jp.Matrix[0]),o.P.TransformNormalToRef(this.cameraDirection,o.jp.Matrix[0],o.jp.Vector3[0]),void this.position.addInPlace(o.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}_checkInputs(){const t=this.invertRotation?-this.inverseRotationSpeed:1,e=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(e&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*t,this.rotation.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t)}this.rotationQuaternion&&this.rotation.lengthSquared()&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}e&&(Math.abs(this.cameraDirection.x)<this.speed*r.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*r.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*r.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*r.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*r.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return o.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(t,e,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();o.P.TransformCoordinatesToRef(t,s,this._globalPosition),o.P.TransformCoordinatesToRef(e,s,this._tmpTargetVector),o.P.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(e),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):o.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(t,e,i,this._viewMatrix):o.y3.LookAtLHToRef(t,e,i,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)}createRigCamera(t,e){if(this.cameraRigMode!==a.V.RIG_MODE_NONE){const e=new l(t,this.position.clone(),this.getScene());return e.isRigCamera=!0,e.rigParent=this,this.cameraRigMode!==a.V.RIG_MODE_VR&&this.cameraRigMode!==a.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new o._f),e._cameraRigParams={},e.rotationQuaternion=new o._f),e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoTop=this.orthoTop,e.orthoBottom=this.orthoBottom,e}return null}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case a.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case a.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.V.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===a.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===a.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,e);break}case a.V.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),e.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),e.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),e.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(t,e){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=l._TargetFocalPoint.addInPlace(this.position);o.y3.TranslationToRef(-i.x,-i.y,-i.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(o.y3.RotationAxis(e.upVector,t),l._RigCamTransformMatrix),o.y3.TranslationToRef(i.x,i.y,i.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),o.P.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,e.position),e.setTarget(i)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new o.y3,l._TargetTransformMatrix=new o.y3,l._TargetFocalPoint=new o.P,(0,s.gn)([(0,n.hd)()],l.prototype,"rotation",void 0),(0,s.gn)([(0,n.qC)()],l.prototype,"speed",void 0),(0,s.gn)([(0,n.RR)("lockedTargetId")],l.prototype,"lockedTarget",void 0)},4468:(t,e,i)=>{i.d(e,{e:()=>d});var s=i(1069),n=i(8137),a=i(5412),o=i(2922),r=i(6387),h=i(5888),l=i(646),c=i(183);class u extends r.N{get range(){return this._range}set range(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(t){this._intensityMode=t,this._computePhotometricScale()}get radius(){return this._radius}set radius(t){this._radius=t,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}constructor(t,e){super(t,e),this.diffuse=new o.Wo(1,1,1),this.specular=new o.Wo(1,1,1),this.falloffType=u.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=u.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new h.M(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this._resyncMeshes()}transferTexturesToEffect(t,e){return this}_bindLight(t,e,i,s,n=!0){var a;const r=t.toString();let h=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+r),this._renderId!==e.getRenderId()||this._lastUseSpecular!==s||!this._uniformBuffer.useUbo){this._renderId=e.getRenderId(),this._lastUseSpecular=s;const t=this.getScaledIntensity();this.transferToEffect(i,r),this.diffuse.scaleToRef(t,o.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",o.zZ.Color3[0],this.range,r),s&&(this.specular.scaleToRef(t,o.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",o.zZ.Color3[1],this.radius,r)),h=!0}if(this.transferTexturesToEffect(i,r),e.shadowsEnabled&&this.shadowEnabled&&n){const t=null!==(a=this.getShadowGenerator(e.activeCamera))&&void 0!==a?a:this.getShadowGenerator();t&&(t.bindShadowLight(r,i),h=!0)}h?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(t){let e="Name: "+this.name;if(e+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(t){super.setEnabled(t),this._resyncMeshes()}getShadowGenerator(t=null){var e;return null===this._shadowGenerators?null:null!==(e=this._shadowGenerators.get(t))&&void 0!==e?e:null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return a.P.Zero()}canAffectMesh(t){return!(t&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&t.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask))}dispose(t,e=!1){if(this._shadowGenerators){const t=this._shadowGenerators.values();for(let e=t.next();!0!==e.done;e=t.next())e.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(const t of this.getScene().meshes)t._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(t,e)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(t,e=null){const i=u.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!i)return null;const s=n.p4.Clone(i,this);return t&&(s.name=t),e&&(s.parent=e),s.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(s),s}serialize(){const t=n.p4.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((e=>{t.excludedMeshesIds.push(e.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((e=>{t.includedOnlyMeshesIds.push(e.id)}))),n.p4.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static GetConstructorFromName(t,e,i){return r.N.Construct("Light_Type_"+t,e,i)||null}static Parse(t,e){const i=u.GetConstructorFromName(t.type,t.name,e);if(!i)return null;const s=n.p4.Parse(i,t,e);if(t.excludedMeshesIds&&(s._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(s.falloffType=t.falloffType),void 0!==t.lightmapMode&&(s.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],n=(0,l.q)("BABYLON.Animation");n&&s.animations.push(n.Parse(i))}r.N.ParseAnimationRanges(s,t,e)}return t.autoAnimate&&e.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s}_hookArrayForExcluded(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);for(const t of i)t._resyncLightSource(this);return s};const i=t.splice;t.splice=(e,s)=>{const n=i.apply(t,[e,s]);for(const t of n)t._resyncLightSource(this);return n};for(const e of t)e._resyncLightSource(this)}_hookArrayForIncludedOnly(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);return this._resyncMeshes(),s};const i=t.splice;t.splice=(e,s)=>{const n=i.apply(t,[e,s]);return this._resyncMeshes(),n},this._resyncMeshes()}_resyncMeshes(){for(const t of this.getScene().meshes)t._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const t of this.getScene().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let t=0;const e=this.getTypeID();let i=this.intensityMode;switch(i===u.INTENSITYMODE_AUTOMATIC&&(i=e===u.LIGHTTYPEID_DIRECTIONALLIGHT?u.INTENSITYMODE_ILLUMINANCE:u.INTENSITYMODE_LUMINOUSINTENSITY),e){case u.LIGHTTYPEID_POINTLIGHT:case u.LIGHTTYPEID_SPOTLIGHT:switch(i){case u.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case u.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case u.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case u.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case u.INTENSITYMODE_ILLUMINANCE:t=1;break;case u.INTENSITYMODE_LUMINANCE:{let e=this.radius;e=Math.max(e,.001),t=2*Math.PI*(1-Math.cos(e));break}}break;case u.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}_reorderLightsInScene(){const t=this.getScene();0!=this._renderPriority&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}u.FALLOFF_DEFAULT=c.m.FALLOFF_DEFAULT,u.FALLOFF_PHYSICAL=c.m.FALLOFF_PHYSICAL,u.FALLOFF_GLTF=c.m.FALLOFF_GLTF,u.FALLOFF_STANDARD=c.m.FALLOFF_STANDARD,u.LIGHTMAP_DEFAULT=c.m.LIGHTMAP_DEFAULT,u.LIGHTMAP_SPECULAR=c.m.LIGHTMAP_SPECULAR,u.LIGHTMAP_SHADOWSONLY=c.m.LIGHTMAP_SHADOWSONLY,u.INTENSITYMODE_AUTOMATIC=c.m.INTENSITYMODE_AUTOMATIC,u.INTENSITYMODE_LUMINOUSPOWER=c.m.INTENSITYMODE_LUMINOUSPOWER,u.INTENSITYMODE_LUMINOUSINTENSITY=c.m.INTENSITYMODE_LUMINOUSINTENSITY,u.INTENSITYMODE_ILLUMINANCE=c.m.INTENSITYMODE_ILLUMINANCE,u.INTENSITYMODE_LUMINANCE=c.m.INTENSITYMODE_LUMINANCE,u.LIGHTTYPEID_POINTLIGHT=c.m.LIGHTTYPEID_POINTLIGHT,u.LIGHTTYPEID_DIRECTIONALLIGHT=c.m.LIGHTTYPEID_DIRECTIONALLIGHT,u.LIGHTTYPEID_SPOTLIGHT=c.m.LIGHTTYPEID_SPOTLIGHT,u.LIGHTTYPEID_HEMISPHERICLIGHT=c.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,s.gn)([(0,n.n9)()],u.prototype,"diffuse",void 0),(0,s.gn)([(0,n.n9)()],u.prototype,"specular",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"falloffType",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"intensity",void 0),(0,s.gn)([(0,n.qC)()],u.prototype,"range",null),(0,s.gn)([(0,n.qC)()],u.prototype,"intensityMode",null),(0,s.gn)([(0,n.qC)()],u.prototype,"radius",null),(0,s.gn)([(0,n.qC)()],u.prototype,"_renderPriority",void 0),(0,s.gn)([(0,n.wz)("_reorderLightsInScene")],u.prototype,"renderPriority",void 0),(0,s.gn)([(0,n.qC)("shadowEnabled")],u.prototype,"_shadowEnabled",void 0),(0,s.gn)([(0,n.qC)("excludeWithLayerMask")],u.prototype,"_excludeWithLayerMask",void 0),(0,s.gn)([(0,n.qC)("includeOnlyWithLayerMask")],u.prototype,"_includeOnlyWithLayerMask",void 0),(0,s.gn)([(0,n.qC)("lightmapMode")],u.prototype,"_lightmapMode",void 0),r.N.AddNodeConstructor("Light_Type_3",((t,e)=>()=>new d(t,a.P.Zero(),e)));class d extends u{constructor(t,e,i){super(t,i),this.groundColor=new o.Wo(0,0,0),this.direction=e||a.P.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(t){return this.direction=a.P.Normalize(t.subtract(a.P.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,e){const i=a.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,e),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),e),this}transferToNodeMaterialEffect(t,e){const i=a.P.Normalize(this.direction);return t.setFloat3(e,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=a.y3.Identity()),this._worldMatrix}getTypeID(){return u.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,e){t["HEMILIGHT"+e]=!0}}(0,s.gn)([(0,n.n9)()],d.prototype,"groundColor",void 0),(0,s.gn)([(0,n.hd)()],d.prototype,"direction",void 0)}},t=>{var e=e=>t(t.s=e);t.O(0,[340],(()=>(e(635),e(2988),e(4468)))),t.O()}]);