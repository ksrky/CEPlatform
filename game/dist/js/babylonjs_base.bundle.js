(()=>{"use strict";var t,e={1545:(t,e,s)=>{s.d(e,{h:()=>r});class r{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=r._Counter++}}r._Counter=0},3525:(t,e,s)=>{s.d(e,{L:()=>m});class r{constructor(){this.children=[]}isValid(t){return!0}process(t,e){var s,r,i,n,a,o;let h="";if(this.line){let l=this.line;const _=e.processor;if(_){_.lineProcessor&&(l=_.lineProcessor(l,e.isFragment,e.processingContext));const h=null!==(r=null===(s=e.processor)||void 0===s?void 0:s.attributeKeywordName)&&void 0!==r?r:"attribute",c=e.isFragment&&(null===(i=e.processor)||void 0===i?void 0:i.varyingFragmentKeywordName)?null===(n=e.processor)||void 0===n?void 0:n.varyingFragmentKeywordName:!e.isFragment&&(null===(a=e.processor)||void 0===a?void 0:a.varyingVertexKeywordName)?null===(o=e.processor)||void 0===o?void 0:o.varyingVertexKeywordName:"varying";!e.isFragment&&_.attributeProcessor&&this.line.startsWith(h)?l=_.attributeProcessor(this.line,t,e.processingContext):_.varyingProcessor&&this.line.startsWith(c)?l=_.varyingProcessor(this.line,e.isFragment,t,e.processingContext):_.uniformProcessor&&_.uniformRegexp&&_.uniformRegexp.test(this.line)?e.lookForClosingBracketForUniformBuffer||(l=_.uniformProcessor(this.line,e.isFragment,t,e.processingContext)):_.uniformBufferProcessor&&_.uniformBufferRegexp&&_.uniformBufferRegexp.test(this.line)?e.lookForClosingBracketForUniformBuffer||(l=_.uniformBufferProcessor(this.line,e.isFragment,e.processingContext),e.lookForClosingBracketForUniformBuffer=!0):_.textureProcessor&&_.textureRegexp&&_.textureRegexp.test(this.line)?l=_.textureProcessor(this.line,e.isFragment,t,e.processingContext):(_.uniformProcessor||_.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!e.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?_.uniformProcessor&&(l=_.uniformProcessor(this.line,e.isFragment,t,e.processingContext)):_.uniformBufferProcessor&&(l=_.uniformBufferProcessor(this.line,e.isFragment,e.processingContext),e.lookForClosingBracketForUniformBuffer=!0)),e.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(e.lookForClosingBracketForUniformBuffer=!1,_.endOfUniformBufferProcessor&&(l=_.endOfUniformBufferProcessor(this.line,e.isFragment,e.processingContext)))}h+=l+"\r\n"}return this.children.forEach((s=>{h+=s.process(t,e)})),this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true"),h}}class i{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(t){this._lines.length=0;for(const e of t){if("#"===e[0]){this._lines.push(e);continue}if(e.trim().startsWith("//")){this._lines.push(e);continue}const t=e.split(";");for(let e=0;e<t.length;e++){let s=t[e];s=s.trim(),s&&this._lines.push(s+(e!==t.length-1?";":""))}}}}class n extends r{process(t,e){for(let s=0;s<this.children.length;s++){const r=this.children[s];if(r.isValid(t))return r.process(t,e)}return""}}class a extends r{isValid(t){return this.testExpression.isTrue(t)}}class o{isTrue(t){return!0}static postfixToInfix(t){const e=[];for(const s of t)if(void 0===o._OperatorPriority[s])e.push(s);else{const t=e[e.length-1],r=e[e.length-2];e.length-=2,e.push(`(${r}${s}${t})`)}return e[e.length-1]}static infixToPostfix(t){const e=[];let s=-1;const r=()=>{l=l.trim(),""!==l&&(e.push(l),l="")},i=t=>{s<o._Stack.length-1&&(o._Stack[++s]=t)},n=()=>o._Stack[s],a=()=>-1===s?"!!INVALID EXPRESSION!!":o._Stack[s--];let h=0,l="";for(;h<t.length;){const _=t.charAt(h),c=h<t.length-1?t.substr(h,2):"";if("("===_)l="",i(_);else if(")"===_){for(r();-1!==s&&"("!==n();)e.push(a());a()}else if(o._OperatorPriority[c]>1){for(r();-1!==s&&o._OperatorPriority[n()]>=o._OperatorPriority[c];)e.push(a());i(c),h++}else l+=_;h++}for(r();-1!==s;)"("===n()?a():e.push(a());return e}}o._OperatorPriority={")":0,"(":1,"||":2,"&&":3},o._Stack=["","","","","","","","","","","","","","","","","","","",""];class h extends o{constructor(t,e=!1){super(),this.define=t,this.not=e}isTrue(t){let e=void 0!==t[this.define];return this.not&&(e=!e),e}}class l extends o{isTrue(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)}}class _ extends o{isTrue(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)}}class c extends o{constructor(t,e,s){super(),this.define=t,this.operand=e,this.testValue=s}isTrue(t){let e=t[this.define];void 0===e&&(e=this.define);let s=!1;const r=parseInt(e),i=parseInt(this.testValue);switch(this.operand){case">":s=r>i;break;case"<":s=r<i;break;case"<=":s=r<=i;break;case">=":s=r>=i;break;case"==":s=r===i}return s}}var u=s(9069),d=s(475);const g=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,p=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g;class m{static Initialize(t){t.processor&&t.processor.initializeShaders&&t.processor.initializeShaders(t.processingContext)}static Process(t,e,s,r){var i;(null===(i=e.processor)||void 0===i?void 0:i.preProcessShaderCode)&&(t=e.processor.preProcessShaderCode(t,e.isFragment)),this._ProcessIncludes(t,e,(t=>{e.processCodeAfterIncludes&&(t=e.processCodeAfterIncludes(e.isFragment?"fragment":"vertex",t));const i=this._ProcessShaderConversion(t,e,r);s(i,t)}))}static PreProcess(t,e,s,r){var i;(null===(i=e.processor)||void 0===i?void 0:i.preProcessShaderCode)&&(t=e.processor.preProcessShaderCode(t,e.isFragment)),this._ProcessIncludes(t,e,(t=>{e.processCodeAfterIncludes&&(t=e.processCodeAfterIncludes(e.isFragment?"fragment":"vertex",t));const i=this._ApplyPreProcessing(t,e,r);s(i,t)}))}static Finalize(t,e,s){return s.processor&&s.processor.finalizeShaders?s.processor.finalizeShaders(t,e,s.processingContext):{vertexCode:t,fragmentCode:e}}static _ProcessPrecision(t,e){var s;if(null===(s=e.processor)||void 0===s?void 0:s.noPrecision)return t;const r=e.shouldUseHighPrecisionShader;return-1===t.indexOf("precision highp float")?t=r?"precision highp float;\n"+t:"precision mediump float;\n"+t:r||(t=t.replace("precision highp float","precision mediump float")),t}static _ExtractOperation(t){const e=/defined\((.+)\)/.exec(t);if(e&&e.length)return new h(e[1].trim(),"!"===t[0]);const s=["==",">=","<=","<",">"];let r="",i=0;for(r of s)if(i=t.indexOf(r),i>-1)break;if(-1===i)return new h(t);const n=t.substring(0,i).trim(),a=t.substring(i+r.length).trim();return new c(n,r,a)}static _BuildSubExpression(t){t=t.replace(g,"defined[$1]");const e=o.infixToPostfix(t),s=[];for(const t of e)if("||"!==t&&"&&"!==t)s.push(t);else if(s.length>=2){let e=s[s.length-1],r=s[s.length-2];s.length-=2;const i="&&"==t?new _:new l;"string"==typeof e&&(e=e.replace(f,"defined($1)")),"string"==typeof r&&(r=r.replace(f,"defined($1)")),i.leftOperand="string"==typeof r?this._ExtractOperation(r):r,i.rightOperand="string"==typeof e?this._ExtractOperation(e):e,s.push(i)}let r=s[s.length-1];return"string"==typeof r&&(r=r.replace(f,"defined($1)")),"string"==typeof r?this._ExtractOperation(r):r}static _BuildExpression(t,e){const s=new a,r=t.substring(0,e);let i=t.substring(e);return i=i.substring(0,(i.indexOf("//")+1||i.length+1)-1).trim(),s.testExpression="#ifdef"===r?new h(i):"#ifndef"===r?new h(i,!0):this._BuildSubExpression(i),s}static _MoveCursorWithinIf(t,e,s){let i=t.currentLine;for(;this._MoveCursor(t,s);){i=t.currentLine;const n=i.substring(0,5).toLowerCase();if("#else"===n){const s=new r;return e.children.push(s),void this._MoveCursor(t,s)}if("#elif"===n){const t=this._BuildExpression(i,5);e.children.push(t),s=t}}}static _MoveCursor(t,e){for(;t.canRead;){t.lineIndex++;const s=t.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(s);if(i&&i.length)switch(i[0]){case"#ifdef":{const r=new n;e.children.push(r);const i=this._BuildExpression(s,6);r.children.push(i),this._MoveCursorWithinIf(t,r,i);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const r=new n;e.children.push(r);const i=this._BuildExpression(s,7);r.children.push(i),this._MoveCursorWithinIf(t,r,i);break}case"#if":{const r=new n,i=this._BuildExpression(s,3);e.children.push(r),r.children.push(i),this._MoveCursorWithinIf(t,r,i);break}}else{const t=new r;if(t.line=s,e.children.push(t),"#"===s[0]&&"d"===s[1]){const e=s.replace(";","").split(" ");t.additionalDefineKey=e[1],3===e.length&&(t.additionalDefineValue=e[2])}}}return!1}static _EvaluatePreProcessors(t,e,s){const n=new r,a=new i;return a.lineIndex=-1,a.lines=t.split("\n"),this._MoveCursor(a,n),n.process(e,s)}static _PreparePreProcessors(t,e){var s;const r=t.defines,i={};for(const t of r){const e=t.replace("#define","").replace(";","").trim().split(" ");i[e[0]]=e.length>1?e[1]:""}return(null===(s=t.processor)||void 0===s?void 0:s.shaderLanguage)===d.x.GLSL&&(i.GL_ES="true"),i.__VERSION__=t.version,i[t.platformName]="true",e._getGlobalDefines(i),i}static _ProcessShaderConversion(t,e,s){let r=this._ProcessPrecision(t,e);if(!e.processor)return r;if(e.processor.shaderLanguage===d.x.GLSL&&-1!==r.indexOf("#version 3")&&(r=r.replace("#version 300 es",""),!e.processor.parseGLES3))return r;const i=e.defines,n=this._PreparePreProcessors(e,s);return e.processor.preProcessor&&(r=e.processor.preProcessor(r,i,e.isFragment,e.processingContext)),r=this._EvaluatePreProcessors(r,n,e),e.processor.postProcessor&&(r=e.processor.postProcessor(r,i,e.isFragment,e.processingContext,s)),s._features.needShaderCodeInlining&&(r=s.inlineShaderCode(r)),r}static _ApplyPreProcessing(t,e,s){var r,i;let n=t;const a=e.defines,o=this._PreparePreProcessors(e,s);return(null===(r=e.processor)||void 0===r?void 0:r.preProcessor)&&(n=e.processor.preProcessor(n,a,e.isFragment,e.processingContext)),n=this._EvaluatePreProcessors(n,o,e),(null===(i=e.processor)||void 0===i?void 0:i.postProcessor)&&(n=e.processor.postProcessor(n,a,e.isFragment,e.processingContext,s)),s._features.needShaderCodeInlining&&(n=s.inlineShaderCode(n)),n}static _ProcessIncludes(t,e,s){let r=p.exec(t),i=new String(t),n=!1;for(;null!=r;){let a=r[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),e.supportsUniformBuffers&&(a=a.replace(/Vertex/,"Ubo"),a=a.replace(/Fragment/,"Ubo")),a+="Declaration"),!e.includesShadersStore[a]){const t=e.shadersRepository+"ShadersInclude/"+a+".fx";return void m._FileToolsLoadFile(t,(t=>{e.includesShadersStore[a]=t,this._ProcessIncludes(i,e,s)}))}{let t=e.includesShadersStore[a];if(r[2]){const e=r[3].split(",");for(let s=0;s<e.length;s+=2){const r=new RegExp(e[s],"g"),i=e[s+1];t=t.replace(r,i)}}if(r[4]){const s=r[5];if(-1!==s.indexOf("..")){const r=s.split(".."),i=parseInt(r[0]);let n=parseInt(r[1]),a=t.slice(0);t="",isNaN(n)&&(n=e.indexParameters[r[1]]);for(let s=i;s<n;s++)e.supportsUniformBuffers||(a=a.replace(/light\{X\}.(\w*)/g,((t,e)=>e+"{X}"))),t+=a.replace(/\{X\}/g,s.toString())+"\n"}else e.supportsUniformBuffers||(t=t.replace(/light\{X\}.(\w*)/g,((t,e)=>e+"{X}"))),t=t.replace(/\{X\}/g,s)}i=i.replace(r[0],t),n=n||t.indexOf("#include<")>=0||t.indexOf("#include <")>=0}r=p.exec(t)}n?this._ProcessIncludes(i.toString(),e,s):s(i)}static _FileToolsLoadFile(t,e,s,r,i,n){throw(0,u.S)("FileTools")}}},8449:(t,e,s)=>{s.d(e,{B:()=>r});class r{get underlyingResource(){return this._webGLTexture}constructor(t=null,e){if(this._MSAARenderBuffer=null,this._context=e,!t&&!(t=e.createTexture()))throw new Error("Unable to create webGL texture");this.set(t)}setUsage(){}set(t){this._webGLTexture=t}reset(){this._webGLTexture=null,this._MSAARenderBuffer=null}release(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},2352:(t,e,s)=>{s.d(e,{D:()=>p});var r=s(8139),i=s(3369),n=s(1102),a=s(5953),o=s(9069),h=s(7543),l=s(9665);class _{constructor(t=30){this._enabled=!0,this._rollingFrameTime=new c(t)}sampleFrame(t=l.F.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const e=t-this._lastFrameTimeMs;this._rollingFrameTime.add(e)}this._lastFrameTimeMs=t}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const t=this._rollingFrameTime.history(0);return 0===t?0:1e3/t}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class c{constructor(t){this._samples=new Array(t),this.reset()}add(t){let e;if(this.isSaturated()){const t=this._samples[this._pos];e=t-this.average,this.average-=e/(this._sampleCount-1),this._m2-=e*(t-this.average)}else this._sampleCount++;e=t-this.average,this.average+=e/this._sampleCount,this._m2+=e*(t-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=t,this._pos++,this._pos%=this._samples.length}history(t){if(t>=this._sampleCount||t>=this._samples.length)return 0;const e=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(e-t)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(t){const e=this._samples.length;return(t%e+e)%e}}var u=s(8482),d=s(4081),g=s(658),f=s(8449);h.B.prototype.setAlphaConstants=function(t,e,s,r){this._alphaState.setAlphaBlendConstants(t,e,s,r)},h.B.prototype.setAlphaMode=function(t,e=!1){if(this._alphaMode!==t){switch(t){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}e||(this.depthCullingState.depthMask=0===t),this._alphaMode=t}else if(!e){const e=0===t;this.depthCullingState.depthMask!==e&&(this.depthCullingState.depthMask=e)}},h.B.prototype.getAlphaMode=function(){return this._alphaMode},h.B.prototype.setAlphaEquation=function(t){if(this._alphaEquation!==t){switch(t){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=t}},h.B.prototype.getAlphaEquation=function(){return this._alphaEquation},h.B.prototype._readTexturePixelsSync=function(t,e,s,r=-1,i=0,n=null,a=!0,o=!1,h=0,l=0){var _,c;const u=this._gl;if(!u)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const t=u.createFramebuffer();if(!t)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=t}u.bindFramebuffer(u.FRAMEBUFFER,this._dummyFramebuffer),r>-1?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+r,null===(_=t._hardwareTexture)||void 0===_?void 0:_.underlyingResource,i):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,null===(c=t._hardwareTexture)||void 0===c?void 0:c.underlyingResource,i);let d=void 0!==t.type?this._getWebGLTextureType(t.type):u.UNSIGNED_BYTE;return o?n||(n=function(t,e,s=!1,r){switch(t){case 3:{const t=(ArrayBuffer,new Int8Array(e));return r&&t.set(new Int8Array(r)),t}case 0:{const t=(ArrayBuffer,new Uint8Array(e));return r&&t.set(new Uint8Array(r)),t}case 4:{const t=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(s?e/2:e);return r&&t.set(new Int16Array(r)),t}case 5:case 8:case 9:case 10:case 2:{const t=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(s?e/2:e);return r&&t.set(new Uint16Array(r)),t}case 6:{const t=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(s?e/4:e);return r&&t.set(new Int32Array(r)),t}case 7:case 11:case 12:case 13:case 14:case 15:{const t=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(s?e/4:e);return r&&t.set(new Uint32Array(r)),t}case 1:{const t=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(s?e/4:e);return r&&t.set(new Float32Array(r)),t}}const i=(ArrayBuffer,new Uint8Array(e));return r&&i.set(new Uint8Array(r)),i}(t.type,4*e*s)):d===u.UNSIGNED_BYTE?(n||(n=new Uint8Array(4*e*s)),d=u.UNSIGNED_BYTE):(n||(n=new Float32Array(4*e*s)),d=u.FLOAT),a&&this.flushFramebuffer(),u.readPixels(h,l,e,s,u.RGBA,d,n),u.bindFramebuffer(u.FRAMEBUFFER,this._currentFramebuffer),n},h.B.prototype._readTexturePixels=function(t,e,s,r=-1,i=0,n=null,a=!0,o=!1,h=0,l=0){return Promise.resolve(this._readTexturePixelsSync(t,e,s,r,i,n,a,o,h,l))},h.B.prototype.updateDynamicIndexBuffer=function(t,e,s=0){let r;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(t),r=t.is32Bits?e instanceof Uint32Array?e:new Uint32Array(e):e instanceof Uint16Array?e:new Uint16Array(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},h.B.prototype.updateDynamicVertexBuffer=function(t,e,s,r){this.bindArrayBuffer(t),void 0===s&&(s=0);const i=e.byteLength||e.length;void 0===r||r>=i&&0===s?e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,new Float32Array(e)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,e):e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(e).subarray(s,s+r)):(e=e instanceof ArrayBuffer?new Uint8Array(e,s,r):new Uint8Array(e.buffer,e.byteOffset+s,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)),this._resetVertexBufferBinding()};class p extends h.B{static get NpmPackage(){return h.B.NpmPackage}static get Version(){return h.B.Version}static get Instances(){return a.l.Instances}static get LastCreatedEngine(){return a.l.LastCreatedEngine}static get LastCreatedScene(){return a.l.LastCreatedScene}_createImageBitmapFromSource(t,e){return new Promise(((s,r)=>{const i=new Image;i.onload=()=>{i.decode().then((()=>{this.createImageBitmap(i,e).then((t=>{s(t)}))}))},i.onerror=()=>{r(`Error loading image ${i.src}`)},i.src=t}))}createImageBitmap(t,e){return createImageBitmap(t,e)}resizeImageBitmap(t,e,s){const r=this.createCanvas(e,s).getContext("2d");if(!r)throw new Error("Unable to get 2d context for resizeImageBitmap");return r.drawImage(t,0,0),r.getImageData(0,0,e,s).data}static MarkAllMaterialsAsDirty(t,e){for(let s=0;s<p.Instances.length;s++){const r=p.Instances[s];for(let s=0;s<r.scenes.length;s++)r.scenes[s].markAllMaterialsAsDirty(t,e)}}static DefaultLoadingScreenFactory(t){throw(0,o.S)("LoadingScreen")}get _supportsHardwareTextureRescaling(){return!!p._RescalePostProcessFactory}get performanceMonitor(){return this._performanceMonitor}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(t){this._compatibilityMode=!0}getInputElement(){return this._renderingCanvas}constructor(t,e,s,i=!1){if(super(t,e,s,i),this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.scenes=new Array,this._virtualScenes=new Array,this.onNewSceneAddedObservable=new r.y$,this.postProcesses=new Array,this.isPointerLock=!1,this.onResizeObservable=new r.y$,this.onCanvasBlurObservable=new r.y$,this.onCanvasFocusObservable=new r.y$,this.onCanvasPointerOutObservable=new r.y$,this.onBeginFrameObservable=new r.y$,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new r.y$,this.onBeforeShaderCompilationObservable=new r.y$,this.onAfterShaderCompilationObservable=new r.y$,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this._fps=60,this._deltaTime=0,this._drawCalls=new u.z,this.canvasTabIndex=1,this.disablePerformanceMonitorInBackground=!1,this._performanceMonitor=new _,this._compatibilityMode=!0,this.currentRenderPassId=0,this._renderPassNames=["main"],p.Instances.push(this),t){if(this._features.supportRenderPasses=!0,s=this._creationOptions,t.getContext){const e=t;this._sharedInit(e),this._connectVREvents()}this._prepareVRComponent(),s.autoEnableWebVR&&this.initWebVR()}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(t){super._sharedInit(t),this._onCanvasFocus=()=>{this.onCanvasFocusObservable.notifyObservers(this)},this._onCanvasBlur=()=>{this.onCanvasBlurObservable.notifyObservers(this)},this._onCanvasContextMenu=t=>{this.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",this._onCanvasFocus),t.addEventListener("blur",this._onCanvasBlur),t.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.disable(),this._windowIsBackground=!0},this._onFocus=()=>{this.disablePerformanceMonitorInBackground&&this._performanceMonitor.enable(),this._windowIsBackground=!1},this._onCanvasPointerOut=e=>{document.elementFromPoint(e.clientX,e.clientY)!==t&&this.onCanvasPointerOutObservable.notifyObservers(e)};const e=this.getHostWindow();e&&"function"==typeof e.addEventListener&&(e.addEventListener("blur",this._onBlur),e.addEventListener("focus",this._onFocus)),t.addEventListener("pointerout",this._onCanvasPointerOut),this._creationOptions.doNotHandleTouchAction||this._disableTouchAction(),!p.audioEngine&&this._creationOptions.audioEngine&&p.AudioEngineFactory&&(p.audioEngine=p.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination())),(0,n.n5)()&&(this._onFullscreenChange=()=>{this.isFullscreen=!!document.fullscreenElement,this.isFullscreen&&this._pointerLockRequested&&t&&p._RequestPointerlock(t)},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=()=>{this.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1)),this.enableOfflineSupport=void 0!==p.OfflineProviderFactory,this._deterministicLockstep=!!this._creationOptions.deterministicLockstep,this._lockstepMaxSteps=this._creationOptions.lockstepMaxSteps||0,this._timeStep=this._creationOptions.timeStep||1/60}getAspectRatio(t,e=!1){const s=t.viewport;return this.getRenderWidth(e)*s.width/(this.getRenderHeight(e)*s.height)}getScreenAspectRatio(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)}getRenderingCanvasClientRect(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null}getInputElementClientRect(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}generateMipMapsForCubemap(t,e=!0){if(t.generateMipMaps){const s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,t,!0),s.generateMipmap(s.TEXTURE_CUBE_MAP),e&&this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null)}}getDepthWrite(){return this._depthCullingState.depthMask}setDepthWrite(t){this._depthCullingState.depthMask=t}getStencilBuffer(){return this._stencilState.stencilTest}setStencilBuffer(t){this._stencilState.stencilTest=t}getStencilMask(){return this._stencilState.stencilMask}setStencilMask(t){this._stencilState.stencilMask=t}getStencilFunction(){return this._stencilState.stencilFunc}getStencilFunctionReference(){return this._stencilState.stencilFuncRef}getStencilFunctionMask(){return this._stencilState.stencilFuncMask}setStencilFunction(t){this._stencilState.stencilFunc=t}setStencilFunctionReference(t){this._stencilState.stencilFuncRef=t}setStencilFunctionMask(t){this._stencilState.stencilFuncMask=t}getStencilOperationFail(){return this._stencilState.stencilOpStencilFail}getStencilOperationDepthFail(){return this._stencilState.stencilOpDepthFail}getStencilOperationPass(){return this._stencilState.stencilOpStencilDepthPass}setStencilOperationFail(t){this._stencilState.stencilOpStencilFail=t}setStencilOperationDepthFail(t){this._stencilState.stencilOpDepthFail=t}setStencilOperationPass(t){this._stencilState.stencilOpStencilDepthPass=t}setDitheringState(t){t?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(t){t?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}getDepthFunction(){return this._depthCullingState.depthFunc}setDepthFunction(t){this._depthCullingState.depthFunc=t}setDepthFunctionToGreater(){this.setDepthFunction(516)}setDepthFunctionToGreaterOrEqual(){this.setDepthFunction(518)}setDepthFunctionToLess(){this.setDepthFunction(513)}setDepthFunctionToLessOrEqual(){this.setDepthFunction(515)}cacheStencilState(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()}restoreStencilState(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)}setDirectViewport(t,e,s,r){const i=this._cachedViewport;return this._cachedViewport=null,this._viewport(t,e,s,r),i}scissorClear(t,e,s,r,i){this.enableScissor(t,e,s,r),this.clear(i,!0,!0,!0),this.disableScissor()}enableScissor(t,e,s,r){const i=this._gl;i.enable(i.SCISSOR_TEST),i.scissor(t,e,s,r)}disableScissor(){const t=this._gl;t.disable(t.SCISSOR_TEST)}_reportDrawCall(t=1){this._drawCalls.addCount(t,!1)}initWebVR(){throw(0,o.S)("WebVRCamera")}_prepareVRComponent(){}_connectVREvents(t,e){}_submitVRFrame(){}disableVR(){}isVRPresenting(){return!1}_requestVRFrame(){}_loadFileAsync(t,e,s){return new Promise(((r,i)=>{this._loadFile(t,(t=>{r(t)}),void 0,e,s,((t,e)=>{i(e)}))}))}getVertexShaderSource(t){const e=this._gl.getAttachedShaders(t);return e?this._gl.getShaderSource(e[0]):null}getFragmentShaderSource(t){const e=this._gl.getAttachedShaders(t);return e?this._gl.getShaderSource(e[1]):null}setDepthStencilTexture(t,e,s,r){void 0!==t&&(e&&(this._boundUniforms[t]=e),s&&s.depthStencilTexture?this._setTexture(t,s,!1,!0,r):this._setTexture(t,null,void 0,void 0,r))}setTextureFromPostProcess(t,e,s){var r;let i=null;e&&(e._textures.data[e._currentRenderTextureInd]?i=e._textures.data[e._currentRenderTextureInd]:e._forcedOutputTexture&&(i=e._forcedOutputTexture)),this._bindTexture(t,null!==(r=null==i?void 0:i.texture)&&void 0!==r?r:null,s)}setTextureFromPostProcessOutput(t,e,s){var r,i;this._bindTexture(t,null!==(i=null===(r=null==e?void 0:e._outputTexture)||void 0===r?void 0:r.texture)&&void 0!==i?i:null,s)}_rebuildBuffers(){for(const t of this.scenes)t.resetCachedMaterial(),t._rebuildGeometries(),t._rebuildTextures();for(const t of this._virtualScenes)t.resetCachedMaterial(),t._rebuildGeometries(),t._rebuildTextures();super._rebuildBuffers()}_renderFrame(){for(let t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])()}_renderLoop(){if(!this._contextWasLost){let t=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(t=!1),t&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}_renderViews(){return!1}switchFullscreen(t){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(t)}enterFullscreen(t){this.isFullscreen||(this._pointerLockRequested=t,this._renderingCanvas&&p._RequestFullscreen(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&p._ExitFullscreen()}enterPointerlock(){this._renderingCanvas&&p._RequestPointerlock(this._renderingCanvas)}exitPointerlock(){p._ExitPointerlock()}beginFrame(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),super.beginFrame()}endFrame(){super.endFrame(),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)}resize(t=!1){this.isVRPresenting()||super.resize(t)}setSize(t,e,s=!1){if(!this._renderingCanvas)return!1;if(!super.setSize(t,e,s))return!1;if(this.scenes){for(let t=0;t<this.scenes.length;t++){const e=this.scenes[t];for(let t=0;t<e.cameras.length;t++)e.cameras[t]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}_deletePipelineContext(t){const e=t;e&&e.program&&e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),super._deletePipelineContext(t)}createShaderProgram(t,e,s,r,i,n=null){i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const a=super.createShaderProgram(t,e,s,r,i,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),a}_createShaderProgram(t,e,s,r,i=null){const n=r.createProgram();if(t.program=n,!n)throw new Error("Unable to create program");if(r.attachShader(n,e),r.attachShader(n,s),this.webGLVersion>1&&i){const e=this.createTransformFeedback();this.bindTransformFeedback(e),this.setTranformFeedbackVaryings(n,i),t.transformFeedback=e}return r.linkProgram(n),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),t.context=r,t.vertexShader=e,t.fragmentShader=s,t.isParallelCompiled||this._finalizePipelineContext(t),n}_releaseTexture(t){super._releaseTexture(t)}_releaseRenderTargetWrapper(t){super._releaseRenderTargetWrapper(t),this.scenes.forEach((e=>{e.postProcesses.forEach((e=>{e._outputTexture===t&&(e._outputTexture=null)})),e.cameras.forEach((e=>{e._postProcesses.forEach((e=>{e&&e._outputTexture===t&&(e._outputTexture=null)}))}))}))}getRenderPassNames(){return this._renderPassNames}getCurrentRenderPassName(){return this._renderPassNames[this.currentRenderPassId]}createRenderPassId(t){const e=++p._RenderPassIdCounter;return this._renderPassNames[e]=null!=t?t:"NONAME",e}releaseRenderPassId(t){this._renderPassNames[t]=void 0;for(let e=0;e<this.scenes.length;++e){const s=this.scenes[e];for(let e=0;e<s.meshes.length;++e){const r=s.meshes[e];if(r.subMeshes)for(let e=0;e<r.subMeshes.length;++e)r.subMeshes[e]._removeDrawWrapper(t)}}}_rescaleTexture(t,e,s,r,i){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const n=this.createRenderTargetTexture({width:e.width,height:e.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&p._RescalePostProcessFactory&&(this._rescalePostProcess=p._RescalePostProcessFactory(this)),this._rescalePostProcess&&(this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((()=>{this._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};let a=s;a||(a=this.scenes[this.scenes.length-1]),a.postProcessManager.directRender([this._rescalePostProcess],n,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,r,0,0,e.width,e.height,0),this.unBindFramebuffer(n),n.dispose(),i&&i()})))}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}wrapWebGLTexture(t,e=!1,s=3){const r=new f.B(t,this._gl),n=new i.l(this,i.S.Unknown,!0);return n._hardwareTexture=r,n.isReady=!0,n.useMipMaps=e,this.updateTextureSamplingMode(s,n),n}_uploadImageToTexture(t,e,s=0,r=0){const i=this._gl,n=this._getWebGLTextureType(t.type),a=this._getInternalFormat(t.format),o=this._getRGBABufferInternalSizedFormat(t.type,a),h=t.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(h,t,!0),this._unpackFlipY(t.invertY);let l=i.TEXTURE_2D;t.isCube&&(l=i.TEXTURE_CUBE_MAP_POSITIVE_X+s),i.texImage2D(l,r,o,a,n,e),this._bindTextureDirectly(h,null,!0)}updateTextureComparisonFunction(t,e){if(1===this.webGLVersion)return void g.Y.Error("WebGL 1 does not support texture comparison.");const s=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===e?(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,e),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===e?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=e}createInstancesBuffer(t){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create instance buffer");const s=new d.M(e);return s.capacity=t,this.bindArrayBuffer(s),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.DYNAMIC_DRAW),s.references=1,s}deleteInstancesBuffer(t){this._gl.deleteBuffer(t)}_clientWaitAsync(t,e=0,s=10){const r=this._gl;return new Promise(((i,n)=>{const a=()=>{const o=r.clientWaitSync(t,e,0);o!=r.WAIT_FAILED?o!=r.TIMEOUT_EXPIRED?i():setTimeout(a,s):n()};a()}))}_readPixelsAsync(t,e,s,r,i,n,a){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const o=this._gl,h=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,h),o.bufferData(o.PIXEL_PACK_BUFFER,a.byteLength,o.STREAM_READ),o.readPixels(t,e,s,r,i,n,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);const l=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(o.flush(),this._clientWaitAsync(l,0,10).then((()=>(o.deleteSync(l),o.bindBuffer(o.PIXEL_PACK_BUFFER,h),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(h),a)))):null}dispose(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===a.l.Instances.length&&p.audioEngine&&(p.audioEngine.dispose(),p.audioEngine=null),this.disableVR();const t=this.getHostWindow();t&&"function"==typeof t.removeEventListener&&(t.removeEventListener("blur",this._onBlur),t.removeEventListener("focus",this._onFocus)),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),(0,n.n5)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),super.dispose();const e=a.l.Instances.indexOf(this);e>=0&&a.l.Instances.splice(e,1),p.Instances.length||(a.l.OnEnginesDisposedObservable.notifyObservers(this),a.l.OnEnginesDisposedObservable.clear()),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}_disableTouchAction(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")}displayLoadingUI(){if(!(0,n.CG)())return;const t=this.loadingScreen;t&&t.displayLoadingUI()}hideLoadingUI(){if(!(0,n.CG)())return;const t=this._loadingScreen;t&&t.hideLoadingUI()}get loadingScreen(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=p.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen}set loadingScreen(t){this._loadingScreen=t}set loadingUIText(t){this.loadingScreen.loadingUIText=t}set loadingUIBackgroundColor(t){this.loadingScreen.loadingUIBackgroundColor=t}createVideoElement(t){return document.createElement("video")}static _RequestPointerlock(t){if(t.requestPointerLock){const e=t.requestPointerLock();e instanceof Promise?e.then((()=>{t.focus()})).catch((()=>{})):t.focus()}}static _ExitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}static _RequestFullscreen(t){const e=t.requestFullscreen||t.webkitRequestFullscreen;e&&e.call(t)}static _ExitFullscreen(){const t=document;document.exitFullscreen?document.exitFullscreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()}getFontOffset(t){const e=document.createElement("span");e.innerHTML="Hg",e.setAttribute("style",`font: ${t} !important`);const s=document.createElement("div");s.style.display="inline-block",s.style.width="1px",s.style.height="0px",s.style.verticalAlign="bottom";const r=document.createElement("div");r.style.whiteSpace="nowrap",r.appendChild(e),r.appendChild(s),document.body.appendChild(r);let i=0,n=0;try{n=s.getBoundingClientRect().top-e.getBoundingClientRect().top,s.style.verticalAlign="baseline",i=s.getBoundingClientRect().top-e.getBoundingClientRect().top}finally{document.body.removeChild(r)}return{ascent:i,height:n,descent:n-i}}}p.ALPHA_DISABLE=0,p.ALPHA_ADD=1,p.ALPHA_COMBINE=2,p.ALPHA_SUBTRACT=3,p.ALPHA_MULTIPLY=4,p.ALPHA_MAXIMIZED=5,p.ALPHA_ONEONE=6,p.ALPHA_PREMULTIPLIED=7,p.ALPHA_PREMULTIPLIED_PORTERDUFF=8,p.ALPHA_INTERPOLATE=9,p.ALPHA_SCREENMODE=10,p.DELAYLOADSTATE_NONE=0,p.DELAYLOADSTATE_LOADED=1,p.DELAYLOADSTATE_LOADING=2,p.DELAYLOADSTATE_NOTLOADED=4,p.NEVER=512,p.ALWAYS=519,p.LESS=513,p.EQUAL=514,p.LEQUAL=515,p.GREATER=516,p.GEQUAL=518,p.NOTEQUAL=517,p.KEEP=7680,p.REPLACE=7681,p.INCR=7682,p.DECR=7683,p.INVERT=5386,p.INCR_WRAP=34055,p.DECR_WRAP=34056,p.TEXTURE_CLAMP_ADDRESSMODE=0,p.TEXTURE_WRAP_ADDRESSMODE=1,p.TEXTURE_MIRROR_ADDRESSMODE=2,p.TEXTUREFORMAT_ALPHA=0,p.TEXTUREFORMAT_LUMINANCE=1,p.TEXTUREFORMAT_LUMINANCE_ALPHA=2,p.TEXTUREFORMAT_RGB=4,p.TEXTUREFORMAT_RGBA=5,p.TEXTUREFORMAT_RED=6,p.TEXTUREFORMAT_R=6,p.TEXTUREFORMAT_RG=7,p.TEXTUREFORMAT_RED_INTEGER=8,p.TEXTUREFORMAT_R_INTEGER=8,p.TEXTUREFORMAT_RG_INTEGER=9,p.TEXTUREFORMAT_RGB_INTEGER=10,p.TEXTUREFORMAT_RGBA_INTEGER=11,p.TEXTURETYPE_UNSIGNED_BYTE=0,p.TEXTURETYPE_UNSIGNED_INT=0,p.TEXTURETYPE_FLOAT=1,p.TEXTURETYPE_HALF_FLOAT=2,p.TEXTURETYPE_BYTE=3,p.TEXTURETYPE_SHORT=4,p.TEXTURETYPE_UNSIGNED_SHORT=5,p.TEXTURETYPE_INT=6,p.TEXTURETYPE_UNSIGNED_INTEGER=7,p.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,p.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,p.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,p.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,p.TEXTURETYPE_UNSIGNED_INT_24_8=12,p.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,p.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,p.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,p.TEXTURE_NEAREST_SAMPLINGMODE=1,p.TEXTURE_BILINEAR_SAMPLINGMODE=2,p.TEXTURE_TRILINEAR_SAMPLINGMODE=3,p.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,p.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,p.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,p.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,p.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,p.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,p.TEXTURE_NEAREST_LINEAR=7,p.TEXTURE_NEAREST_NEAREST=1,p.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,p.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,p.TEXTURE_LINEAR_LINEAR=2,p.TEXTURE_LINEAR_NEAREST=12,p.TEXTURE_EXPLICIT_MODE=0,p.TEXTURE_SPHERICAL_MODE=1,p.TEXTURE_PLANAR_MODE=2,p.TEXTURE_CUBIC_MODE=3,p.TEXTURE_PROJECTION_MODE=4,p.TEXTURE_SKYBOX_MODE=5,p.TEXTURE_INVCUBIC_MODE=6,p.TEXTURE_EQUIRECTANGULAR_MODE=7,p.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,p.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,p.SCALEMODE_FLOOR=1,p.SCALEMODE_NEAREST=2,p.SCALEMODE_CEILING=3,p._RescalePostProcessFactory=null,p._RenderPassIdCounter=0},5953:(t,e,s)=>{s.d(e,{l:()=>i});var r=s(8139);class i{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}i.Instances=new Array,i.OnEnginesDisposedObservable=new r.y$,i._LastCreatedScene=null,i.UseFallbackTexture=!0,i.FallbackTexture=""},1716:(t,e,s)=>{s.d(e,{Z:()=>r});class r{static SetMatrixPrecision(t){if(r.MatrixTrackPrecisionChange=!1,t&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(let t=0;t<r.MatrixTrackedMatrices.length;++t){const e=r.MatrixTrackedMatrices[t],s=e._m;e._m=new Array(16);for(let t=0;t<16;++t)e._m[t]=s[t]}r.MatrixUse64Bits=t,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null}}r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[]},1206:(t,e,s)=>{s.d(e,{v:()=>i});var r=s(475);class i{static GetShadersRepository(t=r.x.GLSL){return t===r.x.GLSL?i.ShadersRepository:i.ShadersRepositoryWGSL}static GetShadersStore(t=r.x.GLSL){return t===r.x.GLSL?i.ShadersStore:i.ShadersStoreWGSL}static GetIncludesShadersStore(t=r.x.GLSL){return t===r.x.GLSL?i.IncludesShadersStore:i.IncludesShadersStoreWGSL}}i.ShadersRepository="src/Shaders/",i.ShadersStore={},i.IncludesShadersStore={},i.ShadersRepositoryWGSL="src/ShadersWGSL/",i.ShadersStoreWGSL={},i.IncludesShadersStoreWGSL={}},7543:(t,e,s)=>{s.d(e,{B:()=>S});var r=s(5953),i=s(4442),n=s(9069),a=s(8139);class o{constructor(t=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,t&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(t){this._zOffset!==t&&(this._zOffset=t,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(t){this._zOffsetUnits!==t&&(this._zOffsetUnits=t,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(t){this._cullFace!==t&&(this._cullFace=t,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(t){this._cull!==t&&(this._cull=t,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(t){this._depthFunc!==t&&(this._depthFunc=t,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(t){this._depthMask!==t&&(this._depthMask=t,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(t){this._depthTest!==t&&(this._depthTest=t,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(t){this._frontFace!==t&&(this._frontFace=t,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(t){this.isDirty&&(this._isCullDirty&&(this.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(t.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(t.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(t.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.zOffset,this.zOffsetUnits)):t.disable(t.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(t.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class h{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=h.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=h.KEEP,this.opDepthFail=h.KEEP,this.opStencilDepthPass=h.REPLACE}get stencilFunc(){return this.func}set stencilFunc(t){this.func=t}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(t){this.funcRef=t}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(t){this.funcMask=t}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(t){this.opStencilFail=t}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(t){this.opDepthFail=t}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(t){this.opStencilDepthPass=t}get stencilMask(){return this.mask}set stencilMask(t){this.mask=t}get stencilTest(){return this.enabled}set stencilTest(t){this.enabled=t}}h.ALWAYS=519,h.KEEP=7680,h.REPLACE=7681;class l{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(t){this._alphaBlend!==t&&(this._alphaBlend=t,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(t,e,s,r){this._blendConstants[0]===t&&this._blendConstants[1]===e&&this._blendConstants[2]===s&&this._blendConstants[3]===r||(this._blendConstants[0]=t,this._blendConstants[1]=e,this._blendConstants[2]=s,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(t,e,s,r){this._blendFunctionParameters[0]===t&&this._blendFunctionParameters[1]===e&&this._blendFunctionParameters[2]===s&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=t,this._blendFunctionParameters[1]=e,this._blendFunctionParameters[2]=s,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(t,e){this._blendEquationParameters[0]===t&&this._blendEquationParameters[1]===e||(this._blendEquationParameters[0]=t,this._blendEquationParameters[1]=e,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(t){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?t.enable(t.BLEND):t.disable(t.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(t.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(t.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(t.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var _=s(3369),c=s(658),u=s(1102),d=s(475);class g{constructor(){this.shaderLanguage=d.x.GLSL}postProcessor(t,e,s,r,i){if(!i.getCaps().drawBuffersExtension){const e=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;t=t.replace(e,"")}return t}}class f{constructor(){this.shaderLanguage=d.x.GLSL}attributeProcessor(t){return t.replace("attribute","in")}varyingProcessor(t,e){return t.replace("varying",e?"in":"out")}postProcessor(t,e,s){const r=-1!==t.search(/#extension.+GL_EXT_draw_buffers.+require/);if(t=(t=t.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),s)t=(t=(t=(t=(t=(t=(t=t.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(");else if(-1!==e.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+t;return t}}var p=s(4081);const m=["Int","Int2","Int3","Int4","UInt","UInt2","UInt3","UInt4","Vector2","Vector3","Vector4","Float2","Float","Float3","Float4","Quaternion","Color3","Color4","DirectColor4"];class R{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null;const t=[],e=function(){t.length=0,Array.prototype.push.apply(t,arguments),t[0]=this._uniforms[t[0]]},s=s=>{const r=m.includes(s.substring(3))&&"FloatN";if(r){const i=this[`_cache${r}`];return function(){const r=this.engine[s];e.apply(this,arguments),i.apply(this,arguments)&&(r.apply(this.engine,t)||(this._valueCache[arguments[0]]=null))}}return function(){const r=this.engine[s];e.apply(this,arguments),void 0!==arguments[1]&&(this._valueCache[arguments[0]]=null,r.apply(this.engine,t))}};["Int?","UInt?","IntArray?","UIntArray?","Array?","Float?","Matrices","Matrix3x3","Matrix2x2"].forEach((t=>{const e=`set${t}`;this[e]||(e.endsWith("?")?["",2,3,4].forEach((t=>{this[e.slice(0,-1)+t]=this[e.slice(0,-1)+t]||s(e.slice(0,-1)+t).bind(this)})):this[e]=this[e]||s(e).bind(this))}))}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(t){t&&this.program&&t(this.program)}_fillEffectInformation(t,e,s,r,i,n,a,o){const h=this.engine;if(h.supportsUniformBuffers)for(const s in e)t.bindUniformBlock(s,e[s]);let l;for(this.engine.getUniforms(this,s).forEach(((t,e)=>{r[s[e]]=t})),this._uniforms=r,l=0;l<i.length;l++)null==t.getUniform(i[l])&&(i.splice(l,1),l--);i.forEach(((t,e)=>{n[t]=e}));for(const t of h.getAttributes(this,a))o.push(t)}dispose(){this._uniforms={}}_cacheMatrix(t,e){const s=this._valueCache[t],r=e.updateFlag;return(void 0===s||s!==r)&&(this._valueCache[t]=r,!0)}_cacheFloatN(t,e,s,r,i){let n=this._valueCache[arguments[0]];if(!n||n.length!==arguments.length-1)return n=Array.prototype.slice.call(arguments,1),this._valueCache[arguments[0]]=n,!0;let a=!1;for(let t=0;t<n.length;++t)n[t]!==arguments[t+1]&&(n[t]=arguments[t+1],a=!0);return a}_cacheFloat2(t,e,s){return this._cacheFloatN(t,e,s)}_cacheFloat3(t,e,s,r){return this._cacheFloatN(t,e,s,r)}_cacheFloat4(t,e,s,r,i){return this._cacheFloatN(t,e,s,r,i)}setMatrix(t,e){this._cacheMatrix(t,e)&&(this.engine.setMatrices(this._uniforms[t],e.toArray())||(this._valueCache[t]=null))}setVector2(t,e){this.setFloat2(t,e.x,e.y)}setVector3(t,e){this.setFloat3(t,e.x,e.y,e.z)}setVector4(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)}setQuaternion(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)}setColor3(t,e){this.setFloat3(t,e.r,e.g,e.b)}setColor4(t,e,s){this.setFloat4(t,e.r,e.g,e.b,s)}setDirectColor4(t,e){this.setFloat4(t,e.r,e.g,e.b,e.a)}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}var T=s(1716),x=s(8449),E=s(7050);class y{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(t){this._func!==t&&(this._func=t,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(t){this._funcRef!==t&&(this._funcRef=t,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(t){this._funcMask!==t&&(this._funcMask=t,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(t){this._opStencilFail!==t&&(this._opStencilFail=t,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(t){this._opDepthFail!==t&&(this._opDepthFail=t,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(t){this._opStencilDepthPass!==t&&(this._opStencilDepthPass=t,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t,this._isStencilTestDirty=!0)}constructor(t=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,t&&this.reset()}reset(){var t;this.stencilMaterial=void 0,null===(t=this.stencilGlobal)||void 0===t||t.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(t){var e;if(!t)return;const s=!this.useStencilGlobalOnly&&!!(null===(e=this.stencilMaterial)||void 0===e?void 0:e.enabled);this.enabled=s?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=s?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=s?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=s?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=s?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=s?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=s?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=s?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(t.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(t.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(t.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}var b=s(9665);class A{}class S{static get NpmPackage(){return"babylonjs@5.50.1"}static get Version(){return"5.50.1"}get description(){let t=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(t+=" - Parallel shader compilation"),t}get name(){return this._name}set name(t){this._name=t}get version(){return this._webGLVersion}get isDisposed(){return this._isDisposed}static get ShadersRepository(){return i.Q.ShadersRepository}static set ShadersRepository(t){i.Q.ShadersRepository=t}_getShaderProcessor(t){return this._shaderProcessor}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(t){t!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=t,this._depthCullingState.depthFunc=t?518:515)}get frameId(){return this._frameId}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}getCreationOptions(){return this._creationOptions}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get activeRenderLoops(){return this._activeRenderLoops}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(t){this._doNotHandleContextLost=t}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(t){this._framebufferDimensionsObject=t}get currentViewport(){return this._cachedViewport}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const t=new Uint8Array(4),e=[t,t,t,t,t,t];this._emptyCubeTexture=this.createRawCubeTexture(e,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get isWebGPU(){return this._isWebGPU}get shaderPlatformName(){return this._shaderPlatformName}get snapshotRendering(){return!1}set snapshotRendering(t){}get snapshotRenderingMode(){return this._snapshotRenderingMode}set snapshotRenderingMode(t){this._snapshotRenderingMode=t}snapshotRenderingReset(){this.snapshotRendering=!1}static _CreateCanvas(t,e){if("undefined"==typeof document)return new OffscreenCanvas(t,e);const s=document.createElement("canvas");return s.width=t,s.height=e,s}createCanvas(t,e){return S._CreateCanvas(t,e)}createCanvasImage(){return document.createElement("img")}constructor(t,e,s,r){var i,n,_,d,p,m,R,x,E,C,F;this._name="WebGL",this._isDisposed=!1,this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new a.y$,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new a.y$,this.onContextRestoredObservable=new a.y$,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new o,this._stencilStateComposer=new y,this._stencilState=new h,this._alphaState=new l,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new a.y$,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},this.startTime=b.F.Now;let w=null;s=s||{},this._creationOptions=s,this.adaptToDeviceRatio=null!=r&&r,this._stencilStateComposer.stencilGlobal=this._stencilState,T.Z.SetMatrixPrecision(!!s.useHighPrecisionMatrix),s.antialias=null!=e?e:s.antialias,s.deterministicLockstep=null!==(i=s.deterministicLockstep)&&void 0!==i&&i,s.lockstepMaxSteps=null!==(n=s.lockstepMaxSteps)&&void 0!==n?n:4,s.timeStep=null!==(_=s.timeStep)&&void 0!==_?_:1/60,s.audioEngine=null===(d=s.audioEngine)||void 0===d||d,s.stencil=null===(p=s.stencil)||void 0===p||p,this._audioContext=null!==(R=null===(m=s.audioEngineOptions)||void 0===m?void 0:m.audioContext)&&void 0!==R?R:null,this._audioDestination=null!==(E=null===(x=s.audioEngineOptions)||void 0===x?void 0:x.audioDestination)&&void 0!==E?E:null,this.premultipliedAlpha=null===(C=s.premultipliedAlpha)||void 0===C||C,this.useExactSrgbConversions=null!==(F=s.useExactSrgbConversions)&&void 0!==F&&F,this._doNotHandleContextLost=!!s.doNotHandleContextLost,this._isStencilEnable=!!s.stencil,r=r||s.adaptToDeviceRatio||!1;const v=(0,u.CG)()&&window.devicePixelRatio||1,P=s.limitDeviceRatio||v;if(this._hardwareScalingLevel=r?1/Math.min(P,v):1,this._lastDevicePixelRatio=v,!t)return;if(t.getContext){if(w=t,this._renderingCanvas=w,void 0===s.preserveDrawingBuffer&&(s.preserveDrawingBuffer=!1),void 0===s.xrCompatible&&(s.xrCompatible=!0),navigator&&navigator.userAgent){this._setupMobileChecks();const t=navigator.userAgent;for(const e of S.ExceptionList){const r=e.key,i=e.targets;if(new RegExp(r).test(t)){if(e.capture&&e.captureConstraint){const s=e.capture,r=e.captureConstraint,i=new RegExp(s).exec(t);if(i&&i.length>0&&parseInt(i[i.length-1])>=r)continue}for(const t of i)switch(t){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":s.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=t=>{t.preventDefault(),this._contextWasLost=!0,c.Y.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost(this._initGLContext.bind(this))},w.addEventListener("webglcontextlost",this._onContextLost,!1),w.addEventListener("webglcontextrestored",this._onContextRestored,!1),s.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(s.xrCompatible=!1),!s.disableWebGL2Support)try{this._gl=w.getContext("webgl2",s)||w.getContext("experimental-webgl2",s),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(t){}if(!this._gl){if(!w)throw new Error("The provided canvas is null or undefined.");try{this._gl=w.getContext("webgl",s)||w.getContext("experimental-webgl",s)}catch(t){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const e=this._gl.getContextAttributes();e&&(s.stencil=e.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==s.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=s.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let t=0;t<this._caps.maxVertexAttribs;t++)this._currentBufferPointers[t]=new A;this._shaderProcessor=this.webGLVersion>1?new f:new g,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);const M=`Babylon.js v${S.Version}`;console.log(M+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",M)}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const t=navigator.userAgent;this.hostInformation.isMobile=-1!==t.indexOf("Mobile")||-1!==t.indexOf("Mac")&&(0,u.n5)()&&"ontouchend"in document},this._checkForMobile(),(0,u.CG)()&&window.addEventListener("resize",this._checkForMobile))}_restoreEngineAfterContextLost(t){setTimeout((async()=>{var e;this._dummyFramebuffer=null;const s=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,i=this._depthCullingState.depthMask,n=this._stencilState.stencilTest;await t(),this.wipeCaches(!0),this._rebuildEffects(),null===(e=this._rebuildComputeEffects)||void 0===e||e.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0),this._depthCullingState.depthTest=s,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=i,this._stencilState.stencilTest=n,c.Y.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}),0)}_sharedInit(t){this._renderingCanvas=t}_getShaderProcessingContext(t){return null}_rebuildInternalTextures(){const t=this._internalTexturesCache.slice();for(const e of t)e._rebuild()}_rebuildRenderTargetWrappers(){const t=this._renderTargetWrapperCache.slice();for(const e of t)e._rebuild()}_rebuildEffects(){for(const t in this._compiledEffects){const e=this._compiledEffects[t];e._pipelineContext=null,e._wasPreviouslyReady=!1,e._prepareEffect()}i.Q.ResetCache()}areAllEffectsReady(){for(const t in this._compiledEffects)if(!this._compiledEffects[t].isReady())return!1;return!0}_rebuildBuffers(){for(const t of this._uniformBuffers)t._rebuild();for(const t of this._storageBuffers)t._rebuild()}_initGLContext(){var t;this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128},this._glVersion=this._gl.getParameter(this._gl.VERSION);const e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(null!==(t=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT))&&void 0!==t?t:0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let e=0;e<16;e++)this._gl["COLOR_ATTACHMENT"+e+"_WEBGL"]=t["COLOR_ATTACHMENT"+e+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const t=this._gl.getExtension("WEBGL_depth_texture");null!=t&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const t=this._gl.getExtension("OES_vertex_array_object");null!=t&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const t=this._gl.getExtension("ANGLE_instanced_arrays");null!=t?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),this._gl.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),this._gl.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const t=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),e=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);t&&e&&(this._caps.highPrecisionShaderSupported=0!==t.precision&&0!==e.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const t=this._gl.getExtension("EXT_blend_minmax");null!=t&&(this._caps.blendMinMax=!0,this._gl.MAX=t.MAX_EXT,this._gl.MIN=t.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{const t=this._gl.getExtension("EXT_sRGB");null!=t&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=t.SRGB_EXT,this._gl.SRGB8=t.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=t.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}get isStencilEnable(){return this._isStencilEnable}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const t=this._workingCanvas.getContext("2d");t&&(this._workingContext=t)}resetTextureCache(){for(const t in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,t)&&(this._boundTexturesCache[t]=null);this._currentTextureChannel=-1}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}setHardwareScalingLevel(t){this._hardwareScalingLevel=t,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}getLoadedTexturesCache(){return this._internalTexturesCache}getCaps(){return this._caps}stopRenderLoop(t){if(!t)return void(this._activeRenderLoops.length=0);const e=this._activeRenderLoops.indexOf(t);e>=0&&this._activeRenderLoops.splice(e,1)}_renderLoop(){if(!this._contextWasLost){let t=!0;if((this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(t=!1),t){this.beginFrame();for(let t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}getHostWindow(){return(0,u.CG)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}getRenderWidth(t=!1){return!t&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(t=!1){return!t&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}_queueNewFrame(t,e){return S.QueueNewFrame(t,e)}runRenderLoop(t){-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}clear(t,e,s,r=!1){const i=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=i;let n=0;e&&t&&(this._gl.clearColor(t.r,t.g,t.b,void 0!==t.a?t.a:1),n|=this._gl.COLOR_BUFFER_BIT),s&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)}_viewport(t,e,s,r){t===this._viewportCached.x&&e===this._viewportCached.y&&s===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=t,this._viewportCached.y=e,this._viewportCached.z=s,this._viewportCached.w=r,this._gl.viewport(t,e,s,r))}setViewport(t,e,s){const r=e||this.getRenderWidth(),i=s||this.getRenderHeight(),n=t.x||0,a=t.y||0;this._cachedViewport=t,this._viewport(n*r,a*i,r*t.width,i*t.height)}beginFrame(){}endFrame(){this._badOS&&this.flushFramebuffer(),this._frameId++}resize(t=!1){let e,s;if(this.adaptToDeviceRatio){const t=(0,u.CG)()&&window.devicePixelRatio||1,e=this._lastDevicePixelRatio/t;this._lastDevicePixelRatio=t,this._hardwareScalingLevel*=e}(0,u.CG)()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,s=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,s=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,s/this._hardwareScalingLevel,t)}setSize(t,e,s=!1){return!(!this._renderingCanvas||(t|=0,e|=0,!s&&this._renderingCanvas.width===t&&this._renderingCanvas.height===e||(this._renderingCanvas.width=t,this._renderingCanvas.height=e,0)))}bindFramebuffer(t,e=0,s,r,i,n=0,a=0){var o,h,l,_,c;const u=t;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=t,this._bindUnboundFramebuffer(u._MSAAFramebuffer?u._MSAAFramebuffer:u._framebuffer);const d=this._gl;t.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,null===(o=t.texture._hardwareTexture)||void 0===o?void 0:o.underlyingResource,n,a):t.isCube&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+e,null===(h=t.texture._hardwareTexture)||void 0===h?void 0:h.underlyingResource,n);const g=t._depthStencilTexture;if(g){const s=t._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;t.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,s,null===(l=g._hardwareTexture)||void 0===l?void 0:l.underlyingResource,n,a):t.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,s,d.TEXTURE_CUBE_MAP_POSITIVE_X+e,null===(_=g._hardwareTexture)||void 0===_?void 0:_.underlyingResource,n):d.framebufferTexture2D(d.FRAMEBUFFER,s,d.TEXTURE_2D,null===(c=g._hardwareTexture)||void 0===c?void 0:c.underlyingResource,n)}this._cachedViewport&&!i?this.setViewport(this._cachedViewport,s,r):(s||(s=t.width,n&&(s/=Math.pow(2,n))),r||(r=t.height,n&&(r/=Math.pow(2,n))),this._viewport(0,0,s,r)),this.wipeCaches()}setState(t,e=0,s,r=!1,i,n,a=0){var o,h;(this._depthCullingState.cull!==t||s)&&(this._depthCullingState.cull=t);const l=null===(h=null!==(o=this.cullBackFaces)&&void 0!==o?o:i)||void 0===h||h?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==l||s)&&(this._depthCullingState.cullFace=l),this.setZOffset(e),this.setZOffsetUnits(a);const _=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==_||s)&&(this._depthCullingState.frontFace=_),this._stencilStateComposer.stencilMaterial=n}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(t){this._depthCullingState.depthTest=t}setZOffset(t){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-t:t}getZOffset(){const t=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-t:t}setZOffsetUnits(t){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-t:t}getZOffsetUnits(){const t=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-t:t}_bindUnboundFramebuffer(t){this._currentFramebuffer!==t&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,t),this._currentFramebuffer=t)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(t){this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)}unBindFramebuffer(t,e=!1,s){var r;const i=t;this._currentRenderTarget=null;const n=this._gl;if(i._MSAAFramebuffer){if(t.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(t,e,s);n.bindFramebuffer(n.READ_FRAMEBUFFER,i._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,i._framebuffer),n.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,n.COLOR_BUFFER_BIT,n.NEAREST)}!(null===(r=t.texture)||void 0===r?void 0:r.generateMipMaps)||e||t.isCube||this.generateMipmaps(t.texture),s&&(i._MSAAFramebuffer&&this._bindUnboundFramebuffer(i._framebuffer),s()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(t){return this._createVertexBuffer(t,this._gl.STATIC_DRAW)}_createVertexBuffer(t,e){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create vertex buffer");const r=new p.M(s);return this.bindArrayBuffer(r),t instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(t),e):this._gl.bufferData(this._gl.ARRAY_BUFFER,t,e),this._resetVertexBufferBinding(),r.references=1,r}createDynamicVertexBuffer(t){return this._createVertexBuffer(t,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(t,e){const s=this._gl.createBuffer(),r=new p.M(s);if(!s)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);const i=this._normalizeIndexData(t);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,e?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=4===i.BYTES_PER_ELEMENT,r}_normalizeIndexData(t){if(2===t.BYTES_PER_ELEMENT)return t;if(this._caps.uintIndices){if(t instanceof Uint32Array)return t;for(let e=0;e<t.length;e++)if(t[e]>=65535)return new Uint32Array(t);return new Uint16Array(t)}return new Uint16Array(t)}bindArrayBuffer(t){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(t,this._gl.ARRAY_BUFFER)}bindUniformBlock(t,e,s){const r=t.program,i=this._gl.getUniformBlockIndex(r,e);this._gl.uniformBlockBinding(r,i,s)}bindIndexBuffer(t){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(t,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(t,e){(this._vaoRecordInProgress||this._currentBoundBuffer[e]!==t)&&(this._gl.bindBuffer(e,t?t.underlyingResource:null),this._currentBoundBuffer[e]=t)}updateArrayBuffer(t){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)}_vertexAttribPointer(t,e,s,r,i,n,a){const o=this._currentBufferPointers[e];if(!o)return;let h=!1;o.active?(o.buffer!==t&&(o.buffer=t,h=!0),o.size!==s&&(o.size=s,h=!0),o.type!==r&&(o.type=r,h=!0),o.normalized!==i&&(o.normalized=i,h=!0),o.stride!==n&&(o.stride=n,h=!0),o.offset!==a&&(o.offset=a,h=!0)):(h=!0,o.active=!0,o.index=e,o.size=s,o.type=r,o.normalized=i,o.stride=n,o.offset=a,o.buffer=t),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(t),r===this._gl.UNSIGNED_INT||r===this._gl.INT?this._gl.vertexAttribIPointer(e,s,r,n,a):this._gl.vertexAttribPointer(e,s,r,i,n,a))}_bindIndexBufferWithCache(t){null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this.bindIndexBuffer(t),this._uintIndicesCurrentlySet=t.is32Bits)}_bindVertexBuffersAttributes(t,e,s){const r=e.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let i=0;i<r.length;i++){const n=e.getAttributeLocation(i);if(n>=0){const e=r[i];let a=null;if(s&&(a=s[e]),a||(a=t[e]),!a)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);const o=a.getBuffer();o&&(this._vertexAttribPointer(o,n,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}}recordVertexArrayObject(t,e,s,r){const i=this._gl.createVertexArray();if(!i)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(t,s,r),this.bindIndexBuffer(e),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i}bindVertexArrayObject(t,e){this._cachedVertexArrayObject!==t&&(this._cachedVertexArrayObject=t,this._gl.bindVertexArray(t),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=e&&e.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(t,e,s,r,i){if(this._cachedVertexBuffers!==t||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=t,this._cachedEffectForVertexBuffers=i;const e=i.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let n=0;for(let a=0;a<e;a++)if(a<s.length){const e=i.getAttributeLocation(a);e>=0&&(this._gl.enableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!0,this._vertexAttribPointer(t,e,s[a],this._gl.FLOAT,!1,r,n)),n+=4*s[a]}}this._bindIndexBufferWithCache(e)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(t,e,s,r){this._cachedVertexBuffers===t&&this._cachedEffectForVertexBuffers===s||(this._cachedVertexBuffers=t,this._cachedEffectForVertexBuffers=s,this._bindVertexBuffersAttributes(t,s,r)),this._bindIndexBufferWithCache(e)}unbindInstanceAttributes(){let t;for(let e=0,s=this._currentInstanceLocations.length;e<s;e++){const s=this._currentInstanceBuffers[e];t!=s&&s.references&&(t=s,this.bindArrayBuffer(s));const r=this._currentInstanceLocations[e];this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(t){this._gl.deleteVertexArray(t)}_releaseBuffer(t){return t.references--,0===t.references&&(this._deleteBuffer(t),!0)}_deleteBuffer(t){this._gl.deleteBuffer(t.underlyingResource)}updateAndBindInstancesBuffer(t,e,s){if(this.bindArrayBuffer(t),e&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e),void 0!==s[0].index)this.bindInstancesBuffer(t,s,!0);else for(let e=0;e<4;e++){const r=s[e];this._vertexAttribArraysEnabled[r]||(this._gl.enableVertexAttribArray(r),this._vertexAttribArraysEnabled[r]=!0),this._vertexAttribPointer(t,r,4,this._gl.FLOAT,!1,64,16*e),this._gl.vertexAttribDivisor(r,1),this._currentInstanceLocations.push(r),this._currentInstanceBuffers.push(t)}}bindInstancesBuffer(t,e,s=!0){this.bindArrayBuffer(t);let r=0;if(s)for(let t=0;t<e.length;t++)r+=4*e[t].attributeSize;for(let s=0;s<e.length;s++){const i=e[s];void 0===i.index&&(i.index=this._currentEffect.getAttributeLocationByName(i.attributeName)),i.index<0||(this._vertexAttribArraysEnabled[i.index]||(this._gl.enableVertexAttribArray(i.index),this._vertexAttribArraysEnabled[i.index]=!0),this._vertexAttribPointer(t,i.index,i.attributeSize,i.attributeType||this._gl.FLOAT,i.normalized||!1,r,i.offset),this._gl.vertexAttribDivisor(i.index,void 0===i.divisor?1:i.divisor),this._currentInstanceLocations.push(i.index),this._currentInstanceBuffers.push(t))}}disableInstanceAttributeByName(t){if(!this._currentEffect)return;const e=this._currentEffect.getAttributeLocationByName(t);this.disableInstanceAttribute(e)}disableInstanceAttribute(t){let e,s=!1;for(;-1!==(e=this._currentInstanceLocations.indexOf(t));)this._currentInstanceLocations.splice(e,1),this._currentInstanceBuffers.splice(e,1),s=!0,e=this._currentInstanceLocations.indexOf(t);s&&(this._gl.vertexAttribDivisor(t,0),this.disableAttributeByIndex(t))}disableAttributeByIndex(t){this._gl.disableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!1,this._currentBufferPointers[t].active=!1}draw(t,e,s,r){this.drawElementsType(t?0:1,e,s,r)}drawPointClouds(t,e,s){this.drawArraysType(2,t,e,s)}drawUnIndexed(t,e,s,r){this.drawArraysType(t?0:1,e,s,r)}drawElementsType(t,e,s,r){this.applyStates(),this._reportDrawCall();const i=this._drawMode(t),n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(i,s,n,e*a,r):this._gl.drawElements(i,s,n,e*a)}drawArraysType(t,e,s,r){this.applyStates(),this._reportDrawCall();const i=this._drawMode(t);r?this._gl.drawArraysInstanced(i,e,s,r):this._gl.drawArrays(i,e,s)}_drawMode(t){switch(t){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_reportDrawCall(){}_releaseEffect(t){this._compiledEffects[t._key]&&delete this._compiledEffects[t._key];const e=t.getPipelineContext();e&&this._deletePipelineContext(e)}_deletePipelineContext(t){const e=t;e&&e.program&&(e.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(e.program))}_getGlobalDefines(t){if(t)return this.isNDCHalfZRange?t.IS_NDC_HALF_ZRANGE="":delete t.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?t.USE_REVERSE_DEPTHBUFFER="":delete t.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?t.USE_EXACT_SRGB_CONVERSIONS="":delete t.USE_EXACT_SRGB_CONVERSIONS);{let t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}createEffect(t,e,s,r,n,a,o,h,l,_=d.x.GLSL){var c;const u=t.vertexElement||t.vertex||t.vertexToken||t.vertexSource||t,g=t.fragmentElement||t.fragment||t.fragmentToken||t.fragmentSource||t,f=this._getGlobalDefines();let p=null!==(c=null!=n?n:e.defines)&&void 0!==c?c:"";f&&(p+=f);const m=u+"+"+g+"@"+p;if(this._compiledEffects[m]){const t=this._compiledEffects[m];return o&&t.isReady()&&o(t),t}const R=new i.Q(t,e,s,r,this,n,a,o,h,l,m,_);return this._compiledEffects[m]=R,R}static _ConcatenateShader(t,e,s=""){return s+(e?e+"\n":"")+t}_compileShader(t,e,s,r){return this._compileRawShader(S._ConcatenateShader(t,s,r),e)}_compileRawShader(t,e){const s=this._gl,r=s.createShader("vertex"===e?s.VERTEX_SHADER:s.FRAGMENT_SHADER);if(!r){let t=s.NO_ERROR,r=s.NO_ERROR;for(;(r=s.getError())!==s.NO_ERROR;)t=r;throw new Error(`Something went wrong while creating a gl ${e} shader object. gl error=${t}, gl isContextLost=${s.isContextLost()}, _contextWasLost=${this._contextWasLost}`)}return s.shaderSource(r,t),s.compileShader(r),r}_getShaderSource(t){return this._gl.getShaderSource(t)}createRawShaderProgram(t,e,s,r,i=null){r=r||this._gl;const n=this._compileRawShader(e,"vertex"),a=this._compileRawShader(s,"fragment");return this._createShaderProgram(t,n,a,r,i)}createShaderProgram(t,e,s,r,i,n=null){i=i||this._gl;const a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",o=this._compileShader(e,"vertex",r,a),h=this._compileShader(s,"fragment",r,a);return this._createShaderProgram(t,o,h,i,n)}inlineShaderCode(t){return t}createPipelineContext(t){const e=new R;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e}createMaterialContext(){}createDrawContext(){}_createShaderProgram(t,e,s,r,i=null){const n=r.createProgram();if(t.program=n,!n)throw new Error("Unable to create program");return r.attachShader(n,e),r.attachShader(n,s),r.linkProgram(n),t.context=r,t.vertexShader=e,t.fragmentShader=s,t.isParallelCompiled||this._finalizePipelineContext(t),n}_finalizePipelineContext(t){const e=t.context,s=t.vertexShader,r=t.fragmentShader,i=t.program;if(!e.getProgramParameter(i,e.LINK_STATUS)){if(!this._gl.getShaderParameter(s,this._gl.COMPILE_STATUS)){const e=this._gl.getShaderInfoLog(s);if(e)throw t.vertexCompilationError=e,new Error("VERTEX SHADER "+e)}if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)){const e=this._gl.getShaderInfoLog(r);if(e)throw t.fragmentCompilationError=e,new Error("FRAGMENT SHADER "+e)}const n=e.getProgramInfoLog(i);if(n)throw t.programLinkError=n,new Error(n)}if(this.validateShaderPrograms&&(e.validateProgram(i),!e.getProgramParameter(i,e.VALIDATE_STATUS))){const s=e.getProgramInfoLog(i);if(s)throw t.programValidationError=s,new Error(s)}e.deleteShader(s),e.deleteShader(r),t.vertexShader=void 0,t.fragmentShader=void 0,t.onCompiled&&(t.onCompiled(),t.onCompiled=void 0)}_preparePipelineContext(t,e,s,r,i,n,a,o,h,l){const _=t;_.program=r?this.createRawShaderProgram(_,e,s,void 0,h):this.createShaderProgram(_,e,s,o,void 0,h),_.program.__SPECTOR_rebuildProgram=a}_isRenderingStateCompiled(t){const e=t;return!!this._gl.getProgramParameter(e.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(e),!0)}_executeWhenRenderingStateIsCompiled(t,e){const s=t;if(!s.isParallelCompiled)return void e();const r=s.onCompiled;s.onCompiled=r?()=>{r(),e()}:e}getUniforms(t,e){const s=new Array,r=t;for(let t=0;t<e.length;t++)s.push(this._gl.getUniformLocation(r.program,e[t]));return s}getAttributes(t,e){const s=[],r=t;for(let t=0;t<e.length;t++)try{s.push(this._gl.getAttribLocation(r.program,e[t]))}catch(t){s.push(-1)}return s}enableEffect(t){(t=null!==t&&E.q.IsWrapper(t)?t.effect:t)&&t!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(t),this._currentEffect=t,t.onBind&&t.onBind(t),t._onBindObservable&&t._onBindObservable.notifyObservers(t))}setInt(t,e){return!!t&&(this._gl.uniform1i(t,e),!0)}setInt2(t,e,s){return!!t&&(this._gl.uniform2i(t,e,s),!0)}setInt3(t,e,s,r){return!!t&&(this._gl.uniform3i(t,e,s,r),!0)}setInt4(t,e,s,r,i){return!!t&&(this._gl.uniform4i(t,e,s,r,i),!0)}setIntArray(t,e){return!!t&&(this._gl.uniform1iv(t,e),!0)}setIntArray2(t,e){return!(!t||e.length%2!=0||(this._gl.uniform2iv(t,e),0))}setIntArray3(t,e){return!(!t||e.length%3!=0||(this._gl.uniform3iv(t,e),0))}setIntArray4(t,e){return!(!t||e.length%4!=0||(this._gl.uniform4iv(t,e),0))}setUInt(t,e){return!!t&&(this._gl.uniform1ui(t,e),!0)}setUInt2(t,e,s){return!!t&&(this._gl.uniform2ui(t,e,s),!0)}setUInt3(t,e,s,r){return!!t&&(this._gl.uniform3ui(t,e,s,r),!0)}setUInt4(t,e,s,r,i){return!!t&&(this._gl.uniform4ui(t,e,s,r,i),!0)}setUIntArray(t,e){return!!t&&(this._gl.uniform1uiv(t,e),!0)}setUIntArray2(t,e){return!(!t||e.length%2!=0||(this._gl.uniform2uiv(t,e),0))}setUIntArray3(t,e){return!(!t||e.length%3!=0||(this._gl.uniform3uiv(t,e),0))}setUIntArray4(t,e){return!(!t||e.length%4!=0||(this._gl.uniform4uiv(t,e),0))}setArray(t,e){return!(!t||e.length<1||(this._gl.uniform1fv(t,e),0))}setArray2(t,e){return!(!t||e.length%2!=0||(this._gl.uniform2fv(t,e),0))}setArray3(t,e){return!(!t||e.length%3!=0||(this._gl.uniform3fv(t,e),0))}setArray4(t,e){return!(!t||e.length%4!=0||(this._gl.uniform4fv(t,e),0))}setMatrices(t,e){return!!t&&(this._gl.uniformMatrix4fv(t,!1,e),!0)}setMatrix3x3(t,e){return!!t&&(this._gl.uniformMatrix3fv(t,!1,e),!0)}setMatrix2x2(t,e){return!!t&&(this._gl.uniformMatrix2fv(t,!1,e),!0)}setFloat(t,e){return!!t&&(this._gl.uniform1f(t,e),!0)}setFloat2(t,e,s){return!!t&&(this._gl.uniform2f(t,e,s),!0)}setFloat3(t,e,s,r){return!!t&&(this._gl.uniform3f(t,e,s,r),!0)}setFloat4(t,e,s,r,i){return!!t&&(this._gl.uniform4f(t,e,s,r,i),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const t=this._colorWrite;this._gl.colorMask(t,t,t,t)}}setColorWrite(t){t!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=t)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}clearInternalTexturesCache(){this._internalTexturesCache.length=0}wipeCaches(t){this.preventCacheWipeBetweenFrames&&!t||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),t&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(t,e){const s=this._gl;let r=s.NEAREST,i=s.NEAREST;switch(t){case 11:r=s.LINEAR,i=e?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 3:r=s.LINEAR,i=e?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 8:r=s.NEAREST,i=e?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 4:r=s.NEAREST,i=e?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 5:r=s.NEAREST,i=e?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 6:r=s.NEAREST,i=e?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 7:r=s.NEAREST,i=s.LINEAR;break;case 1:r=s.NEAREST,i=s.NEAREST;break;case 9:r=s.LINEAR,i=e?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 10:r=s.LINEAR,i=e?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 2:r=s.LINEAR,i=s.LINEAR;break;case 12:r=s.LINEAR,i=s.NEAREST}return{min:i,mag:r}}_createTexture(){const t=this._gl.createTexture();if(!t)throw new Error("Unable to create texture");return t}_createHardwareTexture(){return new x.B(this._createTexture(),this._gl)}_createInternalTexture(t,e,s=!0,r=_.S.Unknown){var i;let n=!1,a=0,o=3,h=5,l=!1,u=1;void 0!==e&&"object"==typeof e?(n=!!e.generateMipMaps,a=void 0===e.type?0:e.type,o=void 0===e.samplingMode?3:e.samplingMode,h=void 0===e.format?5:e.format,l=void 0!==e.useSRGBBuffer&&e.useSRGBBuffer,u=null!==(i=e.samples)&&void 0!==i?i:1):n=!!e,l&&(l=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==a||this._caps.textureFloatLinearFiltering)&&(2!==a||this._caps.textureHalfFloatLinearFiltering)||(o=1),1!==a||this._caps.textureFloat||(a=0,c.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const d=this._gl,g=new _.l(this,r),f=t.width||t,p=t.height||t,m=t.layers||0,R=this._getSamplingParameters(o,n),T=0!==m?d.TEXTURE_2D_ARRAY:d.TEXTURE_2D,x=this._getRGBABufferInternalSizedFormat(a,h,l),E=this._getInternalFormat(h),y=this._getWebGLTextureType(a);return this._bindTextureDirectly(T,g),0!==m?(g.is2DArray=!0,d.texImage3D(T,0,x,f,p,m,0,E,y,null)):d.texImage2D(T,0,x,f,p,0,E,y,null),d.texParameteri(T,d.TEXTURE_MAG_FILTER,R.mag),d.texParameteri(T,d.TEXTURE_MIN_FILTER,R.min),d.texParameteri(T,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(T,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),n&&this._gl.generateMipmap(T),this._bindTextureDirectly(T,null),g._useSRGBBuffer=l,g.baseWidth=f,g.baseHeight=p,g.width=f,g.height=p,g.depth=m,g.isReady=!0,g.samples=u,g.generateMipMaps=n,g.samplingMode=o,g.type=a,g.format=h,this._internalTexturesCache.push(g),g}_getUseSRGBBuffer(t,e){return t&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||e)}_createTextureBase(t,e,s,i,n=3,a=null,o=null,h,l,u=null,d=null,g=null,f=null,p,m,R){const T="data:"===(t=t||"").substr(0,5),x="blob:"===t.substr(0,5),E=T&&-1!==t.indexOf(";base64,"),y=d||new _.l(this,_.S.Url),b=t;!this._transformTextureUrl||E||d||u||(t=this._transformTextureUrl(t)),b!==t&&(y._originalUrl=b);const A=t.lastIndexOf(".");let C=f||(A>-1?t.substring(A).toLowerCase():""),F=null;C.indexOf("?")>-1&&(C=C.split("?")[0]);for(const t of S._TextureLoaders)if(t.canLoad(C,p)){F=t;break}i&&i.addPendingData(y),y.url=t,y.generateMipMaps=!e,y.samplingMode=n,y.invertY=s,y._useSRGBBuffer=this._getUseSRGBBuffer(!!R,e),this._doNotHandleContextLost||(y._buffer=u);let w=null;a&&!d&&(w=y.onLoadedObservable.add(a)),d||this._internalTexturesCache.push(y);const v=(s,_)=>{i&&i.removePendingData(y),t===b?(w&&y.onLoadedObservable.remove(w),r.l.UseFallbackTexture&&this._createTextureBase(r.l.FallbackTexture,e,y.invertY,i,n,null,o,h,l,u,y),s=(s||"Unknown error")+(r.l.UseFallbackTexture?" - Fallback texture was used":""),y.onErrorObservable.notifyObservers({message:s,exception:_}),o&&o(s,_)):(c.Y.Warn(`Failed to load ${t}, falling back to ${b}`),this._createTextureBase(b,e,y.invertY,i,n,a,o,h,l,u,y,g,f,p,m,R))};if(F){const e=t=>{F.loadData(t,y,((t,e,s,r,a,o)=>{o?v("TextureLoader failed to load data"):h(y,C,i,{width:t,height:e},y.invertY,!s,r,(()=>(a(),!1)),n)}),m)};u?u instanceof ArrayBuffer?e(new Uint8Array(u)):ArrayBuffer.isView(u)?e(u):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(t=>e(new Uint8Array(t))),void 0,i?i.offlineProvider:void 0,!0,((t,e)=>{v("Unable to load "+(t&&t.responseURL,e))}))}else{const s=t=>{x&&!this._doNotHandleContextLost&&(y._buffer=t),h(y,C,i,t,y.invertY,e,!1,l,n)};!T||E?u&&("string"==typeof u.decoding||u.close)?s(u):S._FileToolsLoadImage(t,s,v,i?i.offlineProvider:null,p,y.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?S._FileToolsLoadImage(u,s,v,i?i.offlineProvider:null,p,y.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):u&&s(u)}return y}createTexture(t,e,s,r,i=3,n=null,a=null,o=null,h=null,l=null,c=null,u,d,g,f){return this._createTextureBase(t,e,s,r,i,n,a,this._prepareWebGLTexture.bind(this),((t,e,s,i,n,a)=>{const o=this._gl,h=s.width===t&&s.height===e,c=l?this._getInternalFormat(l,n._useSRGBBuffer):".jpg"!==i||n._useSRGBBuffer?n._useSRGBBuffer?o.SRGB8_ALPHA8:o.RGBA:o.RGB;let u=l?this._getInternalFormat(l):".jpg"!==i||n._useSRGBBuffer?o.RGBA:o.RGB;if(n._useSRGBBuffer&&1===this.webGLVersion&&(u=c),h)return o.texImage2D(o.TEXTURE_2D,0,c,u,o.UNSIGNED_BYTE,s),!1;const d=this._caps.maxTextureSize;if(s.width>d||s.height>d||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext||(this._workingCanvas.width=t,this._workingCanvas.height=e,this._workingContext.drawImage(s,0,0,s.width,s.height,0,0,t,e),o.texImage2D(o.TEXTURE_2D,0,c,u,o.UNSIGNED_BYTE,this._workingCanvas),n.width=t,n.height=e,1));{const t=new _.l(this,_.S.Temp);this._bindTextureDirectly(o.TEXTURE_2D,t,!0),o.texImage2D(o.TEXTURE_2D,0,c,u,o.UNSIGNED_BYTE,s),this._rescaleTexture(t,n,r,c,(()=>{this._releaseTexture(t),this._bindTextureDirectly(o.TEXTURE_2D,n,!0),a()}))}return!0}),o,h,l,c,u,d,f)}static _FileToolsLoadImage(t,e,s,r,i,a){throw(0,n.S)("FileTools")}_rescaleTexture(t,e,s,r,i){}createRawTexture(t,e,s,r,i,a,o,h=null,l=0,_=0,c=!1){throw(0,n.S)("Engine.RawTexture")}createRawCubeTexture(t,e,s,r,i,a,o,h=null){throw(0,n.S)("Engine.RawTexture")}createRawTexture3D(t,e,s,r,i,a,o,h,l=null,_=0){throw(0,n.S)("Engine.RawTexture")}createRawTexture2DArray(t,e,s,r,i,a,o,h,l=null,_=0){throw(0,n.S)("Engine.RawTexture")}_unpackFlipY(t){this._unpackFlipYCached!==t&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,t?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=t))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(t){return t.isCube?this._gl.TEXTURE_CUBE_MAP:t.is3D?this._gl.TEXTURE_3D:t.is2DArray||t.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(t,e,s=!1){const r=this._getTextureTarget(e),i=this._getSamplingParameters(t,e.useMipMaps||s);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,i.mag,e),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,i.min),s&&(e.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),e.samplingMode=t}updateTextureDimensions(t,e,s,r=1){}updateTextureWrappingMode(t,e,s=null,r=null){const i=this._getTextureTarget(t);null!==e&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(e),t),t._cachedWrapU=e),null!==s&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(s),t),t._cachedWrapV=s),(t.is2DArray||t.is3D)&&null!==r&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),t),t._cachedWrapR=r),this._bindTextureDirectly(i,null)}_setupDepthStencilTexture(t,e,s,r,i,n=1){const a=e.width||e,o=e.height||e,h=e.layers||0;t.baseWidth=a,t.baseHeight=o,t.width=a,t.height=o,t.is2DArray=h>0,t.depth=h,t.isReady=!0,t.samples=n,t.generateMipMaps=!1,t.samplingMode=r?2:1,t.type=0,t._comparisonFunction=i;const l=this._gl,_=this._getTextureTarget(t),c=this._getSamplingParameters(t.samplingMode,!1);l.texParameteri(_,l.TEXTURE_MAG_FILTER,c.mag),l.texParameteri(_,l.TEXTURE_MIN_FILTER,c.min),l.texParameteri(_,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(_,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===i?(l.texParameteri(_,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(_,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(_,l.TEXTURE_COMPARE_FUNC,i),l.texParameteri(_,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)))}_uploadCompressedDataToTextureDirectly(t,e,s,r,i,n=0,a=0){const o=this._gl;let h=o.TEXTURE_2D;if(t.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+n),t._useSRGBBuffer)switch(e){case 37492:case 36196:this._caps.etc2?e=o.COMPRESSED_SRGB8_ETC2:t._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?e=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:t._useSRGBBuffer=!1;break;case 36492:e=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:e=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?e=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:t._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?e=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:t._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?e=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:t._useSRGBBuffer=!1;break;default:t._useSRGBBuffer=!1}this._gl.compressedTexImage2D(h,a,e,s,r,0,i)}_uploadDataToTextureDirectly(t,e,s=0,r=0,i,n=!1){const a=this._gl,o=this._getWebGLTextureType(t.type),h=this._getInternalFormat(t.format),l=void 0===i?this._getRGBABufferInternalSizedFormat(t.type,t.format,t._useSRGBBuffer):this._getInternalFormat(i,t._useSRGBBuffer);this._unpackFlipY(t.invertY);let _=a.TEXTURE_2D;t.isCube&&(_=a.TEXTURE_CUBE_MAP_POSITIVE_X+s);const c=Math.round(Math.log(t.width)*Math.LOG2E),u=Math.round(Math.log(t.height)*Math.LOG2E),d=n?t.width:Math.pow(2,Math.max(c-r,0)),g=n?t.height:Math.pow(2,Math.max(u-r,0));a.texImage2D(_,r,l,d,g,0,h,o,e)}updateTextureData(t,e,s,r,i,n,a=0,o=0,h=!1){const l=this._gl,_=this._getWebGLTextureType(t.type),c=this._getInternalFormat(t.format);this._unpackFlipY(t.invertY);let u=l.TEXTURE_2D,d=l.TEXTURE_2D;t.isCube&&(d=l.TEXTURE_CUBE_MAP_POSITIVE_X+a,u=l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(u,t,!0),l.texSubImage2D(d,o,s,r,i,n,c,_,e),h&&this._gl.generateMipmap(d),this._bindTextureDirectly(u,null)}_uploadArrayBufferViewToTexture(t,e,s=0,r=0){const i=this._gl,n=t.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(n,t,!0),this._uploadDataToTextureDirectly(t,e,s,r),this._bindTextureDirectly(n,null,!0)}_prepareWebGLTextureContinuation(t,e,s,r,i){const n=this._gl;if(!n)return;const a=this._getSamplingParameters(i,!s);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,a.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,a.min),s||r||n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),e&&e.removePendingData(t),t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear()}_prepareWebGLTexture(t,e,s,r,i,n,a,o,h=3){const l=this.getCaps().maxTextureSize,_=Math.min(l,this.needPOTTextures?S.GetExponentOfTwo(r.width,l):r.width),c=Math.min(l,this.needPOTTextures?S.GetExponentOfTwo(r.height,l):r.height),u=this._gl;u&&(t._hardwareTexture?(this._bindTextureDirectly(u.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===i||!!i),t.baseWidth=r.width,t.baseHeight=r.height,t.width=_,t.height=c,t.isReady=!0,o(_,c,r,e,t,(()=>{this._prepareWebGLTextureContinuation(t,s,n,a,h)}))||this._prepareWebGLTextureContinuation(t,s,n,a,h)):s&&s.removePendingData(t))}_setupFramebufferDepthAttachments(t,e,s,r,i=1){const n=this._gl;if(t&&e)return this._createRenderBuffer(s,r,i,n.DEPTH_STENCIL,n.DEPTH24_STENCIL8,n.DEPTH_STENCIL_ATTACHMENT);if(e){let t=n.DEPTH_COMPONENT16;return this._webGLVersion>1&&(t=n.DEPTH_COMPONENT32F),this._createRenderBuffer(s,r,i,t,t,n.DEPTH_ATTACHMENT)}return t?this._createRenderBuffer(s,r,i,n.STENCIL_INDEX8,n.STENCIL_INDEX8,n.STENCIL_ATTACHMENT):null}_createRenderBuffer(t,e,s,r,i,n,a=!0){const o=this._gl.createRenderbuffer();return this._updateRenderBuffer(o,t,e,s,r,i,n,a)}_updateRenderBuffer(t,e,s,r,i,n,a,o=!0){const h=this._gl;return h.bindRenderbuffer(h.RENDERBUFFER,t),r>1&&h.renderbufferStorageMultisample?h.renderbufferStorageMultisample(h.RENDERBUFFER,r,n,e,s):h.renderbufferStorage(h.RENDERBUFFER,i,e,s),h.framebufferRenderbuffer(h.FRAMEBUFFER,a,h.RENDERBUFFER,t),o&&h.bindRenderbuffer(h.RENDERBUFFER,null),t}_releaseTexture(t){var e;this._deleteTexture(null===(e=t._hardwareTexture)||void 0===e?void 0:e.underlyingResource),this.unbindAllTextures();const s=this._internalTexturesCache.indexOf(t);-1!==s&&this._internalTexturesCache.splice(s,1),t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureLow&&t._lodTextureLow.dispose(),t._irradianceTexture&&t._irradianceTexture.dispose()}_releaseRenderTargetWrapper(t){const e=this._renderTargetWrapperCache.indexOf(t);-1!==e&&this._renderTargetWrapperCache.splice(e,1)}_deleteTexture(t){t&&this._gl.deleteTexture(t)}_setProgram(t){this._currentProgram!==t&&(this._gl.useProgram(t),this._currentProgram=t)}bindSamplers(t){const e=t.getPipelineContext();this._setProgram(e.program);const s=t.getSamplers();for(let e=0;e<s.length;e++){const r=t.getUniform(s[e]);r&&(this._boundUniforms[e]=r)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(t,e,s=!1,r=!1){var i,n;let a=!1;const o=e&&e._associatedChannel>-1;if(s&&o&&(this._activeChannel=e._associatedChannel),this._boundTexturesCache[this._activeChannel]!==e||r){if(this._activateCurrentTexture(),e&&e.isMultiview)throw console.error(t,e),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(t,null!==(n=null===(i=null==e?void 0:e._hardwareTexture)||void 0===i?void 0:i.underlyingResource)&&void 0!==n?n:null),this._boundTexturesCache[this._activeChannel]=e,e&&(e._associatedChannel=this._activeChannel)}else s&&(a=!0,this._activateCurrentTexture());return o&&!s&&this._bindSamplerUniformToChannel(e._associatedChannel,this._activeChannel),a}_bindTexture(t,e,s){if(void 0===t)return;e&&(e._associatedChannel=t),this._activeChannel=t;const r=e?this._getTextureTarget(e):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,e)}unbindAllTextures(){for(let t=0;t<this._maxSimultaneousTextures;t++)this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(t,e,s,r){void 0!==t&&(e&&(this._boundUniforms[t]=e),this._setTexture(t,s))}_bindSamplerUniformToChannel(t,e){const s=this._boundUniforms[t];s&&s._currentState!==e&&(this._gl.uniform1i(s,e),s._currentState=e)}_getTextureWrapMode(t){switch(t){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(t,e,s=!1,r=!1,i=""){if(!e)return null!=this._boundTexturesCache[t]&&(this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(e.video)this._activeChannel=t,e.update();else if(4===e.delayLoadState)return e.delayLoad(),!1;let n;n=r?e.depthStencilTexture:e.isReady()?e.getInternalTexture():e.isCube?this.emptyCubeTexture:e.is3D?this.emptyTexture3D:e.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!s&&n&&(n._associatedChannel=t);let a=!0;this._boundTexturesCache[t]===n&&(s||this._bindSamplerUniformToChannel(n._associatedChannel,t),a=!1),this._activeChannel=t;const o=this._getTextureTarget(n);if(a&&this._bindTextureDirectly(o,n,s),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==e.coordinatesMode){n._cachedCoordinatesMode=e.coordinatesMode;const t=3!==e.coordinatesMode&&5!==e.coordinatesMode?1:0;e.wrapU=t,e.wrapV=t}n._cachedWrapU!==e.wrapU&&(n._cachedWrapU=e.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(e.wrapU),n)),n._cachedWrapV!==e.wrapV&&(n._cachedWrapV=e.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(e.wrapV),n)),n.is3D&&n._cachedWrapR!==e.wrapR&&(n._cachedWrapR=e.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(e.wrapR),n)),this._setAnisotropicLevel(o,n,e.anisotropicFilteringLevel)}return!0}setTextureArray(t,e,s,r){if(void 0!==t&&e){this._textureUnits&&this._textureUnits.length===s.length||(this._textureUnits=new Int32Array(s.length));for(let e=0;e<s.length;e++){const r=s[e].getInternalTexture();r?(this._textureUnits[e]=t+e,r._associatedChannel=t+e):this._textureUnits[e]=-1}this._gl.uniform1iv(e,this._textureUnits);for(let t=0;t<s.length;t++)this._setTexture(this._textureUnits[t],s[t],!0)}}_setAnisotropicLevel(t,e,s){const r=this._caps.textureAnisotropicFilterExtension;11!==e.samplingMode&&3!==e.samplingMode&&2!==e.samplingMode&&(s=1),r&&e._cachedAnisotropicFilteringLevel!==s&&(this._setTextureParameterFloat(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s,this._caps.maxAnisotropy),e),e._cachedAnisotropicFilteringLevel=s)}_setTextureParameterFloat(t,e,s,r){this._bindTextureDirectly(t,r,!0,!0),this._gl.texParameterf(t,e,s)}_setTextureParameterInteger(t,e,s,r){r&&this._bindTextureDirectly(t,r,!0,!0),this._gl.texParameteri(t,e,s)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let t=0;t<this._caps.maxVertexAttribs;t++)this.disableAttributeByIndex(t)}else for(let t=0,e=this._vertexAttribArraysEnabled.length;t<e;t++)t>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[t]||this.disableAttributeByIndex(t)}releaseEffects(){for(const t in this._compiledEffects){const e=this._compiledEffects[t].getPipelineContext();this._deletePipelineContext(e)}this._compiledEffects={}}dispose(){var t;this._isDisposed=!0,this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(t=this.releaseComputeEffects)||void 0===t||t.call(this),this.unbindAllAttributes(),this._boundUniforms={},(0,u.CG)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,i.Q.ResetCache();for(const t of this._activeRequests)t.abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}attachContextLostEvent(t){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",t,!1)}attachContextRestoredEvent(t){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",t,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(t){const e=this._gl;for(;e.getError()!==e.NO_ERROR;);let s=!0;const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(t),1,1,0,e.RGBA,this._getWebGLTextureType(t),null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(s=s&&n===e.FRAMEBUFFER_COMPLETE,s=s&&e.getError()===e.NO_ERROR,s&&(e.clear(e.COLOR_BUFFER_BIT),s=s&&e.getError()===e.NO_ERROR),s){e.bindFramebuffer(e.FRAMEBUFFER,null);const t=e.RGBA,r=e.UNSIGNED_BYTE,i=new Uint8Array(4);e.readPixels(0,0,1,1,t,r,i),s=s&&e.getError()===e.NO_ERROR}for(e.deleteTexture(r),e.deleteFramebuffer(i),e.bindFramebuffer(e.FRAMEBUFFER,null);!s&&e.getError()!==e.NO_ERROR;);return s}_getWebGLTextureType(t){if(1===this._webGLVersion){switch(t){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(t){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(t,e=!1){let s=e?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(t){case 0:s=this._gl.ALPHA;break;case 1:s=this._gl.LUMINANCE;break;case 2:s=this._gl.LUMINANCE_ALPHA;break;case 6:s=this._gl.RED;break;case 7:s=this._gl.RG;break;case 4:s=e?this._gl.SRGB:this._gl.RGB;break;case 5:s=e?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(t){case 8:s=this._gl.RED_INTEGER;break;case 9:s=this._gl.RG_INTEGER;break;case 10:s=this._gl.RGB_INTEGER;break;case 11:s=this._gl.RGBA_INTEGER}return s}_getRGBABufferInternalSizedFormat(t,e,s=!1){if(1===this._webGLVersion){if(void 0!==e)switch(e){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return s?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(t){case 3:switch(e){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(e){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return s?this._gl.SRGB8:this._gl.RGB8;case 5:return s?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(e){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(e){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(e){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(e){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(e){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(e){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(e){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return s?this._gl.SRGB8_ALPHA8:this._gl.RGBA8}_getRGBAMultiSampleBufferFormat(t){return 1===t?this._gl.RGBA32F:2===t?this._gl.RGBA16F:this._gl.RGBA8}_loadFile(t,e,s,r,i,n){const a=S._FileToolsLoadFile(t,e,s,r,i,n);return this._activeRequests.push(a),a.onCompleteObservable.add((t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)})),a}static _FileToolsLoadFile(t,e,s,r,i,a){throw(0,n.S)("FileTools")}readPixels(t,e,s,r,i=!0,n=!0){const a=i?4:3,o=i?this._gl.RGBA:this._gl.RGB,h=new Uint8Array(r*s*a);return n&&this.flushFramebuffer(),this._gl.readPixels(t,e,s,r,o,this._gl.UNSIGNED_BYTE,h),Promise.resolve(h)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const t=this._CreateCanvas(1,1),e=t.getContext("webgl")||t.getContext("experimental-webgl");this._IsSupported=null!=e&&!!window.WebGLRenderingContext}catch(t){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const t=this._CreateCanvas(1,1),e=t.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||t.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!e}catch(t){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}static CeilingPOT(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}static FloorPOT(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)-(t>>1)}static NearestPOT(t){const e=S.CeilingPOT(t),s=S.FloorPOT(t);return e-t>t-s?s:e}static GetExponentOfTwo(t,e,s=2){let r;switch(s){case 1:r=S.FloorPOT(t);break;case 2:r=S.NearestPOT(t);break;default:r=S.CeilingPOT(t)}return Math.min(r,e)}static QueueNewFrame(t,e){if((0,u.CG)()){const{requestPostAnimationFrame:s,requestAnimationFrame:r}=e||window;if("function"==typeof s)return s(t);if("function"==typeof r)return r(t)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(t);return setTimeout(t,16)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,u.n5)()?document:null}}S.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],S._TextureLoaders=[],S.CollisionsEpsilon=.001,S._IsSupported=null,S._HasMajorPerformanceCaveat=null},3369:(t,e,s)=>{s.d(e,{l:()=>a,S:()=>r});var r,i=s(8139);class n{get wrapU(){return this._cachedWrapU}set wrapU(t){this._cachedWrapU=t}get wrapV(){return this._cachedWrapV}set wrapV(t){this._cachedWrapV=t}get wrapR(){return this._cachedWrapR}set wrapR(t){this._cachedWrapR=t}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(t){this._cachedAnisotropicFilteringLevel=t}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(t){this._comparisonFunction=t}get useMipMaps(){return this._useMipMaps}set useMipMaps(t){this._useMipMaps=t}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(t=1,e=1,s=1,r=1,i=2,n=0){return this._cachedWrapU=t,this._cachedWrapV=e,this._cachedWrapR=s,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=i,this._comparisonFunction=n,this}compareSampler(t){return this._cachedWrapU===t._cachedWrapU&&this._cachedWrapV===t._cachedWrapV&&this._cachedWrapR===t._cachedWrapR&&this._cachedAnisotropicFilteringLevel===t._cachedAnisotropicFilteringLevel&&this.samplingMode===t.samplingMode&&this._comparisonFunction===t._comparisonFunction&&this._useMipMaps===t._useMipMaps}}!function(t){t[t.Unknown=0]="Unknown",t[t.Url=1]="Url",t[t.Temp=2]="Temp",t[t.Raw=3]="Raw",t[t.Dynamic=4]="Dynamic",t[t.RenderTarget=5]="RenderTarget",t[t.MultiRenderTarget=6]="MultiRenderTarget",t[t.Cube=7]="Cube",t[t.CubeRaw=8]="CubeRaw",t[t.CubePrefiltered=9]="CubePrefiltered",t[t.Raw3D=10]="Raw3D",t[t.Raw2DArray=11]="Raw2DArray",t[t.DepthStencil=12]="DepthStencil",t[t.CubeRawRGBD=13]="CubeRawRGBD",t[t.Depth=14]="Depth"}(r||(r={}));class a extends n{get useMipMaps(){return this.generateMipMaps}set useMipMaps(t){this.generateMipMaps=t}get uniqueId(){return this._uniqueId}_setUniqueId(t){this._uniqueId=t}getEngine(){return this._engine}get source(){return this._source}constructor(t,e,s=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new i.y$,this.onErrorObservable=new i.y$,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=r.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._engine=t,this._source=e,this._uniqueId=a._Counter++,s||(this._hardwareTexture=t._createHardwareTexture())}incrementReferences(){this._references++}updateSize(t,e,s=1){this._engine.updateTextureDimensions(this,t,e,s),this.width=t,this.height=e,this.depth=s,this.baseWidth=t,this.baseHeight=e,this.baseDepth=s,this._size=t*e*s}_rebuild(){var t;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const t=this.onRebuildCallback(this),e=e=>{e._swapAndDie(this,!1),this.isReady=t.isReady};return void(t.isAsync?t.proxy.then(e):e(t.proxy))}let e;switch(this.source){case r.Temp:break;case r.Url:return void(e=this._engine.createTexture(null!==(t=this._originalUrl)&&void 0!==t?t:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(t=>{t._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case r.Raw:e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer),e._swapAndDie(this,!1),this.isReady=!0;break;case r.Raw3D:e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case r.Raw2DArray:e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),e._swapAndDie(this,!1),this.isReady=!0;break;case r.Dynamic:e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),e._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case r.Cube:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{e._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case r.CubeRaw:e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e._swapAndDie(this,!1),this.isReady=!0;break;case r.CubeRawRGBD:return;case r.CubePrefiltered:return e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(t=>{t&&t._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(e._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(t,e=!0){var s;null===(s=this._hardwareTexture)||void 0===s||s.setUsage(t._source,this.generateMipMaps,this.isCube,this.width,this.height),t._hardwareTexture=this._hardwareTexture,e&&(t._isRGBD=this._isRGBD),this._lodTextureHigh&&(t._lodTextureHigh&&t._lodTextureHigh.dispose(),t._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(t._lodTextureMid&&t._lodTextureMid.dispose(),t._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(t._lodTextureLow&&t._lodTextureLow.dispose(),t._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(t._irradianceTexture&&t._irradianceTexture.dispose(),t._irradianceTexture=this._irradianceTexture);const r=this._engine.getLoadedTexturesCache();let i=r.indexOf(this);-1!==i&&r.splice(i,1),i=r.indexOf(t),-1===i&&r.push(t)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)}}a._Counter=0},7050:(t,e,s)=>{s.d(e,{q:()=>r});class r{static IsWrapper(t){return void 0===t.getPipelineContext}static GetEffect(t){return void 0===t.getPipelineContext?t.effect:t}constructor(t,e=!0){this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),e&&(this.materialContext=t.createMaterialContext())}setEffect(t,e,s=!0){var r;this.effect=t,void 0!==e&&(this.defines=e),s&&(null===(r=this.drawContext)||void 0===r||r.reset())}dispose(){var t;null===(t=this.drawContext)||void 0===t||t.dispose()}}},4442:(t,e,s)=>{s.d(e,{Q:()=>l});var r=s(8139),i=s(1102),n=s(658),a=s(3525),o=s(1206),h=s(475);class l{static get ShadersRepository(){return o.v.ShadersRepository}static set ShadersRepository(t){o.v.ShadersRepository=t}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new r.y$),this._onBindObservable}constructor(t,e,s,n=null,_,c=null,u=null,d=null,g=null,f,p="",m=h.x.GLSL){var R,T,x;let E;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.y$,this.onErrorObservable=new r.y$,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=p;let y,b,A=null;if(e.attributes){const t=e;if(this._engine=s,this._attributesNames=t.attributes,this._uniformsNames=t.uniformsNames.concat(t.samplers),this._samplerList=t.samplers.slice(),this.defines=t.defines,this.onError=t.onError,this.onCompiled=t.onCompiled,this._fallbacks=t.fallbacks,this._indexParameters=t.indexParameters,this._transformFeedbackVaryings=t.transformFeedbackVaryings||null,this._multiTarget=!!t.multiTarget,this._shaderLanguage=null!==(R=t.shaderLanguage)&&void 0!==R?R:h.x.GLSL,t.uniformBuffersNames){this._uniformBuffersNamesList=t.uniformBuffersNames.slice();for(let e=0;e<t.uniformBuffersNames.length;e++)this._uniformBuffersNames[t.uniformBuffersNames[e]]=e}A=null!==(T=t.processFinalCode)&&void 0!==T?T:null,E=null!==(x=t.processCodeAfterIncludes)&&void 0!==x?x:void 0}else this._engine=_,this.defines=null==c?"":c,this._uniformsNames=s.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=e,this._uniformBuffersNamesList=[],this._shaderLanguage=m,this.onError=g,this.onCompiled=d,this._indexParameters=f,this._fallbacks=u;this._attributeLocationByName={},this.uniqueId=l._UniqueIdSeed++;const S=(0,i.CG)()?this._engine.getHostDocument():null;t.vertexSource?y="source:"+t.vertexSource:t.vertexElement?(y=S?S.getElementById(t.vertexElement):null,y||(y=t.vertexElement)):y=t.vertex||t,t.fragmentSource?b="source:"+t.fragmentSource:t.fragmentElement?(b=S?S.getElementById(t.fragmentElement):null,b||(b=t.fragmentElement)):b=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);let C={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:o.v.GetShadersRepository(this._shaderLanguage),includesShadersStore:o.v.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:E};const F=[void 0,void 0],w=()=>{if(F[0]&&F[1]){C.isFragment=!0;const[e,s]=F;a.L.Process(s,C,((s,r)=>{this._fragmentSourceCodeBeforeMigration=r,A&&(s=A("fragment",s));const i=a.L.Finalize(e,s,C);C=null,this._useFinalCode(i.vertexCode,i.fragmentCode,t)}),this._engine)}};this._loadShader(y,"Vertex","",(t=>{a.L.Initialize(C),a.L.Process(t,C,((e,s)=>{this._rawVertexSourceCode=t,this._vertexSourceCodeBeforeMigration=s,A&&(e=A("vertex",e)),F[0]=e,w()}),this._engine)})),this._loadShader(b,"Fragment","Pixel",(t=>{this._rawFragmentSourceCode=t,F[1]=t,w()}));const v=function(t){return function(){return this._pipelineContext&&this._pipelineContext[t].apply(this._pipelineContext,arguments),this}};["Int?","UInt?","IntArray?","UIntArray?","Array?","Color?","Vector?","Float?","Matrices","Matrix","Matrix3x3","Matrix2x2","Quaternion","DirectColor4"].forEach((t=>{const e=`set${t}`;e.endsWith("?")?["",2,3,4].forEach((t=>{this[e.slice(0,-1)+t]=this[e.slice(0,-1)+t]||v(e.slice(0,-1)+t).bind(this)})):this[e]=this[e]||v(e).bind(this)}))}_useFinalCode(t,e,s){if(s){const r=s.vertexElement||s.vertex||s.spectorName||s,i=s.fragmentElement||s.fragment||s.spectorName||s;this._vertexSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME vertex:"+r+"\n"+t,this._fragmentSourceCode=(this._shaderLanguage===h.x.WGSL?"//":"")+"#define SHADER_NAME fragment:"+i+"\n"+e}else this._vertexSourceCode=t,this._fragmentSourceCode=e;this._prepareEffect()}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(t){return!1}}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(t){return this._attributes[t]}getAttributeLocationByName(t){return this._attributeLocationByName[t]}getAttributesCount(){return this._attributes.length}getUniformIndex(t){return this._uniformsNames.indexOf(t)}getUniform(t){return this._uniforms[t]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(t){this.isReady()?t(this):(this.onCompileObservable.add((e=>{t(e)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(t){try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e,t)}this._isDisposed||setTimeout((()=>{this._checkIsReady(t)}),16)}_loadShader(t,e,s,r){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return void r((0,i.v)(t));if("source:"===t.substr(0,7))return void r(t.substr(7));if("base64:"===t.substr(0,7))return void r(window.atob(t.substr(7)));const n=o.v.GetShadersStore(this._shaderLanguage);if(n[t+e+"Shader"])return void r(n[t+e+"Shader"]);if(s&&n[t+s+"Shader"])return void r(n[t+s+"Shader"]);let a;a="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:o.v.GetShadersRepository(this._shaderLanguage)+t,this._engine._loadFile(a+"."+e.toLowerCase()+".fx",r)}get vertexSourceCode(){var t,e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getVertexShaderCode())&&void 0!==e?e:this._vertexSourceCode}get fragmentSourceCode(){var t,e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getFragmentShaderCode())&&void 0!==e?e:this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}_rebuildProgram(t,e,s,r){this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=e,this.onError=(t,e)=>{r&&r(e)},this.onCompiled=()=>{const t=this.getEngine().scenes;if(t)for(let e=0;e<t.length;e++)t[e].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback(s)},this._fallbacks=null,this._prepareEffect()}_prepareEffect(){const t=this._attributesNames,e=this.defines,s=this._pipelineContext;this._isReady=!1;try{const r=this._engine;this._pipelineContext=r.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;const i=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?r._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,i,null,this._transformFeedbackVaryings,this._key):r._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,i,e,this._transformFeedbackVaryings,this._key),r._executeWhenRenderingStateIsCompiled(this._pipelineContext,(()=>{if(this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,t,this._attributes),t)for(let e=0;e<t.length;e++){const s=t[e];this._attributeLocationByName[s]=this._attributes[e]}r.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),s&&this.getEngine()._deletePipelineContext(s)})),this._pipelineContext.isAsync&&this._checkIsReady(s)}catch(t){this._processCompilationErrors(t,s)}}_getShaderCodeAndErrorLine(t,e,s){const r=s?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let i=null;if(e&&t){const n=e.match(r);if(n&&2===n.length){const e=parseInt(n[1]),r=t.split("\n",-1);r.length>=e&&(i=`Offending line [${e}] in ${s?"fragment":"vertex"} code: ${r[e-1]}`)}}return[t,i]}_processCompilationErrors(t,e=null){var s,r,i;this._compilationError=t.message;const a=this._attributesNames,o=this._fallbacks;if(n.Y.Error("Unable to compile effect:"),n.Y.Error("Uniforms: "+this._uniformsNames.map((function(t){return" "+t}))),n.Y.Error("Attributes: "+a.map((function(t){return" "+t}))),n.Y.Error("Defines:\r\n"+this.defines),l.LogShaderCodeOnCompilationError){let t=null,e=null,a=null;(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())&&([a,t]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),a&&(n.Y.Error("Vertex code:"),n.Y.Error(a))),(null===(r=this._pipelineContext)||void 0===r?void 0:r._getFragmentShaderCode())&&([a,e]=this._getShaderCodeAndErrorLine(null===(i=this._pipelineContext)||void 0===i?void 0:i._getFragmentShaderCode(),this._compilationError,!0),a&&(n.Y.Error("Fragment code:"),n.Y.Error(a))),t&&n.Y.Error(t),e&&n.Y.Error(e)}n.Y.Error("Error: "+this._compilationError);const h=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};e&&(this._pipelineContext=e,this._isReady=!0,h()),o?(this._pipelineContext=null,o.hasMoreFallbacks?(this._allFallbacksProcessed=!1,n.Y.Error("Trying next fallback."),this.defines=o.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,h(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,e||h())}get isSupported(){return""===this._compilationError}_bindTexture(t,e){this._engine._bindTexture(this._samplers[t],e,t)}setTexture(t,e){this._engine.setTexture(this._samplers[t],this._uniforms[t],e,t)}setDepthStencilTexture(t,e){this._engine.setDepthStencilTexture(this._samplers[t],this._uniforms[t],e,t)}setTextureArray(t,e){const s=t+"Ex";if(-1===this._samplerList.indexOf(s+"0")){const r=this._samplerList.indexOf(t);for(let t=1;t<e.length;t++){const e=s+(t-1).toString();this._samplerList.splice(r+t,0,e)}let i=0;for(const t of this._samplerList)this._samplers[t]=i,i+=1}this._engine.setTextureArray(this._samplers[t],this._uniforms[t],e,t)}setTextureFromPostProcess(t,e){this._engine.setTextureFromPostProcess(this._samplers[t],e,t)}setTextureFromPostProcessOutput(t,e){this._engine.setTextureFromPostProcessOutput(this._samplers[t],e,t)}bindUniformBuffer(t,e){const s=this._uniformBuffersNames[e];void 0===s||l._BaseCache[s]===t&&this._engine._features.useUBOBindingCache||(l._BaseCache[s]=t,this._engine.bindUniformBufferBase(t,s,e))}bindUniformBlock(t,e){this._engine.bindUniformBlock(this._pipelineContext,t,e)}setFloatArray(t,e){return this._pipelineContext.setArray(t,e),this}setFloatArray2(t,e){return this._pipelineContext.setArray2(t,e),this}setFloatArray3(t,e){return this._pipelineContext.setArray3(t,e),this}setFloatArray4(t,e){return this._pipelineContext.setArray4(t,e),this}setBool(t,e){return this._pipelineContext.setInt(t,e?1:0),this}dispose(){var t;null===(t=this._pipelineContext)||void 0===t||t.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0}static RegisterShader(t,e,s,r=h.x.GLSL){e&&(o.v.GetShadersStore(r)[`${t}PixelShader`]=e),s&&(o.v.GetShadersStore(r)[`${t}VertexShader`]=s)}static ResetCache(){l._BaseCache={}}}l.LogShaderCodeOnCompilationError=!0,l._UniqueIdSeed=0,l._BaseCache={},l.ShadersStore=o.v.ShadersStore,l.IncludesShadersStore=o.v.IncludesShadersStore},475:(t,e,s)=>{var r;s.d(e,{x:()=>r}),function(t){t[t.GLSL=0]="GLSL",t[t.WGSL=1]="WGSL"}(r||(r={}))},5241:(t,e,s)=>{s.d(e,{RD:()=>a,T:()=>r,c7:()=>i});var r,i,n=s(5412);!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD",t[t.BONE=2]="BONE"}(r||(r={}));class a{}a.X=new n.P(1,0,0),a.Y=new n.P(0,1,0),a.Z=new n.P(0,0,1),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(i||(i={}))},2922:(t,e,s)=>{s.d(e,{HE:()=>u,Wo:()=>c,zZ:()=>d});var r=s(1226),i=s(4551),n=s(2554),a=s(646);function o(t){return Math.pow(t,i.Nn)}function h(t){return t<=.04045?.0773993808*t:Math.pow(.947867299*(t+.055),2.4)}function l(t){return Math.pow(t,i.zp)}function _(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class c{constructor(t=0,e=0,s=0){this.r=t,this.g=e,this.b=s}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let t=255*this.r|0;return t=397*t^(255*this.g|0),t=397*t^(255*this.b|0),t}toArray(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,this}fromArray(t,e=0){return c.FromArrayToRef(t,e,this),this}toColor4(t=1){return new u(this.r,this.g,this.b,t)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(t){return new c(this.r*t.r,this.g*t.g,this.b*t.b)}multiplyToRef(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,this}equals(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b}equalsFloats(t,e,s){return this.r===t&&this.g===e&&this.b===s}scale(t){return new c(this.r*t,this.g*t,this.b*t)}scaleInPlace(t){return this.r*=t,this.g*=t,this.b*=t,this}scaleToRef(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,this}scaleAndAddToRef(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,this}clampToRef(t=0,e=1,s){return s.r=r.R.Clamp(this.r,t,e),s.g=r.R.Clamp(this.g,t,e),s.b=r.R.Clamp(this.b,t,e),this}add(t){return new c(this.r+t.r,this.g+t.g,this.b+t.b)}addToRef(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,this}subtract(t){return new c(this.r-t.r,this.g-t.g,this.b-t.b)}subtractToRef(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,this}clone(){return new c(this.r,this.g,this.b)}copyFrom(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyFromFloats(t,e,s){return this.r=t,this.g=e,this.b=s,this}set(t,e,s){return this.copyFromFloats(t,e,s)}toHexString(){const t=Math.round(255*this.r),e=Math.round(255*this.g),s=Math.round(255*this.b);return"#"+r.R.ToHex(t)+r.R.ToHex(e)+r.R.ToHex(s)}toHSV(){const t=new c;return this.toHSVToRef(t),t}toHSVToRef(t){const e=this.r,s=this.g,r=this.b,i=Math.max(e,s,r),n=Math.min(e,s,r);let a=0,o=0;const h=i,l=i-n;0!==i&&(o=l/i),i!=n&&(i==e?(a=(s-r)/l,s<r&&(a+=6)):i==s?a=(r-e)/l+2:i==r&&(a=(e-s)/l+4),a*=60),t.r=a,t.g=o,t.b=h}toLinearSpace(t=!1){const e=new c;return this.toLinearSpaceToRef(e,t),e}toLinearSpaceToRef(t,e=!1){return e?(t.r=h(this.r),t.g=h(this.g),t.b=h(this.b)):(t.r=o(this.r),t.g=o(this.g),t.b=o(this.b)),this}toGammaSpace(t=!1){const e=new c;return this.toGammaSpaceToRef(e,t),e}toGammaSpaceToRef(t,e=!1){return e?(t.r=_(this.r),t.g=_(this.g),t.b=_(this.b)):(t.r=l(this.r),t.g=l(this.g),t.b=l(this.b)),this}static HSVtoRGBToRef(t,e,s,r){const i=s*e,n=t/60,a=i*(1-Math.abs(n%2-1));let o=0,h=0,l=0;n>=0&&n<=1?(o=i,h=a):n>=1&&n<=2?(o=a,h=i):n>=2&&n<=3?(h=i,l=a):n>=3&&n<=4?(h=a,l=i):n>=4&&n<=5?(o=a,l=i):n>=5&&n<=6&&(o=i,l=a);const _=s-i;r.set(o+_,h+_,l+_)}static FromHSV(t,e,s){const r=new c(0,0,0);return c.HSVtoRGBToRef(t,e,s,r),r}static FromHexString(t){if("#"!==t.substring(0,1)||7!==t.length)return new c(0,0,0);const e=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16);return c.FromInts(e,s,r)}static FromArray(t,e=0){return new c(t[e],t[e+1],t[e+2])}static FromArrayToRef(t,e=0,s){s.r=t[e],s.g=t[e+1],s.b=t[e+2]}static FromInts(t,e,s){return new c(t/255,e/255,s/255)}static Lerp(t,e,s){const r=new c(0,0,0);return c.LerpToRef(t,e,s,r),r}static LerpToRef(t,e,s,r){r.r=t.r+(e.r-t.r)*s,r.g=t.g+(e.g-t.g)*s,r.b=t.b+(e.b-t.b)*s}static Hermite(t,e,s,r,i){const n=i*i,a=i*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+i,_=a-n,u=t.r*o+s.r*h+e.r*l+r.r*_,d=t.g*o+s.g*h+e.g*l+r.g*_,g=t.b*o+s.b*h+e.b*l+r.b*_;return new c(u,d,g)}static Hermite1stDerivative(t,e,s,r,i){const n=c.Black();return this.Hermite1stDerivativeToRef(t,e,s,r,i,n),n}static Hermite1stDerivativeToRef(t,e,s,r,i,n){const a=i*i;n.r=6*(a-i)*t.r+(3*a-4*i+1)*e.r+6*(-a+i)*s.r+(3*a-2*i)*r.r,n.g=6*(a-i)*t.g+(3*a-4*i+1)*e.g+6*(-a+i)*s.g+(3*a-2*i)*r.g,n.b=6*(a-i)*t.b+(3*a-4*i+1)*e.b+6*(-a+i)*s.b+(3*a-2*i)*r.b}static Red(){return new c(1,0,0)}static Green(){return new c(0,1,0)}static Blue(){return new c(0,0,1)}static Black(){return new c(0,0,0)}static get BlackReadOnly(){return c._BlackReadOnly}static White(){return new c(1,1,1)}static Purple(){return new c(.5,0,.5)}static Magenta(){return new c(1,0,1)}static Yellow(){return new c(1,1,0)}static Gray(){return new c(.5,.5,.5)}static Teal(){return new c(0,1,1)}static Random(){return new c(Math.random(),Math.random(),Math.random())}}c._BlackReadOnly=c.Black();class u{constructor(t=0,e=0,s=0,r=1){this.r=t,this.g=e,this.b=s,this.a=r}addInPlace(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}asArray(){return[this.r,this.g,this.b,this.a]}toArray(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,this}fromArray(t,e=0){return u.FromArrayToRef(t,e,this),this}equals(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}add(t){return new u(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new u(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}subtractToRef(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,this}scale(t){return new u(this.r*t,this.g*t,this.b*t,this.a*t)}scaleInPlace(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}scaleToRef(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this}scaleAndAddToRef(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,e.a+=this.a*t,this}clampToRef(t=0,e=1,s){return s.r=r.R.Clamp(this.r,t,e),s.g=r.R.Clamp(this.g,t,e),s.b=r.R.Clamp(this.b,t,e),s.a=r.R.Clamp(this.a,t,e),this}multiply(t){return new u(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}multiplyToRef(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,e.a=this.a*t.a,e}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let t=255*this.r|0;return t=397*t^(255*this.g|0),t=397*t^(255*this.b|0),t=397*t^(255*this.a|0),t}clone(){return new u(this.r,this.g,this.b,this.a)}copyFrom(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}copyFromFloats(t,e,s,r){return this.r=t,this.g=e,this.b=s,this.a=r,this}set(t,e,s,r){return this.copyFromFloats(t,e,s,r)}toHexString(t=!1){const e=Math.round(255*this.r),s=Math.round(255*this.g),i=Math.round(255*this.b);if(t)return"#"+r.R.ToHex(e)+r.R.ToHex(s)+r.R.ToHex(i);const n=Math.round(255*this.a);return"#"+r.R.ToHex(e)+r.R.ToHex(s)+r.R.ToHex(i)+r.R.ToHex(n)}toLinearSpace(t=!1){const e=new u;return this.toLinearSpaceToRef(e,t),e}toLinearSpaceToRef(t,e=!1){return e?(t.r=h(this.r),t.g=h(this.g),t.b=h(this.b)):(t.r=o(this.r),t.g=o(this.g),t.b=o(this.b)),t.a=this.a,this}toGammaSpace(t=!1){const e=new u;return this.toGammaSpaceToRef(e,t),e}toGammaSpaceToRef(t,e=!1){return e?(t.r=_(this.r),t.g=_(this.g),t.b=_(this.b)):(t.r=l(this.r),t.g=l(this.g),t.b=l(this.b)),t.a=this.a,this}static FromHexString(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new u(0,0,0,0);const e=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),i=9===t.length?parseInt(t.substring(7,9),16):255;return u.FromInts(e,s,r,i)}static Lerp(t,e,s){const r=new u(0,0,0,0);return u.LerpToRef(t,e,s,r),r}static LerpToRef(t,e,s,r){r.r=t.r+(e.r-t.r)*s,r.g=t.g+(e.g-t.g)*s,r.b=t.b+(e.b-t.b)*s,r.a=t.a+(e.a-t.a)*s}static Hermite(t,e,s,r,i){const n=i*i,a=i*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+i,_=a-n,c=t.r*o+s.r*h+e.r*l+r.r*_,d=t.g*o+s.g*h+e.g*l+r.g*_,g=t.b*o+s.b*h+e.b*l+r.b*_,f=t.a*o+s.a*h+e.a*l+r.a*_;return new u(c,d,g,f)}static Hermite1stDerivative(t,e,s,r,i){const n=new u;return this.Hermite1stDerivativeToRef(t,e,s,r,i,n),n}static Hermite1stDerivativeToRef(t,e,s,r,i,n){const a=i*i;n.r=6*(a-i)*t.r+(3*a-4*i+1)*e.r+6*(-a+i)*s.r+(3*a-2*i)*r.r,n.g=6*(a-i)*t.g+(3*a-4*i+1)*e.g+6*(-a+i)*s.g+(3*a-2*i)*r.g,n.b=6*(a-i)*t.b+(3*a-4*i+1)*e.b+6*(-a+i)*s.b+(3*a-2*i)*r.b,n.a=6*(a-i)*t.a+(3*a-4*i+1)*e.a+6*(-a+i)*s.a+(3*a-2*i)*r.a}static FromColor3(t,e=1){return new u(t.r,t.g,t.b,e)}static FromArray(t,e=0){return new u(t[e],t[e+1],t[e+2],t[e+3])}static FromArrayToRef(t,e=0,s){s.r=t[e],s.g=t[e+1],s.b=t[e+2],s.a=t[e+3]}static FromInts(t,e,s,r){return new u(t/255,e/255,s/255,r/255)}static CheckColors4(t,e){if(t.length===3*e){const e=[];for(let s=0;s<t.length;s+=3){const r=s/3*4;e[r]=t[s],e[r+1]=t[s+1],e[r+2]=t[s+2],e[r+3]=1}return e}return t}}class d{}d.Color3=n.B.BuildArray(3,c.Black),d.Color4=n.B.BuildArray(3,(()=>new u(0,0,0,0))),(0,a.H)("BABYLON.Color3",c),(0,a.H)("BABYLON.Color4",u)},4551:(t,e,s)=>{s.d(e,{Nn:()=>i,Q_:()=>n,kn:()=>a,zp:()=>r});const r=1/2.2,i=2.2,n=(1+Math.sqrt(5))/2,a=.001},8952:(t,e,s)=>{s.d(e,{i:()=>i});var r=s(6504);class i{static GetPlanes(t){const e=[];for(let t=0;t<6;t++)e.push(new r.J(0,0,0,0));return i.GetPlanesToRef(t,e),e}static GetNearPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]+s[2],e.normal.y=s[7]+s[6],e.normal.z=s[11]+s[10],e.d=s[15]+s[14],e.normalize()}static GetFarPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]-s[2],e.normal.y=s[7]-s[6],e.normal.z=s[11]-s[10],e.d=s[15]-s[14],e.normalize()}static GetLeftPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]+s[0],e.normal.y=s[7]+s[4],e.normal.z=s[11]+s[8],e.d=s[15]+s[12],e.normalize()}static GetRightPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]-s[0],e.normal.y=s[7]-s[4],e.normal.z=s[11]-s[8],e.d=s[15]-s[12],e.normalize()}static GetTopPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]-s[1],e.normal.y=s[7]-s[5],e.normal.z=s[11]-s[9],e.d=s[15]-s[13],e.normalize()}static GetBottomPlaneToRef(t,e){const s=t.m;e.normal.x=s[3]+s[1],e.normal.y=s[7]+s[5],e.normal.z=s[11]+s[9],e.d=s[15]+s[13],e.normalize()}static GetPlanesToRef(t,e){i.GetNearPlaneToRef(t,e[0]),i.GetFarPlaneToRef(t,e[1]),i.GetLeftPlaneToRef(t,e[2]),i.GetRightPlaneToRef(t,e[3]),i.GetTopPlaneToRef(t,e[4]),i.GetBottomPlaneToRef(t,e[5])}}},8830:(t,e,s)=>{s.d(e,{RD:()=>r.RD,Wo:()=>i.Wo,HE:()=>i.HE,$B:()=>n.$B,T:()=>r.T,P:()=>a.P,Lt:()=>a.Lt});var r=s(5241),i=s(2922),n=(s(4551),s(8952),s(3118)),a=(s(6504),s(3321),s(5412));s(470)},3118:(t,e,s)=>{s.d(e,{$B:()=>_,ZZ:()=>l});var r,i=s(1226),n=s(5412),a=s(4551);!function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(r||(r={}));class o{constructor(t){this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(t,e){const s=e.subtract(t),r=Math.atan2(s.y,s.x);return new o(r)}static FromRadians(t){return new o(t)}static FromDegrees(t){return new o(t*Math.PI/180)}}class h{constructor(t,e,s){this.startPoint=t,this.midPoint=e,this.endPoint=s;const i=Math.pow(e.x,2)+Math.pow(e.y,2),a=(Math.pow(t.x,2)+Math.pow(t.y,2)-i)/2,h=(i-Math.pow(s.x,2)-Math.pow(s.y,2))/2,l=(t.x-e.x)*(e.y-s.y)-(e.x-s.x)*(t.y-e.y);this.centerPoint=new n.FM((a*(e.y-s.y)-h*(t.y-e.y))/l,((t.x-e.x)*h-(e.x-s.x)*a)/l),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=o.BetweenTwoPoints(this.centerPoint,this.startPoint);const _=this.startAngle.degrees();let c=o.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=o.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-_>180&&(c-=360),c-_<-180&&(c+=360),u-c>180&&(u-=360),u-c<-180&&(u+=360),this.orientation=c-_<0?r.CW:r.CCW,this.angle=o.FromDegrees(this.orientation===r.CW?_-u:u-_)}}class l{constructor(t,e){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n.FM(t,e))}addLineTo(t,e){if(this.closed)return this;const s=new n.FM(t,e),r=this._points[this._points.length-1];return this._points.push(s),this._length+=s.subtract(r).length(),this}addArcTo(t,e,s,i,a=36){if(this.closed)return this;const o=this._points[this._points.length-1],l=new n.FM(t,e),_=new n.FM(s,i),c=new h(o,l,_);let u=c.angle.radians()/a;c.orientation===r.CW&&(u*=-1);let d=c.startAngle.radians()+u;for(let t=0;t<a;t++){const t=Math.cos(d)*c.radius+c.centerPoint.x,e=Math.sin(d)*c.radius+c.centerPoint.y;this.addLineTo(t,e),d+=u}return this}close(){return this.closed=!0,this}length(){let t=this._length;if(this.closed){const e=this._points[this._points.length-1];t+=this._points[0].subtract(e).length()}return t}getPoints(){return this._points}getPointAtLengthPosition(t){if(t<0||t>1)return n.FM.Zero();const e=t*this.length();let s=0;for(let t=0;t<this._points.length;t++){const r=(t+1)%this._points.length,i=this._points[t],a=this._points[r].subtract(i),o=a.length()+s;if(e>=s&&e<=o){const t=a.normalize(),r=e-s;return new n.FM(i.x+t.x*r,i.y+t.y*r)}s=o}return n.FM.Zero()}static StartingAt(t,e){return new l(t,e)}}class _{constructor(t,e=null,s,r=!1){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:n.P.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:n.y3.Identity()};for(let e=0;e<t.length;e++)this._curve[e]=t[e].clone();this._raw=s||!1,this._alignTangentsWithPath=r,this._compute(e,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(t){return this._updatePointAtData(t).point}getTangentAt(t,e=!1){return this._updatePointAtData(t,e),e?n.P.TransformCoordinates(n.P.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(t,e=!1){return this._updatePointAtData(t,e),e?n.P.TransformCoordinates(n.P.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(t,e=!1){return this._updatePointAtData(t,e),e?n.P.TransformCoordinates(n.P.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(t){return this.length()*t}getPreviousPointIndexAt(t){return this._updatePointAtData(t),this._pointAtData.previousPointArrayIndex}getSubPositionAt(t){return this._updatePointAtData(t),this._pointAtData.subPosition}getClosestPositionTo(t){let e=Number.MAX_VALUE,s=0;for(let r=0;r<this._curve.length-1;r++){const i=this._curve[r+0],a=this._curve[r+1].subtract(i).normalize(),o=this._distances[r+1]-this._distances[r+0],h=Math.min(Math.max(n.P.Dot(a,t.subtract(i).normalize()),0)*n.P.Distance(i,t)/o,1),l=n.P.Distance(i.add(a.scale(h*o)),t);l<e&&(e=l,s=(this._distances[r+0]+o*h)/this.length())}return s}slice(t=0,e=1){if(t<0&&(t=1- -1*t%1),e<0&&(e=1- -1*e%1),t>e){const s=t;t=e,e=s}const s=this.getCurve(),r=this.getPointAt(t);let i=this.getPreviousPointIndexAt(t);const n=this.getPointAt(e),a=this.getPreviousPointIndexAt(e)+1,o=[];return 0!==t&&(i++,o.push(r)),o.push(...s.slice(i,a)),1===e&&1!==t||o.push(n),new _(o,this.getNormalAt(t),this._raw,this._alignTangentsWithPath)}update(t,e=null,s=!1){for(let e=0;e<t.length;e++)this._curve[e].x=t[e].x,this._curve[e].y=t[e].y,this._curve[e].z=t[e].z;return this._compute(e,s),this}_compute(t,e=!1){const s=this._curve.length;if(s<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[s-1]=this._curve[s-1].subtract(this._curve[s-2]),this._raw||this._tangents[s-1].normalize();const r=this._tangents[0],i=this._normalVector(r,t);let a,o,h,l,_;this._normals[0]=i,this._raw||this._normals[0].normalize(),this._binormals[0]=n.P.Cross(r,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let t=1;t<s;t++)a=this._getLastNonNullVector(t),t<s-1&&(o=this._getFirstNonNullVector(t),this._tangents[t]=e?o:a.add(o),this._tangents[t].normalize()),this._distances[t]=this._distances[t-1]+this._curve[t].subtract(this._curve[t-1]).length(),h=this._tangents[t],_=this._binormals[t-1],this._normals[t]=n.P.Cross(_,h),this._raw||(0===this._normals[t].length()?(l=this._normals[t-1],this._normals[t]=l.clone()):this._normals[t].normalize()),this._binormals[t]=n.P.Cross(h,this._normals[t]),this._raw||this._binormals[t].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(t){let e=1,s=this._curve[t+e].subtract(this._curve[t]);for(;0===s.length()&&t+e+1<this._curve.length;)e++,s=this._curve[t+e].subtract(this._curve[t]);return s}_getLastNonNullVector(t){let e=1,s=this._curve[t].subtract(this._curve[t-e]);for(;0===s.length()&&t>e+1;)e++,s=this._curve[t].subtract(this._curve[t-e]);return s}_normalVector(t,e){let s,r=t.length();if(0===r&&(r=1),null==e){let e;e=i.R.WithinEpsilon(Math.abs(t.y)/r,1,a.kn)?i.R.WithinEpsilon(Math.abs(t.x)/r,1,a.kn)?i.R.WithinEpsilon(Math.abs(t.z)/r,1,a.kn)?n.P.Zero():new n.P(0,0,1):new n.P(1,0,0):new n.P(0,-1,0),s=n.P.Cross(t,e)}else s=n.P.Cross(t,e),n.P.CrossToRef(s,t,s);return s.normalize(),s}_updatePointAtData(t,e=!1){if(this._pointAtData.id===t)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=t;const s=this.getPoints();if(t<=0)return this._setPointAtData(0,0,s[0],0,e);if(t>=1)return this._setPointAtData(1,1,s[s.length-1],s.length-1,e);let r,i=s[0],a=0;const o=t*this.length();for(let h=1;h<s.length;h++){r=s[h];const l=n.P.Distance(i,r);if(a+=l,a===o)return this._setPointAtData(t,1,r,h,e);if(a>o){const s=(a-o)/l,n=i.subtract(r),_=r.add(n.scaleInPlace(s));return this._setPointAtData(t,1-s,_,h-1,e)}i=r}return this._pointAtData}_setPointAtData(t,e,s,r,i){return this._pointAtData.point=s,this._pointAtData.position=t,this._pointAtData.subPosition=e,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=i,i&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=n.y3.Identity();const t=this._pointAtData.previousPointArrayIndex;if(t!==this._tangents.length-1){const e=t+1,s=this._tangents[t].clone(),r=this._normals[t].clone(),i=this._binormals[t].clone(),a=this._tangents[e].clone(),o=this._normals[e].clone(),h=this._binormals[e].clone(),l=n._f.RotationQuaternionFromAxis(r,i,s),_=n._f.RotationQuaternionFromAxis(o,h,a);n._f.Slerp(l,_,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},6504:(t,e,s)=>{s.d(e,{J:()=>i});var r=s(5412);class i{constructor(t,e,s,i){this.normal=new r.P(t,e,s),this.d=i}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new i(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let t=this.normal.getHashCode();return t=397*t^(0|this.d),t}normalize(){const t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let e=0;return 0!==t&&(e=1/t),this.normal.x*=e,this.normal.y*=e,this.normal.z*=e,this.d*=e,this}transform(t){const e=i._TmpMatrix;t.invertToRef(e);const s=e.m,r=this.normal.x,n=this.normal.y,a=this.normal.z,o=this.d,h=r*s[0]+n*s[1]+a*s[2]+o*s[3],l=r*s[4]+n*s[5]+a*s[6]+o*s[7],_=r*s[8]+n*s[9]+a*s[10]+o*s[11],c=r*s[12]+n*s[13]+a*s[14]+o*s[15];return new i(h,l,_,c)}dotCoordinate(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d}copyFromPoints(t,e,s){const r=e.x-t.x,i=e.y-t.y,n=e.z-t.z,a=s.x-t.x,o=s.y-t.y,h=s.z-t.z,l=i*h-n*o,_=n*a-r*h,c=r*o-i*a,u=Math.sqrt(l*l+_*_+c*c);let d;return d=0!==u?1/u:0,this.normal.x=l*d,this.normal.y=_*d,this.normal.z=c*d,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this}isFrontFacingTo(t,e){return r.P.Dot(this.normal,t)<=e}signedDistanceTo(t){return r.P.Dot(t,this.normal)+this.d}static FromArray(t){return new i(t[0],t[1],t[2],t[3])}static FromPoints(t,e,s){const r=new i(0,0,0,0);return r.copyFromPoints(t,e,s),r}static FromPositionAndNormal(t,e){const s=new i(0,0,0,0);return e.normalize(),s.normal=e,s.d=-(e.x*t.x+e.y*t.y+e.z*t.z),s}static SignedDistanceToPlaneFromPositionAndNormal(t,e,s){const i=-(e.x*t.x+e.y*t.y+e.z*t.z);return r.P.Dot(s,e)+i}}i._TmpMatrix=r.y3.Identity()},1226:(t,e,s)=>{s.d(e,{R:()=>r});class r{static WithinEpsilon(t,e,s=1401298e-51){return Math.abs(t-e)<=s}static ToHex(t){const e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()}static Sign(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}static Clamp(t,e=0,s=1){return Math.min(s,Math.max(e,t))}static Log2(t){return Math.log(t)*Math.LOG2E}static ILog2(t){if(Math.log2)return Math.floor(Math.log2(t));if(t<0)return NaN;if(0===t)return-1/0;let e=0;if(t<1){for(;t<1;)e++,t*=2;e=-e}else if(t>1)for(;t>1;)e++,t=Math.floor(t/2);return e}static Repeat(t,e){return t-Math.floor(t/e)*e}static Normalize(t,e,s){return(t-e)/(s-e)}static Denormalize(t,e,s){return t*(s-e)+e}static DeltaAngle(t,e){let s=r.Repeat(e-t,360);return s>180&&(s-=360),s}static PingPong(t,e){const s=r.Repeat(t,2*e);return e-Math.abs(s-e)}static SmoothStep(t,e,s){let i=r.Clamp(s);return i=-2*i*i*i+3*i*i,e*i+t*(1-i)}static MoveTowards(t,e,s){let i=0;return i=Math.abs(e-t)<=s?e:t+r.Sign(e-t)*s,i}static MoveTowardsAngle(t,e,s){const i=r.DeltaAngle(t,e);let n=0;return-s<i&&i<s?n=e:(e=t+i,n=r.MoveTowards(t,e,s)),n}static Lerp(t,e,s){return t+(e-t)*s}static LerpAngle(t,e,s){let i=r.Repeat(e-t,360);return i>180&&(i-=360),t+i*r.Clamp(s)}static InverseLerp(t,e,s){let i=0;return i=t!=e?r.Clamp((s-t)/(e-t)):0,i}static Hermite(t,e,s,r,i){const n=i*i,a=i*n;return t*(2*a-3*n+1)+s*(-2*a+3*n)+e*(a-2*n+i)+r*(a-n)}static Hermite1stDerivative(t,e,s,r,i){const n=i*i;return 6*(n-i)*t+(3*n-4*i+1)*e+6*(-n+i)*s+(3*n-2*i)*r}static RandomRange(t,e){return t===e?t:Math.random()*(e-t)+t}static RangeToPercent(t,e,s){return(t-e)/(s-e)}static PercentToRange(t,e,s){return(s-e)*t+e}static NormalizeRadians(t){return t-r.TwoPi*Math.floor((t+Math.PI)/r.TwoPi)}static HCF(t,e){const s=t%e;return 0===s?e:r.HCF(e,s)}}r.TwoPi=2*Math.PI},3321:(t,e,s)=>{s.d(e,{$:()=>r});class r{constructor(t,e){this.width=t,this.height=e}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let t=0|this.width;return t=397*t^(0|this.height),t}copyFrom(t){this.width=t.width,this.height=t.height}copyFromFloats(t,e){return this.width=t,this.height=e,this}set(t,e){return this.copyFromFloats(t,e)}multiplyByFloats(t,e){return new r(this.width*t,this.height*e)}clone(){return new r(this.width,this.height)}equals(t){return!!t&&this.width===t.width&&this.height===t.height}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(t){return new r(this.width+t.width,this.height+t.height)}subtract(t){return new r(this.width-t.width,this.height-t.height)}static Lerp(t,e,s){const i=t.width+(e.width-t.width)*s,n=t.height+(e.height-t.height)*s;return new r(i,n)}}},5412:(t,e,s)=>{s.d(e,{FM:()=>_,Lt:()=>u,P:()=>c,_f:()=>d,jp:()=>p,y3:()=>g});var r=s(1226),i=s(4551),n=s(2554),a=s(646),o=s(1716),h=s(5953);const l=t=>parseInt(t.toString().replace(/\W/g,""));class _{constructor(t=0,e=0){this.x=t,this.y=e}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let t=l(this.x);return t=397*t^l(this.y),t}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,this}fromArray(t,e=0){return _.FromArrayToRef(t,e,this),this}asArray(){const t=new Array;return this.toArray(t,0),t}copyFrom(t){return this.x=t.x,this.y=t.y,this}copyFromFloats(t,e){return this.x=t,this.y=e,this}set(t,e){return this.copyFromFloats(t,e)}add(t){return new this.constructor(this.x+t.x,this.y+t.y)}addToRef(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,e}addInPlace(t){return this.x+=t.x,this.y+=t.y,this}addVector3(t){return new this.constructor(this.x+t.x,this.y+t.y)}subtract(t){return new this.constructor(this.x-t.x,this.y-t.y)}subtractToRef(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,e}subtractInPlace(t){return this.x-=t.x,this.y-=t.y,this}multiplyInPlace(t){return this.x*=t.x,this.y*=t.y,this}multiply(t){return new this.constructor(this.x*t.x,this.y*t.y)}multiplyToRef(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByFloats(t,e){return new this.constructor(this.x*t,this.y*e)}divide(t){return new this.constructor(this.x/t.x,this.y/t.y)}divideToRef(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,e}divideInPlace(t){return this.divideToRef(t,this)}negate(){return new this.constructor(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(t){return t.copyFromFloats(-1*this.x,-1*this.y)}scaleInPlace(t){return this.x*=t,this.y*=t,this}scale(t){const e=new this.constructor(0,0);return this.scaleToRef(t,e),e}scaleToRef(t,e){return e.x=this.x*t,e.y=this.y*t,e}scaleAndAddToRef(t,e){return e.x+=this.x*t,e.y+=this.y*t,e}equals(t){return t&&this.x===t.x&&this.y===t.y}equalsWithEpsilon(t,e=i.kn){return t&&r.R.WithinEpsilon(this.x,t.x,e)&&r.R.WithinEpsilon(this.y,t.y,e)}floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))}fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}rotateToRef(t,e){const s=Math.cos(t),r=Math.sin(t);return e.x=s*this.x-r*this.y,e.y=r*this.x+s*this.y,e}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return _.NormalizeToRef(this,this),this}clone(){return new this.constructor(this.x,this.y)}static Zero(){return new _(0,0)}static One(){return new _(1,1)}static Random(t=0,e=1){return new _(r.R.RandomRange(t,e),r.R.RandomRange(t,e))}static get ZeroReadOnly(){return _._ZeroReadOnly}static FromArray(t,e=0){return new _(t[e],t[e+1])}static FromArrayToRef(t,e,s){return s.x=t[e],s.y=t[e+1],s}static CatmullRom(t,e,s,r,i){const n=i*i,a=i*n,o=.5*(2*e.x+(-t.x+s.x)*i+(2*t.x-5*e.x+4*s.x-r.x)*n+(-t.x+3*e.x-3*s.x+r.x)*a),h=.5*(2*e.y+(-t.y+s.y)*i+(2*t.y-5*e.y+4*s.y-r.y)*n+(-t.y+3*e.y-3*s.y+r.y)*a);return new t.constructor(o,h)}static Clamp(t,e,s){let r=t.x;r=r>s.x?s.x:r,r=r<e.x?e.x:r;let i=t.y;return i=i>s.y?s.y:i,i=i<e.y?e.y:i,new t.constructor(r,i)}static Hermite(t,e,s,r,i){const n=i*i,a=i*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+i,_=a-n,c=t.x*o+s.x*h+e.x*l+r.x*_,u=t.y*o+s.y*h+e.y*l+r.y*_;return new t.constructor(c,u)}static Hermite1stDerivative(t,e,s,r,i){const n=new t.constructor;return this.Hermite1stDerivativeToRef(t,e,s,r,i,n),n}static Hermite1stDerivativeToRef(t,e,s,r,i,n){const a=i*i;return n.x=6*(a-i)*t.x+(3*a-4*i+1)*e.x+6*(-a+i)*s.x+(3*a-2*i)*r.x,n.y=6*(a-i)*t.y+(3*a-4*i+1)*e.y+6*(-a+i)*s.y+(3*a-2*i)*r.y,n}static Lerp(t,e,s){const r=t.x+(e.x-t.x)*s,i=t.y+(e.y-t.y)*s;return new t.constructor(r,i)}static Dot(t,e){return t.x*e.x+t.y*e.y}static Normalize(t){const e=new t.constructor;return this.NormalizeToRef(t,e),e}static NormalizeToRef(t,e){const s=t.length();return 0===s||(e.x=t.x/s,e.y=t.y/s),e}static Minimize(t,e){const s=t.x<e.x?t.x:e.x,r=t.y<e.y?t.y:e.y;return new t.constructor(s,r)}static Maximize(t,e){const s=t.x>e.x?t.x:e.x,r=t.y>e.y?t.y:e.y;return new t.constructor(s,r)}static Transform(t,e){const s=new t.constructor;return _.TransformToRef(t,e,s),s}static TransformToRef(t,e,s){const r=e.m,i=t.x*r[0]+t.y*r[4]+r[12],n=t.x*r[1]+t.y*r[5]+r[13];return s.x=i,s.y=n,s}static PointInTriangle(t,e,s,r){const i=.5*(-s.y*r.x+e.y*(-s.x+r.x)+e.x*(s.y-r.y)+s.x*r.y),n=i<0?-1:1,a=(e.y*r.x-e.x*r.y+(r.y-e.y)*t.x+(e.x-r.x)*t.y)*n,o=(e.x*s.y-e.y*s.x+(e.y-s.y)*t.x+(s.x-e.x)*t.y)*n;return a>0&&o>0&&a+o<2*i*n}static Distance(t,e){return Math.sqrt(_.DistanceSquared(t,e))}static DistanceSquared(t,e){const s=t.x-e.x,r=t.y-e.y;return s*s+r*r}static Center(t,e){const s=new t.constructor;return _.CenterToRef(t,e,s)}static CenterToRef(t,e,s){return s.copyFromFloats((t.x+e.x)/2,(t.y+e.y)/2)}static DistanceOfPointFromSegment(t,e,s){const r=_.DistanceSquared(e,s);if(0===r)return _.Distance(t,e);const i=s.subtract(e),n=Math.max(0,Math.min(1,_.Dot(t.subtract(e),i)/r)),a=e.add(i.multiplyByFloats(n,n));return _.Distance(t,a)}}_._ZeroReadOnly=_.Zero();class c{get x(){return this._x}set x(t){this._x=t,this._isDirty=!0}get y(){return this._y}set y(t){this._y=t,this._isDirty=!0}get z(){return this._z}set z(t){this._z=t,this._isDirty=!0}constructor(t=0,e=0,s=0){this._isDirty=!0,this._x=t,this._y=e,this._z=s}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){let t=l(this._x);return t=397*t^l(this._y),t=397*t^l(this._z),t}asArray(){const t=[];return this.toArray(t,0),t}toArray(t,e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,this}fromArray(t,e=0){return c.FromArrayToRef(t,e,this),this}toQuaternion(){return d.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(t){return this.addInPlaceFromFloats(t._x,t._y,t._z)}addInPlaceFromFloats(t,e,s){return this._x+=t,this._y+=e,this._z+=s,this._isDirty=!0,this}add(t){return new this.constructor(this._x+t._x,this._y+t._y,this._z+t._z)}addToRef(t,e){return e.copyFromFloats(this._x+t._x,this._y+t._y,this._z+t._z)}subtractInPlace(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._isDirty=!0,this}subtract(t){return new this.constructor(this._x-t._x,this._y-t._y,this._z-t._z)}subtractToRef(t,e){return this.subtractFromFloatsToRef(t._x,t._y,t._z,e)}subtractFromFloats(t,e,s){return new this.constructor(this._x-t,this._y-e,this._z-s)}subtractFromFloatsToRef(t,e,s,r){return r.copyFromFloats(this._x-t,this._y-e,this._z-s)}negate(){return new this.constructor(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(t){return t.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)}scaleInPlace(t){return this._x*=t,this._y*=t,this._z*=t,this._isDirty=!0,this}scale(t){return new this.constructor(this._x*t,this._y*t,this._z*t)}scaleToRef(t,e){return e.copyFromFloats(this._x*t,this._y*t,this._z*t)}getNormalToRef(t){const e=this.length();let s=Math.acos(this.y/e);const r=Math.atan2(this.z,this.x);s>Math.PI/2?s-=Math.PI/2:s+=Math.PI/2;const i=e*Math.sin(s)*Math.cos(r),n=e*Math.cos(s),a=e*Math.sin(s)*Math.sin(r);return t.set(i,n,a),t}applyRotationQuaternionToRef(t,e){const s=t._w*this._x+t._y*this._z-t._z*this._y,r=t._w*this._y+t._z*this._x-t._x*this._z,i=t._w*this._z+t._x*this._y-t._y*this._x,n=-t._x*this._x-t._y*this._y-t._z*this._z;return e._x=s*t._w+n*-t._x+r*-t._z-i*-t._y,e._y=r*t._w+n*-t._y+i*-t._x-s*-t._z,e._z=i*t._w+n*-t._z+s*-t._y-r*-t._x,e._isDirty=!0,e}applyRotationQuaternionInPlace(t){return this.applyRotationQuaternionToRef(t,this)}applyRotationQuaternion(t){return this.applyRotationQuaternionToRef(t,new this.constructor)}scaleAndAddToRef(t,e){return e.addInPlaceFromFloats(this._x*t,this._y*t,this._z*t)}projectOnPlane(t,e){const s=new this.constructor;return this.projectOnPlaneToRef(t,e,s),s}projectOnPlaneToRef(t,e,s){const r=t.normal,i=t.d,n=f.Vector3[0];this.subtractToRef(e,n),n.normalize();const a=c.Dot(n,r);if(Math.abs(a)<Math.pow(10,-10))s.setAll(1/0);else{const t=-(c.Dot(e,r)+i)/a,o=n.scaleInPlace(t);e.addToRef(o,s)}return s}equals(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z}equalsWithEpsilon(t,e=i.kn){return t&&r.R.WithinEpsilon(this._x,t._x,e)&&r.R.WithinEpsilon(this._y,t._y,e)&&r.R.WithinEpsilon(this._z,t._z,e)}equalsToFloats(t,e,s){return this._x===t&&this._y===e&&this._z===s}multiplyInPlace(t){return this._x*=t._x,this._y*=t._y,this._z*=t._z,this._isDirty=!0,this}multiply(t){return this.multiplyByFloats(t._x,t._y,t._z)}multiplyToRef(t,e){return e.copyFromFloats(this._x*t._x,this._y*t._y,this._z*t._z)}multiplyByFloats(t,e,s){return new this.constructor(this._x*t,this._y*e,this._z*s)}divide(t){return new this.constructor(this._x/t._x,this._y/t._y,this._z/t._z)}divideToRef(t,e){return e.copyFromFloats(this._x/t._x,this._y/t._y,this._z/t._z)}divideInPlace(t){return this.divideToRef(t,this)}minimizeInPlace(t){return this.minimizeInPlaceFromFloats(t._x,t._y,t._z)}maximizeInPlace(t){return this.maximizeInPlaceFromFloats(t._x,t._y,t._z)}minimizeInPlaceFromFloats(t,e,s){return t<this._x&&(this.x=t),e<this._y&&(this.y=e),s<this._z&&(this.z=s),this}maximizeInPlaceFromFloats(t,e,s){return t>this._x&&(this.x=t),e>this._y&&(this.y=e),s>this._z&&(this.z=s),this}isNonUniformWithinEpsilon(t){const e=Math.abs(this._x),s=Math.abs(this._y);if(!r.R.WithinEpsilon(e,s,t))return!0;const i=Math.abs(this._z);return!r.R.WithinEpsilon(e,i,t)||!r.R.WithinEpsilon(s,i,t)}get isNonUniform(){const t=Math.abs(this._x);return t!==Math.abs(this._y)||t!==Math.abs(this._z)}floor(){return new this.constructor(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fract(){return new this.constructor(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z==0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(t){return"xyz"===(t=t.toLowerCase())||(f.Vector3[0].copyFrom(this),["x","y","z"].forEach(((e,s)=>{this[e]=f.Vector3[0][t[s]]}))),this}rotateByQuaternionToRef(t,e){return t.toRotationMatrix(f.Matrix[0]),c.TransformCoordinatesToRef(this,f.Matrix[0],e),e}rotateByQuaternionAroundPointToRef(t,e,s){return this.subtractToRef(e,f.Vector3[0]),f.Vector3[0].rotateByQuaternionToRef(t,f.Vector3[0]),e.addToRef(f.Vector3[0],s),s}cross(t){const e=new this.constructor;return c.CrossToRef(this,t,e)}normalizeFromLength(t){return 0===t||1===t?this:this.scaleInPlace(1/t)}normalizeToNew(){const t=new this.constructor(0,0,0);return this.normalizeToRef(t),t}normalizeToRef(t){const e=this.length();return 0===e||1===e?t.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/e,t)}clone(){return new this.constructor(this._x,this._y,this._z)}copyFrom(t){return this.copyFromFloats(t._x,t._y,t._z)}copyFromFloats(t,e,s){return this._x=t,this._y=e,this._z=s,this._isDirty=!0,this}set(t,e,s){return this.copyFromFloats(t,e,s)}setAll(t){return this._x=this._y=this._z=t,this._isDirty=!0,this}static GetClipFactor(t,e,s,r){const i=c.Dot(t,s)-r;return i/(i-(c.Dot(e,s)-r))}static GetAngleBetweenVectors(t,e,s){const i=t.normalizeToRef(f.Vector3[1]),n=e.normalizeToRef(f.Vector3[2]);let a=c.Dot(i,n);a=r.R.Clamp(a,-1,1);const o=Math.acos(a),h=f.Vector3[3];return c.CrossToRef(i,n,h),c.Dot(h,s)>0?isNaN(o)?0:o:isNaN(o)?-Math.PI:-Math.acos(a)}static GetAngleBetweenVectorsOnPlane(t,e,s){f.Vector3[0].copyFrom(t);const i=f.Vector3[0];f.Vector3[1].copyFrom(e);const n=f.Vector3[1];f.Vector3[2].copyFrom(s);const a=f.Vector3[2],o=f.Vector3[3],h=f.Vector3[4];i.normalize(),n.normalize(),a.normalize(),c.CrossToRef(a,i,o),c.CrossToRef(o,a,h);const l=Math.atan2(c.Dot(n,o),c.Dot(n,h));return r.R.NormalizeRadians(l)}static PitchYawRollToMoveBetweenPointsToRef(t,e,s){const r=p.Vector3[0];return e.subtractToRef(t,r),s._y=Math.atan2(r.x,r.z)||0,s._x=Math.atan2(Math.sqrt(r.x**2+r.z**2),r.y)||0,s._z=0,s._isDirty=!0,s}static PitchYawRollToMoveBetweenPoints(t,e){const s=c.Zero();return c.PitchYawRollToMoveBetweenPointsToRef(t,e,s)}static SlerpToRef(t,e,s,n){s=r.R.Clamp(s,0,1);const a=f.Vector3[0],o=f.Vector3[1];a.copyFrom(t);const h=a.length();a.normalizeFromLength(h),o.copyFrom(e);const l=o.length();o.normalizeFromLength(l);const _=c.Dot(a,o);let u,d;if(_<1-i.kn){const t=Math.acos(_),e=1/Math.sin(t);u=Math.sin((1-s)*t)*e,d=Math.sin(s*t)*e}else u=1-s,d=s;return a.scaleInPlace(u),o.scaleInPlace(d),n.copyFrom(a).addInPlace(o),n.scaleInPlace(r.R.Lerp(h,l,s)),n}static SmoothToRef(t,e,s,r,i){return c.SlerpToRef(t,e,0===r?1:s/r,i),i}static FromArray(t,e=0){return new c(t[e],t[e+1],t[e+2])}static FromFloatArray(t,e){return c.FromArray(t,e)}static FromArrayToRef(t,e,s){return s._x=t[e],s._y=t[e+1],s._z=t[e+2],s._isDirty=!0,s}static FromFloatArrayToRef(t,e,s){return c.FromArrayToRef(t,e,s)}static FromFloatsToRef(t,e,s,r){return r.copyFromFloats(t,e,s),r}static Zero(){return new c(0,0,0)}static One(){return new c(1,1,1)}static Up(){return new c(0,1,0)}static get UpReadOnly(){return c._UpReadOnly}static get DownReadOnly(){return c._DownReadOnly}static get RightReadOnly(){return c._RightReadOnly}static get LeftReadOnly(){return c._LeftReadOnly}static get LeftHandedForwardReadOnly(){return c._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return c._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return c._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return c._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return c._ZeroReadOnly}static Down(){return new c(0,-1,0)}static Forward(t=!1){return new c(0,0,t?-1:1)}static Backward(t=!1){return new c(0,0,t?1:-1)}static Right(){return new c(1,0,0)}static Left(){return new c(-1,0,0)}static Random(t=0,e=1){return new c(r.R.RandomRange(t,e),r.R.RandomRange(t,e),r.R.RandomRange(t,e))}static TransformCoordinates(t,e){const s=c.Zero();return c.TransformCoordinatesToRef(t,e,s),s}static TransformCoordinatesToRef(t,e,s){return c.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,e,s),s}static TransformCoordinatesFromFloatsToRef(t,e,s,r,i){const n=r.m,a=t*n[0]+e*n[4]+s*n[8]+n[12],o=t*n[1]+e*n[5]+s*n[9]+n[13],h=t*n[2]+e*n[6]+s*n[10]+n[14],l=1/(t*n[3]+e*n[7]+s*n[11]+n[15]);return i._x=a*l,i._y=o*l,i._z=h*l,i._isDirty=!0,i}static TransformNormal(t,e){const s=c.Zero();return c.TransformNormalToRef(t,e,s),s}static TransformNormalToRef(t,e,s){return this.TransformNormalFromFloatsToRef(t._x,t._y,t._z,e,s),s}static TransformNormalFromFloatsToRef(t,e,s,r,i){const n=r.m;return i._x=t*n[0]+e*n[4]+s*n[8],i._y=t*n[1]+e*n[5]+s*n[9],i._z=t*n[2]+e*n[6]+s*n[10],i._isDirty=!0,i}static CatmullRom(t,e,s,r,i){const n=i*i,a=i*n,o=.5*(2*e._x+(-t._x+s._x)*i+(2*t._x-5*e._x+4*s._x-r._x)*n+(-t._x+3*e._x-3*s._x+r._x)*a),h=.5*(2*e._y+(-t._y+s._y)*i+(2*t._y-5*e._y+4*s._y-r._y)*n+(-t._y+3*e._y-3*s._y+r._y)*a),l=.5*(2*e._z+(-t._z+s._z)*i+(2*t._z-5*e._z+4*s._z-r._z)*n+(-t._z+3*e._z-3*s._z+r._z)*a);return new t.constructor(o,h,l)}static Clamp(t,e,s){const r=new t.constructor;return c.ClampToRef(t,e,s,r),r}static ClampToRef(t,e,s,r){let i=t._x;i=i>s._x?s._x:i,i=i<e._x?e._x:i;let n=t._y;n=n>s._y?s._y:n,n=n<e._y?e._y:n;let a=t._z;return a=a>s._z?s._z:a,a=a<e._z?e._z:a,r.copyFromFloats(i,n,a),r}static CheckExtends(t,e,s){e.minimizeInPlace(t),s.maximizeInPlace(t)}static Hermite(t,e,s,r,i){const n=i*i,a=i*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+i,_=a-n,c=t._x*o+s._x*h+e._x*l+r._x*_,u=t._y*o+s._y*h+e._y*l+r._y*_,d=t._z*o+s._z*h+e._z*l+r._z*_;return new t.constructor(c,u,d)}static Hermite1stDerivative(t,e,s,r,i){const n=new t.constructor;return this.Hermite1stDerivativeToRef(t,e,s,r,i,n),n}static Hermite1stDerivativeToRef(t,e,s,r,i,n){const a=i*i;return n._x=6*(a-i)*t._x+(3*a-4*i+1)*e._x+6*(-a+i)*s._x+(3*a-2*i)*r._x,n._y=6*(a-i)*t._y+(3*a-4*i+1)*e._y+6*(-a+i)*s._y+(3*a-2*i)*r._y,n._z=6*(a-i)*t._z+(3*a-4*i+1)*e._z+6*(-a+i)*s._z+(3*a-2*i)*r._z,n._isDirty=!0,n}static Lerp(t,e,s){const r=new t.constructor(0,0,0);return c.LerpToRef(t,e,s,r),r}static LerpToRef(t,e,s,r){return r._x=t._x+(e._x-t._x)*s,r._y=t._y+(e._y-t._y)*s,r._z=t._z+(e._z-t._z)*s,r._isDirty=!0,r}static Dot(t,e){return t._x*e._x+t._y*e._y+t._z*e._z}static Cross(t,e){const s=new t.constructor;return c.CrossToRef(t,e,s),s}static CrossToRef(t,e,s){const r=t._y*e._z-t._z*e._y,i=t._z*e._x-t._x*e._z,n=t._x*e._y-t._y*e._x;return s.copyFromFloats(r,i,n),s}static Normalize(t){const e=c.Zero();return c.NormalizeToRef(t,e),e}static NormalizeToRef(t,e){return t.normalizeToRef(e),e}static Project(t,e,s,r){const i=new t.constructor;return c.ProjectToRef(t,e,s,r,i),i}static ProjectToRef(t,e,s,r,i){const n=r.width,a=r.height,o=r.x,h=r.y,l=f.Matrix[1];g.FromValuesToRef(n/2,0,0,0,0,-a/2,0,0,0,0,.5,0,o+n/2,a/2+h,.5,1,l);const _=f.Matrix[0];return e.multiplyToRef(s,_),_.multiplyToRef(l,_),c.TransformCoordinatesToRef(t,_,i),i}static Reflect(t,e){return this.ReflectToRef(t,e,new c)}static ReflectToRef(t,e,s){const r=p.Vector3[0];return r.copyFrom(e).scaleInPlace(2*c.Dot(t,e)),s.copyFrom(t).subtractInPlace(r)}static _UnprojectFromInvertedMatrixToRef(t,e,s){c.TransformCoordinatesToRef(t,e,s);const i=e.m,n=t._x*i[3]+t._y*i[7]+t._z*i[11]+i[15];return r.R.WithinEpsilon(n,1)&&s.scaleInPlace(1/n),s}static UnprojectFromTransform(t,e,s,r,i){return this.Unproject(t,e,s,r,i,g.IdentityReadOnly)}static Unproject(t,e,s,r,i,n){const a=new t.constructor;return c.UnprojectToRef(t,e,s,r,i,n,a),a}static UnprojectToRef(t,e,s,r,i,n,a){return c.UnprojectFloatsToRef(t._x,t._y,t._z,e,s,r,i,n,a),a}static UnprojectFloatsToRef(t,e,s,r,i,n,a,o,l){var _;const u=f.Matrix[0];n.multiplyToRef(a,u),u.multiplyToRef(o,u),u.invert();const d=f.Vector3[0];return d.x=t/r*2-1,d.y=-(e/i*2-1),(null===(_=h.l.LastCreatedEngine)||void 0===_?void 0:_.isNDCHalfZRange)?d.z=s:d.z=2*s-1,c._UnprojectFromInvertedMatrixToRef(d,u,l),l}static Minimize(t,e){const s=new t.constructor;return s.copyFrom(t),s.minimizeInPlace(e),s}static Maximize(t,e){const s=new t.constructor;return s.copyFrom(t),s.maximizeInPlace(e),s}static Distance(t,e){return Math.sqrt(c.DistanceSquared(t,e))}static DistanceSquared(t,e){const s=t._x-e._x,r=t._y-e._y,i=t._z-e._z;return s*s+r*r+i*i}static ProjectOnTriangleToRef(t,e,s,n,a){const o=f.Vector3[0],h=f.Vector3[1],l=f.Vector3[2],_=f.Vector3[3],u=f.Vector3[4];s.subtractToRef(e,o),n.subtractToRef(e,h),n.subtractToRef(s,l);const d=o.length(),g=h.length(),p=l.length();if(d<i.kn||g<i.kn||p<i.kn)return a.copyFrom(e),c.Distance(t,e);t.subtractToRef(e,u),c.CrossToRef(o,h,_);const m=_.length();if(m<i.kn)return a.copyFrom(e),c.Distance(t,e);_.normalizeFromLength(m);let R=u.length();if(R<i.kn)return a.copyFrom(e),0;u.normalizeFromLength(R);const T=c.Dot(_,u),x=f.Vector3[5],E=f.Vector3[6];x.copyFrom(_).scaleInPlace(-R*T),E.copyFrom(t).addInPlace(x);const y=f.Vector3[4],b=f.Vector3[5],A=f.Vector3[7],S=f.Vector3[8];y.copyFrom(o).scaleInPlace(1/d),S.copyFrom(h).scaleInPlace(1/g),y.addInPlace(S).scaleInPlace(-1),b.copyFrom(o).scaleInPlace(-1/d),S.copyFrom(l).scaleInPlace(1/p),b.addInPlace(S).scaleInPlace(-1),A.copyFrom(l).scaleInPlace(-1/p),S.copyFrom(h).scaleInPlace(-1/g),A.addInPlace(S).scaleInPlace(-1);const C=f.Vector3[9];let F;C.copyFrom(E).subtractInPlace(e),c.CrossToRef(y,C,S),F=c.Dot(S,_);const w=F;C.copyFrom(E).subtractInPlace(s),c.CrossToRef(b,C,S),F=c.Dot(S,_);const v=F;C.copyFrom(E).subtractInPlace(n),c.CrossToRef(A,C,S),F=c.Dot(S,_);const P=F,M=f.Vector3[10];let D,L;w>0&&v<0?(M.copyFrom(o),D=e,L=s):v>0&&P<0?(M.copyFrom(l),D=s,L=n):(M.copyFrom(h).scaleInPlace(-1),D=n,L=e);const I=f.Vector3[9],B=f.Vector3[4];if(D.subtractToRef(E,S),L.subtractToRef(E,I),c.CrossToRef(S,I,B),!(c.Dot(B,_)<0))return a.copyFrom(E),Math.abs(R*T);const O=f.Vector3[5];c.CrossToRef(M,B,O),O.normalize();const U=f.Vector3[9];U.copyFrom(D).subtractInPlace(E);const N=U.length();if(N<i.kn)return a.copyFrom(D),c.Distance(t,D);U.normalizeFromLength(N);const z=c.Dot(O,U),G=f.Vector3[7];G.copyFrom(E).addInPlace(O.scaleInPlace(N*z)),S.copyFrom(G).subtractInPlace(D),R=M.length(),M.normalizeFromLength(R);let k=c.Dot(S,M)/Math.max(R,i.kn);return k=r.R.Clamp(k,0,1),G.copyFrom(D).addInPlace(M.scaleInPlace(k*R)),a.copyFrom(G),c.Distance(t,G)}static Center(t,e){return c.CenterToRef(t,e,c.Zero())}static CenterToRef(t,e,s){return s.copyFromFloats((t._x+e._x)/2,(t._y+e._y)/2,(t._z+e._z)/2)}static RotationFromAxis(t,e,s){const r=new t.constructor;return c.RotationFromAxisToRef(t,e,s,r),r}static RotationFromAxisToRef(t,e,s,r){const i=f.Quaternion[0];return d.RotationQuaternionFromAxisToRef(t,e,s,i),i.toEulerAnglesToRef(r),r}}c._UpReadOnly=c.Up(),c._DownReadOnly=c.Down(),c._LeftHandedForwardReadOnly=c.Forward(!1),c._RightHandedForwardReadOnly=c.Forward(!0),c._LeftHandedBackwardReadOnly=c.Backward(!1),c._RightHandedBackwardReadOnly=c.Backward(!0),c._RightReadOnly=c.Right(),c._LeftReadOnly=c.Left(),c._ZeroReadOnly=c.Zero();class u{constructor(t=0,e=0,s=0,r=0){this.x=t,this.y=e,this.z=s,this.w=r}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let t=l(this.x);return t=397*t^l(this.y),t=397*t^l(this.z),t=397*t^l(this.w),t}asArray(){const t=new Array;return this.toArray(t,0),t}toArray(t,e){return void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,this}fromArray(t,e=0){return u.FromArrayToRef(t,e,this),this}addInPlace(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}add(t){return new this.constructor(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}addToRef(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e}subtractInPlace(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subtract(t){return new this.constructor(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}subtractToRef(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e}subtractFromFloats(t,e,s,r){return new this.constructor(this.x-t,this.y-e,this.z-s,this.w-r)}subtractFromFloatsToRef(t,e,s,r,i){return i.x=this.x-t,i.y=this.y-e,i.z=this.z-s,i.w=this.w-r,i}negate(){return new this.constructor(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(t){return t.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)}scaleInPlace(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}scale(t){return new this.constructor(this.x*t,this.y*t,this.z*t,this.w*t)}scaleToRef(t,e){return e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t,e}scaleAndAddToRef(t,e){return e.x+=this.x*t,e.y+=this.y*t,e.z+=this.z*t,e.w+=this.w*t,e}equals(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}equalsWithEpsilon(t,e=i.kn){return t&&r.R.WithinEpsilon(this.x,t.x,e)&&r.R.WithinEpsilon(this.y,t.y,e)&&r.R.WithinEpsilon(this.z,t.z,e)&&r.R.WithinEpsilon(this.w,t.w,e)}equalsToFloats(t,e,s,r){return this.x===t&&this.y===e&&this.z===s&&this.w===r}multiplyInPlace(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiply(t){return new this.constructor(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}multiplyToRef(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e.w=this.w*t.w,e}multiplyByFloats(t,e,s,r){return new this.constructor(this.x*t,this.y*e,this.z*s,this.w*r)}divide(t){return new this.constructor(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}divideToRef(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,e.z=this.z/t.z,e.w=this.w/t.w,e}divideInPlace(t){return this.divideToRef(t,this)}minimizeInPlace(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this}maximizeInPlace(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this}floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const t=this.length();return 0===t?this:this.scaleInPlace(1/t)}toVector3(){return new c(this.x,this.y,this.z)}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}copyFromFloats(t,e,s,r){return this.x=t,this.y=e,this.z=s,this.w=r,this}set(t,e,s,r){return this.copyFromFloats(t,e,s,r)}setAll(t){return this.x=this.y=this.z=this.w=t,this}static FromArray(t,e){return e||(e=0),new u(t[e],t[e+1],t[e+2],t[e+3])}static FromArrayToRef(t,e,s){return s.x=t[e],s.y=t[e+1],s.z=t[e+2],s.w=t[e+3],s}static FromFloatArrayToRef(t,e,s){return u.FromArrayToRef(t,e,s),s}static FromFloatsToRef(t,e,s,r,i){return i.x=t,i.y=e,i.z=s,i.w=r,i}static Zero(){return new u(0,0,0,0)}static One(){return new u(1,1,1,1)}static Random(t=0,e=1){return new u(r.R.RandomRange(t,e),r.R.RandomRange(t,e),r.R.RandomRange(t,e),r.R.RandomRange(t,e))}static get ZeroReadOnly(){return u._ZeroReadOnly}static Normalize(t){const e=u.Zero();return u.NormalizeToRef(t,e),e}static NormalizeToRef(t,e){return e.copyFrom(t),e.normalize(),e}static Minimize(t,e){const s=new t.constructor;return s.copyFrom(t),s.minimizeInPlace(e),s}static Maximize(t,e){const s=new t.constructor;return s.copyFrom(t),s.maximizeInPlace(e),s}static Distance(t,e){return Math.sqrt(u.DistanceSquared(t,e))}static DistanceSquared(t,e){const s=t.x-e.x,r=t.y-e.y,i=t.z-e.z,n=t.w-e.w;return s*s+r*r+i*i+n*n}static Center(t,e){return u.CenterToRef(t,e,u.Zero())}static CenterToRef(t,e,s){return s.copyFromFloats((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2,(t.w+e.w)/2)}static TransformCoordinates(t,e){const s=u.Zero();return u.TransformCoordinatesToRef(t,e,s),s}static TransformCoordinatesToRef(t,e,s){return u.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,e,s),s}static TransformCoordinatesFromFloatsToRef(t,e,s,r,i){const n=r.m,a=t*n[0]+e*n[4]+s*n[8]+n[12],o=t*n[1]+e*n[5]+s*n[9]+n[13],h=t*n[2]+e*n[6]+s*n[10]+n[14],l=t*n[3]+e*n[7]+s*n[11]+n[15];return i.x=a,i.y=o,i.z=h,i.w=l,i}static TransformNormal(t,e){const s=new t.constructor;return u.TransformNormalToRef(t,e,s),s}static TransformNormalToRef(t,e,s){const r=e.m,i=t.x*r[0]+t.y*r[4]+t.z*r[8],n=t.x*r[1]+t.y*r[5]+t.z*r[9],a=t.x*r[2]+t.y*r[6]+t.z*r[10];return s.x=i,s.y=n,s.z=a,s.w=t.w,s}static TransformNormalFromFloatsToRef(t,e,s,r,i,n){const a=i.m;return n.x=t*a[0]+e*a[4]+s*a[8],n.y=t*a[1]+e*a[5]+s*a[9],n.z=t*a[2]+e*a[6]+s*a[10],n.w=r,n}static FromVector3(t,e=0){return new u(t._x,t._y,t._z,e)}}u._ZeroReadOnly=u.Zero();class d{get x(){return this._x}set x(t){this._x=t,this._isDirty=!0}get y(){return this._y}set y(t){this._y=t,this._isDirty=!0}get z(){return this._z}set z(t){this._z=t,this._isDirty=!0}get w(){return this._w}set w(t){this._w=t,this._isDirty=!0}constructor(t=0,e=0,s=0,r=1){this._isDirty=!0,this._x=t,this._y=e,this._z=s,this._w=r}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let t=l(this._x);return t=397*t^l(this._y),t=397*t^l(this._z),t=397*t^l(this._w),t}asArray(){return[this._x,this._y,this._z,this._w]}toArray(t,e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,this}equals(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w}equalsWithEpsilon(t,e=i.kn){return t&&r.R.WithinEpsilon(this._x,t._x,e)&&r.R.WithinEpsilon(this._y,t._y,e)&&r.R.WithinEpsilon(this._z,t._z,e)&&r.R.WithinEpsilon(this._w,t._w,e)}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copyFrom(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._w=t._w,this._isDirty=!0,this}copyFromFloats(t,e,s,r){return this._x=t,this._y=e,this._z=s,this._w=r,this._isDirty=!0,this}set(t,e,s,r){return this.copyFromFloats(t,e,s,r)}add(t){return new this.constructor(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)}addInPlace(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this._isDirty=!0,this}subtract(t){return new this.constructor(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)}subtractInPlace(t){return this._x-=t._x,this._y-=t._y,this._z-=t._z,this._w-=t._w,this._isDirty=!0,this}scale(t){return new this.constructor(this._x*t,this._y*t,this._z*t,this._w*t)}scaleToRef(t,e){return e._x=this._x*t,e._y=this._y*t,e._z=this._z*t,e._w=this._w*t,e._isDirty=!0,e}scaleInPlace(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this._isDirty=!0,this}scaleAndAddToRef(t,e){return e._x+=this._x*t,e._y+=this._y*t,e._z+=this._z*t,e._w+=this._w*t,e._isDirty=!0,e}multiply(t){const e=new this.constructor(0,0,0,1);return this.multiplyToRef(t,e),e}multiplyToRef(t,e){const s=this._x*t._w+this._y*t._z-this._z*t._y+this._w*t._x,r=-this._x*t._z+this._y*t._w+this._z*t._x+this._w*t._y,i=this._x*t._y-this._y*t._x+this._z*t._w+this._w*t._z,n=-this._x*t._x-this._y*t._y-this._z*t._z+this._w*t._w;return e.copyFromFloats(s,r,i,n),e}multiplyInPlace(t){return this.multiplyToRef(t,this),this}conjugateToRef(t){return t.copyFromFloats(-this._x,-this._y,-this._z,this._w),t}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new this.constructor(-this._x,-this._y,-this._z,this._w)}invert(){const t=this.conjugate(),e=this.lengthSquared();return 0==e||1==e||t.scaleInPlace(1/e),t}invertInPlace(){this.conjugateInPlace();const t=this.lengthSquared();return 0==t||1==t||this.scaleInPlace(1/t),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){const t=this.length();if(0===t)return this;const e=1/t;return this.scaleInPlace(e),this}normalizeToNew(){const t=this.length();if(0===t)return this.clone();const e=1/t;return this.scale(e)}toEulerAngles(){const t=c.Zero();return this.toEulerAnglesToRef(t),t}toEulerAnglesToRef(t){const e=this._z,s=this._x,r=this._y,i=this._w,n=r*e-s*i,a=.4999999;if(n<-a)t._y=2*Math.atan2(r,i),t._x=Math.PI/2,t._z=0,t._isDirty=!0;else if(n>a)t._y=2*Math.atan2(r,i),t._x=-Math.PI/2,t._z=0,t._isDirty=!0;else{const a=i*i,o=e*e,h=s*s,l=r*r;t._z=Math.atan2(2*(s*r+e*i),-o-h+l+a),t._x=Math.asin(-2*n),t._y=Math.atan2(2*(e*s+r*i),o-h-l+a),t._isDirty=!0}return t}toRotationMatrix(t){return g.FromQuaternionToRef(this,t),t}fromRotationMatrix(t){return d.FromRotationMatrixToRef(t,this),this}static FromRotationMatrix(t){const e=new d;return d.FromRotationMatrixToRef(t,e),e}static FromRotationMatrixToRef(t,e){const s=t.m,r=s[0],i=s[4],n=s[8],a=s[1],o=s[5],h=s[9],l=s[2],_=s[6],c=s[10],u=r+o+c;let d;return u>0?(d=.5/Math.sqrt(u+1),e._w=.25/d,e._x=(_-h)*d,e._y=(n-l)*d,e._z=(a-i)*d,e._isDirty=!0):r>o&&r>c?(d=2*Math.sqrt(1+r-o-c),e._w=(_-h)/d,e._x=.25*d,e._y=(i+a)/d,e._z=(n+l)/d,e._isDirty=!0):o>c?(d=2*Math.sqrt(1+o-r-c),e._w=(n-l)/d,e._x=(i+a)/d,e._y=.25*d,e._z=(h+_)/d,e._isDirty=!0):(d=2*Math.sqrt(1+c-r-o),e._w=(a-i)/d,e._x=(n+l)/d,e._y=(h+_)/d,e._z=.25*d,e._isDirty=!0),e}static Dot(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w}static AreClose(t,e,s=.1){const r=d.Dot(t,e);return 1-r*r<=s}static SmoothToRef(t,e,s,i,n){let a=0===i?1:s/i;return a=r.R.Clamp(a,0,1),d.SlerpToRef(t,e,a,n),n}static Zero(){return new d(0,0,0,0)}static Inverse(t){return new t.constructor(-t._x,-t._y,-t._z,t._w)}static InverseToRef(t,e){return e.set(-t._x,-t._y,-t._z,t._w),e}static Identity(){return new d(0,0,0,1)}static IsIdentity(t){return t&&0===t._x&&0===t._y&&0===t._z&&1===t._w}static RotationAxis(t,e){return d.RotationAxisToRef(t,e,new d)}static RotationAxisToRef(t,e,s){const r=Math.sin(e/2);return t.normalize(),s._w=Math.cos(e/2),s._x=t._x*r,s._y=t._y*r,s._z=t._z*r,s._isDirty=!0,s}static FromArray(t,e){return e||(e=0),new d(t[e],t[e+1],t[e+2],t[e+3])}static FromArrayToRef(t,e,s){return s._x=t[e],s._y=t[e+1],s._z=t[e+2],s._w=t[e+3],s._isDirty=!0,s}static FromEulerAngles(t,e,s){const r=new d;return d.RotationYawPitchRollToRef(e,t,s,r),r}static FromEulerAnglesToRef(t,e,s,r){return d.RotationYawPitchRollToRef(e,t,s,r),r}static FromEulerVector(t){const e=new d;return d.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e}static FromEulerVectorToRef(t,e){return d.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e}static FromUnitVectorsToRef(t,e,s){const r=c.Dot(t,e)+1;return r<i.kn?Math.abs(t.x)>Math.abs(t.z)?s.set(-t.y,t.x,0,0):s.set(0,-t.z,t.y,0):(c.CrossToRef(t,e,p.Vector3[0]),s.set(p.Vector3[0].x,p.Vector3[0].y,p.Vector3[0].z,r)),s.normalize()}static RotationYawPitchRoll(t,e,s){const r=new d;return d.RotationYawPitchRollToRef(t,e,s,r),r}static RotationYawPitchRollToRef(t,e,s,r){const i=.5*s,n=.5*e,a=.5*t,o=Math.sin(i),h=Math.cos(i),l=Math.sin(n),_=Math.cos(n),c=Math.sin(a),u=Math.cos(a);return r._x=u*l*h+c*_*o,r._y=c*_*h-u*l*o,r._z=u*_*o-c*l*h,r._w=u*_*h+c*l*o,r._isDirty=!0,r}static RotationAlphaBetaGamma(t,e,s){const r=new d;return d.RotationAlphaBetaGammaToRef(t,e,s,r),r}static RotationAlphaBetaGammaToRef(t,e,s,r){const i=.5*(s+t),n=.5*(s-t),a=.5*e;return r._x=Math.cos(n)*Math.sin(a),r._y=Math.sin(n)*Math.sin(a),r._z=Math.sin(i)*Math.cos(a),r._w=Math.cos(i)*Math.cos(a),r._isDirty=!0,r}static RotationQuaternionFromAxis(t,e,s){const r=new d(0,0,0,0);return d.RotationQuaternionFromAxisToRef(t,e,s,r),r}static RotationQuaternionFromAxisToRef(t,e,s,r){const i=f.Matrix[0];return g.FromXYZAxesToRef(t.normalize(),e.normalize(),s.normalize(),i),d.FromRotationMatrixToRef(i,r),r}static FromLookDirectionLH(t,e){const s=new d;return d.FromLookDirectionLHToRef(t,e,s),s}static FromLookDirectionLHToRef(t,e,s){const r=f.Matrix[0];return g.LookDirectionLHToRef(t,e,r),d.FromRotationMatrixToRef(r,s),s}static FromLookDirectionRH(t,e){const s=new d;return d.FromLookDirectionRHToRef(t,e,s),s}static FromLookDirectionRHToRef(t,e,s){const r=f.Matrix[0];return g.LookDirectionRHToRef(t,e,r),d.FromRotationMatrixToRef(r,s)}static Slerp(t,e,s){const r=d.Identity();return d.SlerpToRef(t,e,s,r),r}static SlerpToRef(t,e,s,r){let i,n,a=t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w,o=!1;if(a<0&&(o=!0,a=-a),a>.999999)n=1-s,i=o?-s:s;else{const t=Math.acos(a),e=1/Math.sin(t);n=Math.sin((1-s)*t)*e,i=o?-Math.sin(s*t)*e:Math.sin(s*t)*e}return r._x=n*t._x+i*e._x,r._y=n*t._y+i*e._y,r._z=n*t._z+i*e._z,r._w=n*t._w+i*e._w,r._isDirty=!0,r}static Hermite(t,e,s,r,i){const n=i*i,a=i*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+i,_=a-n,c=t._x*o+s._x*h+e._x*l+r._x*_,u=t._y*o+s._y*h+e._y*l+r._y*_,d=t._z*o+s._z*h+e._z*l+r._z*_,g=t._w*o+s._w*h+e._w*l+r._w*_;return new t.constructor(c,u,d,g)}static Hermite1stDerivative(t,e,s,r,i){const n=new t.constructor;return this.Hermite1stDerivativeToRef(t,e,s,r,i,n),n}static Hermite1stDerivativeToRef(t,e,s,r,i,n){const a=i*i;return n._x=6*(a-i)*t._x+(3*a-4*i+1)*e._x+6*(-a+i)*s._x+(3*a-2*i)*r._x,n._y=6*(a-i)*t._y+(3*a-4*i+1)*e._y+6*(-a+i)*s._y+(3*a-2*i)*r._y,n._z=6*(a-i)*t._z+(3*a-4*i+1)*e._z+6*(-a+i)*s._z+(3*a-2*i)*r._z,n._w=6*(a-i)*t._w+(3*a-4*i+1)*e._w+6*(-a+i)*s._w+(3*a-2*i)*r._w,n._isDirty=!0,n}}class g{static get Use64Bits(){return o.Z.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=g._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(t,e=!1,s=!1,r=!0){this._isIdentity=t,this._isIdentity3x2=t||s,this._isIdentityDirty=!this._isIdentity&&e,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,o.Z.MatrixTrackPrecisionChange&&o.Z.MatrixTrackedMatrices.push(this),this._m=new o.Z.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const t=this._m;this._isIdentity=1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const t=this._m,e=t[0],s=t[1],r=t[2],i=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],_=t[9],c=t[10],u=t[11],d=t[12],g=t[13],f=t[14],p=t[15],m=c*p-f*u,R=_*p-g*u,T=_*f-g*c,x=l*p-d*u,E=l*f-c*d,y=l*g-d*_;return e*+(a*m-o*R+h*T)+s*-(n*m-o*x+h*E)+r*+(n*R-a*x+h*y)+i*-(n*T-a*E+o*y)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return g.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(t){const e=new this.constructor;return this.addToRef(t,e),e}addToRef(t,e){const s=this._m,r=e._m,i=t.m;for(let t=0;t<16;t++)r[t]=s[t]+i[t];return e.markAsUpdated(),e}addToSelf(t){const e=this._m,s=t.m;for(let t=0;t<16;t++)e[t]+=s[t];return this.markAsUpdated(),this}invertToRef(t){if(!0===this._isIdentity)return g.IdentityToRef(t),t;const e=this._m,s=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],_=e[8],c=e[9],u=e[10],d=e[11],f=e[12],p=e[13],m=e[14],R=e[15],T=u*R-m*d,x=c*R-p*d,E=c*m-p*u,y=_*R-f*d,b=_*m-u*f,A=_*p-f*c,S=+(o*T-h*x+l*E),C=-(a*T-h*y+l*b),F=+(a*x-o*y+l*A),w=-(a*E-o*b+h*A),v=s*S+r*C+i*F+n*w;if(0===v)return t.copyFrom(this),t;const P=1/v,M=h*R-m*l,D=o*R-p*l,L=o*m-p*h,I=a*R-f*l,B=a*m-f*h,O=a*p-f*o,U=h*d-u*l,N=o*d-c*l,z=o*u-c*h,G=a*d-_*l,k=a*u-_*h,V=a*c-_*o,H=-(r*T-i*x+n*E),X=+(s*T-i*y+n*b),W=-(s*x-r*y+n*A),Y=+(s*E-r*b+i*A),q=+(r*M-i*D+n*L),Z=-(s*M-i*I+n*B),j=+(s*D-r*I+n*O),Q=-(s*L-r*B+i*O),$=-(r*U-i*N+n*z),K=+(s*U-i*G+n*k),J=-(s*N-r*G+n*V),tt=+(s*z-r*k+i*V);return g.FromValuesToRef(S*P,H*P,q*P,$*P,C*P,X*P,Z*P,K*P,F*P,W*P,j*P,J*P,w*P,Y*P,Q*P,tt*P,t),t}addAtIndex(t,e){return this._m[t]+=e,this.markAsUpdated(),this}multiplyAtIndex(t,e){return this._m[t]*=e,this.markAsUpdated(),this}setTranslationFromFloats(t,e,s){return this._m[12]=t,this._m[13]=e,this._m[14]=s,this.markAsUpdated(),this}addTranslationFromFloats(t,e,s){return this._m[12]+=t,this._m[13]+=e,this._m[14]+=s,this.markAsUpdated(),this}setTranslation(t){return this.setTranslationFromFloats(t._x,t._y,t._z)}getTranslation(){return new c(this._m[12],this._m[13],this._m[14])}getTranslationToRef(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],t}removeRotationAndScaling(){const t=this.m;return g.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this}multiply(t){const e=new this.constructor;return this.multiplyToRef(t,e),e}copyFrom(t){t.copyToArray(this._m);const e=t;return this.updateFlag=e.updateFlag,this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this}copyToArray(t,e=0){const s=this._m;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],this}multiplyToRef(t,e){return this._isIdentity?(e.copyFrom(t),e):t._isIdentity?(e.copyFrom(this),e):(this.multiplyToArray(t,e._m,0),e.markAsUpdated(),e)}multiplyToArray(t,e,s){const r=this._m,i=t.m,n=r[0],a=r[1],o=r[2],h=r[3],l=r[4],_=r[5],c=r[6],u=r[7],d=r[8],g=r[9],f=r[10],p=r[11],m=r[12],R=r[13],T=r[14],x=r[15],E=i[0],y=i[1],b=i[2],A=i[3],S=i[4],C=i[5],F=i[6],w=i[7],v=i[8],P=i[9],M=i[10],D=i[11],L=i[12],I=i[13],B=i[14],O=i[15];return e[s]=n*E+a*S+o*v+h*L,e[s+1]=n*y+a*C+o*P+h*I,e[s+2]=n*b+a*F+o*M+h*B,e[s+3]=n*A+a*w+o*D+h*O,e[s+4]=l*E+_*S+c*v+u*L,e[s+5]=l*y+_*C+c*P+u*I,e[s+6]=l*b+_*F+c*M+u*B,e[s+7]=l*A+_*w+c*D+u*O,e[s+8]=d*E+g*S+f*v+p*L,e[s+9]=d*y+g*C+f*P+p*I,e[s+10]=d*b+g*F+f*M+p*B,e[s+11]=d*A+g*w+f*D+p*O,e[s+12]=m*E+R*S+T*v+x*L,e[s+13]=m*y+R*C+T*P+x*I,e[s+14]=m*b+R*F+T*M+x*B,e[s+15]=m*A+R*w+T*D+x*O,this}equals(t){const e=t;if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;const s=this.m,r=e.m;return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]&&s[4]===r[4]&&s[5]===r[5]&&s[6]===r[6]&&s[7]===r[7]&&s[8]===r[8]&&s[9]===r[9]&&s[10]===r[10]&&s[11]===r[11]&&s[12]===r[12]&&s[13]===r[13]&&s[14]===r[14]&&s[15]===r[15]}clone(){const t=new this.constructor;return t.copyFrom(this),t}getClassName(){return"Matrix"}getHashCode(){let t=l(this._m[0]);for(let e=1;e<16;e++)t=397*t^l(this._m[e]);return t}decomposeToTransformNode(t){return t.rotationQuaternion=t.rotationQuaternion||new d,this.decompose(t.scaling,t.rotationQuaternion,t.position)}decompose(t,e,s,r){if(this._isIdentity)return s&&s.setAll(0),t&&t.setAll(1),e&&e.copyFromFloats(0,0,0,1),!0;const i=this._m;if(s&&s.copyFromFloats(i[12],i[13],i[14]),(t=t||f.Vector3[0]).x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),t.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),t.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),r){const e=r.scaling.x<0?-1:1,s=r.scaling.y<0?-1:1,i=r.scaling.z<0?-1:1;t.x*=e,t.y*=s,t.z*=i}else this.determinant()<=0&&(t.y*=-1);if(0===t._x||0===t._y||0===t._z)return e&&e.copyFromFloats(0,0,0,1),!1;if(e){const s=1/t._x,r=1/t._y,n=1/t._z;g.FromValuesToRef(i[0]*s,i[1]*s,i[2]*s,0,i[4]*r,i[5]*r,i[6]*r,0,i[8]*n,i[9]*n,i[10]*n,0,0,0,0,1,f.Matrix[0]),d.FromRotationMatrixToRef(f.Matrix[0],e)}return!0}getRow(t){if(t<0||t>3)return null;const e=4*t;return new u(this._m[e+0],this._m[e+1],this._m[e+2],this._m[e+3])}getRowToRef(t,e){if(t>=0&&t<3){const s=4*t;e.x=this._m[s+0],e.y=this._m[s+1],e.z=this._m[s+2],e.w=this._m[s+3]}return e}setRow(t,e){return this.setRowFromFloats(t,e.x,e.y,e.z,e.w)}transpose(){const t=new this.constructor;return g.TransposeToRef(this,t),t}transposeToRef(t){return g.TransposeToRef(this,t),t}setRowFromFloats(t,e,s,r,i){if(t<0||t>3)return this;const n=4*t;return this._m[n+0]=e,this._m[n+1]=s,this._m[n+2]=r,this._m[n+3]=i,this.markAsUpdated(),this}scale(t){const e=new this.constructor;return this.scaleToRef(t,e),e}scaleToRef(t,e){for(let s=0;s<16;s++)e._m[s]=this._m[s]*t;return e.markAsUpdated(),e}scaleAndAddToRef(t,e){for(let s=0;s<16;s++)e._m[s]+=this._m[s]*t;return e.markAsUpdated(),e}toNormalMatrix(t){const e=f.Matrix[0];this.invertToRef(e),e.transposeToRef(t);const s=t._m;return g.FromValuesToRef(s[0],s[1],s[2],0,s[4],s[5],s[6],0,s[8],s[9],s[10],0,0,0,0,1,t),t}getRotationMatrix(){const t=new this.constructor;return this.getRotationMatrixToRef(t),t}getRotationMatrixToRef(t){const e=f.Vector3[0];if(!this.decompose(e))return g.IdentityToRef(t),t;const s=this._m,r=1/e._x,i=1/e._y,n=1/e._z;return g.FromValuesToRef(s[0]*r,s[1]*r,s[2]*r,0,s[4]*i,s[5]*i,s[6]*i,0,s[8]*n,s[9]*n,s[10]*n,0,0,0,0,1,t),t}toggleModelMatrixHandInPlace(){const t=this._m;return t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const t=this._m;return t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this.markAsUpdated(),this}static FromArray(t,e=0){const s=new g;return g.FromArrayToRef(t,e,s),s}static FromArrayToRef(t,e,s){for(let r=0;r<16;r++)s._m[r]=t[r+e];return s.markAsUpdated(),s}static FromFloat32ArrayToRefScaled(t,e,s,r){for(let i=0;i<16;i++)r._m[i]=t[i+e]*s;return r.markAsUpdated(),r}static get IdentityReadOnly(){return g._IdentityReadOnly}static FromValuesToRef(t,e,s,r,i,n,a,o,h,l,_,c,u,d,g,f,p){const m=p._m;m[0]=t,m[1]=e,m[2]=s,m[3]=r,m[4]=i,m[5]=n,m[6]=a,m[7]=o,m[8]=h,m[9]=l,m[10]=_,m[11]=c,m[12]=u,m[13]=d,m[14]=g,m[15]=f,p.markAsUpdated()}static FromValues(t,e,s,r,i,n,a,o,h,l,_,c,u,d,f,p){const m=new g,R=m._m;return R[0]=t,R[1]=e,R[2]=s,R[3]=r,R[4]=i,R[5]=n,R[6]=a,R[7]=o,R[8]=h,R[9]=l,R[10]=_,R[11]=c,R[12]=u,R[13]=d,R[14]=f,R[15]=p,m.markAsUpdated(),m}static Compose(t,e,s){const r=new g;return g.ComposeToRef(t,e,s,r),r}static ComposeToRef(t,e,s,r){const i=r._m,n=e._x,a=e._y,o=e._z,h=e._w,l=n+n,_=a+a,c=o+o,u=n*l,d=n*_,g=n*c,f=a*_,p=a*c,m=o*c,R=h*l,T=h*_,x=h*c,E=t._x,y=t._y,b=t._z;return i[0]=(1-(f+m))*E,i[1]=(d+x)*E,i[2]=(g-T)*E,i[3]=0,i[4]=(d-x)*y,i[5]=(1-(u+m))*y,i[6]=(p+R)*y,i[7]=0,i[8]=(g+T)*b,i[9]=(p-R)*b,i[10]=(1-(u+f))*b,i[11]=0,i[12]=s._x,i[13]=s._y,i[14]=s._z,i[15]=1,r.markAsUpdated(),r}static Identity(){const t=g.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t}static IdentityToRef(t){return g.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0),t}static Zero(){const t=g.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t}static RotationX(t){const e=new g;return g.RotationXToRef(t,e),e}static Invert(t){const e=new t.constructor;return t.invertToRef(e),e}static RotationXToRef(t,e){const s=Math.sin(t),r=Math.cos(t);return g.FromValuesToRef(1,0,0,0,0,r,s,0,0,-s,r,0,0,0,0,1,e),e._updateIdentityStatus(1===r&&0===s),e}static RotationY(t){const e=new g;return g.RotationYToRef(t,e),e}static RotationYToRef(t,e){const s=Math.sin(t),r=Math.cos(t);return g.FromValuesToRef(r,0,-s,0,0,1,0,0,s,0,r,0,0,0,0,1,e),e._updateIdentityStatus(1===r&&0===s),e}static RotationZ(t){const e=new g;return g.RotationZToRef(t,e),e}static RotationZToRef(t,e){const s=Math.sin(t),r=Math.cos(t);return g.FromValuesToRef(r,s,0,0,-s,r,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(1===r&&0===s),e}static RotationAxis(t,e){const s=new g;return g.RotationAxisToRef(t,e,s),s}static RotationAxisToRef(t,e,s){const r=Math.sin(-e),i=Math.cos(-e),n=1-i;t.normalize();const a=s._m;return a[0]=t._x*t._x*n+i,a[1]=t._x*t._y*n-t._z*r,a[2]=t._x*t._z*n+t._y*r,a[3]=0,a[4]=t._y*t._x*n+t._z*r,a[5]=t._y*t._y*n+i,a[6]=t._y*t._z*n-t._x*r,a[7]=0,a[8]=t._z*t._x*n-t._y*r,a[9]=t._z*t._y*n+t._x*r,a[10]=t._z*t._z*n+i,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,s.markAsUpdated(),s}static RotationAlignToRef(t,e,s){const r=c.Dot(e,t),n=s._m;if(r<-1+i.kn)n[0]=-1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0;else{const s=c.Cross(e,t),i=1/(1+r);n[0]=s._x*s._x*i+r,n[1]=s._y*s._x*i-s._z,n[2]=s._z*s._x*i+s._y,n[3]=0,n[4]=s._x*s._y*i+s._z,n[5]=s._y*s._y*i+r,n[6]=s._z*s._y*i-s._x,n[7]=0,n[8]=s._x*s._z*i-s._y,n[9]=s._y*s._z*i+s._x,n[10]=s._z*s._z*i+r,n[11]=0}return n[12]=0,n[13]=0,n[14]=0,n[15]=1,s.markAsUpdated(),s}static RotationYawPitchRoll(t,e,s){const r=new g;return g.RotationYawPitchRollToRef(t,e,s,r),r}static RotationYawPitchRollToRef(t,e,s,r){return d.RotationYawPitchRollToRef(t,e,s,f.Quaternion[0]),f.Quaternion[0].toRotationMatrix(r),r}static Scaling(t,e,s){const r=new g;return g.ScalingToRef(t,e,s,r),r}static ScalingToRef(t,e,s,r){return g.FromValuesToRef(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1,r),r._updateIdentityStatus(1===t&&1===e&&1===s),r}static Translation(t,e,s){const r=new g;return g.TranslationToRef(t,e,s,r),r}static TranslationToRef(t,e,s,r){return g.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,e,s,1,r),r._updateIdentityStatus(0===t&&0===e&&0===s),r}static Lerp(t,e,s){const r=new t.constructor;return g.LerpToRef(t,e,s,r),r}static LerpToRef(t,e,s,r){const i=r._m,n=t.m,a=e.m;for(let t=0;t<16;t++)i[t]=n[t]*(1-s)+a[t]*s;return r.markAsUpdated(),r}static DecomposeLerp(t,e,s){const r=new t.constructor;return g.DecomposeLerpToRef(t,e,s,r),r}static DecomposeLerpToRef(t,e,s,r){const i=f.Vector3[0],n=f.Quaternion[0],a=f.Vector3[1];t.decompose(i,n,a);const o=f.Vector3[2],h=f.Quaternion[1],l=f.Vector3[3];e.decompose(o,h,l);const _=f.Vector3[4];c.LerpToRef(i,o,s,_);const u=f.Quaternion[2];d.SlerpToRef(n,h,s,u);const p=f.Vector3[5];return c.LerpToRef(a,l,s,p),g.ComposeToRef(_,u,p,r),r}static LookAtLH(t,e,s){const r=new g;return g.LookAtLHToRef(t,e,s,r),r}static LookAtLHToRef(t,e,s,r){const i=f.Vector3[0],n=f.Vector3[1],a=f.Vector3[2];e.subtractToRef(t,a),a.normalize(),c.CrossToRef(s,a,i);const o=i.lengthSquared();0===o?i.x=1:i.normalizeFromLength(Math.sqrt(o)),c.CrossToRef(a,i,n),n.normalize();const h=-c.Dot(i,t),l=-c.Dot(n,t),_=-c.Dot(a,t);g.FromValuesToRef(i._x,n._x,a._x,0,i._y,n._y,a._y,0,i._z,n._z,a._z,0,h,l,_,1,r)}static LookAtRH(t,e,s){const r=new g;return g.LookAtRHToRef(t,e,s,r),r}static LookAtRHToRef(t,e,s,r){const i=f.Vector3[0],n=f.Vector3[1],a=f.Vector3[2];t.subtractToRef(e,a),a.normalize(),c.CrossToRef(s,a,i);const o=i.lengthSquared();0===o?i.x=1:i.normalizeFromLength(Math.sqrt(o)),c.CrossToRef(a,i,n),n.normalize();const h=-c.Dot(i,t),l=-c.Dot(n,t),_=-c.Dot(a,t);return g.FromValuesToRef(i._x,n._x,a._x,0,i._y,n._y,a._y,0,i._z,n._z,a._z,0,h,l,_,1,r),r}static LookDirectionLH(t,e){const s=new g;return g.LookDirectionLHToRef(t,e,s),s}static LookDirectionLHToRef(t,e,s){const r=f.Vector3[0];r.copyFrom(t),r.scaleInPlace(-1);const i=f.Vector3[1];return c.CrossToRef(e,r,i),g.FromValuesToRef(i._x,i._y,i._z,0,e._x,e._y,e._z,0,r._x,r._y,r._z,0,0,0,0,1,s),s}static LookDirectionRH(t,e){const s=new g;return g.LookDirectionRHToRef(t,e,s),s}static LookDirectionRHToRef(t,e,s){const r=f.Vector3[2];return c.CrossToRef(e,t,r),g.FromValuesToRef(r._x,r._y,r._z,0,e._x,e._y,e._z,0,t._x,t._y,t._z,0,0,0,0,1,s),s}static OrthoLH(t,e,s,r,i){const n=new g;return g.OrthoLHToRef(t,e,s,r,n,i),n}static OrthoLHToRef(t,e,s,r,i,n){const a=2/t,o=2/e,h=2/(r-s),l=-(r+s)/(r-s);return g.FromValuesToRef(a,0,0,0,0,o,0,0,0,0,h,0,0,0,l,1,i),n&&i.multiplyToRef(m,i),i._updateIdentityStatus(1===a&&1===o&&1===h&&0===l),i}static OrthoOffCenterLH(t,e,s,r,i,n,a){const o=new g;return g.OrthoOffCenterLHToRef(t,e,s,r,i,n,o,a),o}static OrthoOffCenterLHToRef(t,e,s,r,i,n,a,o){const h=2/(e-t),l=2/(r-s),_=2/(n-i),c=-(n+i)/(n-i),u=(t+e)/(t-e),d=(r+s)/(s-r);return g.FromValuesToRef(h,0,0,0,0,l,0,0,0,0,_,0,u,d,c,1,a),o&&a.multiplyToRef(m,a),a.markAsUpdated(),a}static OrthoOffCenterRH(t,e,s,r,i,n,a){const o=new g;return g.OrthoOffCenterRHToRef(t,e,s,r,i,n,o,a),o}static OrthoOffCenterRHToRef(t,e,s,r,i,n,a,o){return g.OrthoOffCenterLHToRef(t,e,s,r,i,n,a,o),a._m[10]*=-1,a}static PerspectiveLH(t,e,s,r,i,n=0){const a=new g,o=2*s/t,h=2*s/e,l=(r+s)/(r-s),_=-2*r*s/(r-s),c=Math.tan(n);return g.FromValuesToRef(o,0,0,0,0,h,0,c,0,0,l,1,0,0,_,0,a),i&&a.multiplyToRef(m,a),a._updateIdentityStatus(!1),a}static PerspectiveFovLH(t,e,s,r,i,n=0,a=!1){const o=new g;return g.PerspectiveFovLHToRef(t,e,s,r,o,!0,i,n,a),o}static PerspectiveFovLHToRef(t,e,s,r,i,n=!0,a,o=0,h=!1){const l=s,_=r,c=1/Math.tan(.5*t),u=n?c/e:c,d=n?c:c*e,f=h&&0===l?-1:0!==_?(_+l)/(_-l):1,p=h&&0===l?2*_:0!==_?-2*_*l/(_-l):-2*l,R=Math.tan(o);return g.FromValuesToRef(u,0,0,0,0,d,0,R,0,0,f,1,0,0,p,0,i),a&&i.multiplyToRef(m,i),i._updateIdentityStatus(!1),i}static PerspectiveFovReverseLHToRef(t,e,s,r,i,n=!0,a,o=0){const h=1/Math.tan(.5*t),l=n?h/e:h,_=n?h:h*e,c=Math.tan(o);return g.FromValuesToRef(l,0,0,0,0,_,0,c,0,0,-s,1,0,0,1,0,i),a&&i.multiplyToRef(m,i),i._updateIdentityStatus(!1),i}static PerspectiveFovRH(t,e,s,r,i,n=0,a=!1){const o=new g;return g.PerspectiveFovRHToRef(t,e,s,r,o,!0,i,n,a),o}static PerspectiveFovRHToRef(t,e,s,r,i,n=!0,a,o=0,h=!1){const l=s,_=r,c=1/Math.tan(.5*t),u=n?c/e:c,d=n?c:c*e,f=h&&0===l?1:0!==_?-(_+l)/(_-l):-1,p=h&&0===l?2*_:0!==_?-2*_*l/(_-l):-2*l,R=Math.tan(o);return g.FromValuesToRef(u,0,0,0,0,d,0,R,0,0,f,-1,0,0,p,0,i),a&&i.multiplyToRef(m,i),i._updateIdentityStatus(!1),i}static PerspectiveFovReverseRHToRef(t,e,s,r,i,n=!0,a,o=0){const h=1/Math.tan(.5*t),l=n?h/e:h,_=n?h:h*e,c=Math.tan(o);return g.FromValuesToRef(l,0,0,0,0,_,0,c,0,0,-s,-1,0,0,-1,0,i),a&&i.multiplyToRef(m,i),i._updateIdentityStatus(!1),i}static PerspectiveFovWebVRToRef(t,e,s,r,i=!1,n,a=0){const o=i?-1:1,h=Math.tan(t.upDegrees*Math.PI/180),l=Math.tan(t.downDegrees*Math.PI/180),_=Math.tan(t.leftDegrees*Math.PI/180),c=Math.tan(t.rightDegrees*Math.PI/180),u=2/(_+c),d=2/(h+l),g=Math.tan(a),f=r._m;return f[0]=u,f[1]=f[2]=f[3]=f[4]=0,f[5]=d,f[6]=0,f[7]=g,f[8]=(_-c)*u*.5,f[9]=-(h-l)*d*.5,f[10]=-s/(e-s),f[11]=1*o,f[12]=f[13]=f[15]=0,f[14]=-2*s*e/(s-e),n&&r.multiplyToRef(m,r),r.markAsUpdated(),r}static GetFinalMatrix(t,e,s,r,i,n){const a=t.width,o=t.height,h=t.x,l=t.y,_=g.FromValues(a/2,0,0,0,0,-o/2,0,0,0,0,n-i,0,h+a/2,o/2+l,i,1),c=new e.constructor;return e.multiplyToRef(s,c),c.multiplyToRef(r,c),c.multiplyToRef(_,c)}static GetAsMatrix2x2(t){const e=t.m,s=[e[0],e[1],e[4],e[5]];return o.Z.MatrixUse64Bits?s:new Float32Array(s)}static GetAsMatrix3x3(t){const e=t.m,s=[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]];return o.Z.MatrixUse64Bits?s:new Float32Array(s)}static Transpose(t){const e=new t.constructor;return g.TransposeToRef(t,e),e}static TransposeToRef(t,e){const s=e._m,r=t.m;return s[0]=r[0],s[1]=r[4],s[2]=r[8],s[3]=r[12],s[4]=r[1],s[5]=r[5],s[6]=r[9],s[7]=r[13],s[8]=r[2],s[9]=r[6],s[10]=r[10],s[11]=r[14],s[12]=r[3],s[13]=r[7],s[14]=r[11],s[15]=r[15],e.markAsUpdated(),e._updateIdentityStatus(t._isIdentity,t._isIdentityDirty),e}static Reflection(t){const e=new g;return g.ReflectionToRef(t,e),e}static ReflectionToRef(t,e){t.normalize();const s=t.normal.x,r=t.normal.y,i=t.normal.z,n=-2*s,a=-2*r,o=-2*i;return g.FromValuesToRef(n*s+1,a*s,o*s,0,n*r,a*r+1,o*r,0,n*i,a*i,o*i+1,0,n*t.d,a*t.d,o*t.d,1,e),e}static FromXYZAxesToRef(t,e,s,r){return g.FromValuesToRef(t._x,t._y,t._z,0,e._x,e._y,e._z,0,s._x,s._y,s._z,0,0,0,0,1,r),r}static FromQuaternionToRef(t,e){const s=t._x*t._x,r=t._y*t._y,i=t._z*t._z,n=t._x*t._y,a=t._z*t._w,o=t._z*t._x,h=t._y*t._w,l=t._y*t._z,_=t._x*t._w;return e._m[0]=1-2*(r+i),e._m[1]=2*(n+a),e._m[2]=2*(o-h),e._m[3]=0,e._m[4]=2*(n-a),e._m[5]=1-2*(i+s),e._m[6]=2*(l+_),e._m[7]=0,e._m[8]=2*(o+h),e._m[9]=2*(l-_),e._m[10]=1-2*(r+s),e._m[11]=0,e._m[12]=0,e._m[13]=0,e._m[14]=0,e._m[15]=1,e.markAsUpdated(),e}}g._UpdateFlagSeed=0,g._IdentityReadOnly=g.Identity();class f{}f.Vector3=n.B.BuildTuple(11,c.Zero),f.Matrix=n.B.BuildTuple(2,g.Identity),f.Quaternion=n.B.BuildTuple(3,d.Zero);class p{}p.Vector2=n.B.BuildTuple(3,_.Zero),p.Vector3=n.B.BuildTuple(13,c.Zero),p.Vector4=n.B.BuildTuple(3,u.Zero),p.Quaternion=n.B.BuildTuple(2,d.Zero),p.Matrix=n.B.BuildTuple(8,g.Identity),(0,a.H)("BABYLON.Vector2",_),(0,a.H)("BABYLON.Vector3",c),(0,a.H)("BABYLON.Vector4",u),(0,a.H)("BABYLON.Matrix",g);const m=g.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},470:(t,e,s)=>{s.d(e,{l:()=>r});class r{constructor(t,e,s,r){this.x=t,this.y=e,this.width=s,this.height=r}toGlobal(t,e){return new r(this.x*t,this.y*e,this.width*t,this.height*e)}toGlobalToRef(t,e,s){return s.x=this.x*t,s.y=this.y*e,s.width=this.width*t,s.height=this.height*e,this}clone(){return new r(this.x,this.y,this.width,this.height)}}},4081:(t,e,s)=>{s.d(e,{M:()=>i});var r=s(1545);class i extends r.h{constructor(t){super(),this._buffer=t}get underlyingResource(){return this._buffer}}},2554:(t,e,s)=>{s.d(e,{B:()=>r,M:()=>n});class r{static BuildArray(t,e){const s=[];for(let r=0;r<t;++r)s.push(e());return s}static BuildTuple(t,e){return r.BuildArray(t,e)}}const i=["push","splice","pop","shift","unshift"];function n(t,e){const s=i.map((s=>function(t,e,s){const r=t[e];if("function"!=typeof r)return null;const i=function(){const r=t.length,n=i.previous.apply(t,arguments);return s(e,r),n};return r.next=i,i.previous=r,t[e]=i,()=>{const s=i.previous;if(!s)return;const r=i.next;r?(s.next=r,r.previous=s):(s.next=void 0,t[e]=s),i.next=void 0,i.previous=void 0}}(t,s,e)));return()=>{s.forEach((t=>{null==t||t()}))}}},9069:(t,e,s)=>{function r(t){return`${t} needs to be imported before as it contains a side-effect required by your code.`}s.d(e,{S:()=>r})},1102:(t,e,s)=>{function r(){return"undefined"!=typeof window}function i(){return"undefined"!=typeof navigator}function n(){return"undefined"!=typeof document}function a(t){let e="",s=t.firstChild;for(;s;)3===s.nodeType&&(e+=s.textContent),s=s.nextSibling;return e}s.d(e,{CG:()=>r,MZ:()=>o,n5:()=>n,up:()=>i,v:()=>a});const o={IsWindowObjectExist:r,IsNavigatorAvailable:i,IsDocumentAvailable:n,GetDOMTextContent:a}},658:(t,e,s)=>{s.d(e,{Y:()=>r});class r{static _CheckLimit(t,e){let s=r._LogLimitOutputs[t];return s?s.current++:(s={limit:e,current:1},r._LogLimitOutputs[t]=s),s.current<=s.limit}static _GenerateLimitMessage(t,e=1){var s;const i=r._LogLimitOutputs[t];if(!i||!r.MessageLimitReached)return;const n=this._Levels[e];i.current===i.limit&&r[n.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,null!==(s=n.name)&&void 0!==s?s:""))}static _AddLogEntry(t){r._LogCache=t+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(t)}static _FormatMessage(t){const e=t=>t<10?"0"+t:""+t,s=new Date;return"["+e(s.getHours())+":"+e(s.getMinutes())+":"+e(s.getSeconds())+"]: "+t}static _LogDisabled(t,e){}static _LogEnabled(t=1,e,s){if(void 0!==s&&!r._CheckLimit(e,s))return;const i=r._FormatMessage(e),n=this._Levels[t];n.logFunc&&n.logFunc("BJS - "+i);const a=`<div style='color:${n.color}'>${i}</div><br>`;r._AddLogEntry(a),r._GenerateLimitMessage(e,t)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(t){r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled,[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel].forEach((e=>{if((t&e)===e){const t=this._Levels[e];r[t.name]=r._LogEnabled.bind(r,e)}}))}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},8139:(t,e,s)=>{s.d(e,{y$:()=>n});class r{constructor(t,e=!1,s,r){this.initialize(t,e,s,r)}initialize(t,e=!1,s,r){return this.mask=t,this.skipNextObservers=e,this.target=s,this.currentTarget=r,this}}class i{constructor(t,e,s=null){this.callback=t,this.mask=e,this.scope=s,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}}class n{static FromPromise(t,e){const s=new n;return t.then((t=>{s.notifyObservers(t)})).catch((t=>{if(!e)throw t;e.notifyObservers(t)})),s}get observers(){return this._observers}constructor(t,e=!1){this.notifyIfTriggered=e,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new r(0),t&&(this._onObserverAdded=t)}add(t,e=-1,s=!1,r=null,n=!1){if(!t)return null;const a=new i(t,e,r);return a.unregisterOnNextCall=n,s?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(a,this._lastNotifiedValue),a}addOnce(t){return this.add(t,void 0,void 0,void 0,!0)}remove(t){return!!t&&(-1!==this._observers.indexOf(t)&&(this._deferUnregister(t),!0))}removeCallback(t,e){for(let s=0;s<this._observers.length;s++){const r=this._observers[s];if(!(r._willBeUnregistered||r.callback!==t||e&&e!==r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(t){this._numObserversMarkedAsDeleted++,t.unregisterOnNextCall=!1,t._willBeUnregistered=!0,setTimeout((()=>{this._remove(t)}),0)}_remove(t,e=!0){if(!t)return!1;const s=this._observers.indexOf(t);return-1!==s&&(e&&this._numObserversMarkedAsDeleted--,this._observers.splice(s,1),!0)}makeObserverTopPriority(t){this._remove(t,!1),this._observers.unshift(t)}makeObserverBottomPriority(t){this._remove(t,!1),this._observers.push(t)}notifyObservers(t,e=-1,s,r,i){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),!this._observers.length)return!0;const n=this._eventState;n.mask=e,n.target=s,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=t,n.userInfo=i;for(const s of this._observers)if(!s._willBeUnregistered&&(s.mask&e&&(s.unregisterOnNextCall&&this._deferUnregister(s),s.scope?n.lastReturnValue=s.callback.apply(s.scope,[t,n]):n.lastReturnValue=s.callback(t,n)),n.skipNextObservers))return!1;return!0}notifyObserver(t,e,s=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),t._willBeUnregistered)return;const r=this._eventState;r.mask=s,r.skipNextObservers=!1,t.unregisterOnNextCall&&this._deferUnregister(t),t.callback(e,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){this._observers.length=0,this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const t=new n;return t._observers=this._observers.slice(0),t}hasSpecificMask(t=-1){for(const e of this._observers)if(e.mask&t||e.mask===t)return!0;return!1}}},8482:(t,e,s)=>{s.d(e,{z:()=>i});var r=s(9665);class i{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(t,e){i.Enabled&&(this._current+=t,e&&this._fetchResult())}beginMonitoring(){i.Enabled&&(this._startMonitoringTime=r.F.Now)}endMonitoring(t=!0){if(!i.Enabled)return;t&&this.fetchNewFrame();const e=r.F.Now;this._current=e-this._startMonitoringTime,t&&this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const t=r.F.Now;t-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=t,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}i.Enabled=!0},9665:(t,e,s)=>{s.d(e,{F:()=>i});var r=s(1102);class i{static get Now(){return r.MZ.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},646:(t,e,s)=>{s.d(e,{H:()=>i,q:()=>n});const r={};function i(t,e){r[t]=e}function n(t){return r[t]}}},s={};function r(t){var i=s[t];if(void 0!==i)return i.exports;var n=s[t]={exports:{}};return e[t](n,n.exports,r),n.exports}r.m=e,t=[],r.O=(e,s,i,n)=>{if(!s){var a=1/0;for(_=0;_<t.length;_++){for(var[s,i,n]=t[_],o=!0,h=0;h<s.length;h++)(!1&n||a>=n)&&Object.keys(r.O).every((t=>r.O[t](s[h])))?s.splice(h--,1):(o=!1,n<a&&(a=n));if(o){t.splice(_--,1);var l=i();void 0!==l&&(e=l)}}return e}n=n||0;for(var _=t.length;_>0&&t[_-1][2]>n;_--)t[_]=t[_-1];t[_]=[s,i,n]},r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={405:0};r.O.j=e=>0===t[e];var e=(e,s)=>{var i,n,[a,o,h]=s,l=0;if(a.some((e=>0!==t[e]))){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(h)var _=h(r)}for(e&&e(s);l<a.length;l++)n=a[l],r.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return r.O(_)},s=self.webpackChunkgame=self.webpackChunkgame||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),r(8830);var i=r(2352);i=r.O(i)})();