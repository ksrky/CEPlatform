"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[340],{4515:(e,t,s)=>{s.d(t,{V:()=>p});var i=s(1069),r=s(8137),n=s(8173),a=s(8658),o=s(8139),h=s(5412),l=s(6387),c=s(658),d=s(646),u=s(9069),f=s(470),_=s(8952);class p extends l.N{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){var e,t,s,i;let r=0,n=0;if(this.mode===p.PERSPECTIVE_CAMERA)this.fovMode===p.FOVMODE_VERTICAL_FIXED?(n=2*this.minZ*Math.tan(this.fov/2),r=this.getEngine().getAspectRatio(this)*n):(r=2*this.minZ*Math.tan(this.fov/2),n=r/this.getEngine().getAspectRatio(this));else{const a=this.getEngine().getRenderWidth()/2,o=this.getEngine().getRenderHeight()/2;r=(null!==(e=this.orthoRight)&&void 0!==e?e:a)-(null!==(t=this.orthoLeft)&&void 0!==t?t:-a),n=(null!==(s=this.orthoTop)&&void 0!==s?s:o)-(null!==(i=this.orthoBottom)&&void 0!==i?i:-o)}return r*n}set orthoLeft(e){this._orthoLeft=e;for(const t of this._rigCameras)t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){this._orthoRight=e;for(const t of this._rigCameras)t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){this._orthoBottom=e;for(const t of this._rigCameras)t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){this._orthoTop=e;for(const t of this._rigCameras)t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){this._mode=e;for(const t of this._rigCameras)t.mode=e}get mode(){return this._mode}constructor(e,t,s,i=!0){super(e,s),this._position=h.P.Zero(),this._upVector=h.P.Up(),this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=p.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new f.l(0,0,1,1),this.layerMask=268435455,this.fovMode=p.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=p.RIG_MODE_NONE,this.customRenderTargets=new Array,this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new o.y$,this.onProjectionMatrixChangedObservable=new o.y$,this.onAfterCheckInputsObservable=new o.y$,this.onRestoreStateObservable=new o.y$,this.isRigCamera=!1,this._rigCameras=new Array,this._webvrViewMatrix=h.y3.Identity(),this._skipRendering=!1,this._projectionMatrix=new h.y3,this._postProcesses=new Array,this._activeMeshes=new n.t(256),this._globalPosition=h.P.Zero(),this._computedViewMatrix=h.y3.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=h.y3.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=h._f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),i&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let s=0;s<this.animations.length;s++)t+=", animation[0]: "+this.animations[s].toString(e);return t}applyVerticalCorrection(){const e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}isReady(e=!1){if(e)for(const e of this._postProcesses)if(e&&!e.isReady())return!1;return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;const t=this.getEngine();return e=this.mode===p.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),e}attachControl(e,t){}detachControl(e){}update(){this._checkInputs(),this.cameraRigMode!==p.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){const e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let e=0,t=this._rigCameras.length;e<t;e++){const t=this._rigCameras[e],s=t._rigPostProcess;s?("pass"===s.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()):t._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(c.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){const t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return h.y3.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){var t,s,i,r,n,a,o,l;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),d=this.getScene(),u=c.useReverseDepthBuffer;if(this.mode===p.PERSPECTIVE_CAMERA){let e;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),e=d.useRightHandedSystem?h.y3.PerspectiveFovRHToRef:h.y3.PerspectiveFovLHToRef,e(this.fov,c.getAspectRatio(this),u?this.maxZ:this.minZ,u?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===p.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,u)}else{const e=c.getRenderWidth()/2,f=c.getRenderHeight()/2;d.useRightHandedSystem?h.y3.OrthoOffCenterRHToRef(null!==(t=this.orthoLeft)&&void 0!==t?t:-e,null!==(s=this.orthoRight)&&void 0!==s?s:e,null!==(i=this.orthoBottom)&&void 0!==i?i:-f,null!==(r=this.orthoTop)&&void 0!==r?r:f,u?this.maxZ:this.minZ,u?this.minZ:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):h.y3.OrthoOffCenterLHToRef(null!==(n=this.orthoLeft)&&void 0!==n?n:-e,null!==(a=this.orthoRight)&&void 0!==a?a:e,null!==(o=this.orthoBottom)&&void 0!==o?o:-f,null!==(l=this.orthoTop)&&void 0!==l?l:f,u?this.maxZ:this.minZ,u?this.minZ:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?_.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=_.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((s=>{s._updateFrustumPlanes(),t=t||e.isInFrustum(s._frustumPlanes)})),t}return e.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(e=100,t,s){throw(0,u.S)("Ray")}getForwardRayToRef(e,t=100,s,i){throw(0,u.S)("Ray")}dispose(e,t=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){const e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==p.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){const t=this._postProcesses[e];t&&t.dispose(this)}}let s=this.customRenderTargets.length;for(;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){const e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==p.RIG_MODE_NONE){const e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return h.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}_updateCameraRotationMatrix(){}_updateWebVRCameraRotationMatrix(){}_getWebVRProjectionMatrix(){return h.y3.Identity()}_getWebVRViewMatrix(){return h.y3.Identity()}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=a.w1.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===p.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const e=r.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),r.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e,t=null){const s=r.p4.Clone(p.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return s.name=e,s.parent=t,this.onClonedObservable.notifyObservers(s),s}getDirection(e){const t=h.P.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){h.P.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,s,i=0,r=!0){return l.N.Construct(e,t,s,{interaxial_distance:i,isStereoscopicSideBySide:r})||(()=>p._CreateDefaultParsedCamera(t,s))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){const s=e.type,i=p.GetConstructorFromName(s,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),n=r.p4.Parse(i,e,t);if(void 0!==e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(n._waitingParentInstanceIndex=e.parentInstanceIndex),n.inputs&&(n.inputs.parse(e),n._setupInputs()),e.upVector&&(n.upVector=h.P.FromArray(e.upVector)),n.setPosition&&(n.position.copyFromFloats(0,0,0),n.setPosition(h.P.FromArray(e.position))),e.target&&n.setTarget&&n.setTarget(h.P.FromArray(e.target)),e.cameraRigMode){const t=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};n.setCameraRigMode(e.cameraRigMode,t)}if(e.animations){for(let t=0;t<e.animations.length;t++){const s=e.animations[t],i=(0,d.q)("BABYLON.Animation");i&&n.animations.push(i.Parse(s))}l.N.ParseAnimationRanges(n,e,t)}return e.autoAnimate&&t.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&n.setEnabled(e.isEnabled),n}}p._CreateDefaultParsedCamera=(e,t)=>{throw(0,u.S)("UniversalCamera")},p.PERSPECTIVE_CAMERA=0,p.ORTHOGRAPHIC_CAMERA=1,p.FOVMODE_VERTICAL_FIXED=0,p.FOVMODE_HORIZONTAL_FIXED=1,p.RIG_MODE_NONE=0,p.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,p.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,p.RIG_MODE_STEREOSCOPIC_INTERLACED=14,p.RIG_MODE_VR=20,p.RIG_MODE_WEBVR=21,p.RIG_MODE_CUSTOM=22,p.ForceAttachControlToAlwaysPreventDefault=!1,(0,i.gn)([(0,r.hd)("position")],p.prototype,"_position",void 0),(0,i.gn)([(0,r.hd)("upVector")],p.prototype,"_upVector",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"orthoLeft",null),(0,i.gn)([(0,r.qC)()],p.prototype,"orthoRight",null),(0,i.gn)([(0,r.qC)()],p.prototype,"orthoBottom",null),(0,i.gn)([(0,r.qC)()],p.prototype,"orthoTop",null),(0,i.gn)([(0,r.qC)()],p.prototype,"fov",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"projectionPlaneTilt",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"minZ",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"maxZ",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"inertia",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"mode",null),(0,i.gn)([(0,r.qC)()],p.prototype,"layerMask",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"fovMode",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"cameraRigMode",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"interaxialDistance",void 0),(0,i.gn)([(0,r.qC)()],p.prototype,"isStereoscopicSideBySide",void 0)},6629:(e,t,s)=>{s.d(t,{e:()=>i});class i{}i.UseOpenGLOrientationForUV=!1},2543:(e,t,s)=>{s.d(t,{j:()=>u});var i=s(2554),r=s(5412),n=s(4551);class a{constructor(e,t,s){this.vectors=i.B.BuildArray(8,r.P.Zero),this.center=r.P.Zero(),this.centerWorld=r.P.Zero(),this.extendSize=r.P.Zero(),this.extendSizeWorld=r.P.Zero(),this.directions=i.B.BuildArray(3,r.P.Zero),this.vectorsWorld=i.B.BuildArray(8,r.P.Zero),this.minimumWorld=r.P.Zero(),this.maximumWorld=r.P.Zero(),this.minimum=r.P.Zero(),this.maximum=r.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,s)}reConstruct(e,t,s){const i=e.x,n=e.y,a=e.z,o=t.x,h=t.y,l=t.z,c=this.vectors;this.minimum.copyFromFloats(i,n,a),this.maximum.copyFromFloats(o,h,l),c[0].copyFromFloats(i,n,a),c[1].copyFromFloats(o,h,l),c[2].copyFromFloats(o,n,a),c[3].copyFromFloats(i,h,a),c[4].copyFromFloats(i,n,l),c[5].copyFromFloats(o,h,a),c[6].copyFromFloats(i,h,l),c[7].copyFromFloats(o,n,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=s||r.y3.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const t=a._TmpVector3,s=this.maximum.subtractToRef(this.minimum,t[0]),i=s.length();s.normalizeFromLength(i);const r=i*e,n=s.scaleInPlace(.5*r),o=this.center.subtractToRef(n,t[1]),h=this.center.addToRef(n,t[2]);return this.reConstruct(o,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const t=this.minimumWorld,s=this.maximumWorld,i=this.directions,n=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),s.copyFrom(this.maximum);for(let e=0;e<8;++e)n[e].copyFrom(a[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),s.setAll(-Number.MAX_VALUE);for(let i=0;i<8;++i){const o=n[i];r.P.TransformCoordinatesToRef(a[i],e,o),t.minimizeInPlace(o),s.maximizeInPlace(o)}s.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),s.addToRef(t,this.centerWorld).scaleInPlace(.5)}r.P.FromArrayToRef(e.m,0,i[0]),r.P.FromArrayToRef(e.m,4,i[1]),r.P.FromArrayToRef(e.m,8,i[2]),this._worldMatrix=e}isInFrustum(e){return a.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return a.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const t=this.minimumWorld,s=this.maximumWorld,i=t.x,r=t.y,a=t.z,o=s.x,h=s.y,l=s.z,c=e.x,d=e.y,u=e.z,f=-n.kn;return!(o-c<f||f>c-i||h-d<f||f>d-r||l-u<f||f>u-a)}intersectsSphere(e){return a.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){const s=this.minimumWorld,i=this.maximumWorld,r=s.x,n=s.y,a=s.z,o=i.x,h=i.y,l=i.z,c=e.x,d=e.y,u=e.z,f=t.x,_=t.y,p=t.z;return!(o<c||r>f||h<d||n>_||l<u||a>p)}dispose(){var e,t;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,s,i){const n=a._TmpVector3[0];return r.P.ClampToRef(s,e,t,n),r.P.DistanceSquared(s,n)<=i*i}static IsCompletelyInFrustum(e,t){for(let s=0;s<6;++s){const i=t[s];for(let t=0;t<8;++t)if(i.dotCoordinate(e[t])<0)return!1}return!0}static IsInFrustum(e,t){for(let s=0;s<6;++s){let i=!0;const r=t[s];for(let t=0;t<8;++t)if(r.dotCoordinate(e[t])>=0){i=!1;break}if(i)return!1}return!0}}a._TmpVector3=i.B.BuildArray(3,r.P.Zero);class o{constructor(e,t,s){this.center=r.P.Zero(),this.centerWorld=r.P.Zero(),this.minimum=r.P.Zero(),this.maximum=r.P.Zero(),this.reConstruct(e,t,s)}reConstruct(e,t,s){this.minimum.copyFrom(e),this.maximum.copyFrom(t);const i=r.P.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(s||r.y3.IdentityReadOnly)}scale(e){const t=this.radius*e,s=o._TmpVector3,i=s[0].setAll(t),r=this.center.subtractToRef(i,s[1]),n=this.center.addToRef(i,s[2]);return this.reConstruct(r,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{r.P.TransformCoordinatesToRef(this.center,e,this.centerWorld);const t=o._TmpVector3[0];r.P.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){const t=this.centerWorld,s=this.radiusWorld;for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<=-s)return!1;return!0}isCenterInFrustum(e){const t=this.centerWorld;for(let s=0;s<6;s++)if(e[s].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(e){const t=r.P.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){const s=r.P.DistanceSquared(e.centerWorld,t.centerWorld),i=e.radiusWorld+t.radiusWorld;return!(i*i<s)}static CreateFromCenterAndRadius(e,t,s){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const i=new o(this._TmpVector3[0],this._TmpVector3[2]);return i._worldMatrix=s||r.y3.Identity(),i}}o._TmpVector3=i.B.BuildArray(3,r.P.Zero);const h={min:0,max:0},l={min:0,max:0},c=(e,t,s)=>{const i=r.P.Dot(t.centerWorld,e),n=Math.abs(r.P.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(r.P.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(r.P.Dot(t.directions[2],e))*t.extendSize.z;s.min=i-n,s.max=i+n},d=(e,t,s)=>(c(e,t,h),c(e,s,l),!(h.min>l.max||l.min>h.max));class u{constructor(e,t,s){this._isLocked=!1,this.boundingBox=new a(e,t,s),this.boundingSphere=new o(e,t,s)}reConstruct(e,t,s){this.boundingBox.reConstruct(e,t,s),this.boundingSphere.reConstruct(e,t,s)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){const s=u._TmpVector3[0].copyFrom(e).subtractInPlace(t),i=u._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(s,i,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(s,i,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const t=r.P.Minimize(this.minimum,e),s=r.P.Maximize(this.maximum,e);return this.reConstruct(t,s,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){return this.encapsulate(e.boundingBox.centerWorld.subtract(e.boundingBox.extendSizeWorld)),this.encapsulate(e.boundingBox.centerWorld.add(e.boundingBox.extendSizeWorld)),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e,t=0){return!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e))}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)}intersects(e,t){if(!o.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!a.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;const s=this.boundingBox,i=e.boundingBox;return!!(d(s.directions[0],s,i)&&d(s.directions[1],s,i)&&d(s.directions[2],s,i)&&d(i.directions[0],s,i)&&d(i.directions[1],s,i)&&d(i.directions[2],s,i)&&d(r.P.Cross(s.directions[0],i.directions[0]),s,i)&&d(r.P.Cross(s.directions[0],i.directions[1]),s,i)&&d(r.P.Cross(s.directions[0],i.directions[2]),s,i)&&d(r.P.Cross(s.directions[1],i.directions[0]),s,i)&&d(r.P.Cross(s.directions[1],i.directions[1]),s,i)&&d(r.P.Cross(s.directions[1],i.directions[2]),s,i)&&d(r.P.Cross(s.directions[2],i.directions[0]),s,i)&&d(r.P.Cross(s.directions[2],i.directions[1]),s,i)&&d(r.P.Cross(s.directions[2],i.directions[2]),s,i))}}u._TmpVector3=i.B.BuildArray(2,r.P.Zero)},5356:(e,t,s)=>{s.d(t,{x:()=>y});var i=s(1069),r=s(8137),n=s(8139),a=s(5412),o=s(5953),h=s(3706),l=(s(9485),s(3321));class c{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return void 0!==(null==e?void 0:e._shareDepth)}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=l.$.Zero(),this._cachedBaseSize=l.$.Zero(),this._initialSamplingMode=2,this._texture=c._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}class d extends c{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(e){this._texture&&(this._texture._isRGBD=e)}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=(0,h.f)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=new Array,this.onDisposeObservable=new n.y$,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?d._IsScene(e)?this._scene=e:this._engine=e:this._scene=o.l.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}checkTransformsAreIdentical(e){return null!==e}getTextureMatrix(){return a.y3.IdentityReadOnly}getReflectionTextureMatrix(){return a.y3.IdentityReadOnly}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,s,i,r,n){const a=this._getEngine();if(!a)return null;const o=a._getUseSRGBBuffer(!!r,t),h=a.getLoadedTexturesCache();for(let a=0;a<h.length;a++){const l=h[a];if(!(void 0!==r&&o!==l._useSRGBBuffer||void 0!==i&&i!==l.invertY||l.url!==e||l.generateMipMaps!==!t||s&&s!==l.samplingMode||void 0!==n&&n!==l.isCube))return l.incrementReferences(),l}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,s=null,i=!0,r=!1,n=0,a=0,o=Number.MAX_VALUE,h=Number.MAX_VALUE){if(!this._texture)return null;const l=this._getEngine();if(!l)return null;const c=this.getSize();let d=c.width,u=c.height;0!==t&&(d/=Math.pow(2,t),u/=Math.pow(2,t),d=Math.round(d),u=Math.round(u)),o=Math.min(d,o),h=Math.min(u,h);try{return this._texture.isCube?l._readTexturePixels(this._texture,o,h,e,t,s,i,r,n,a):l._readTexturePixels(this._texture,o,h,-1,t,s,i,r,n,a)}catch(e){return null}}_readPixelsSync(e=0,t=0,s=null,i=!0,r=!1){if(!this._texture)return null;const n=this.getSize();let a=n.width,o=n.height;const h=this._getEngine();if(!h)return null;0!=t&&(a/=Math.pow(2,t),o/=Math.pow(2,t),a=Math.round(a),o=Math.round(o));try{return this._texture.isCube?h._readTexturePixelsSync(this._texture,a,o,e,t,s,i,r):h._readTexturePixelsSync(this._texture,a,o,-1,t,s,i,r)}catch(e){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=r.p4.Serialize(this);return r.p4.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let s=e.length;if(0!==s)for(let i=0;i<e.length;i++){const r=e[i];if(r.isReady())0==--s&&t();else{const e=r.onLoadObservable;e?e.addOnce((()=>{0==--s&&t()})):0==--s&&t()}}else t()}static _IsScene(e){return"Scene"===e.getClassName()}}d.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,i.gn)([(0,r.qC)()],d.prototype,"uniqueId",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"name",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"metadata",void 0),(0,i.gn)([(0,r.qC)("hasAlpha")],d.prototype,"_hasAlpha",void 0),(0,i.gn)([(0,r.qC)("getAlphaFromRGB")],d.prototype,"_getAlphaFromRGB",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"level",void 0),(0,i.gn)([(0,r.qC)("coordinatesIndex")],d.prototype,"_coordinatesIndex",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"optimizeUVAllocation",void 0),(0,i.gn)([(0,r.qC)("coordinatesMode")],d.prototype,"_coordinatesMode",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"wrapU",null),(0,i.gn)([(0,r.qC)()],d.prototype,"wrapV",null),(0,i.gn)([(0,r.qC)()],d.prototype,"wrapR",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"anisotropicFilteringLevel",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"isCube",null),(0,i.gn)([(0,r.qC)()],d.prototype,"is3D",null),(0,i.gn)([(0,r.qC)()],d.prototype,"is2DArray",null),(0,i.gn)([(0,r.qC)()],d.prototype,"gammaSpace",null),(0,i.gn)([(0,r.qC)()],d.prototype,"invertZ",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"lodLevelInAlpha",void 0),(0,i.gn)([(0,r.qC)()],d.prototype,"lodGenerationOffset",null),(0,i.gn)([(0,r.qC)()],d.prototype,"lodGenerationScale",null),(0,i.gn)([(0,r.qC)()],d.prototype,"linearSpecularLOD",null),(0,i.gn)([(0,r.oU)()],d.prototype,"irradianceTexture",null),(0,i.gn)([(0,r.qC)()],d.prototype,"isRenderTarget",void 0);var u=s(646),f=s(9069),_=s(9447),p=s(6448),g=s(6504),m=s(8661);function x(e,t,s=!1){const i=t.width,r=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const s=new Uint8Array(t);for(;--t>=0;){let i=e[t];i<0?i=0:i>1&&(i=1),s[t]=255*i}e=s}const n=document.createElement("canvas");n.width=i,n.height=r;const a=n.getContext("2d");if(!a)return null;const o=a.createImageData(i,r);if(o.data.set(e),a.putImageData(o,0,0),s){const e=document.createElement("canvas");e.width=i,e.height=r;const t=e.getContext("2d");return t?(t.translate(0,r),t.scale(1,-1),t.drawImage(n,0,0),e.toDataURL("image/png")):null}return n.toDataURL("image/png")}var M=s(6629);class y extends d{get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,s,i,r=y.TRILINEAR_SAMPLINGMODE,a=null,o=null,h=null,l=!1,c,d,u,f,p){var g,m,x,b,A,I,v,D,S;let P;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new n.y$,this._isBlocking=!0,this.name=e||"",this.url=e;let T=!1,O=null;"object"==typeof s&&null!==s?(P=null!==(g=s.noMipmap)&&void 0!==g&&g,i=null!==(m=s.invertY)&&void 0!==m?m:!M.e.UseOpenGLOrientationForUV,r=null!==(x=s.samplingMode)&&void 0!==x?x:y.TRILINEAR_SAMPLINGMODE,a=null!==(b=s.onLoad)&&void 0!==b?b:null,o=null!==(A=s.onError)&&void 0!==A?A:null,h=null!==(I=s.buffer)&&void 0!==I?I:null,l=null!==(v=s.deleteBuffer)&&void 0!==v&&v,c=s.format,d=s.mimeType,u=s.loaderOptions,f=s.creationFlags,T=null!==(D=s.useSRGBBuffer)&&void 0!==D&&D,O=null!==(S=s.internalTexture)&&void 0!==S?S:null):P=!!s,this._noMipmap=P,this._invertY=void 0===i?!M.e.UseOpenGLOrientationForUV:i,this._initialSamplingMode=r,this._buffer=h,this._deleteBuffer=l,this._mimeType=d,this._loaderOptions=u,this._creationFlags=f,this._useSRGBBuffer=T,this._forcedExtension=p,c&&(this._format=c);const C=this.getScene(),E=this._getEngine();if(!E)return;E.onBeforeTextureInitObservable.notifyObservers(this);const R=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),a&&a(),!this.isBlocking&&C&&C.resetCachedMaterial()},B=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},o&&o(e,t),y.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!O)return this._delayedOnLoad=R,void(this._delayedOnError=B);if(this._texture=null!=O?O:this._getFromCache(this.url,P,r,this._invertY,T),this._texture)if(this._texture.isReady)_.Q.SetImmediate((()=>R()));else{const e=this._texture.onLoadedObservable.add(R);this._texture.onErrorObservable.add((t=>{var s;B(t.message,t.exception),null===(s=this._texture)||void 0===s||s.onLoadedObservable.remove(e)}))}else if(C&&C.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=R,this._delayedOnError=B;else{try{this._texture=E.createTexture(this.url,P,this._invertY,C,r,R,B,this._buffer,void 0,this._format,this._forcedExtension,d,u,f,T)}catch(e){throw B("error loading",e),e}l&&(this._buffer=null)}}updateURL(e,t=null,s,i){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=i,this.delayLoadState=4,s&&(this._delayedOnLoad=s),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?_.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,s,i){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,s-=this.wRotationCenter,a.P.TransformCoordinatesFromFloatsToRef(e,t,s,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,i.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,i.z+=this.wRotationCenter}checkTransformsAreIdentical(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.y3.Zero(),this._rowGenerationMatrix=new a.y3,this._t0=a.P.Zero(),this._t1=a.P.Zero(),this._t2=a.P.Zero()),a.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.jp.Matrix[0]),a.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.jp.Matrix[1]),a.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.jp.Matrix[2]),a.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.jp.Matrix[3]),a.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();return t?(this.optimizeUVAllocation&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix):this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==y.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.y3.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case y.PLANAR_MODE:a.y3.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case y.PROJECTION_MODE:{a.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:a.y3.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return r.p4.Clone((()=>new y(this._texture?this._texture.url:null,this.getScene(),e)),this)}serialize(){var e,t;const s=this.name;y.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const i=super.serialize(y._SerializeInternalTextureUniqueId);return i?((y.SerializeBuffers||y.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+(0,m.Gh)(this._buffer):(y.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?function(e,t=0,s=0){const i=e.getInternalTexture();if(!i)return null;const r=e._readPixelsSync(t,s);return r?x(r,e.getSize(),i.invertY):null}(this):async function(e,t=0,s=0){const i=e.getInternalTexture();if(!i)return null;const r=await e.readPixels(t,s);return r?x(r,e.getSize(),i.invertY):null}(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,y._SerializeInternalTextureUniqueId&&(i.internalTextureUniqueId=null!==(t=null===(e=this._texture)||void 0===e?void 0:e.uniqueId)&&void 0!==t?t:void 0),this.name=s,i):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,s){if(e.customType){const i=p.K.Instantiate(e.customType).Parse(e,t,s);return e.samplingMode&&i.updateSamplingMode&&i._samplingMode&&i._samplingMode!==e.samplingMode&&i.updateSamplingMode(e.samplingMode),i}if(e.isCube&&!e.isRenderTarget)return y._CubeTextureParser(e,t,s);const i=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!i)return null;let n;if(i){const s=t.getEngine().getLoadedTexturesCache();for(const t of s)if(t.uniqueId===e.internalTextureUniqueId){n=t;break}}const a=t=>{var s;if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){const s=e.samplingMode;t&&t.samplingMode!==s&&t.updateSamplingMode(s)}if(t&&e.animations)for(let s=0;s<e.animations.length;s++){const i=e.animations[s],r=(0,u.q)("BABYLON.Animation");r&&t.animations.push(r.Parse(i))}i&&!n&&(null===(s=null==t?void 0:t._texture)||void 0===s||s._setUniqueId(e.internalTextureUniqueId))};return r.p4.Parse((()=>{var i,r,o;let h=!0;if(e.noMipmap&&(h=!1),e.mirrorPlane){const s=y._CreateMirror(e.name,e.renderTargetSize,t,h);return s._waitingRenderList=e.renderList,s.mirrorPlane=g.J.FromArray(e.mirrorPlane),a(s),s}if(e.isRenderTarget){let s=null;if(e.isCube){if(t.reflectionProbes)for(let s=0;s<t.reflectionProbes.length;s++){const i=t.reflectionProbes[s];if(i.name===e.name)return i.cubeTexture}}else s=y._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,h,null!==(i=e._creationFlags)&&void 0!==i?i:0),s._waitingRenderList=e.renderList;return a(s),s}{let i;if(e.base64String&&!n)i=y.CreateFromBase64String(e.base64String,e.base64String,t,!h,e.invertY,e.samplingMode,(()=>{a(i)}),null!==(r=e._creationFlags)&&void 0!==r?r:0,null!==(o=e._useSRGBBuffer)&&void 0!==o&&o),i.name=e.name;else{let r;r=e.name&&e.name.indexOf("://")>0?e.name:s+e.name,e.url&&(e.url.startsWith("data:")||y.UseSerializedUrlIfAny)&&(r=e.url);const o={noMipmap:!h,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{a(i)},internalTexture:n};i=new y(r,t,o)}return i}}),e,t)}static CreateFromBase64String(e,t,s,i,r,n=y.TRILINEAR_SAMPLINGMODE,a=null,o=null,h=5,l){return new y("data:"+t,s,i,r,n,a,o,e,!1,h,void 0,void 0,l)}static LoadFromDataString(e,t,s,i=!1,r,n=!0,a=y.TRILINEAR_SAMPLINGMODE,o=null,h=null,l=5,c){return"data:"!==e.substr(0,5)&&(e="data:"+e),new y(e,s,r,n,a,o,h,t,i,l,void 0,void 0,c)}}y.SerializeBuffers=!0,y.ForceSerializeBuffers=!1,y.OnTextureLoadErrorObservable=new n.y$,y._SerializeInternalTextureUniqueId=!1,y._CubeTextureParser=(e,t,s)=>{throw(0,f.S)("CubeTexture")},y._CreateMirror=(e,t,s,i)=>{throw(0,f.S)("MirrorTexture")},y._CreateRenderTargetTexture=(e,t,s,i,r)=>{throw(0,f.S)("RenderTargetTexture")},y.NEAREST_SAMPLINGMODE=1,y.NEAREST_NEAREST_MIPLINEAR=8,y.BILINEAR_SAMPLINGMODE=2,y.LINEAR_LINEAR_MIPNEAREST=11,y.TRILINEAR_SAMPLINGMODE=3,y.LINEAR_LINEAR_MIPLINEAR=3,y.NEAREST_NEAREST_MIPNEAREST=4,y.NEAREST_LINEAR_MIPNEAREST=5,y.NEAREST_LINEAR_MIPLINEAR=6,y.NEAREST_LINEAR=7,y.NEAREST_NEAREST=1,y.LINEAR_NEAREST_MIPNEAREST=9,y.LINEAR_NEAREST_MIPLINEAR=10,y.LINEAR_LINEAR=2,y.LINEAR_NEAREST=12,y.EXPLICIT_MODE=0,y.SPHERICAL_MODE=1,y.PLANAR_MODE=2,y.CUBIC_MODE=3,y.PROJECTION_MODE=4,y.SKYBOX_MODE=5,y.INVCUBIC_MODE=6,y.EQUIRECTANGULAR_MODE=7,y.FIXED_EQUIRECTANGULAR_MODE=8,y.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,y.CLAMP_ADDRESSMODE=0,y.WRAP_ADDRESSMODE=1,y.MIRROR_ADDRESSMODE=2,y.UseSerializedUrlIfAny=!1,(0,i.gn)([(0,r.qC)()],y.prototype,"url",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"uOffset",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"vOffset",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"uScale",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"vScale",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"uAng",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"vAng",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"wAng",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"uRotationCenter",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"vRotationCenter",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"wRotationCenter",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"homogeneousRotationInUVTransform",void 0),(0,i.gn)([(0,r.qC)()],y.prototype,"isBlocking",null),(0,u.H)("BABYLON.Texture",y),r.p4._TextureParser=y.Parse},6181:(e,t,s)=>{function i(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function r(e,t,s){var i,r,n,a,h,l;let c=!1,d=null!==(i=e.clipPlane)&&void 0!==i?i:t.clipPlane;return c=o(d,s,"CLIPPLANE","#define CLIPPLANE")||c,d=null!==(r=e.clipPlane2)&&void 0!==r?r:t.clipPlane2,c=o(d,s,"CLIPPLANE2","#define CLIPPLANE2")||c,d=null!==(n=e.clipPlane3)&&void 0!==n?n:t.clipPlane3,c=o(d,s,"CLIPPLANE3","#define CLIPPLANE3")||c,d=null!==(a=e.clipPlane4)&&void 0!==a?a:t.clipPlane4,c=o(d,s,"CLIPPLANE4","#define CLIPPLANE4")||c,d=null!==(h=e.clipPlane5)&&void 0!==h?h:t.clipPlane5,c=o(d,s,"CLIPPLANE5","#define CLIPPLANE5")||c,d=null!==(l=e.clipPlane6)&&void 0!==l?l:t.clipPlane6,c=o(d,s,"CLIPPLANE6","#define CLIPPLANE6")||c,c}function n(e,t,s){var i,r,n,o,h,l;let c=null!==(i=t.clipPlane)&&void 0!==i?i:s.clipPlane;a(e,"vClipPlane",c),c=null!==(r=t.clipPlane2)&&void 0!==r?r:s.clipPlane2,a(e,"vClipPlane2",c),c=null!==(n=t.clipPlane3)&&void 0!==n?n:s.clipPlane3,a(e,"vClipPlane3",c),c=null!==(o=t.clipPlane4)&&void 0!==o?o:s.clipPlane4,a(e,"vClipPlane4",c),c=null!==(h=t.clipPlane5)&&void 0!==h?h:s.clipPlane5,a(e,"vClipPlane5",c),c=null!==(l=t.clipPlane6)&&void 0!==l?l:s.clipPlane6,a(e,"vClipPlane6",c)}function a(e,t,s){s&&e.setFloat4(t,s.normal.x,s.normal.y,s.normal.z,s.d)}function o(e,t,s,i){const r=!!e;let n;if(Array.isArray(t)){const s=t.indexOf(i);n=-1!==s,!n&&e?t.push(i):n&&!e&&t.splice(s,1)}else n=t[s],t[s]=r;return n!==r}s.d(t,{AN:()=>r,an:()=>n,qx:()=>i})},708:(e,t,s)=>{s.d(t,{L:()=>i});class i{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)}addCPUSkinningFallback(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const s=this._mesh.getScene();for(let e=0;e<s.meshes.length;e++){const i=s.meshes[e];if(i.material){if(i.computeBonesUsingShaders&&0!==i.numBoneInfluencers)if(i.material.getEffect()===t)i.computeBonesUsingShaders=!1;else if(i.subMeshes)for(const e of i.subMeshes)if(e.effect===t){i.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&i.computeBonesUsingShaders&&i.numBoneInfluencers>0&&(i.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let s=0;s<t.length;s++)e=e.replace("#define "+t[s],"");this._currentRank++}return e}}},2067:(e,t,s)=>{s.d(t,{F:()=>m});var i=s(1069),r=s(8137),n=s(8658),a=s(8139),o=s(5953),h=s(2175),l=s(5888),c=s(658),d=s(6504),u=s(2108),f=s(7050);class _{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){r.p4.Clone((()=>e),this)}serialize(){return r.p4.Serialize(this)}parse(e,t,s){r.p4.Parse((()=>this),e,t,s)}}(0,i.gn)([(0,r.qC)()],_.prototype,"func",null),(0,i.gn)([(0,r.qC)()],_.prototype,"funcRef",null),(0,i.gn)([(0,r.qC)()],_.prototype,"funcMask",null),(0,i.gn)([(0,r.qC)()],_.prototype,"opStencilFail",null),(0,i.gn)([(0,r.qC)()],_.prototype,"opDepthFail",null),(0,i.gn)([(0,r.qC)()],_.prototype,"opStencilDepthPass",null),(0,i.gn)([(0,r.qC)()],_.prototype,"mask",null),(0,i.gn)([(0,r.qC)()],_.prototype,"enabled",null);var p=s(253),g=s(7545);class m{get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const t=this._alpha;this._alpha=e,1!==t&&1!==e||this.markAsDirty(m.MiscDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(m.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(m.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.y$),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new a.y$),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new a.y$),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(m.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(m.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case m.WireFrameFillMode:case m.LineListDrawMode:case m.LineLoopDrawMode:case m.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?m.WireFrameFillMode:m.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case m.PointFillMode:case m.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?m.PointFillMode:m.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(m.MiscDirtyFlag))}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,s){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new _,this._useUBO=!1,this._fillMode=m.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=e;const i=t||o.l.LastCreatedScene;i&&(this._scene=i,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||n.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new f.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=m.ClockWiseSideOrientation:this.sideOrientation=m.CounterClockWiseSideOrientation,this._uniformBuffer=new l.M(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,s||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),m.OnEventObservable.notifyObservers(this,g.S.Created))}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,s){const i=t.materialDefines;return!!i&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===m.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===m.MATERIAL_OPAQUE||this._transparencyMode===m.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(e=!1){const t=this.getScene().meshes;for(const s of t)if(s.subMeshes)for(const t of s.subMeshes)t.getMaterial()===this&&t.effect&&(t.effect._wasPreviouslyReady=!1,t.effect._wasPreviouslyUsingInstances=null,t.effect._forceRebindOnNextCall=e);e&&this.markAsDirty(m.AllDirtyFlag)}_preBind(e,t=null){const s=this._scene.getEngine(),i=(null==t?this.sideOrientation:t)===m.ClockWiseSideOrientation;return s.enableEffect(e||this._getDrawWrapper()),s.setState(this.backFaceCulling,this.zOffset,!1,i,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),i}bind(e,t){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(g.S.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,s){const i=s.effect;i&&(this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),i._forceRebindOnNextCall=!1)}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e,t=null){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,u.G.BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(g.S.GetAnimatables,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(g.S.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(g.S.HasTexture,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}getBindedMeshes(){if(this.meshMap){const e=new Array;for(const t in this.meshMap){const s=this.meshMap[t];s&&e.push(s)}return e}return this._scene.meshes.filter((e=>e.material===this))}forceCompilation(e,t,s,i){const r={clipPlane:!1,useInstances:!1,...s},n=this.getScene(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const o=()=>{if(!this._scene||!this._scene.getEngine())return;const s=n.clipPlane;if(r.clipPlane&&(n.clipPlane=new d.J(0,0,0,1)),this._storeEffectOnSubMeshes){let s=!0,n=null;if(e.subMeshes){const t=new h.P(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,r.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?n=t.effect.getCompilationError():(s=!1,setTimeout(o,16)))}s&&(this.allowShaderHotSwapping=a,n&&i&&i(n),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=a,t&&t(this)):setTimeout(o,16);r.clipPlane&&(n.clipPlane=s)};o()}forceCompilationAsync(e,t){return new Promise(((s,i)=>{this.forceCompilation(e,(()=>{s()}),t,(e=>{i(e)}))}))}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(m._DirtyCallbackArray.length=0,e&m.TextureDirtyFlag&&m._DirtyCallbackArray.push(m._TextureDirtyCallBack),e&m.LightDirtyFlag&&m._DirtyCallbackArray.push(m._LightsDirtyCallBack),e&m.FresnelDirtyFlag&&m._DirtyCallbackArray.push(m._FresnelDirtyCallBack),e&m.AttributesDirtyFlag&&m._DirtyCallbackArray.push(m._AttributeDirtyCallBack),e&m.MiscDirtyFlag&&m._DirtyCallbackArray.push(m._MiscDirtyCallBack),e&m.PrePassDirtyFlag&&m._DirtyCallbackArray.push(m._PrePassDirtyCallBack),m._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(m._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const e=this.getScene().meshes;for(const t of e)if(t.subMeshes)for(const e of t.subMeshes)e.getMaterial()===this&&e.resetDrawCache()}_markAllSubMeshesAsDirty(e){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.getScene().meshes;for(const s of t)if(s.subMeshes)for(const t of s.subMeshes)if(t.getMaterial(!1)===this)for(const s of t._drawWrappers)s&&s.defines&&s.defines.markAllAsDirty&&this._materialContext===s.materialContext&&e(s.defines)}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(m._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(m._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(m._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(m._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(m._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(m._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(m._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(m._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(m._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(m._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(this._scene.performancePriority!==p.a.BackwardCompatible){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}setPrePassRenderer(e){return!1}dispose(e,t,s){const i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(g.S.Disposed,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==s)if(this.meshMap)for(const t in this.meshMap){const s=this.meshMap[t];s&&(s.material=null,this.releaseVertexArrayObject(s,e))}else{const t=i.meshes;for(const s of t)s.material!==this||s.sourceMesh||(s.material=null,this.releaseVertexArrayObject(s,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(e,t){if(e.geometry){const s=e.geometry;if(this._storeEffectOnSubMeshes)for(const i of e.subMeshes)s._releaseVertexArrayObject(i.effect),t&&i.effect&&i.effect.dispose();else s._releaseVertexArrayObject(this._drawWrapper.effect)}}serialize(){const e=r.p4.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,e}static Parse(e,t,s){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return c.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const i=n.w1.Instantiate(e.customType).Parse(e,t,s);return i._loadedUniqueId=e.uniqueId,i}}m.TriangleFillMode=0,m.WireFrameFillMode=1,m.PointFillMode=2,m.PointListDrawMode=3,m.LineListDrawMode=4,m.LineLoopDrawMode=5,m.LineStripDrawMode=6,m.TriangleStripDrawMode=7,m.TriangleFanDrawMode=8,m.ClockWiseSideOrientation=0,m.CounterClockWiseSideOrientation=1,m.TextureDirtyFlag=1,m.LightDirtyFlag=2,m.FresnelDirtyFlag=4,m.AttributesDirtyFlag=8,m.MiscDirtyFlag=16,m.PrePassDirtyFlag=32,m.AllDirtyFlag=63,m.MATERIAL_OPAQUE=0,m.MATERIAL_ALPHATEST=1,m.MATERIAL_ALPHABLEND=2,m.MATERIAL_ALPHATESTANDBLEND=3,m.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,m.MATERIAL_NORMALBLENDMETHOD_RNM=1,m.OnEventObservable=new a.y$,o.l.OnEnginesDisposedObservable.addOnce((()=>{m.OnEventObservable.clear()})),m._AllDirtyCallBack=e=>e.markAllAsDirty(),m._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),m._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),m._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),m._MiscDirtyCallBack=e=>e.markAsMiscDirty(),m._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),m._LightsDirtyCallBack=e=>e.markAsLightDirty(),m._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),m._FresnelAndMiscDirtyCallBack=e=>{m._FresnelDirtyCallBack(e),m._MiscDirtyCallBack(e)},m._TextureAndMiscDirtyCallBack=e=>{m._TextureDirtyCallBack(e),m._MiscDirtyCallBack(e)},m._DirtyCallbackArray=[],m._RunDirtyCallBacks=e=>{for(const t of m._DirtyCallbackArray)t(e)},(0,i.gn)([(0,r.qC)()],m.prototype,"id",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"uniqueId",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"name",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"metadata",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"checkReadyOnEveryCall",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"checkReadyOnlyOnce",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"state",void 0),(0,i.gn)([(0,r.qC)("alpha")],m.prototype,"_alpha",void 0),(0,i.gn)([(0,r.qC)("backFaceCulling")],m.prototype,"_backFaceCulling",void 0),(0,i.gn)([(0,r.qC)("cullBackFaces")],m.prototype,"_cullBackFaces",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"sideOrientation",void 0),(0,i.gn)([(0,r.qC)("alphaMode")],m.prototype,"_alphaMode",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"_needDepthPrePass",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"disableDepthWrite",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"disableColorWrite",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"forceDepthWrite",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"depthFunction",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"separateCullingPass",void 0),(0,i.gn)([(0,r.qC)("fogEnabled")],m.prototype,"_fogEnabled",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"pointSize",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"zOffset",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"zOffsetUnits",void 0),(0,i.gn)([(0,r.qC)()],m.prototype,"pointsCloud",null),(0,i.gn)([(0,r.qC)()],m.prototype,"fillMode",null),(0,i.gn)([(0,r.qC)()],m.prototype,"transparencyMode",null)},2108:(e,t,s)=>{s.d(t,{G:()=>d});var i=s(658),r=s(4515),n=s(253),a=s(5953),o=s(2186),h=s(183),l=s(2922),c=s(6181);class d{static BindSceneUniformBuffer(e,t){t.bindToEffect(e,"Scene")}static PrepareDefinesForMergedUV(e,t,s){t._needUVs=!0,t[s]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[s+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[s+"DIRECTUV"]=0}static BindTextureMatrix(e,t,s){const i=e.getTextureMatrix();t.updateMatrix(s+"Matrix",i)}static GetFogState(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==n.x.FOGMODE_NONE}static PrepareDefinesForMisc(e,t,s,i,r,n,a){a._areMiscDirty&&(a.LOGARITHMICDEPTH=s,a.POINTSIZE=i,a.FOG=r&&this.GetFogState(e,t),a.NONUNIFORMSCALING=e.nonUniformScaling,a.ALPHATEST=n)}static PrepareDefinesForCamera(e,t){let s=!1;if(e.activeCamera){const i=t.CAMERA_ORTHOGRAPHIC?1:0,n=t.CAMERA_PERSPECTIVE?1:0,a=e.activeCamera.mode===r.V.ORTHOGRAPHIC_CAMERA?1:0,o=e.activeCamera.mode===r.V.PERSPECTIVE_CAMERA?1:0;(i^a||n^o)&&(t.CAMERA_ORTHOGRAPHIC=1===a,t.CAMERA_PERSPECTIVE=1===o,s=!0)}return s}static PrepareDefinesForFrameBoundValues(e,t,s,i,r,n=null,a=!1){let o=d.PrepareDefinesForCamera(e,i);!1!==n&&(o=(0,c.AN)(s,e,i)),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,o=!0),i.INSTANCES!==r&&(i.INSTANCES=r,o=!0),i.THIN_INSTANCES!==a&&(i.THIN_INSTANCES=a,o=!0),o&&i.markAsUnprocessed()}static PrepareDefinesForBones(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const s=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&s)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!s&&void 0;const i=e.getScene().prePassRenderer;if(i&&i.enabled){const s=-1===i.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=s}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}static PrepareDefinesForMorphTargets(e,t){const s=e.morphTargetManager;s?(t.MORPHTARGETS_UV=s.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=s.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=s.supportsNormals&&t.NORMAL,t.MORPHTARGETS=s.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=s.numInfluencers,t.MORPHTARGETS_TEXTURE=s.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}static PrepareDefinesForBakedVertexAnimation(e,t){const s=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!s||!s.isEnabled)}static PrepareDefinesForAttributes(e,t,s,i,r=!1,n=!0,a=!0){if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(o.o.NormalKind),t._needNormals&&e.isVerticesDataPresent(o.o.TangentKind)&&(t.TANGENT=!0);for(let s=1;s<=6;++s)t["UV"+s]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===s?"":s}`);if(s){const s=e.useVertexColors&&e.isVerticesDataPresent(o.o.ColorKind);t.VERTEXCOLOR=s,t.VERTEXALPHA=e.hasVertexAlpha&&s&&n}return e.isVerticesDataPresent(o.o.ColorInstanceKind)&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),i&&this.PrepareDefinesForBones(e,t),r&&this.PrepareDefinesForMorphTargets(e,t),a&&this.PrepareDefinesForBakedVertexAnimation(e,t),!0}static PrepareDefinesForMultiview(e,t){if(e.activeCamera){const s=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=s&&t.markAsUnprocessed()}}static PrepareDefinesForOIT(e,t,s){const i=t.ORDER_INDEPENDENT_TRANSPARENCY,r=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&s,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,i===t.ORDER_INDEPENDENT_TRANSPARENCY&&r===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}static PrepareDefinesForPrePass(e,t,s){const i=t.PREPASS;if(!t._arePrePassDirty)return;const r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&s){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(let s=0;s<r.length;s++){const i=e.prePassRenderer.getIndex(r[s].type);-1!==i?(t[r[s].define]=!0,t[r[s].index]=i):t[r[s].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<r.length;e++)t[r[e].define]=!1}t.PREPASS!=i&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}static PrepareDefinesForLight(e,t,s,i,r,n,a){var o;switch(a.needNormals=!0,void 0===r["LIGHT"+i]&&(a.needRebuild=!0),r["LIGHT"+i]=!0,r["SPOTLIGHT"+i]=!1,r["HEMILIGHT"+i]=!1,r["POINTLIGHT"+i]=!1,r["DIRLIGHT"+i]=!1,s.prepareLightSpecificDefines(r,i),r["LIGHT_FALLOFF_PHYSICAL"+i]=!1,r["LIGHT_FALLOFF_GLTF"+i]=!1,r["LIGHT_FALLOFF_STANDARD"+i]=!1,s.falloffType){case h.m.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+i]=!0;break;case h.m.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case h.m.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+i]=!0}if(n&&!s.specular.equalsFloats(0,0,0)&&(a.specularEnabled=!0),r["SHADOW"+i]=!1,r["SHADOWCSM"+i]=!1,r["SHADOWCSMDEBUG"+i]=!1,r["SHADOWCSMNUM_CASCADES"+i]=!1,r["SHADOWCSMUSESHADOWMAXZ"+i]=!1,r["SHADOWCSMNOBLEND"+i]=!1,r["SHADOWCSM_RIGHTHANDED"+i]=!1,r["SHADOWPCF"+i]=!1,r["SHADOWPCSS"+i]=!1,r["SHADOWPOISSON"+i]=!1,r["SHADOWESM"+i]=!1,r["SHADOWCLOSEESM"+i]=!1,r["SHADOWCUBE"+i]=!1,r["SHADOWLOWQUALITY"+i]=!1,r["SHADOWMEDIUMQUALITY"+i]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&s.shadowEnabled){const t=null!==(o=s.getShadowGenerator(e.activeCamera))&&void 0!==o?o:s.getShadowGenerator();if(t){const e=t.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(a.shadowEnabled=!0,t.prepareDefines(r,i))}}s.lightmapMode!=h.m.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+i]=!0,r["LIGHTMAPNOSPECULAR"+i]=s.lightmapMode==h.m.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+i]=!1,r["LIGHTMAPNOSPECULAR"+i]=!1)}static PrepareDefinesForLights(e,t,s,i,r=4,n=!1){if(!s._areLightsDirty)return s._needNormals;let a=0;const o={needNormals:s._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!n)for(const n of t.lightSources)if(this.PrepareDefinesForLight(e,t,n,a,s,i,o),a++,a===r)break;s.SPECULARTERM=o.specularEnabled,s.SHADOWS=o.shadowEnabled;for(let e=a;e<r;e++)void 0!==s["LIGHT"+e]&&(s["LIGHT"+e]=!1,s["HEMILIGHT"+e]=!1,s["POINTLIGHT"+e]=!1,s["DIRLIGHT"+e]=!1,s["SPOTLIGHT"+e]=!1,s["SHADOW"+e]=!1,s["SHADOWCSM"+e]=!1,s["SHADOWCSMDEBUG"+e]=!1,s["SHADOWCSMNUM_CASCADES"+e]=!1,s["SHADOWCSMUSESHADOWMAXZ"+e]=!1,s["SHADOWCSMNOBLEND"+e]=!1,s["SHADOWCSM_RIGHTHANDED"+e]=!1,s["SHADOWPCF"+e]=!1,s["SHADOWPCSS"+e]=!1,s["SHADOWPOISSON"+e]=!1,s["SHADOWESM"+e]=!1,s["SHADOWCLOSEESM"+e]=!1,s["SHADOWCUBE"+e]=!1,s["SHADOWLOWQUALITY"+e]=!1,s["SHADOWMEDIUMQUALITY"+e]=!1);const h=e.getEngine().getCaps();return void 0===s.SHADOWFLOAT&&(o.needRebuild=!0),s.SHADOWFLOAT=o.shadowEnabled&&(h.textureFloatRender&&h.textureFloatLinearFiltering||h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering),s.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&s.rebuild(),o.needNormals}static PrepareUniformsAndSamplersForLight(e,t,s,i,r=null,n=!1){r&&r.push("Light"+e),n||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),s.push("shadowSampler"+e),s.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),i&&(s.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))}static PrepareUniformsAndSamplersList(e,t,s,i=4){let r,n=null;if(e.uniformsNames){const a=e;r=a.uniformsNames,n=a.uniformBuffersNames,t=a.samplers,s=a.defines,i=a.maxSimultaneousLights||0}else r=e,t||(t=[]);for(let e=0;e<i&&s["LIGHT"+e];e++)this.PrepareUniformsAndSamplersForLight(e,r,t,s["PROJECTEDLIGHTTEXTURE"+e],n);s.NUM_MORPH_INFLUENCERS&&r.push("morphTargetInfluences"),s.BAKED_VERTEX_ANIMATION_TEXTURE&&(r.push("bakedVertexAnimationSettings"),r.push("bakedVertexAnimationTextureSizeInverted"),r.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}static HandleFallbacksForShadows(e,t,s=4,i=0){let r=0;for(let n=0;n<s&&e["LIGHT"+n];n++)n>0&&(r=i+n,t.addFallback(r,"LIGHT"+n)),e.SHADOWS||(e["SHADOW"+n]&&t.addFallback(i,"SHADOW"+n),e["SHADOWPCF"+n]&&t.addFallback(i,"SHADOWPCF"+n),e["SHADOWPCSS"+n]&&t.addFallback(i,"SHADOWPCSS"+n),e["SHADOWPOISSON"+n]&&t.addFallback(i,"SHADOWPOISSON"+n),e["SHADOWESM"+n]&&t.addFallback(i,"SHADOWESM"+n),e["SHADOWCLOSEESM"+n]&&t.addFallback(i,"SHADOWCLOSEESM"+n));return r++}static PrepareAttributesForMorphTargetsInfluencers(e,t,s){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=s,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)}static PrepareAttributesForMorphTargets(e,t,s){const r=s.NUM_MORPH_INFLUENCERS;if(r>0&&a.l.LastCreatedEngine){const n=a.l.LastCreatedEngine.getCaps().maxVertexAttribs,h=t.morphTargetManager;if(null==h?void 0:h.isUsingTextureForTargets)return;const l=h&&h.supportsNormals&&s.NORMAL,c=h&&h.supportsTangents&&s.TANGENT,d=h&&h.supportsUVs&&s.UV1;for(let s=0;s<r;s++)e.push(o.o.PositionKind+s),l&&e.push(o.o.NormalKind+s),c&&e.push(o.o.TangentKind+s),d&&e.push(o.o.UVKind+"_"+s),e.length>n&&i.Y.Error("Cannot add more vertex attributes for mesh "+t.name)}}static PrepareAttributesForBakedVertexAnimation(e,t,s){s.BAKED_VERTEX_ANIMATION_TEXTURE&&s.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}static PrepareAttributesForBones(e,t,s,i){s.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(o.o.MatricesIndicesKind),e.push(o.o.MatricesWeightsKind),s.NUM_BONE_INFLUENCERS>4&&(e.push(o.o.MatricesIndicesExtraKind),e.push(o.o.MatricesWeightsExtraKind)))}static PrepareAttributesForInstances(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push(o.o.ColorInstanceKind)}static PushAttributesForInstances(e,t=!1){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}static BindLightProperties(e,t,s){e.transferToEffect(t,s+"")}static BindLight(e,t,s,i,r,n=!0){e._bindLight(t,s,i,r,n)}static BindLights(e,t,s,i,r=4){const n=Math.min(t.lightSources.length,r);for(let r=0;r<n;r++){const n=t.lightSources[r];this.BindLight(n,r,e,s,"boolean"==typeof i?i:i.SPECULARTERM,t.receiveShadows)}}static BindFogParameters(e,t,s,i=!1){e.fogEnabled&&t.applyFog&&e.fogMode!==n.x.FOGMODE_NONE&&(s.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._TempFogColor,e.getEngine().useExactSrgbConversions),s.setColor3("vFogColor",this._TempFogColor)):s.setColor3("vFogColor",e.fogColor))}static BindBonesParameters(e,t,s){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const i=e.skeleton;if(i.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const s=i.getTransformMatrixTexture(e);t.setTexture("boneSampler",s),t.setFloat("boneTextureWidth",4*(i.bones.length+1))}else{const r=i.getTransformMatrices(e);r&&(t.setMatrices("mBones",r),s&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(s.previousBones[e.uniqueId]||(s.previousBones[e.uniqueId]=r.slice()),t.setMatrices("mPreviousBones",s.previousBones[e.uniqueId]),d._CopyBonesTransformationMatrices(r,s.previousBones[e.uniqueId])))}}}static _CopyBonesTransformationMatrices(e,t){return t.set(e),t}static BindMorphTargetParameters(e,t){const s=e.morphTargetManager;e&&s&&t.setFloatArray("morphTargetInfluences",s.influences)}static BindLogDepth(e,t,s){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=s.activeCamera;e.mode===r.V.ORTHOGRAPHIC_CAMERA&&i.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}}d._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},d._TempFogColor=l.Wo.Black()},7545:(e,t,s)=>{var i;s.d(t,{S:()=>i}),function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"}(i||(i={}))},4520:(e,t,s)=>{s.d(t,{a:()=>n});var i=s(5412),r=s(2067);class n extends r.F{constructor(e,t,s=!0){super(e,t),this._normalMatrix=new i.y3,this._storeEffectOnSubMeshes=s}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,t){return!!e&&(!this._storeEffectOnSubMeshes||!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))}_isReadyForSubMesh(e){const t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])}_afterBind(e,t=null){super._afterBind(e,t),this.getScene()._cachedEffect=t,t&&(t._forceRebindOnNextCall=!1)}_mustRebind(e,t,s=1){return e.isCachedMaterialInvalid(this,t,s)}dispose(e,t,s){this._activeEffect=void 0,super.dispose(e,t,s)}}},7303:(e,t,s)=>{s.d(t,{k:()=>h,y:()=>o});var i=s(1069),r=s(5412),n=s(8137);class a{static extractMinAndMaxIndexed(e,t,s,i,r,n){for(let a=s;a<s+i;a++){const s=3*t[a],i=e[s],o=e[s+1],h=e[s+2];r.minimizeInPlaceFromFloats(i,o,h),n.maximizeInPlaceFromFloats(i,o,h)}}static extractMinAndMax(e,t,s,i,r,n){for(let a=t,o=t*i;a<t+s;a++,o+=i){const t=e[o],s=e[o+1],i=e[o+2];r.minimizeInPlaceFromFloats(t,s,i),n.maximizeInPlaceFromFloats(t,s,i)}}}function o(e,t,s,i,n=null){const o=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a.extractMinAndMaxIndexed(e,t,s,i,o,h),n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,h.x+=h.x*n.x+n.y,h.y+=h.y*n.x+n.y,h.z+=h.z*n.x+n.y),{minimum:o,maximum:h}}function h(e,t,s,i=null,n){const o=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),a.extractMinAndMax(e,t,s,n,o,h),i&&(o.x-=o.x*i.x+i.y,o.y-=o.y*i.x+i.y,o.z-=o.z*i.x+i.y,h.x+=h.x*i.x+i.y,h.y+=h.y*i.x+i.y,h.z+=h.z*i.x+i.y),{minimum:o,maximum:h}}(0,i.gn)([n.G6.filter(((...[e,t])=>!Array.isArray(e)&&!Array.isArray(t)))],a,"extractMinAndMaxIndexed",null),(0,i.gn)([n.G6.filter(((...[e])=>!Array.isArray(e)))],a,"extractMinAndMax",null)},7142:(e,t,s)=>{s.d(t,{x:()=>A});var i=s(8139),r=s(253),n=s(5412),a=s(2352),o=s(2186),h=s(2341),l=s(4179),c=s(318),d=s(2543),u=s(5888);class f{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new n.P(0,0,0),this._diffPositionForCollisions=new n.P(0,0,0),this._collisionResponse=!0}}var _=s(9069),p=s(7303),g=s(2922),m=s(4551),x=s(5241),M=s(646);class y{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=n.P.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class b{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new f,this._enableDistantPicking=!1}}class A extends l.Y{static get BILLBOARDMODE_NONE(){return l.Y.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return l.Y.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return l.Y.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return l.Y.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return l.Y.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return l.Y.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(e){return!!super._updateNonUniformScalingState(e)&&(this._markSubMeshesAsMiscDirty(),!0)}set onCollide(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)}set onCollisionPositionChange(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(e){if(this._internalAbstractMeshDataInfo._visibility===e)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsMiscDirty()}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(e){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=e}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(e){this._internalAbstractMeshDataInfo._renderingGroupId=e}get material(){return this._internalAbstractMeshDataInfo._material}set material(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(e){var t;return null===(t=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===t?void 0:t[e]}setMaterialForRenderPass(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e}get lightSources(){return this._lightSources}get _positions(){return null}set skeleton(e){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(e,t=null){switch(super(e,t,!1),this._internalAbstractMeshDataInfo=new b,this._waitingMaterialId=null,this.cullingStrategy=A.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new i.y$,this.onCollisionPositionChangeObservable=new i.y$,this.onMaterialChangedObservable=new i.y$,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this.isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=g.Wo.Red(),this.outlineWidth=.02,this.overlayColor=g.Wo.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new n.P(.5,1,.5),this.ellipsoidOffset=new n.P(0,0,0),this.edgesWidth=1,this.edgesColor=new g.HE(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new i.y$,this._onCollisionPositionChange=(e,t,s=null)=>{t.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>a.D.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),s&&this.onCollideObservable.notifyObservers(s),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(t=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new u.M(this.getScene().getEngine(),void 0,void 0,e,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),t.performancePriority){case r.a.Aggressive:this.doNotSyncBoundingInfo=!0;case r.a.Intermediate:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(e){const t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(e){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const s=this._internalAbstractMeshDataInfo._skeleton;return s&&(t+=", skeleton: "+s.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==l.Y.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(e,t=!0){if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_rebuild(e=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(const e of this.subMeshes)e._rebuild()}_resyncLightSources(){this._lightSources.length=0;for(const e of this.getScene().lights)e.isEnabled()&&e.canAffectMesh(this)&&this._lightSources.push(e);this._markSubMeshesAsLightDirty()}_resyncLightSource(e){const t=e.isEnabled()&&e.canAffectMesh(this),s=this._lightSources.indexOf(e);let i=!1;if(-1===s){if(!t)return;this._lightSources.push(e)}else{if(t)return;i=!0,this._lightSources.splice(s,1)}this._markSubMeshesAsLightDirty(i)}_unBindEffect(){for(const e of this.subMeshes)e.setEffect(null)}_removeLightSource(e,t){const s=this._lightSources.indexOf(e);-1!==s&&(this._lightSources.splice(s,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(e){if(this.subMeshes)for(const t of this.subMeshes)for(let s=0;s<t._drawWrappers.length;++s){const i=t._drawWrappers[s];i&&i.defines&&i.defines.markAllAsDirty&&e(i.defines)}}_markSubMeshesAsLightDirty(e=!1){this._markSubMeshesAsDirty((t=>t.markAsLightDirty(e)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((e=>e.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((e=>e.markAsMiscDirty()))}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(e){if(this.subMeshes)for(const t of this.subMeshes)t.resetDrawCache(e)}get isBlocked(){return!1}getLOD(e){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(e){return null}setVerticesData(e,t,s,i){return this}updateVerticesData(e,t,s,i){return this}setIndices(e,t){return this}isVerticesDataPresent(e){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}setBoundingInfo(e){return this._boundingInfo=e,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(e,t,s){return this._boundingInfo=new d.j(e,t,s),this._boundingInfo}normalizeToUnitCube(e=!0,t=!1,s){return super.normalizeToUnitCube(e,t,s)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(o.o.MatricesIndicesKind)&&this.isVerticesDataPresent(o.o.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(e){}_activate(e,t){return this._renderId=e,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===l.Y.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(e,t,s){return this.position.addInPlace(this.calcMovePOV(e,t,s)),this}calcMovePOV(e,t,s){const i=new n.y3;(this.rotationQuaternion?this.rotationQuaternion:n._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(i);const r=n.P.Zero(),a=this.definedFacingForward?-1:1;return n.P.TransformCoordinatesFromFloatsToRef(e*a,t,s*a,i,r),r}rotatePOV(e,t,s){return this.rotation.addInPlace(this.calcRotatePOV(e,t,s)),this}calcRotatePOV(e,t,s){const i=this.definedFacingForward?1:-1;return new n.P(e*i,t,s*i)}refreshBoundingInfo(e=!1,t=!1){return this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e,t),null),this}_refreshBoundingInfo(e,t){if(e){const s=(0,p.k)(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new d.j(s.minimum,s.maximum)}if(this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(e);this._updateBoundingInfo()}_getData(e=!1,t=!1,s,i=o.o.PositionKind){if((s=null!=s?s:this.getVerticesData(i).slice())&&t&&this.morphTargetManager){let e=0,t=0;for(let r=0;r<s.length;r++){for(let e=0;e<this.morphTargetManager.numTargets;e++){const t=this.morphTargetManager.getTarget(e),i=t.influence;if(i>0){const e=t.getPositions();e&&(s[r]+=(e[r]-s[r])*i)}}if(e++,i===o.o.PositionKind&&this._positions&&3===e){e=0;const i=3*t;this._positions[t++].copyFromFloats(s[i],s[i+1],s[i+2])}}}if(s&&e&&this.skeleton){const e=this.getVerticesData(o.o.MatricesIndicesKind),t=this.getVerticesData(o.o.MatricesWeightsKind);if(t&&e){const r=this.numBoneInfluencers>4,a=r?this.getVerticesData(o.o.MatricesIndicesExtraKind):null,h=r?this.getVerticesData(o.o.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this),c=n.jp.Vector3[0],d=n.jp.Matrix[0],u=n.jp.Matrix[1];let f=0;for(let _=0;_<s.length;_+=3,f+=4){let p,g;for(d.reset(),p=0;p<4;p++)g=t[f+p],g>0&&(n.y3.FromFloat32ArrayToRefScaled(l,Math.floor(16*e[f+p]),g,u),d.addToSelf(u));if(r)for(p=0;p<4;p++)g=h[f+p],g>0&&(n.y3.FromFloat32ArrayToRefScaled(l,Math.floor(16*a[f+p]),g,u),d.addToSelf(u));i===o.o.NormalKind?n.P.TransformNormalFromFloatsToRef(s[_],s[_+1],s[_+2],d,c):n.P.TransformCoordinatesFromFloatsToRef(s[_],s[_+1],s[_+2],d,c),c.toArray(s,_),i===o.o.PositionKind&&this._positions&&this._positions[_/3].copyFrom(c)}}}return s}getNormalsData(e=!1,t=!1){return this._getData(e,t,null,o.o.NormalKind)}getPositionData(e=!1,t=!1,s){return this._getData(e,t,s,o.o.PositionKind)}_getPositionData(e,t){var s;let i=this.getVerticesData(o.o.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),i&&(e&&this.skeleton||t&&this.morphTargetManager)){if(i=i.slice(),this._generatePointsArray(),this._positions){const e=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(e.length);for(let t=0;t<e.length;t++)this._internalAbstractMeshDataInfo._positions[t]=(null===(s=e[t])||void 0===s?void 0:s.clone())||new n.P}return this.getPositionData(e,t,i)}return i}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new d.j(n.P.Zero(),n.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(e){if(!this.subMeshes)return this;const t=this.subMeshes.length;for(let s=0;s<t;s++){const i=this.subMeshes[s];(t>1||!i.IsGlobal)&&i.updateBoundingInfo(e)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)}isCompletelyInFrustum(e){return this.getBoundingInfo().isCompletelyInFrustum(e)}intersectsMesh(e,t=!1,s){const i=this.getBoundingInfo(),r=e.getBoundingInfo();if(i.intersects(r,t))return!0;if(s)for(const s of this.getChildMeshes())if(s.intersectsMesh(e,t,!0))return!0;return!1}intersectsPoint(e){return this.getBoundingInfo().intersectsPoint(e)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(e,t,s){var i;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];const s=e.verticesStart,i=e.verticesStart+e.verticesCount;for(let r=s;r<i;r++)e._lastColliderWorldVertices.push(n.P.TransformCoordinates(this._positions[r],t))}return s._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===(null===(i=e.getMaterial())||void 0===i?void 0:i.fillMode)),this}_processCollisionsForSubMeshes(e,t){const s=this._scene.getCollidingSubMeshCandidates(this,e),i=s.length;for(let r=0;r<i;r++){const n=s.data[r];i>1&&!n._checkCollision(e)||this._collideForSubMesh(n,t,e)}return this}_shouldConvertRHS(){return!1}_checkCollision(e){if(!this.getBoundingInfo()._checkCollision(e))return this;const t=n.jp.Matrix[0],s=n.jp.Matrix[1];return n.y3.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,s),this._processCollisionsForSubMeshes(e,s),this}_generatePointsArray(){return!1}intersects(e,t,s,i=!1,r,a=!1){const o=new c.p,h="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,l=this.getBoundingInfo();if(!this.subMeshes)return o;if(!(a||e.intersectsSphere(l.boundingSphere,h)&&e.intersectsBox(l.boundingBox,h)))return o;if(i)return o.hit=!a,o.pickedMesh=a?null:this,o.distance=a?0:n.P.Distance(e.origin,l.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;let d=null;const u=this._scene.getIntersectingSubMeshCandidates(this,e),f=u.length;let _=!1;for(let e=0;e<f;e++){const t=u.data[e].getMaterial();if(t&&(7==t.fillMode||0==t.fillMode||1==t.fillMode||2==t.fillMode||4==t.fillMode)){_=!0;break}}if(!_)return o.hit=!0,o.pickedMesh=this,o.distance=n.P.Distance(e.origin,l.boundingSphere.center),o.subMeshId=-1,o;for(let i=0;i<f;i++){const r=u.data[i];if(f>1&&!r.canIntersects(e))continue;const n=r.intersects(e,this._positions,this.getIndices(),t,s);if(n&&(t||!d||n.distance<d.distance)&&(d=n,d.subMeshId=i,t))break}if(d){const t=null!=r?r:this.getWorldMatrix(),s=n.jp.Vector3[0],i=n.jp.Vector3[1];n.P.TransformCoordinatesToRef(e.origin,t,s),e.direction.scaleToRef(d.distance,i);const a=n.P.TransformNormal(i,t).addInPlace(s);return o.hit=!0,o.distance=n.P.Distance(s,a),o.pickedPoint=a,o.pickedMesh=this,o.bu=d.bu||0,o.bv=d.bv||0,o.subMeshFaceId=d.faceId,o.faceId=d.faceId+u.data[d.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),o.subMeshId=d.subMeshId,o}return o}clone(e,t,s){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this}dispose(e,t=!1){let s;for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),s=0;s<this._intersectionsInProgress.length;s++){const e=this._intersectionsInProgress[s],t=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(t,1)}this._intersectionsInProgress.length=0,this.getScene().lights.forEach((e=>{let t=e.includedOnlyMeshes.indexOf(this);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(this),-1!==t&&e.excludedMeshes.splice(t,1);const s=e.getShadowGenerators();if(s){const e=s.values();for(let s=e.next();!0!==s.done;s=e.next()){const e=s.value.getShadowMap();e&&e.renderList&&(t=e.renderList.indexOf(this),-1!==t&&e.renderList.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const i=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,i.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),i.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){const e=this._parentContainer.meshes.indexOf(this);e>-1&&this._parentContainer.meshes.splice(e,1),this._parentContainer=null}if(t&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(s=0;s<this.getScene().particleSystems.length;s++)this.getScene().particleSystems[s].emitter===this&&(this.getScene().particleSystems[s].dispose(),s--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(e,t)}addChild(e,t=!1){return e.setParent(this,t),this}removeChild(e,t=!1){return e.setParent(null,t),this}_initFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(let t=0;t<e.facetNb;t++)e.facetNormals[t]=n.P.Zero(),e.facetPositions[t]=n.P.Zero();return e.facetDataEnabled=!0,this}updateFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(o.o.PositionKind),s=this.getIndices(),i=this.getVerticesData(o.o.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,s instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(s);else if(s instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(s);else{let t=!1;for(let e=0;e<s.length;e++)if(s[e]>65535){t=!0;break}e.depthSortedIndices=t?new Uint32Array(s):new Uint16Array(s)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){const t=this.getScene().activeCamera;e.facetDepthSortFrom=t?t.position:n.P.Zero()}e.depthSortedFacets=[];for(let t=0;t<e.facetNb;t++){const s={ind:3*t,sqDistance:0};e.depthSortedFacets.push(s)}e.invertedMatrix=n.y3.Identity(),e.facetDepthSortOrigin=n.P.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>m.kn?r.maximum.x-r.minimum.x:m.kn,e.bbSize.y=r.maximum.y-r.minimum.y>m.kn?r.maximum.y-r.minimum.y:m.kn,e.bbSize.z=r.maximum.z-r.minimum.z>m.kn?r.maximum.z-r.minimum.z:m.kn;let a=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(a=a>e.bbSize.z?a:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/a),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/a),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/a),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),n.P.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,i&&h.x.ComputeNormals(t,s,i,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);const t=e.depthSortedIndices.length/3|0;for(let i=0;i<t;i++){const t=e.depthSortedFacets[i].ind;e.depthSortedIndices[3*i]=s[t],e.depthSortedIndices[3*i+1]=s[t+1],e.depthSortedIndices[3*i+2]=s[t+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals}getFacetLocalPositions(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions}getFacetLocalPartitioning(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning}getFacetPosition(e){const t=n.P.Zero();return this.getFacetPositionToRef(e,t),t}getFacetPositionToRef(e,t){const s=this.getFacetLocalPositions()[e],i=this.getWorldMatrix();return n.P.TransformCoordinatesToRef(s,i,t),this}getFacetNormal(e){const t=n.P.Zero();return this.getFacetNormalToRef(e,t),t}getFacetNormalToRef(e,t){const s=this.getFacetLocalNormals()[e];return n.P.TransformNormalToRef(s,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(e,t,s){const i=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,n=Math.floor((e-i.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),a=Math.floor((t-i.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),o=Math.floor((s-i.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return n<0||n>r.subDiv.max||a<0||a>r.subDiv.max||o<0||o>r.subDiv.max?null:r.facetPartitioning[n+r.subDiv.max*a+r.subDiv.max*r.subDiv.max*o]}getClosestFacetAtCoordinates(e,t,s,i,r=!1,a=!0){const o=this.getWorldMatrix(),h=n.jp.Matrix[5];o.invertToRef(h);const l=n.jp.Vector3[8];n.P.TransformCoordinatesFromFloatsToRef(e,t,s,h,l);const c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,i,r,a);return i&&n.P.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,o,i),c}getClosestFacetAtLocalCoordinates(e,t,s,i,r=!1,n=!0){let a=null,o=0,h=0,l=0,c=0,d=0,u=0,f=0,_=0;const p=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,s);if(!m)return null;let x,M,y,b=Number.MAX_VALUE,A=b;for(let I=0;I<m.length;I++)x=m[I],M=g[x],y=p[x],c=(e-y.x)*M.x+(t-y.y)*M.y+(s-y.z)*M.z,(!r||r&&n&&c>=0||r&&!n&&c<=0)&&(c=M.x*y.x+M.y*y.y+M.z*y.z,d=-(M.x*e+M.y*t+M.z*s-c)/(M.x*M.x+M.y*M.y+M.z*M.z),u=e+M.x*d,f=t+M.y*d,_=s+M.z*d,o=u-e,h=f-t,l=_-s,A=o*o+h*h+l*l,A<b&&(b=A,a=x,i&&(i.x=u,i.y=f,i.z=_)));return a}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this}updateIndices(e,t,s=!1){return this}createNormals(e){const t=this.getVerticesData(o.o.PositionKind),s=this.getIndices();let i;return i=this.isVerticesDataPresent(o.o.NormalKind)?this.getVerticesData(o.o.NormalKind):[],h.x.ComputeNormals(t,s,i,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(o.o.NormalKind,i,e),this}alignWithNormal(e,t){t||(t=x.RD.Y);const s=n.jp.Vector3[0],i=n.jp.Vector3[1];return n.P.CrossToRef(t,e,i),n.P.CrossToRef(e,i,s),this.rotationQuaternion?n._f.RotationQuaternionFromAxisToRef(s,e,i,this.rotationQuaternion):n.P.RotationFromAxisToRef(s,e,i,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,_.S)("EdgesRenderer")}enableEdgesRendering(e,t,s){throw(0,_.S)("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter((e=>e.emitter===this))}}A.OCCLUSION_TYPE_NONE=0,A.OCCLUSION_TYPE_OPTIMISTIC=1,A.OCCLUSION_TYPE_STRICT=2,A.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,A.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,A.CULLINGSTRATEGY_STANDARD=0,A.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,A.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,A.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,M.H)("BABYLON.AbstractMesh",A)},6791:(e,t,s)=>{s.d(t,{Kj:()=>V,gW:()=>E});var i=s(8139),r=s(8658),n=s(2827),a=s(1995),o=s(140),h=s(4515),l=s(253),c=s(5412),d=s(2922),u=s(6387),f=s(2186),_=s(2341),p=s(2175);class g{static get ForceFullSceneLoadingForIncremental(){return g._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){g._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return g._ShowLoadingScreen}static set ShowLoadingScreen(e){g._ShowLoadingScreen=e}static get loggingLevel(){return g._LoggingLevel}static set loggingLevel(e){g._LoggingLevel=e}static get CleanBoneMatrixWeights(){return g._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){g._CleanBoneMatrixWeights=e}}g._ForceFullSceneLoadingForIncremental=!1,g._ShowLoadingScreen=!0,g._CleanBoneMatrixWeights=!1,g._LoggingLevel=0;var m=s(2543),x=s(7303),M=s(5953),y=s(6629);class b{get boundingBias(){return this._boundingBias}set boundingBias(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(e){const t=new b(b.RandomId(),e.getScene());return t.applyToMesh(e),t}get meshes(){return this._meshes}constructor(e,t,s,i=!1,r=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||M.l.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=i,s?this.setAllVerticesData(s,i):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),r&&(this.applyToMesh(r),r.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable));for(const e in this._vertexBuffers)this._vertexBuffers[e]._rebuild()}setAllVerticesData(e,t){e.applyToGeometry(this,t),this._notifyUpdate()}setVerticesData(e,t,s=!1,i){s&&Array.isArray(t)&&(t=new Float32Array(t));const r=new f.o(this._engine,t,e,s,0===this._meshes.length,i);this.setVerticesBuffer(r)}removeVerticesData(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(e,t=null,s=!0){const i=e.getKind();this._vertexBuffers[i]&&s&&this._vertexBuffers[i].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[i]=e;const r=this._meshes,n=r.length;if(i===f.o.PositionKind){const s=e.getData();null!=t?this._totalVertices=t:null!=s&&(this._totalVertices=s.length/(e.type===f.o.BYTE?e.byteStride:e.byteStride/4)),this._updateExtend(s),this._resetPointsArrayCache();for(let e=0;e<n;e++){const t=r[e];t.buildBoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(t.isUnIndexed),t.computeWorldMatrix(!0),t.synchronizeInstances()}}this._notifyUpdate(i)}updateVerticesDataDirectly(e,t,s,i=!1){const r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,s,i),this._notifyUpdate(e))}updateVerticesData(e,t,s=!1){const i=this.getVertexBuffer(e);i&&(i.update(t),e===f.o.PositionKind&&this._updateBoundingInfo(s,t),this._notifyUpdate(e))}_updateBoundingInfo(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e){const e=this._meshes;for(const t of e){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const e=t.subMeshes;for(const t of e)t.refreshBoundingInfo()}}}_bind(e,t,s,i){if(!e)return;void 0===t&&(t=this._indexBuffer);const r=this.getVertexBuffers();if(!r)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!i)return void this._engine.bindBuffers(r,t,e,s);const n=i||this._vertexArrayObjects;n[e.key]||(n[e.key]=this._engine.recordVertexArrayObject(r,t,e,s)),this._engine.bindVertexArrayObject(n[e.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(e,t,s){const i=this.getVertexBuffer(e);return i?i.getFloatData(this._totalVertices,s||t&&1!==this._meshes.length):null}isVertexBufferUpdatable(e){const t=this._vertexBuffers[e];return!!t&&t.isUpdatable()}getVertexBuffer(e){return this.isReady()?this._vertexBuffers[e]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}getVerticesDataKinds(){const e=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(e,t,s=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const i=e.length!==this._indices.length;if(s||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),i)for(const e of this._meshes)e._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)}setIndices(e,t=null,s=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=s,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,s)),null!=t&&(this._totalVertices=t);for(const e of this._meshes)e._createGlobalSubMesh(!0),e.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?this._indices.length:0}getIndices(e,t){if(!this.isReady())return null;const s=this._indices;return t||e&&1!==this._meshes.length?s.slice():s}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(e=null){e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])}releaseForMesh(e,t){const s=this._meshes,i=s.indexOf(e);-1!==i&&(s.splice(i,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===s.length&&t&&this.dispose())}applyToMesh(e){if(e._geometry===this)return;const t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();const s=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),s.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}_updateExtend(e=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(f.o.PositionKind)))return;this._extend=(0,x.k)(e,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(e){const t=this._meshes.length;for(const s in this._vertexBuffers)1===t&&this._vertexBuffers[s].create(),s===f.o.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()}_notifyUpdate(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const e of this._meshes)e._markSubMeshesAsAttributesDirty()}load(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))}_queueLoad(e,t){this.delayLoadingFile&&(e.addPendingData(this),e._loadFile(this.delayLoadingFile,(s=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(s),this),this.delayLoadState=1,this._delayInfo=[],e.removePendingData(this);const i=this._meshes,r=i.length;for(let e=0;e<r;e++)this._applyToMesh(i[e]);t&&t()}),void 0,!0))}toLeftHanded(){const e=this.getIndices(!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3){const s=e[t+0];e[t+0]=e[t+2],e[t+2]=s}this.setIndices(e)}const t=this.getVerticesData(f.o.PositionKind,!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3)t[e+2]=-t[e+2];this.setVerticesData(f.o.PositionKind,t,!1)}const s=this.getVerticesData(f.o.NormalKind,!1);if(null!=s&&s.length>0){for(let e=0;e<s.length;e+=3)s[e+2]=-s[e+2];this.setVerticesData(f.o.NormalKind,s,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const e=this.getVerticesData(f.o.PositionKind);if(!e||0===e.length)return!1;for(let t=3*this._positionsCache.length,s=this._positionsCache.length;t<e.length;t+=3,++s)this._positionsCache[s]=c.P.FromArray(e,t);for(let t=0,s=0;t<e.length;t+=3,++s)this._positionsCache[s].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const e=this._meshes,t=e.length;for(let s=0;s<t;s++)e[s]._invalidateInstanceVertexArrayObject()}}dispose(){const e=this._meshes,t=e.length;let s;for(s=0;s<t;s++)this.releaseForMesh(e[s]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const e in this._vertexBuffers)this._vertexBuffers[e].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const e=this._parentContainer.geometries.indexOf(this);e>-1&&this._parentContainer.geometries.splice(e,1),this._parentContainer=null}this._isDisposed=!0}copy(e){const t=new _.x;t.indices=[];const s=this.getIndices();if(s)for(let e=0;e<s.length;e++)t.indices.push(s[e]);let i,r=!1,n=!1;for(i in this._vertexBuffers){const e=this.getVerticesData(i);if(e&&(e instanceof Float32Array?t.set(new Float32Array(e),i):t.set(e.slice(0),i),!n)){const e=this.getVertexBuffer(i);e&&(r=e.isUpdatable(),n=!r)}}const a=new b(e,this._scene,t,r);for(i in a.delayLoadState=this.delayLoadState,a.delayLoadingFile=this.delayLoadingFile,a._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(i);return a._boundingInfo=new m.j(this._extend.minimum,this._extend.maximum),a}serialize(){const e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,a.$&&a.$.HasTags(this)&&(e.tags=a.$.GetTags(this)),e}_toNumberArray(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const e in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)}serializeVerticeData(){const e=this.serialize();return this.isVerticesDataPresent(f.o.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(f.o.PositionKind)),this.isVertexBufferUpdatable(f.o.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(f.o.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(f.o.NormalKind)),this.isVertexBufferUpdatable(f.o.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(f.o.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(f.o.TangentKind)),this.isVertexBufferUpdatable(f.o.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(f.o.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(f.o.UVKind)),this.isVertexBufferUpdatable(f.o.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(f.o.UV2Kind)&&(e.uv2s=this._toNumberArray(this.getVerticesData(f.o.UV2Kind)),this.isVertexBufferUpdatable(f.o.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(f.o.UV3Kind)&&(e.uv3s=this._toNumberArray(this.getVerticesData(f.o.UV3Kind)),this.isVertexBufferUpdatable(f.o.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(f.o.UV4Kind)&&(e.uv4s=this._toNumberArray(this.getVerticesData(f.o.UV4Kind)),this.isVertexBufferUpdatable(f.o.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(f.o.UV5Kind)&&(e.uv5s=this._toNumberArray(this.getVerticesData(f.o.UV5Kind)),this.isVertexBufferUpdatable(f.o.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(f.o.UV6Kind)&&(e.uv6s=this._toNumberArray(this.getVerticesData(f.o.UV6Kind)),this.isVertexBufferUpdatable(f.o.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(f.o.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(f.o.ColorKind)),this.isVertexBufferUpdatable(f.o.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(f.o.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(f.o.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(f.o.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(f.o.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(f.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(f.o.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e}static ExtractFromMesh(e,t){const s=e._geometry;return s?s.copy(t):null}static RandomId(){return r.w1.RandomId()}static _GetGeometryByLoadedUniqueId(e,t){for(let s=0;s<t.geometries.length;s++)if(t.geometries[s]._loadedUniqueId===e)return t.geometries[s];return null}static _ImportGeometry(e,t){const s=t.getScene(),i=e.geometryUniqueId,r=e.geometryId;if(i||r){const e=i?this._GetGeometryByLoadedUniqueId(i,s):s.getGeometryById(r);e&&e.applyToMesh(t)}else if(e instanceof ArrayBuffer){const s=t._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){const i=new Float32Array(e,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);t.setVerticesData(f.o.PositionKind,i,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){const i=new Float32Array(e,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);t.setVerticesData(f.o.NormalKind,i,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){const i=new Float32Array(e,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);t.setVerticesData(f.o.TangentKind,i,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){const i=new Float32Array(e,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UVKind,i,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){const i=new Float32Array(e,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UV2Kind,i,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){const i=new Float32Array(e,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UV3Kind,i,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){const i=new Float32Array(e,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UV4Kind,i,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){const i=new Float32Array(e,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UV5Kind,i,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){const i=new Float32Array(e,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);if(y.e.UseOpenGLOrientationForUV)for(let e=1;e<i.length;e+=2)i[e]=1-i[e];t.setVerticesData(f.o.UV6Kind,i,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){const i=new Float32Array(e,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);t.setVerticesData(f.o.ColorKind,i,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){const i=new Int32Array(e,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),r=[];for(let e=0;e<i.length;e++){const t=i[e];r.push(255&t),r.push((65280&t)>>8),r.push((16711680&t)>>16),r.push(t>>24&255)}t.setVerticesData(f.o.MatricesIndicesKind,r,!1)}if(s.matricesIndicesExtraAttrDesc&&s.matricesIndicesExtraAttrDesc.count>0){const i=new Int32Array(e,s.matricesIndicesExtraAttrDesc.offset,s.matricesIndicesExtraAttrDesc.count),r=[];for(let e=0;e<i.length;e++){const t=i[e];r.push(255&t),r.push((65280&t)>>8),r.push((16711680&t)>>16),r.push(t>>24&255)}t.setVerticesData(f.o.MatricesIndicesExtraKind,r,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){const i=new Float32Array(e,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);t.setVerticesData(f.o.MatricesWeightsKind,i,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){const i=new Int32Array(e,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);t.setIndices(i,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){const i=new Int32Array(e,s.subMeshesAttrDesc.offset,5*s.subMeshesAttrDesc.count);t.subMeshes=[];for(let e=0;e<s.subMeshesAttrDesc.count;e++){const s=i[5*e+0],r=i[5*e+1],n=i[5*e+2],a=i[5*e+3],o=i[5*e+4];p.P.AddToMesh(s,r,n,a,o,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(f.o.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(f.o.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(f.o.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(f.o.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(f.o.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(f.o.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(f.o.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(f.o.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(f.o.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(f.o.ColorKind,d.HE.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(f.o.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{const s=[];for(let t=0;t<e.matricesIndices.length;t++){const i=e.matricesIndices[t];s.push(255&i),s.push((65280&i)>>8),s.push((16711680&i)>>16),s.push(i>>24&255)}t.setVerticesData(f.o.MatricesIndicesKind,s,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(f.o.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{const s=[];for(let t=0;t<e.matricesIndicesExtra.length;t++){const i=e.matricesIndicesExtra[t];s.push(255&i),s.push((65280&i)>>8),s.push((16711680&i)>>16),s.push(i>>24&255)}t.setVerticesData(f.o.MatricesIndicesExtraKind,s,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(b._CleanMatricesWeights(e,t),t.setVerticesData(f.o.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(f.o.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(let s=0;s<e.subMeshes.length;s++){const i=e.subMeshes[s];p.P.AddToMesh(i.materialIndex,i.verticesStart,i.verticesCount,i.indexStart,i.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),s.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(e,t){const s=.001;if(!g.CleanBoneMatrixWeights)return;let i=0;if(!(e.skeletonId>-1))return;{const s=t.getScene().getLastSkeletonById(e.skeletonId);if(!s)return;i=s.bones.length}const r=t.getVerticesData(f.o.MatricesIndicesKind),n=t.getVerticesData(f.o.MatricesIndicesExtraKind),a=e.matricesWeights,o=e.matricesWeightsExtra,h=e.numBoneInfluencer,l=a.length;for(let e=0;e<l;e+=4){let t=0,l=-1;for(let i=0;i<4;i++){const r=a[e+i];t+=r,r<s&&l<0&&(l=i)}if(o)for(let i=0;i<4;i++){const r=o[e+i];t+=r,r<s&&l<0&&(l=i+4)}if((l<0||l>h-1)&&(l=h-1),t>s){const s=1/t;for(let t=0;t<4;t++)a[e+t]*=s;if(o)for(let t=0;t<4;t++)o[e+t]*=s}else l>=4?(o[e+l-4]=1-t,n[e+l-4]=i):(a[e+l]=1-t,r[e+l]=i)}t.setVerticesData(f.o.MatricesIndicesKind,r),e.matricesWeightsExtra&&t.setVerticesData(f.o.MatricesIndicesExtraKind,n)}static Parse(e,t,s){const i=new b(e.id,t,void 0,e.updatable);return i._loadedUniqueId=e.uniqueId,a.$&&a.$.AddTagsTo(i,e.tags),e.delayLoadingFile?(i.delayLoadState=4,i.delayLoadingFile=s+e.delayLoadingFile,i._boundingInfo=new m.j(c.P.FromArray(e.boundingBoxMinimum),c.P.FromArray(e.boundingBoxMaximum)),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(f.o.UVKind),e.hasUVs2&&i._delayInfo.push(f.o.UV2Kind),e.hasUVs3&&i._delayInfo.push(f.o.UV3Kind),e.hasUVs4&&i._delayInfo.push(f.o.UV4Kind),e.hasUVs5&&i._delayInfo.push(f.o.UV5Kind),e.hasUVs6&&i._delayInfo.push(f.o.UV6Kind),e.hasColors&&i._delayInfo.push(f.o.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(f.o.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(f.o.MatricesWeightsKind),i._delayLoadingFunction=_.x.ImportVertexData):_.x.ImportVertexData(e,i),t.pushGeometry(i,!0),i}}var A=s(7142),I=s(2067),v=s(646);class D extends I.F{get subMaterials(){return this._subMaterials}set subMaterials(e){this._subMaterials=e,this._hookArray(e)}getChildren(){return this.subMaterials}constructor(e,t){super(e,t,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().multiMaterials.push(this),this.subMaterials=new Array,this._storeEffectOnSubMeshes=!0}_hookArray(e){const t=e.push;e.push=(...s)=>{const i=t.apply(e,s);return this._markAllSubMeshesAsTexturesDirty(),i};const s=e.splice;e.splice=(t,i)=>{const r=s.apply(e,[t,i]);return this._markAllSubMeshesAsTexturesDirty(),r}}getSubMaterial(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((e=>e?e.getActiveTextures():[])))}hasTexture(e){var t;if(super.hasTexture(e))return!0;for(let s=0;s<this.subMaterials.length;s++)if(null===(t=this.subMaterials[s])||void 0===t?void 0:t.hasTexture(e))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(e,t,s){for(let i=0;i<this.subMaterials.length;i++){const r=this.subMaterials[i];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,s))return!1;continue}if(!r.isReady(e))return!1}}return!0}clone(e,t){const s=new D(e,this.getScene());for(let i=0;i<this.subMaterials.length;i++){let r=null;const n=this.subMaterials[i];r=t&&n?n.clone(e+"-"+n.name):this.subMaterials[i],s.subMaterials.push(r)}return s}serialize(){const e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,a.$&&(e.tags=a.$.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(let t=0;t<this.subMaterials.length;t++){const s=this.subMaterials[t];s?(e.materialsUniqueIds.push(s.uniqueId),e.materials.push(s.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e}dispose(e,t,s){const i=this.getScene();if(!i)return;if(s)for(let s=0;s<this.subMaterials.length;s++){const i=this.subMaterials[s];i&&i.dispose(e,t)}const r=i.multiMaterials.indexOf(this);r>=0&&i.multiMaterials.splice(r,1),super.dispose(e,t)}static ParseMultiMaterial(e,t){const s=new D(e.name,t);return s.id=e.id,s._loadedUniqueId=e.uniqueId,a.$&&a.$.AddTagsTo(s,e.tags),e.materialsUniqueIds?s._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((e=>s.subMaterials.push(t.getLastMaterialById(e)))),s}}(0,v.H)("BABYLON.MultiMaterial",D);var S=s(8137),P=s(658),T=s(9069),O=s(4559);class C{constructor(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}}class E{}class R{constructor(){this.visibleInstances={},this.batchCache=new B,this.batchCacheReplacementModeInFrozenMode=new B,this.instancesBufferSize=2048}}class B{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array}}class F{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class w{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0}}class V extends A.x{static _GetDefaultSideOrientation(e){return e||V.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(e){this._internalMeshDataInfo._useLODScreenCoverage=e,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(f.o.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(f.o.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new i.y$),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new i.y$),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new i.y$),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new i.y$),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new i.y$),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){var e;return(null!==(e=this._thinInstanceDataStorage.instancesCount)&&void 0!==e?e:0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(e){this._internalMeshDataInfo._forcedInstanceCount=e}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(e){this._instanceDataStorage.manualUpdate=e}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(e){this._instanceDataStorage.previousManualUpdate=e}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(e){this._instanceDataStorage.forceMatrixUpdates=e}constructor(e,t=null,s=null,r=null,o,h=!0){if(super(e,t),this._internalMeshDataInfo=new w,this.delayLoadState=0,this.instances=new Array,this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new R,this._thinInstanceDataStorage=new F,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=V.DEFAULTSIDE,this.overrideMaterialSideOrientation=null,this.ignoreCameraMaxZ=!1,t=this.getScene(),this._onBeforeDraw=(e,t,s)=>{e&&s&&(this._uniformBuffer?this.transferToEffect(t):s.bindOnlyWorldMatrix(t))},r){if(r._geometry&&r._geometry.applyToMesh(this),n.j.DeepCopy(r,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),this._internalMeshDataInfo._source=r,t.useClonedMeshMap&&(r._internalMeshDataInfo.meshMap||(r._internalMeshDataInfo.meshMap={}),r._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=r._originalBuilderSideOrientation,this._creationDataStorage=r._creationDataStorage,r._ranges){const e=r._ranges;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&e[t]&&this.createAnimationRange(t,e[t].from,e[t].to)}if(r.metadata&&r.metadata.clone?this.metadata=r.metadata.clone():this.metadata=r.metadata,this._internalMetadata=r._internalMetadata,a.$&&a.$.HasTags(r)&&a.$.AddTagsTo(this,a.$.GetTags(r,!0)),this.setEnabled(r.isEnabled(!1)),this.parent=r.parent,this.setPivotMatrix(r.getPivotMatrix()),this.id=e+"."+r.id,this.material=r.material,!o){const t=r.getDescendants(!0);for(let s=0;s<t.length;s++){const i=t[s];i.clone&&i.clone(e+"."+i.name,this)}}if(r.morphTargetManager&&(this.morphTargetManager=r.morphTargetManager),t.getPhysicsEngine){const e=t.getPhysicsEngine();if(h&&e&&1===e.getPluginVersion()){const t=e.getImpostorForPhysicsObject(r);t&&(this.physicsImpostor=t.clone(this))}}for(let e=0;e<t.particleSystems.length;e++){const s=t.particleSystems[e];s.emitter===r&&s.clone(s.name,this)}this.skeleton=r.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}null!==s&&(this.parent=s),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=e=>{e.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new i.y$(this._internalMeshDataInfo._onMeshReadyObserverAdded),r&&r.onClonedObservable.notifyObservers(this)}instantiateHierarchy(e=null,t,s){const i=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));i.parent=e||this.parent,i.position=this.position.clone(),i.scaling=this.scaling.clone(),this.rotationQuaternion?i.rotationQuaternion=this.rotationQuaternion.clone():i.rotation=this.rotation.clone(),s&&s(this,i);for(const e of this.getChildTransformNodes(!0))"InstancedMesh"===e.getClassName()&&"Mesh"===i.getClassName()&&e.sourceMesh===this?e.instantiateHierarchy(i,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:i},s):e.instantiateHierarchy(i,t,s);return i}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(e){let t=super.toString(e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let s=0;s<this.animations.length;s++)t+=", animation[0]: "+this.animations[s].toString(e);if(e)if(this._geometry){const e=this.getIndices(),s=this.getVerticesData(f.o.PositionKind);s&&e&&(t+=", flat shading: "+(s.length/3===e.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const e of this.instances)e._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,s)=>t.distanceOrScreenCoverage<s.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>s.distanceOrScreenCoverage?-e:0))}addLODLevel(e,t){if(t&&t._masterMesh)return P.Y.Warn("You cannot use a mesh as LOD level twice"),this;const s=new C(e,t);return this._internalMeshDataInfo._LODLevels.push(s),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(e){const t=this._internalMeshDataInfo;for(let s=0;s<t._LODLevels.length;s++){const i=t._LODLevels[s];if(i.distanceOrScreenCoverage===e)return i.mesh}return null}removeLODLevel(e){const t=this._internalMeshDataInfo;for(let s=0;s<t._LODLevels.length;s++)t._LODLevels[s].mesh===e&&(t._LODLevels.splice(s,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this}getLOD(e,t){const s=this._internalMeshDataInfo;if(!s._LODLevels||0===s._LODLevels.length)return this;const i=t||this.getBoundingInfo().boundingSphere,r=e.mode===h.V.ORTHOGRAPHIC_CAMERA?e.minZ:i.centerWorld.subtract(e.globalPosition).length();let n=r,a=1;if(s._useLODScreenCoverage){const t=e.screenArea;let s=i.radiusWorld*e.minZ/r;s=s*s*Math.PI,n=s/t,a=-1}if(a*s._LODLevels[s._LODLevels.length-1].distanceOrScreenCoverage>a*n)return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this;for(let e=0;e<s._LODLevels.length;e++){const t=s._LODLevels[e];if(a*t.distanceOrScreenCoverage<a*n){if(t.mesh){if(4===t.mesh.delayLoadState)return t.mesh._checkDelayState(),this;if(2===t.mesh.delayLoadState)return this;t.mesh._preActivate(),t.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,t.mesh),t.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(e,t,s){var i,r;if(!this._geometry)return null;let n=null===(r=null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[e])||void 0===r?void 0:r.getFloatData(this._geometry.getTotalVertices(),s||t&&1!==this._geometry.meshes.length);return n||(n=this._geometry.getVerticesData(e,t,s)),n}getVertexBuffer(e){var t,s;return this._geometry?null!==(s=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])&&void 0!==s?s:this._geometry.getVertexBuffer(e):null}isVerticesDataPresent(e){var t;return this._geometry?void 0!==(null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}isVertexBufferUpdatable(e){var t,s;return this._geometry?(null===(s=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||void 0===s?void 0:s.isUpdatable())||this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)}getVerticesDataKinds(){if(!this._geometry){const e=new Array;return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}const e=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(const t in this._userInstancedBuffersStorage.vertexBuffers)e.push(t);return e}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(e,t){return this._geometry?this._geometry.getIndices(e,t):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(e=!1,t=!1){var s,i,r,n,a,o;if(2===this.delayLoadState)return!1;if(!super.isReady(e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;const h=this.getEngine(),l=this.getScene(),c=t||h.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const d=this.material||l.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const e of this.subMeshes){const t=e.getMaterial();if(t)if(t._storeEffectOnSubMeshes){if(!t.isReadyForSubMesh(this,e,c))return!1}else if(!t.isReady(this,c))return!1}else if(!d.isReady(this,c))return!1;const u=h.currentRenderPassId;for(const e of this.lightSources){const t=e.getShadowGenerators();if(!t)continue;const l=t.values();for(let e=l.next();!0!==e.done;e=l.next()){const t=e.value;if(t&&(!(null===(s=t.getShadowMap())||void 0===s?void 0:s.renderList)||(null===(i=t.getShadowMap())||void 0===i?void 0:i.renderList)&&-1!==(null===(n=null===(r=t.getShadowMap())||void 0===r?void 0:r.renderList)||void 0===n?void 0:n.indexOf(this)))){t.getShadowMap()&&(h.currentRenderPassId=t.getShadowMap().renderPassId);for(const e of this.subMeshes)if(!t.isReady(e,c,null!==(o=null===(a=e.getMaterial())||void 0===a?void 0:a.needAlphaBlendingForMesh(this))&&void 0!==o&&o))return h.currentRenderPassId=u,!1;h.currentRenderPassId=u}}}for(const e of this._internalMeshDataInfo._LODLevels)if(e.mesh&&!e.mesh.isReady(c))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(e){this._instanceDataStorage.overridenInstanceCount=e}_preActivate(){const e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this}_registerInstanceForRenderId(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;const s=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e,t),s),this}_createGlobalSubMesh(e){const t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const s=this.getIndices();if(!s)return null;const i=s.length;let r=!1;if(e)r=!0;else for(const e of this.subMeshes){if(e.indexStart+e.indexCount>i){r=!0;break}if(e.verticesStart+e.verticesCount>t){r=!0;break}}if(!r)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.P(0,0,t,0,this.getTotalIndices(),this)}subdivide(e){if(e<1)return;const t=this.getTotalIndices();let s=t/e|0,i=0;for(;s%3!=0;)s++;this.releaseSubMeshes();for(let r=0;r<e&&!(i>=t);r++)p.P.CreateFromIndices(0,i,r===e-1?t-i:s,this),i+=s;this.synchronizeInstances()}setVerticesData(e,t,s=!1,i){if(this._geometry)this._geometry.setVerticesData(e,t,s,i);else{const i=new _.x;i.set(t,e);const r=this.getScene();new b(b.RandomId(),r,i,s,this)}return this}removeVerticesData(e){this._geometry&&this._geometry.removeVerticesData(e)}markVerticesDataAsUpdatable(e,t=!0){const s=this.getVertexBuffer(e);s&&s.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)}setVerticesBuffer(e,t=!0){return this._geometry||(this._geometry=b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this}updateVerticesData(e,t,s,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,s,!1)):this._geometry.updateVerticesData(e,t,s),this):this}updateMeshPositions(e,t=!0){const s=this.getVerticesData(f.o.PositionKind);if(!s)return this;if(e(s),this.updateVerticesData(f.o.PositionKind,s,!1,!1),t){const e=this.getIndices(),t=this.getVerticesData(f.o.NormalKind);if(!t)return this;_.x.ComputeNormals(s,e,t),this.updateVerticesData(f.o.NormalKind,t,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const e=this._geometry,t=this._geometry.copy(b.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this}setIndices(e,t=null,s=!1){if(this._geometry)this._geometry.setIndices(e,t,s);else{const t=new _.x;t.indices=e;const i=this.getScene();new b(b.RandomId(),i,t,s,this)}return this}updateIndices(e,t,s=!1){return this._geometry?(this._geometry.updateIndices(e,t,s),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(e,t,s,i=!0){if(!this._geometry)return this;const r=this.getScene().getEngine();let n;if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t),this._unIndexed)n=null;else switch(s){case I.F.PointFillMode:n=null;break;case I.F.WireFrameFillMode:n=e._getLinesIndexBuffer(this.getIndices(),r);break;default:case I.F.TriangleFillMode:n=this._geometry.getIndexBuffer()}return i&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(t,n,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(t,n),this}_draw(e,t,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const i=this.getScene().getEngine();return this._unIndexed||t==I.F.PointFillMode?i.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||s):t==I.F.WireFrameFillMode?i.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||s):i.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||s),this}registerBeforeRender(e){return this.onBeforeRenderObservable.add(e),this}unregisterBeforeRender(e){return this.onBeforeRenderObservable.removeCallback(e),this}registerAfterRender(e){return this.onAfterRenderObservable.add(e),this}unregisterAfterRender(e){return this.onAfterRenderObservable.removeCallback(e),this}_getInstancesRenderList(e,t=!1){if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const s=this.getScene(),i=s._isInIntermediateRendering(),r=i?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,n=this._instanceDataStorage.batchCache;if(n.mustReturn=!1,n.renderSelf[e]=t||!r&&this.isEnabled()&&this.isVisible,n.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,r=s.getRenderId(),a=i?t.intermediateDefaultRenderId:t.defaultRenderId;n.visibleInstances[e]=t[r],!n.visibleInstances[e]&&a&&(n.visibleInstances[e]=t[a])}return n.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==n.visibleInstances[e]&&void 0!==n.visibleInstances[e],this._instanceDataStorage.previousBatch=n,n}_renderWithInstances(e,t,s,i,r){var n;const a=s.visibleInstances[e._id],o=a?a.length:0,h=this._instanceDataStorage,l=h.instancesBufferSize;let d=h.instancesBuffer,u=h.instancesPreviousBuffer;const _=16*(o+1)*4;for(;h.instancesBufferSize<_;)h.instancesBufferSize*=2;h.instancesData&&l==h.instancesBufferSize||(h.instancesData=new Float32Array(h.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousData||l!=h.instancesBufferSize)&&(h.instancesPreviousData=new Float32Array(h.instancesBufferSize/4));let p=0,g=0;const m=s.renderSelf[e._id],x=!d||l!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||h.isFrozen&&!x)g=(m?1:0)+o;else{const t=this.getWorldMatrix();if(m&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,p),h.masterMeshPreviousWorldMatrix.copyFrom(t)):(h.masterMeshPreviousWorldMatrix=t.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,p))),t.copyToArray(h.instancesData,p),p+=16,g++),a){if(V.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(n=e.getMaterial())||void 0===n?void 0:n.needAlphaBlendingForMesh(e.getRenderingMesh()))){const e=this._scene.activeCamera.globalPosition;for(let t=0;t<a.length;t++){const s=a[t];s._distanceToCamera=c.P.Distance(s.getBoundingInfo().boundingSphere.centerWorld,e)}a.sort(((e,t)=>e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0))}for(let e=0;e<a.length;e++){const t=a[e],s=t.getWorldMatrix();s.copyToArray(h.instancesData,p),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(h.instancesPreviousData,p),t._previousWorldMatrix.copyFrom(s)):(t._previousWorldMatrix=s.clone(),t._previousWorldMatrix.copyToArray(h.instancesPreviousData,p))),p+=16,g++}}}return x?(d&&d.dispose(),u&&u.dispose(),d=new f.l(r,h.instancesData,!0,16,!1,!0),h.instancesBuffer=d,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=d.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=d.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=d.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=d.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new f.l(r,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(d.updateDirectly(h.instancesData,0,g),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(h.instancesPreviousData,0,g)),this._processInstancedBuffers(a,m),this.getScene()._activeIndices.addCount(e.indexCount*g,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,g),!this._scene.needsPreviousWorldMatrices||x||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(h.instancesData,0,g),r.unbindInstanceAttributes(),this}_renderWithThinInstances(e,t,s,i){var r,n;const a=null!==(n=null===(r=this._thinInstanceDataStorage)||void 0===r?void 0:r.instancesCount)&&void 0!==n?n:0;this.getScene()._activeIndices.addCount(e.indexCount*a,!1),i._currentDrawContext&&(i._currentDrawContext.useInstancing=!0),this._bind(e,s,t),this._draw(e,t,a),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,a):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),i.unbindInstanceAttributes()}_processInstancedBuffers(e,t){}_processRendering(e,t,s,i,r,n,a,o){const h=this.getScene(),l=h.getEngine();if(n&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,i,s,l),this;if(n)this._renderWithInstances(t,i,r,s,l);else{l._currentDrawContext&&(l._currentDrawContext.useInstancing=!1);let s=0;r.renderSelf[t._id]&&(a&&a(!1,e.getWorldMatrix(),o),s++,this._draw(t,i,this._instanceDataStorage.overridenInstanceCount));const n=r.visibleInstances[t._id];if(n){const e=n.length;s+=e;for(let s=0;s<e;s++){const e=n[s].getWorldMatrix();a&&a(!0,e,o),this._draw(t,i)}}h._activeIndices.addCount(t.indexCount*s,!1)}return this}_rebuild(e=!1){if(this._instanceDataStorage.instancesBuffer&&(e&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const s=this._userInstancedBuffersStorage.vertexBuffers[t];s&&(e&&s.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(e)}_freeze(){if(this.subMeshes){for(let e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}render(e,t,s){var i,r,n;const a=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const o=this._getInstancesRenderList(e._id,!!s);if(o.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const h=a.getEngine();let c=0,d=null;this.ignoreCameraMaxZ&&a.activeCamera&&!a._isInIntermediateRendering()&&(c=a.activeCamera.maxZ,d=a.activeCamera,a.activeCamera.maxZ=0,a.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const u=e.getRenderingMesh(),f=o.hardwareInstancedRendering[e._id]||u.hasThinInstances||!!this._userInstancedBuffersStorage&&!e.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,_=this._instanceDataStorage,p=e.getMaterial();if(!p)return d&&(d.maxZ=c,a.updateTransformMatrix(!0)),this;if(_.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===p){if(p._storeEffectOnSubMeshes&&!(null===(i=e.effect)||void 0===i?void 0:i._wasPreviouslyReady)||!p._storeEffectOnSubMeshes&&!(null===(r=p.getEffect())||void 0===r?void 0:r._wasPreviouslyReady))return d&&(d.maxZ=c,a.updateTransformMatrix(!0)),this}else{if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(this,e,f))return d&&(d.maxZ=c,a.updateTransformMatrix(!0)),this}else if(!p.isReady(this,f))return d&&(d.maxZ=c,a.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=p}let g;t&&h.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),g=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const m=null!==(n=null==g?void 0:g.effect)&&void 0!==n?n:null;for(const t of a._beforeRenderingMeshStage)t.action(this,e,o,m);if(!g||!m)return d&&(d.maxZ=c,a.updateTransformMatrix(!0)),this;const x=s||this;let M;if(_.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)M=_.sideOrientation;else{const e=x._getWorldMatrixDeterminant();M=this.overrideMaterialSideOrientation,null==M&&(M=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),e<0&&(M=M===I.F.ClockWiseSideOrientation?I.F.CounterClockWiseSideOrientation:I.F.ClockWiseSideOrientation),_.sideOrientation=M}const y=this._internalMeshDataInfo._effectiveMaterial._preBind(g,M);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&h.setDepthWrite(!0);const b=a.forcePointsCloud?I.F.PointFillMode:a.forceWireframe?I.F.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(e,m,b,!1);const A=this._internalMeshDataInfo._effectiveMaterial,v=x.getWorldMatrix();A._storeEffectOnSubMeshes?A.bindForSubMesh(v,this,e):A.bind(v,this),!A.backFaceCulling&&A.separateCullingPass&&(h.setState(!0,A.zOffset,!1,!y,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._processRendering(this,e,m,b,o,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),h.setState(!0,A.zOffset,!1,y,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,m,b,o,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const t of a._afterRenderingMeshStage)t.action(this,e,o,m);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),d&&(d.maxZ=c,a.updateTransformMatrix(!0)),a.performancePriority!==l.a.Aggressive||_.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(f.o.MatricesWeightsKind)&&(this.isVerticesDataPresent(f.o.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const e=this.getVerticesData(f.o.MatricesWeightsKind),t=e.length;for(let s=0;s<t;s+=4){const t=e[s]+e[s+1]+e[s+2]+e[s+3];if(0===t)e[s]=1;else{const i=1/t;e[s]*=i,e[s+1]*=i,e[s+2]*=i,e[s+3]*=i}}this.setVerticesData(f.o.MatricesWeightsKind,e)}_normalizeSkinWeightsAndExtra(){const e=this.getVerticesData(f.o.MatricesWeightsExtraKind),t=this.getVerticesData(f.o.MatricesWeightsKind),s=t.length;for(let i=0;i<s;i+=4){let s=t[i]+t[i+1]+t[i+2]+t[i+3];if(s+=e[i]+e[i+1]+e[i+2]+e[i+3],0===s)t[i]=1;else{const r=1/s;t[i]*=r,t[i+1]*=r,t[i+2]*=r,t[i+3]*=r,e[i]*=r,e[i+1]*=r,e[i+2]*=r,e[i+3]*=r}}this.setVerticesData(f.o.MatricesWeightsKind,t),this.setVerticesData(f.o.MatricesWeightsKind,e)}validateSkinning(){const e=this.getVerticesData(f.o.MatricesWeightsExtraKind),t=this.getVerticesData(f.o.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const s=t.length;let i=0,r=0,n=0,a=0;const o=null===e?4:8,h=new Array;for(let e=0;e<=o;e++)h[e]=0;for(let l=0;l<s;l+=4){let s=t[l],c=s,d=0===c?0:1;for(let r=1;r<o;r++){const n=r<4?t[l+r]:e[l+r-4];n>s&&i++,0!==n&&d++,c+=n,s=n}if(h[d]++,d>n&&(n=d),0===c)r++;else{const s=1/c;let i=0;for(let r=0;r<o;r++)i+=r<4?Math.abs(t[l+r]-t[l+r]*s):Math.abs(e[l+r-4]-e[l+r-4]*s);i>.001&&a++}}const l=this.skeleton.bones.length,c=this.getVerticesData(f.o.MatricesIndicesKind),d=this.getVerticesData(f.o.MatricesIndicesExtraKind);let u=0;for(let e=0;e<s;e+=4)for(let t=0;t<o;t++){const s=t<4?c[e+t]:d[e+t-4];(s>=l||s<0)&&u++}return{skinned:!0,valid:0===r&&0===a&&0===u,report:"Number of Weights = "+s/4+"\nMaximum influences = "+n+"\nMissing Weights = "+r+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+h+"]\nNumber of bones = "+l+"\nBad Bone Indices = "+u}}_checkDelayState(){const e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this}_queueLoad(e){e.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return r.w1.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((e=>{e.refreshBoundingInfo(),e._syncSubMeshes()})),this.delayLoadState=1,e.removePendingData(this)}),(()=>{}),e.offlineProvider,t),this}isInFrustum(e){return 2!==this.delayLoadState&&!!super.isInFrustum(e)&&(this._checkDelayState(),!0)}setMaterialById(e){const t=this.getScene().materials;let s;for(s=t.length-1;s>-1;s--)if(t[s].id===e)return this.material=t[s],this;const i=this.getScene().multiMaterials;for(s=i.length-1;s>-1;s--)if(i[s].id===e)return this.material=i[s],this;return this}getAnimatables(){const e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e}bakeTransformIntoVertices(e){if(!this.isVerticesDataPresent(f.o.PositionKind))return this;const t=this.subMeshes.splice(0);this._resetPointsArrayCache();let s=this.getVerticesData(f.o.PositionKind);const i=c.P.Zero();let r;for(r=0;r<s.length;r+=3)c.P.TransformCoordinatesFromFloatsToRef(s[r],s[r+1],s[r+2],e,i).toArray(s,r);if(this.setVerticesData(f.o.PositionKind,s,this.getVertexBuffer(f.o.PositionKind).isUpdatable()),this.isVerticesDataPresent(f.o.NormalKind)){for(s=this.getVerticesData(f.o.NormalKind),r=0;r<s.length;r+=3)c.P.TransformNormalFromFloatsToRef(s[r],s[r+1],s[r+2],e,i).normalize().toArray(s,r);this.setVerticesData(f.o.NormalKind,s,this.getVertexBuffer(f.o.NormalKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this}bakeCurrentTransformIntoVertices(e=!0){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this}get _positions(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(e="",t=null,s,i=!0){return new V(e,this.getScene(),t,this,s,i)}dispose(e,t=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const s=this._internalMeshDataInfo;if(s._onBeforeDrawObservable&&s._onBeforeDrawObservable.clear(),s._onBeforeBindObservable&&s._onBeforeBindObservable.clear(),s._onBeforeRenderObservable&&s._onBeforeRenderObservable.clear(),s._onAfterRenderObservable&&s._onAfterRenderObservable.clear(),s._onBetweenPassObservable&&s._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(s.meshMap)for(const e in s.meshMap){const t=s.meshMap[e];t&&(t._internalMeshDataInfo._source=null,s.meshMap[e]=void 0)}s._source&&s._source._internalMeshDataInfo.meshMap&&(s._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const e=this.getScene().meshes;for(const t of e){const e=t;e._internalMeshDataInfo&&e._internalMeshDataInfo._source&&e._internalMeshDataInfo._source===this&&(e._internalMeshDataInfo._source=null)}}s._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(e,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(e,t,s,i,n,a,o=!1){const h=this.getScene();return r.w1.LoadImage(e,(e=>{const r=e.width,h=e.height,l=this.getEngine().createCanvas(r,h).getContext("2d");l.drawImage(e,0,0);const c=l.getImageData(0,0,r,h).data;this.applyDisplacementMapFromBuffer(c,r,h,t,s,n,a,o),i&&i(this)}),(()=>{}),h.offlineProvider),this}applyDisplacementMapFromBuffer(e,t,s,i,r,n,a,o=!1){if(!this.isVerticesDataPresent(f.o.PositionKind)||!this.isVerticesDataPresent(f.o.NormalKind)||!this.isVerticesDataPresent(f.o.UVKind))return P.Y.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const h=this.getVerticesData(f.o.PositionKind,!0,!0),l=this.getVerticesData(f.o.NormalKind),d=this.getVerticesData(f.o.UVKind);let u=c.P.Zero();const p=c.P.Zero(),g=c.FM.Zero();n=n||c.FM.Zero(),a=a||new c.FM(1,1);for(let o=0;o<h.length;o+=3){c.P.FromArrayToRef(h,o,u),c.P.FromArrayToRef(l,o,p),c.FM.FromArrayToRef(d,o/3*2,g);const f=4*((Math.abs(g.x*a.x+n.x%1)*(t-1)%t|0)+(Math.abs(g.y*a.y+n.y%1)*(s-1)%s|0)*t),_=e[f]/255*.3+e[f+1]/255*.59+e[f+2]/255*.11;p.normalize(),p.scaleInPlace(i+(r-i)*_),u=u.add(p),u.toArray(h,o)}return _.x.ComputeNormals(h,this.getIndices(),l),o?(this.setVerticesData(f.o.PositionKind,h),this.setVerticesData(f.o.NormalKind,l),this.setVerticesData(f.o.UVKind,d)):(this.updateVerticesData(f.o.PositionKind,h),this.updateVerticesData(f.o.NormalKind,l)),this}convertToFlatShadedMesh(){const e=this.getVerticesDataKinds(),t={},s={},i={};let r,n,a=!1;for(r=0;r<e.length;r++){n=e[r];const o=this.getVertexBuffer(n),h=o.getData();(h instanceof Array||h instanceof Float32Array)&&0===h.length||(n!==f.o.NormalKind?(t[n]=o,s[n]=this.getVerticesData(n),i[n]=[]):(a=o.isUpdatable(),e.splice(r,1),r--))}const o=this.subMeshes.slice(0),h=this.getIndices(),l=this.getTotalIndices();let d;for(d=0;d<l;d++){const a=h[d];for(r=0;r<e.length;r++){if(n=e[r],!t[n])continue;const o=t[n].getStrideSize();for(let e=0;e<o;e++)i[n].push(s[n][a*o+e])}}const u=[],_=i[f.o.PositionKind];let g;for(g=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,d=0;d<l;d+=3){h[d]=d,h[d+1]=d+1,h[d+2]=d+2;const e=c.P.FromArray(_,3*d),t=c.P.FromArray(_,3*(d+1)),s=c.P.FromArray(_,3*(d+2)),i=e.subtract(t),r=s.subtract(t),n=c.P.Normalize(c.P.Cross(i,r));g&&n.scaleInPlace(-1);for(let e=0;e<3;e++)u.push(n.x),u.push(n.y),u.push(n.z)}for(this.setIndices(h),this.setVerticesData(f.o.NormalKind,u,a),r=0;r<e.length;r++)n=e[r],i[n]&&this.setVerticesData(n,i[n],t[n].isUpdatable());this.releaseSubMeshes();for(let e=0;e<o.length;e++){const t=o[e];p.P.AddToMesh(t.materialIndex,t.indexStart,t.indexCount,t.indexStart,t.indexCount,this)}return this.synchronizeInstances(),this}convertToUnIndexedMesh(){const e=this.getVerticesDataKinds(),t={},s={},i={};let r,n;for(r=0;r<e.length;r++){n=e[r];const a=this.getVertexBuffer(n);t[n]=a,s[n]=t[n].getData(),i[n]=[]}const a=this.subMeshes.slice(0),o=this.getIndices(),h=this.getTotalIndices();let l;for(l=0;l<h;l++){const a=o[l];for(r=0;r<e.length;r++){n=e[r];const o=t[n].getStrideSize();for(let e=0;e<o;e++)i[n].push(s[n][a*o+e])}}for(l=0;l<h;l+=3)o[l]=l,o[l+1]=l+1,o[l+2]=l+2;for(this.setIndices(o),r=0;r<e.length;r++)n=e[r],this.setVerticesData(n,i[n],t[n].isUpdatable(),t[n].getStrideSize());this.releaseSubMeshes();for(let e=0;e<a.length;e++){const t=a[e];p.P.AddToMesh(t.materialIndex,t.indexStart,t.indexCount,t.indexStart,t.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this}flipFaces(e=!1){const t=_.x.ExtractFromMesh(this);let s;if(e&&this.isVerticesDataPresent(f.o.NormalKind)&&t.normals)for(s=0;s<t.normals.length;s++)t.normals[s]*=-1;if(t.indices){let e;for(s=0;s<t.indices.length;s+=3)e=t.indices[s+1],t.indices[s+1]=t.indices[s+2],t.indices[s+2]=e}return t.applyToMesh(this,this.isVertexBufferUpdatable(f.o.PositionKind)),this}increaseVertices(e=1){const t=_.x.ExtractFromMesh(this),s=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,i=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,r=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,n=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(s&&i){t.indices=s,t.positions=i,r&&(t.uvs=r),n&&(t.normals=n);const a=e+1,o=new Array;for(let e=0;e<a+1;e++)o[e]=new Array;let h,l;const d=new c.P(0,0,0),u=new c.P(0,0,0),_=new c.FM(0,0),p=new Array,g=new Array,m=new Array;let x,M,y,b=i.length;r&&(M=r.length),n&&(y=n.length);for(let e=0;e<s.length;e+=3){g[0]=s[e],g[1]=s[e+1],g[2]=s[e+2];for(let e=0;e<3;e++)if(h=g[e],l=g[(e+1)%3],void 0===m[h]&&void 0===m[l]?(m[h]=new Array,m[l]=new Array):(void 0===m[h]&&(m[h]=new Array),void 0===m[l]&&(m[l]=new Array)),void 0===m[h][l]&&void 0===m[l][h]){m[h][l]=[],d.x=(i[3*l]-i[3*h])/a,d.y=(i[3*l+1]-i[3*h+1])/a,d.z=(i[3*l+2]-i[3*h+2])/a,n&&(u.x=(n[3*l]-n[3*h])/a,u.y=(n[3*l+1]-n[3*h+1])/a,u.z=(n[3*l+2]-n[3*h+2])/a),r&&(_.x=(r[2*l]-r[2*h])/a,_.y=(r[2*l+1]-r[2*h+1])/a),m[h][l].push(h);for(let e=1;e<a;e++)m[h][l].push(i.length/3),i[b++]=i[3*h]+e*d.x,i[b++]=i[3*h+1]+e*d.y,i[b++]=i[3*h+2]+e*d.z,n&&(n[y++]=n[3*h]+e*u.x,n[y++]=n[3*h+1]+e*u.y,n[y++]=n[3*h+2]+e*u.z),r&&(r[M++]=r[2*h]+e*_.x,r[M++]=r[2*h+1]+e*_.y);m[h][l].push(l),m[l][h]=new Array,x=m[h][l].length;for(let e=0;e<x;e++)m[l][h][e]=m[h][l][x-1-e]}o[0][0]=s[e],o[1][0]=m[s[e]][s[e+1]][1],o[1][1]=m[s[e]][s[e+2]][1];for(let t=2;t<a;t++){o[t][0]=m[s[e]][s[e+1]][t],o[t][t]=m[s[e]][s[e+2]][t],d.x=(i[3*o[t][t]]-i[3*o[t][0]])/t,d.y=(i[3*o[t][t]+1]-i[3*o[t][0]+1])/t,d.z=(i[3*o[t][t]+2]-i[3*o[t][0]+2])/t,n&&(u.x=(n[3*o[t][t]]-n[3*o[t][0]])/t,u.y=(n[3*o[t][t]+1]-n[3*o[t][0]+1])/t,u.z=(n[3*o[t][t]+2]-n[3*o[t][0]+2])/t),r&&(_.x=(r[2*o[t][t]]-r[2*o[t][0]])/t,_.y=(r[2*o[t][t]+1]-r[2*o[t][0]+1])/t);for(let e=1;e<t;e++)o[t][e]=i.length/3,i[b++]=i[3*o[t][0]]+e*d.x,i[b++]=i[3*o[t][0]+1]+e*d.y,i[b++]=i[3*o[t][0]+2]+e*d.z,n&&(n[y++]=n[3*o[t][0]]+e*u.x,n[y++]=n[3*o[t][0]+1]+e*u.y,n[y++]=n[3*o[t][0]+2]+e*u.z),r&&(r[M++]=r[2*o[t][0]]+e*_.x,r[M++]=r[2*o[t][0]+1]+e*_.y)}o[a]=m[s[e+1]][s[e+2]],p.push(o[0][0],o[1][0],o[1][1]);for(let e=1;e<a;e++){let t;for(t=0;t<e;t++)p.push(o[e][t],o[e+1][t],o[e+1][t+1]),p.push(o[e][t],o[e+1][t+1],o[e][t+1]);p.push(o[e][t],o[e+1][t],o[e+1][t+1])}}t.indices=p,t.applyToMesh(this,this.isVertexBufferUpdatable(f.o.PositionKind))}else P.Y.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const e=_.x.ExtractFromMesh(this),t=e.uvs,s=e.indices,i=e.positions,r=e.colors,n=e.matricesIndices,a=e.matricesWeights,o=e.matricesIndicesExtra,h=e.matricesWeightsExtra;if(void 0===s||void 0===i||null===s||null===i)P.Y.Warn("VertexData contains empty entries");else{const l=new Array,c=new Array,d=new Array,u=new Array,p=new Array,g=new Array,m=new Array,x=new Array;let M=new Array,y=0;const b={};let A,I;for(let e=0;e<s.length;e+=3){I=[s[e],s[e+1],s[e+2]],M=new Array;for(let e=0;e<3;e++){M[e]="";for(let t=0;t<3;t++)Math.abs(i[3*I[e]+t])<1e-8&&(i[3*I[e]+t]=0),M[e]+=i[3*I[e]+t]+"|"}if(M[0]!=M[1]&&M[0]!=M[2]&&M[1]!=M[2])for(let e=0;e<3;e++){if(A=b[M[e]],void 0===A){b[M[e]]=y,A=y++;for(let t=0;t<3;t++)l.push(i[3*I[e]+t]);if(null!=r)for(let t=0;t<4;t++)u.push(r[4*I[e]+t]);if(null!=t)for(let s=0;s<2;s++)d.push(t[2*I[e]+s]);if(null!=n)for(let t=0;t<4;t++)p.push(n[4*I[e]+t]);if(null!=a)for(let t=0;t<4;t++)g.push(a[4*I[e]+t]);if(null!=o)for(let t=0;t<4;t++)m.push(o[4*I[e]+t]);if(null!=h)for(let t=0;t<4;t++)x.push(h[4*I[e]+t])}c.push(A)}}const v=new Array;_.x.ComputeNormals(l,c,v),e.positions=l,e.indices=c,e.normals=v,null!=t&&(e.uvs=d),null!=r&&(e.colors=u),null!=n&&(e.matricesIndices=p),null!=a&&(e.matricesWeights=g),null!=o&&(e.matricesIndicesExtra=m),null!=a&&(e.matricesWeightsExtra=x),e.applyToMesh(this,this.isVertexBufferUpdatable(f.o.PositionKind))}}static _instancedMeshFactory(e,t){throw(0,T.S)("InstancedMesh")}static _PhysicsImpostorParser(e,t,s){throw(0,T.S)("PhysicsImpostor")}createInstance(e){return V._instancedMeshFactory(e,this)}synchronizeInstances(){for(let e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this}optimizeIndices(e){const t=this.getIndices(),s=this.getVerticesData(f.o.PositionKind);if(!s||!t)return this;const i=new Array;for(let e=0;e<s.length;e+=3)i.push(c.P.FromArray(s,e));const n=new Array;return r.$g.SyncAsyncForLoop(i.length,40,(e=>{const t=i.length-1-e,s=i[t];for(let e=0;e<t;++e){const r=i[e];if(s.equals(r)){n[t]=e;break}}}),(()=>{for(let e=0;e<t.length;++e)t[e]=n[t[e]]||t[e];const s=this.subMeshes.slice(0);this.setIndices(t),this.subMeshes=s,e&&e(this)})),this}serialize(e={}){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),a.$&&a.$.HasTags(this)&&(e.tags=a.$.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(let t=0;t<this.subMeshes.length;t++){const s=this.subMeshes[t];e.subMeshes.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(O.l.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(e.physicsMass=t.getParam("mass"),e.physicsFriction=t.getParam("friction"),e.physicsRestitution=t.getParam("mass"),e.physicsImpostor=t.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(let t=0;t<this.instances.length;t++){const s=this.instances[t];if(s.doNotSerialize)continue;const i={name:s.name,id:s.id,isEnabled:s.isEnabled(!1),isVisible:s.isVisible,isPickable:s.isPickable,checkCollisions:s.checkCollisions,position:s.position.asArray(),scaling:s.scaling.asArray()};if(s.parent&&s.parent._serializeAsParent(i),s.rotationQuaternion?i.rotationQuaternion=s.rotationQuaternion.asArray():s.rotation&&(i.rotation=s.rotation.asArray()),this.getScene()._getComponent(O.l.NAME_PHYSICSENGINE)){const e=s.getPhysicsImpostor();e&&(i.physicsMass=e.getParam("mass"),i.physicsFriction=e.getParam("friction"),i.physicsRestitution=e.getParam("mass"),i.physicsImpostor=e.type)}s.metadata&&(i.metadata=s.metadata),s.actionManager&&(i.actions=s.actionManager.serialize(s.name)),e.instances.push(i),S.p4.AppendSerializedAnimations(s,i),i.ranges=s.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const e in this._userThinInstanceBuffersStorage.data)t.data[e]=Array.from(this._userThinInstanceBuffersStorage.data[e]),t.sizes[e]=this._userThinInstanceBuffersStorage.sizes[e],t.strides[e]=this._userThinInstanceBuffersStorage.strides[e];e.thinInstances.userThinInstance=t}return S.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name)),e}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return P.Y.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(let t=0;t<e.numInfluencers;t++){const s=e.getActiveTarget(t),i=s.getPositions();if(!i)return void P.Y.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(f.o.PositionKind+t,i,!1,3);const r=s.getNormals();r&&this.geometry.setVerticesData(f.o.NormalKind+t,r,!1,3);const n=s.getTangents();n&&this.geometry.setVerticesData(f.o.TangentKind+t,n,!1,3);const a=s.getUVs();a&&this.geometry.setVerticesData(f.o.UVKind+"_"+t,a,!1,2)}}else{let e=0;for(;this.geometry.isVerticesDataPresent(f.o.PositionKind+e);)this.geometry.removeVerticesData(f.o.PositionKind+e),this.geometry.isVerticesDataPresent(f.o.NormalKind+e)&&this.geometry.removeVerticesData(f.o.NormalKind+e),this.geometry.isVerticesDataPresent(f.o.TangentKind+e)&&this.geometry.removeVerticesData(f.o.TangentKind+e),this.geometry.isVerticesDataPresent(f.o.UVKind+e)&&this.geometry.removeVerticesData(f.o.UVKind+"_"+e),e++}}static Parse(e,t,s){let i;if(i=e.type&&"LinesMesh"===e.type?V._LinesMeshParser(e,t):e.type&&"GroundMesh"===e.type?V._GroundMeshParser(e,t):e.type&&"GoldbergMesh"===e.type?V._GoldbergMeshParser(e,t):new V(e.name,t),i.id=e.id,i._waitingParsedUniqueId=e.uniqueId,a.$&&a.$.AddTagsTo(i,e.tags),i.position=c.P.FromArray(e.position),void 0!==e.metadata&&(i.metadata=e.metadata),e.rotationQuaternion?i.rotationQuaternion=c._f.FromArray(e.rotationQuaternion):e.rotation&&(i.rotation=c.P.FromArray(e.rotation)),i.scaling=c.P.FromArray(e.scaling),e.localMatrix?i.setPreTransformMatrix(c.y3.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(c.y3.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i.isVisible=e.isVisible,i.infiniteDistance=e.infiniteDistance,i.showBoundingBox=e.showBoundingBox,i.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(i.applyFog=e.applyFog),void 0!==e.pickable&&(i.isPickable=e.pickable),void 0!==e.alphaIndex&&(i.alphaIndex=e.alphaIndex),i.receiveShadows=e.receiveShadows,void 0!==e.billboardMode&&(i.billboardMode=e.billboardMode),void 0!==e.visibility&&(i.visibility=e.visibility),i.checkCollisions=e.checkCollisions,i.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(i.isBlocker=e.isBlocker),i._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(i._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(i._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.actions&&(i._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(i.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(i.overlayColor=d.Wo.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(i.renderOverlay=e.renderOverlay),i.isUnIndexed=!!e.isUnIndexed,i.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(i.delayLoadState=4,i.delayLoadingFile=s+e.delayLoadingFile,i.buildBoundingInfo(c.P.FromArray(e.boundingBoxMinimum),c.P.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(i._binaryInfo=e._binaryInfo),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(f.o.UVKind),e.hasUVs2&&i._delayInfo.push(f.o.UV2Kind),e.hasUVs3&&i._delayInfo.push(f.o.UV3Kind),e.hasUVs4&&i._delayInfo.push(f.o.UV4Kind),e.hasUVs5&&i._delayInfo.push(f.o.UV5Kind),e.hasUVs6&&i._delayInfo.push(f.o.UV6Kind),e.hasColors&&i._delayInfo.push(f.o.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(f.o.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(f.o.MatricesWeightsKind),i._delayLoadingFunction=b._ImportGeometry,g.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):b._ImportGeometry(e,i),e.materialUniqueId?i._waitingMaterialId=e.materialUniqueId:e.materialId&&(i._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(i.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),void 0!==e.skeletonId&&null!==e.skeletonId&&(i.skeleton=t.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(i.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(let t=0;t<e.animations.length;t++){const s=e.animations[t],r=(0,v.q)("BABYLON.Animation");r&&i.animations.push(r.Parse(s))}u.N.ParseAnimationRanges(i,e,t)}if(e.autoAnimate&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?i.layerMask=Math.abs(parseInt(e.layerMask)):i.layerMask=268435455,e.physicsImpostor&&V._PhysicsImpostorParser(t,i,e),e.lodMeshIds&&(i._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(let s=0;s<e.instances.length;s++){const r=e.instances[s],n=i.createInstance(r.name);if(r.id&&(n.id=r.id),a.$&&(r.tags?a.$.AddTagsTo(n,r.tags):a.$.AddTagsTo(n,e.tags)),n.position=c.P.FromArray(r.position),void 0!==r.metadata&&(n.metadata=r.metadata),void 0!==r.parentId&&(n._waitingParentId=r.parentId),void 0!==r.parentInstanceIndex&&(n._waitingParentInstanceIndex=r.parentInstanceIndex),void 0!==r.isEnabled&&null!==r.isEnabled&&n.setEnabled(r.isEnabled),void 0!==r.isVisible&&null!==r.isVisible&&(n.isVisible=r.isVisible),void 0!==r.isPickable&&null!==r.isPickable&&(n.isPickable=r.isPickable),r.rotationQuaternion?n.rotationQuaternion=c._f.FromArray(r.rotationQuaternion):r.rotation&&(n.rotation=c.P.FromArray(r.rotation)),n.scaling=c.P.FromArray(r.scaling),null!=r.checkCollisions&&null!=r.checkCollisions&&(n.checkCollisions=r.checkCollisions),null!=r.pickable&&null!=r.pickable&&(n.isPickable=r.pickable),null!=r.showBoundingBox&&null!=r.showBoundingBox&&(n.showBoundingBox=r.showBoundingBox),null!=r.showSubMeshesBoundingBox&&null!=r.showSubMeshesBoundingBox&&(n.showSubMeshesBoundingBox=r.showSubMeshesBoundingBox),null!=r.alphaIndex&&null!=r.showSubMeshesBoundingBox&&(n.alphaIndex=r.alphaIndex),r.physicsImpostor&&V._PhysicsImpostorParser(t,n,r),void 0!==r.actions&&(n._waitingData.actions=r.actions),r.animations){for(let e=0;e<r.animations.length;e++){const t=r.animations[e],s=(0,v.q)("BABYLON.Animation");s&&n.animations.push(s.Parse(t))}u.N.ParseAnimationRanges(n,r,t),r.autoAnimate&&t.beginAnimation(n,r.autoAnimateFrom,r.autoAnimateTo,r.autoAnimateLoop,r.autoAnimateSpeed||1)}}if(e.thinInstances){const t=e.thinInstances;if(i.thinInstanceEnablePicking=!!t.enablePicking,t.matrixData?(i.thinInstanceSetBuffer("matrix",new Float32Array(t.matrixData),16,!1),i._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,i._thinInstanceDataStorage.instancesCount=t.instancesCount):i._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,e.thinInstances.userThinInstance){const t=e.thinInstances.userThinInstance;for(const e in t.data)i.thinInstanceSetBuffer(e,new Float32Array(t.data[e]),t.strides[e],!1),i._userThinInstanceBuffersStorage.sizes[e]=t.sizes[e]}}return i}setPositionsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourcePositions){const t=this.getVerticesData(f.o.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(f.o.PositionKind)||this.setVerticesData(f.o.PositionKind,t,!0)}return e._sourcePositions}setNormalsForCPUSkinning(){const e=this._internalMeshDataInfo;if(!e._sourceNormals){const t=this.getVerticesData(f.o.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(f.o.NormalKind)||this.setVerticesData(f.o.NormalKind,t,!0)}return e._sourceNormals}applySkeleton(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(f.o.PositionKind))return this;if(!this.isVerticesDataPresent(f.o.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(f.o.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(f.o.NormalKind),s=this._internalMeshDataInfo;if(!s._sourcePositions){const e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}t&&!s._sourceNormals&&this.setNormalsForCPUSkinning();let i=this.getVerticesData(f.o.PositionKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));let r=this.getVerticesData(f.o.NormalKind);if(t){if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r))}const n=this.getVerticesData(f.o.MatricesIndicesKind),a=this.getVerticesData(f.o.MatricesWeightsKind);if(!a||!n)return this;const o=this.numBoneInfluencers>4,h=o?this.getVerticesData(f.o.MatricesIndicesExtraKind):null,l=o?this.getVerticesData(f.o.MatricesWeightsExtraKind):null,d=e.getTransformMatrices(this),u=c.P.Zero(),_=new c.y3,p=new c.y3;let g,m=0;for(let e=0;e<i.length;e+=3,m+=4){let f;for(g=0;g<4;g++)f=a[m+g],f>0&&(c.y3.FromFloat32ArrayToRefScaled(d,Math.floor(16*n[m+g]),f,p),_.addToSelf(p));if(o)for(g=0;g<4;g++)f=l[m+g],f>0&&(c.y3.FromFloat32ArrayToRefScaled(d,Math.floor(16*h[m+g]),f,p),_.addToSelf(p));c.P.TransformCoordinatesFromFloatsToRef(s._sourcePositions[e],s._sourcePositions[e+1],s._sourcePositions[e+2],_,u),u.toArray(i,e),t&&(c.P.TransformNormalFromFloatsToRef(s._sourceNormals[e],s._sourceNormals[e+1],s._sourceNormals[e+2],_,u),u.toArray(r,e)),_.reset()}return this.updateVerticesData(f.o.PositionKind,i),t&&this.updateVerticesData(f.o.NormalKind,r),this}static MinMax(e){let t=null,s=null;return e.forEach((function(e){const i=e.getBoundingInfo().boundingBox;t&&s?(t.minimizeInPlace(i.minimumWorld),s.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,s=i.maximumWorld)})),t&&s?{min:t,max:s}:{min:c.P.Zero(),max:c.P.Zero()}}static Center(e){const t=e instanceof Array?V.MinMax(e):e;return c.P.Center(t.min,t.max)}static MergeMeshes(e,t=!0,s,i,r,n){return(0,o.s3)(V._MergeMeshesCoroutine(e,t,s,i,r,n,!1))}static MergeMeshesAsync(e,t=!0,s,i,r,n){return(0,o.sM)(V._MergeMeshesCoroutine(e,t,s,i,r,n,!0),(0,o.KO)())}static*_MergeMeshesCoroutine(e,t=!0,s,i,r,n,a){if(0===(e=e.filter(Boolean)).length)return null;let o;if(!s){let t=0;for(o=0;o<e.length;o++)if(t+=e[o].getTotalVertices(),t>=65536)return P.Y.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}n&&(r=!1);const h=new Array,l=new Array,c=new Array,d=e[0].overrideMaterialSideOrientation;for(o=0;o<e.length;o++){const t=e[o];if(t.isAnInstance)return P.Y.Warn("Cannot merge instance meshes."),null;if(d!==t.overrideMaterialSideOrientation)return P.Y.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),null;if(r&&c.push(t.getTotalIndices()),n)if(t.material){const e=t.material;if(e instanceof D){for(let t=0;t<e.subMaterials.length;t++)h.indexOf(e.subMaterials[t])<0&&h.push(e.subMaterials[t]);for(let s=0;s<t.subMeshes.length;s++)l.push(h.indexOf(e.subMaterials[t.subMeshes[s].materialIndex])),c.push(t.subMeshes[s].indexCount)}else{h.indexOf(e)<0&&h.push(e);for(let s=0;s<t.subMeshes.length;s++)l.push(h.indexOf(e)),c.push(t.subMeshes[s].indexCount)}}else for(let e=0;e<t.subMeshes.length;e++)l.push(0),c.push(t.subMeshes[e].indexCount)}const u=e[0],f=e=>{const t=e.computeWorldMatrix(!0);return[_.x.ExtractFromMesh(e,!1,!1),t]},[g,m]=f(u);a&&(yield);const x=new Array(e.length-1);for(let t=1;t<e.length;t++)x[t-1]=f(e[t]),a&&(yield);const M=g._mergeCoroutine(m,x,s,a,!t);let y=M.next();for(;!y.done;)a&&(yield),y=M.next();const b=y.value;i||(i=new V(u.name+"_merged",u.getScene()));const A=b._applyToCoroutine(i,void 0,a);let I=A.next();for(;!I.done;)a&&(yield),I=A.next();if(i.checkCollisions=u.checkCollisions,i.overrideMaterialSideOrientation=u.overrideMaterialSideOrientation,t)for(o=0;o<e.length;o++)e[o].dispose();if(r||n){i.releaseSubMeshes(),o=0;let e=0;for(;o<c.length;)p.P.CreateFromIndices(0,e,c[o],i,void 0,!1),e+=c[o],o++;for(const e of i.subMeshes)e.refreshBoundingInfo();i.computeWorldMatrix(!0)}if(n){const e=new D(u.name+"_merged",u.getScene());e.subMaterials=h;for(let e=0;e<i.subMeshes.length;e++)i.subMeshes[e].materialIndex=l[e];i.material=e}else i.material=u.material;return i}addInstance(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)}removeInstance(e){const t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const e=this.instances[this.instances.length-1];this.instances[t]=e,e._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this.overrideMaterialSideOrientation===I.F.CounterClockWiseSideOrientation}}V.FRONTSIDE=_.x.FRONTSIDE,V.BACKSIDE=_.x.BACKSIDE,V.DOUBLESIDE=_.x.DOUBLESIDE,V.DEFAULTSIDE=_.x.DEFAULTSIDE,V.NO_CAP=0,V.CAP_START=1,V.CAP_END=2,V.CAP_ALL=3,V.NO_FLIP=0,V.FLIP_TILE=1,V.ROTATE_TILE=2,V.FLIP_ROW=3,V.ROTATE_ROW=4,V.FLIP_N_ROTATE_TILE=5,V.FLIP_N_ROTATE_ROW=6,V.CENTER=0,V.LEFT=1,V.RIGHT=2,V.TOP=3,V.BOTTOM=4,V.INSTANCEDMESH_SORT_TRANSPARENT=!1,V._GroundMeshParser=(e,t)=>{throw(0,T.S)("GroundMesh")},V._GoldbergMeshParser=(e,t)=>{throw(0,T.S)("GoldbergMesh")},V._LinesMeshParser=(e,t)=>{throw(0,T.S)("LinesMesh")},(0,v.H)("BABYLON.Mesh",V),V.prototype.setMaterialByID=function(e){return this.setMaterialById(e)},V.CreateDisc=V.CreateDisc||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateBox=V.CreateBox||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateSphere=V.CreateSphere||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateCylinder=V.CreateCylinder||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateTorusKnot=V.CreateTorusKnot||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateTorus=V.CreateTorus||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreatePlane=V.CreatePlane||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateGround=V.CreateGround||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateTiledGround=V.CreateTiledGround||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateGroundFromHeightMap=V.CreateGroundFromHeightMap||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateTube=V.CreateTube||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreatePolyhedron=V.CreatePolyhedron||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateIcoSphere=V.CreateIcoSphere||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateDecal=V.CreateDecal||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.CreateCapsule=V.CreateCapsule||(()=>{throw new Error("Import MeshBuilder to populate this function")}),V.ExtendToGoldberg=V.ExtendToGoldberg||(()=>{throw new Error("Import MeshBuilder to populate this function")})},2341:(e,t,s)=>{s.d(t,{x:()=>u});var i=s(1069),r=s(5412),n=s(2186),a=s(9069),o=s(2922),h=s(658),l=s(8137),c=s(140),d=s(9714);class u{constructor(){this._applyTo=(0,c.vp)(this._applyToCoroutine.bind(this))}set(e,t){switch(e.length||h.Y.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case n.o.PositionKind:this.positions=e;break;case n.o.NormalKind:this.normals=e;break;case n.o.TangentKind:this.tangents=e;break;case n.o.UVKind:this.uvs=e;break;case n.o.UV2Kind:this.uvs2=e;break;case n.o.UV3Kind:this.uvs3=e;break;case n.o.UV4Kind:this.uvs4=e;break;case n.o.UV5Kind:this.uvs5=e;break;case n.o.UV6Kind:this.uvs6=e;break;case n.o.ColorKind:this.colors=e;break;case n.o.MatricesIndicesKind:this.matricesIndices=e;break;case n.o.MatricesWeightsKind:this.matricesWeights=e;break;case n.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case n.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}}applyToMesh(e,t){return this._applyTo(e,t,!1),this}applyToGeometry(e,t){return this._applyTo(e,t,!1),this}updateMesh(e){return this._update(e),this}updateGeometry(e){return this._update(e),this}*_applyToCoroutine(e,t=!1,s){return this.positions&&(e.setVerticesData(n.o.PositionKind,this.positions,t),s&&(yield)),this.normals&&(e.setVerticesData(n.o.NormalKind,this.normals,t),s&&(yield)),this.tangents&&(e.setVerticesData(n.o.TangentKind,this.tangents,t),s&&(yield)),this.uvs&&(e.setVerticesData(n.o.UVKind,this.uvs,t),s&&(yield)),this.uvs2&&(e.setVerticesData(n.o.UV2Kind,this.uvs2,t),s&&(yield)),this.uvs3&&(e.setVerticesData(n.o.UV3Kind,this.uvs3,t),s&&(yield)),this.uvs4&&(e.setVerticesData(n.o.UV4Kind,this.uvs4,t),s&&(yield)),this.uvs5&&(e.setVerticesData(n.o.UV5Kind,this.uvs5,t),s&&(yield)),this.uvs6&&(e.setVerticesData(n.o.UV6Kind,this.uvs6,t),s&&(yield)),this.colors&&(e.setVerticesData(n.o.ColorKind,this.colors,t),s&&(yield)),this.matricesIndices&&(e.setVerticesData(n.o.MatricesIndicesKind,this.matricesIndices,t),s&&(yield)),this.matricesWeights&&(e.setVerticesData(n.o.MatricesWeightsKind,this.matricesWeights,t),s&&(yield)),this.matricesIndicesExtra&&(e.setVerticesData(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),s&&(yield)),this.matricesWeightsExtra&&(e.setVerticesData(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),s&&(yield)),this.indices?(e.setIndices(this.indices,null,t),s&&(yield)):e.setIndices([],null),this}_update(e,t,s){return this.positions&&e.updateVerticesData(n.o.PositionKind,this.positions,t,s),this.normals&&e.updateVerticesData(n.o.NormalKind,this.normals,t,s),this.tangents&&e.updateVerticesData(n.o.TangentKind,this.tangents,t,s),this.uvs&&e.updateVerticesData(n.o.UVKind,this.uvs,t,s),this.uvs2&&e.updateVerticesData(n.o.UV2Kind,this.uvs2,t,s),this.uvs3&&e.updateVerticesData(n.o.UV3Kind,this.uvs3,t,s),this.uvs4&&e.updateVerticesData(n.o.UV4Kind,this.uvs4,t,s),this.uvs5&&e.updateVerticesData(n.o.UV5Kind,this.uvs5,t,s),this.uvs6&&e.updateVerticesData(n.o.UV6Kind,this.uvs6,t,s),this.colors&&e.updateVerticesData(n.o.ColorKind,this.colors,t,s),this.matricesIndices&&e.updateVerticesData(n.o.MatricesIndicesKind,this.matricesIndices,t,s),this.matricesWeights&&e.updateVerticesData(n.o.MatricesWeightsKind,this.matricesWeights,t,s),this.matricesIndicesExtra&&e.updateVerticesData(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,s),this.matricesWeightsExtra&&e.updateVerticesData(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,s),this.indices&&e.setIndices(this.indices,null),this}static _TransformVector3Coordinates(e,t,s=0,i=e.length){const n=r.jp.Vector3[0],a=r.jp.Vector3[1];for(let o=s;o<s+i;o+=3)r.P.FromArrayToRef(e,o,n),r.P.TransformCoordinatesToRef(n,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}static _TransformVector3Normals(e,t,s=0,i=e.length){const n=r.jp.Vector3[0],a=r.jp.Vector3[1];for(let o=s;o<s+i;o+=3)r.P.FromArrayToRef(e,o,n),r.P.TransformNormalToRef(n,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z}static _TransformVector4Normals(e,t,s=0,i=e.length){const n=r.jp.Vector4[0],a=r.jp.Vector4[1];for(let o=s;o<s+i;o+=4)r.Lt.FromArrayToRef(e,o,n),r.Lt.TransformNormalToRef(n,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z,e[o+3]=a.w}static _FlipFaces(e,t=0,s=e.length){for(let i=t;i<t+s;i+=3){const t=e[i+1];e[i+1]=e[i+2],e[i+2]=t}}transform(e){const t=e.determinant()<0;return this.positions&&u._TransformVector3Coordinates(this.positions,e),this.normals&&u._TransformVector3Normals(this.normals,e),this.tangents&&u._TransformVector4Normals(this.tangents,e),t&&this.indices&&u._FlipFaces(this.indices),this}merge(e,t=!1,s=!1){const i=Array.isArray(e)?e.map((e=>[e,void 0])):[[e,void 0]];return(0,c.s3)(this._mergeCoroutine(void 0,i,t,!1,s))}*_mergeCoroutine(e,t,s=!1,i,r){var a,o,h,l;this._validate();const c=t.map((e=>e[0]));for(const e of c)if(e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");const d=c.reduce(((e,t)=>{var s,i;return e+(null!==(i=null===(s=t.indices)||void 0===s?void 0:s.length)&&void 0!==i?i:0)}),null!==(o=null===(a=this.indices)||void 0===a?void 0:a.length)&&void 0!==o?o:0);let f=r||c.some((e=>e.indices===this.indices))?null===(h=this.indices)||void 0===h?void 0:h.slice():this.indices;if(d>0){let r=null!==(l=null==f?void 0:f.length)&&void 0!==l?l:0;if(f||(f=new Array(d)),f.length!==d){if(Array.isArray(f))f.length=d;else{const e=s||f instanceof Uint32Array?new Uint32Array(d):new Uint16Array(d);e.set(f),f=e}e&&e.determinant()<0&&u._FlipFaces(f,0,r)}let n=this.positions?this.positions.length/3:0;for(const[e,s]of t)if(e.indices){for(let t=0;t<e.indices.length;t++)f[r+t]=e.indices[t]+n;s&&s.determinant()<0&&u._FlipFaces(f,r,e.indices.length),n+=e.positions.length/3,r+=e.indices.length,i&&(yield)}}return this.indices=f,this.positions=u._MergeElement(n.o.PositionKind,this.positions,e,t.map((e=>[e[0].positions,e[1]]))),i&&(yield),this.normals=u._MergeElement(n.o.NormalKind,this.normals,e,t.map((e=>[e[0].normals,e[1]]))),i&&(yield),this.tangents=u._MergeElement(n.o.TangentKind,this.tangents,e,t.map((e=>[e[0].tangents,e[1]]))),i&&(yield),this.uvs=u._MergeElement(n.o.UVKind,this.uvs,e,t.map((e=>[e[0].uvs,e[1]]))),i&&(yield),this.uvs2=u._MergeElement(n.o.UV2Kind,this.uvs2,e,t.map((e=>[e[0].uvs2,e[1]]))),i&&(yield),this.uvs3=u._MergeElement(n.o.UV3Kind,this.uvs3,e,t.map((e=>[e[0].uvs3,e[1]]))),i&&(yield),this.uvs4=u._MergeElement(n.o.UV4Kind,this.uvs4,e,t.map((e=>[e[0].uvs4,e[1]]))),i&&(yield),this.uvs5=u._MergeElement(n.o.UV5Kind,this.uvs5,e,t.map((e=>[e[0].uvs5,e[1]]))),i&&(yield),this.uvs6=u._MergeElement(n.o.UV6Kind,this.uvs6,e,t.map((e=>[e[0].uvs6,e[1]]))),i&&(yield),this.colors=u._MergeElement(n.o.ColorKind,this.colors,e,t.map((e=>[e[0].colors,e[1]]))),i&&(yield),this.matricesIndices=u._MergeElement(n.o.MatricesIndicesKind,this.matricesIndices,e,t.map((e=>[e[0].matricesIndices,e[1]]))),i&&(yield),this.matricesWeights=u._MergeElement(n.o.MatricesWeightsKind,this.matricesWeights,e,t.map((e=>[e[0].matricesWeights,e[1]]))),i&&(yield),this.matricesIndicesExtra=u._MergeElement(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,t.map((e=>[e[0].matricesIndicesExtra,e[1]]))),i&&(yield),this.matricesWeightsExtra=u._MergeElement(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,t.map((e=>[e[0].matricesWeightsExtra,e[1]]))),this}static _MergeElement(e,t,s,i){const r=i.filter((e=>null!==e[0]&&void 0!==e[0]));if(!t&&0==r.length)return t;if(!t)return this._MergeElement(e,r[0][0],r[0][1],r.slice(1));const a=r.reduce(((e,t)=>e+t[0].length),t.length),o=e===n.o.PositionKind?u._TransformVector3Coordinates:e===n.o.NormalKind?u._TransformVector3Normals:e===n.o.TangentKind?u._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const e=new Float32Array(a);e.set(t),s&&o(e,s,0,t.length);let i=t.length;for(const[t,s]of r)e.set(t,i),s&&o(e,s,i,t.length),i+=t.length;return e}{const e=new Array(a);for(let s=0;s<t.length;s++)e[s]=t[s];s&&o(e,s,0,t.length);let i=t.length;for(const[t,s]of r){for(let s=0;s<t.length;s++)e[i+s]=t[s];s&&o(e,s,i,t.length),i+=t.length}return e}}_validate(){if(!this.positions)throw new d.LH("Positions are required",d.SM.MeshInvalidPositionsError);const e=(e,t)=>{const s=n.o.DeduceStride(e);if(t.length%s!=0)throw new Error("The "+e+"s array count must be a multiple of "+s);return t.length/s},t=e(n.o.PositionKind,this.positions),s=(s,i)=>{const r=e(s,i);if(r!==t)throw new Error("The "+s+"s element count ("+r+") does not match the positions count ("+t+")")};this.normals&&s(n.o.NormalKind,this.normals),this.tangents&&s(n.o.TangentKind,this.tangents),this.uvs&&s(n.o.UVKind,this.uvs),this.uvs2&&s(n.o.UV2Kind,this.uvs2),this.uvs3&&s(n.o.UV3Kind,this.uvs3),this.uvs4&&s(n.o.UV4Kind,this.uvs4),this.uvs5&&s(n.o.UV5Kind,this.uvs5),this.uvs6&&s(n.o.UV6Kind,this.uvs6),this.colors&&s(n.o.ColorKind,this.colors),this.matricesIndices&&s(n.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&s(n.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&s(n.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&s(n.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}serialize(){const e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e}static ExtractFromMesh(e,t,s){return u._ExtractFrom(e,t,s)}static ExtractFromGeometry(e,t,s){return u._ExtractFrom(e,t,s)}static _ExtractFrom(e,t,s){const i=new u;return e.isVerticesDataPresent(n.o.PositionKind)&&(i.positions=e.getVerticesData(n.o.PositionKind,t,s)),e.isVerticesDataPresent(n.o.NormalKind)&&(i.normals=e.getVerticesData(n.o.NormalKind,t,s)),e.isVerticesDataPresent(n.o.TangentKind)&&(i.tangents=e.getVerticesData(n.o.TangentKind,t,s)),e.isVerticesDataPresent(n.o.UVKind)&&(i.uvs=e.getVerticesData(n.o.UVKind,t,s)),e.isVerticesDataPresent(n.o.UV2Kind)&&(i.uvs2=e.getVerticesData(n.o.UV2Kind,t,s)),e.isVerticesDataPresent(n.o.UV3Kind)&&(i.uvs3=e.getVerticesData(n.o.UV3Kind,t,s)),e.isVerticesDataPresent(n.o.UV4Kind)&&(i.uvs4=e.getVerticesData(n.o.UV4Kind,t,s)),e.isVerticesDataPresent(n.o.UV5Kind)&&(i.uvs5=e.getVerticesData(n.o.UV5Kind,t,s)),e.isVerticesDataPresent(n.o.UV6Kind)&&(i.uvs6=e.getVerticesData(n.o.UV6Kind,t,s)),e.isVerticesDataPresent(n.o.ColorKind)&&(i.colors=e.getVerticesData(n.o.ColorKind,t,s)),e.isVerticesDataPresent(n.o.MatricesIndicesKind)&&(i.matricesIndices=e.getVerticesData(n.o.MatricesIndicesKind,t,s)),e.isVerticesDataPresent(n.o.MatricesWeightsKind)&&(i.matricesWeights=e.getVerticesData(n.o.MatricesWeightsKind,t,s)),e.isVerticesDataPresent(n.o.MatricesIndicesExtraKind)&&(i.matricesIndicesExtra=e.getVerticesData(n.o.MatricesIndicesExtraKind,t,s)),e.isVerticesDataPresent(n.o.MatricesWeightsExtraKind)&&(i.matricesWeightsExtra=e.getVerticesData(n.o.MatricesWeightsExtraKind,t,s)),i.indices=e.getIndices(t,s),i}static CreateRibbon(e){throw(0,a.S)("ribbonBuilder")}static CreateBox(e){throw(0,a.S)("boxBuilder")}static CreateTiledBox(e){throw(0,a.S)("tiledBoxBuilder")}static CreateTiledPlane(e){throw(0,a.S)("tiledPlaneBuilder")}static CreateSphere(e){throw(0,a.S)("sphereBuilder")}static CreateCylinder(e){throw(0,a.S)("cylinderBuilder")}static CreateTorus(e){throw(0,a.S)("torusBuilder")}static CreateLineSystem(e){throw(0,a.S)("linesBuilder")}static CreateDashedLines(e){throw(0,a.S)("linesBuilder")}static CreateGround(e){throw(0,a.S)("groundBuilder")}static CreateTiledGround(e){throw(0,a.S)("groundBuilder")}static CreateGroundFromHeightMap(e){throw(0,a.S)("groundBuilder")}static CreatePlane(e){throw(0,a.S)("planeBuilder")}static CreateDisc(e){throw(0,a.S)("discBuilder")}static CreatePolygon(e,t,s,i,r,n,o){throw(0,a.S)("polygonBuilder")}static CreateIcoSphere(e){throw(0,a.S)("icoSphereBuilder")}static CreatePolyhedron(e){throw(0,a.S)("polyhedronBuilder")}static CreateCapsule(e={orientation:r.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw(0,a.S)("capsuleBuilder")}static CreateTorusKnot(e){throw(0,a.S)("torusKnotBuilder")}static ComputeNormals(e,t,s,i){let n=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,_=0,p=0,g=0,m=0,x=0,M=0,y=0,b=0,A=0,I=0,v=0,D=!1,S=!1,P=!1,T=!1,O=1,C=0,E=null;i&&(D=!!i.facetNormals,S=!!i.facetPositions,P=!!i.facetPartitioning,O=!0===i.useRightHandedSystem?-1:1,C=i.ratio||0,T=!!i.depthSort,E=i.distanceTo,T&&void 0===E&&(E=r.P.Zero()));let R=0,B=0,F=0,w=0;for(P&&i&&i.bbSize&&(R=i.subDiv.X*C/i.bbSize.x,B=i.subDiv.Y*C/i.bbSize.y,F=i.subDiv.Z*C/i.bbSize.z,w=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0),n=0;n<e.length;n++)s[n]=0;const V=t.length/3|0;for(n=0;n<V;n++){if(g=3*t[3*n],m=g+1,x=g+2,M=3*t[3*n+1],y=M+1,b=M+2,A=3*t[3*n+2],I=A+1,v=A+2,a=e[g]-e[M],o=e[m]-e[y],h=e[x]-e[b],l=e[A]-e[M],c=e[I]-e[y],d=e[v]-e[b],u=O*(o*d-h*c),f=O*(h*l-a*d),_=O*(a*c-o*l),p=Math.sqrt(u*u+f*f+_*_),p=0===p?1:p,u/=p,f/=p,_/=p,D&&i&&(i.facetNormals[n].x=u,i.facetNormals[n].y=f,i.facetNormals[n].z=_),S&&i&&(i.facetPositions[n].x=(e[g]+e[M]+e[A])/3,i.facetPositions[n].y=(e[m]+e[y]+e[I])/3,i.facetPositions[n].z=(e[x]+e[b]+e[v])/3),P&&i){const t=Math.floor((i.facetPositions[n].x-i.bInfo.minimum.x*C)*R),s=Math.floor((i.facetPositions[n].y-i.bInfo.minimum.y*C)*B),r=Math.floor((i.facetPositions[n].z-i.bInfo.minimum.z*C)*F),a=Math.floor((e[g]-i.bInfo.minimum.x*C)*R),o=Math.floor((e[m]-i.bInfo.minimum.y*C)*B),h=Math.floor((e[x]-i.bInfo.minimum.z*C)*F),l=Math.floor((e[M]-i.bInfo.minimum.x*C)*R),c=Math.floor((e[y]-i.bInfo.minimum.y*C)*B),d=Math.floor((e[b]-i.bInfo.minimum.z*C)*F),u=Math.floor((e[A]-i.bInfo.minimum.x*C)*R),f=Math.floor((e[I]-i.bInfo.minimum.y*C)*B),_=Math.floor((e[v]-i.bInfo.minimum.z*C)*F),p=a+i.subDiv.max*o+w*h,D=l+i.subDiv.max*c+w*d,S=u+i.subDiv.max*f+w*_,P=t+i.subDiv.max*s+w*r;i.facetPartitioning[P]=i.facetPartitioning[P]?i.facetPartitioning[P]:new Array,i.facetPartitioning[p]=i.facetPartitioning[p]?i.facetPartitioning[p]:new Array,i.facetPartitioning[D]=i.facetPartitioning[D]?i.facetPartitioning[D]:new Array,i.facetPartitioning[S]=i.facetPartitioning[S]?i.facetPartitioning[S]:new Array,i.facetPartitioning[p].push(n),D!=p&&i.facetPartitioning[D].push(n),S!=D&&S!=p&&i.facetPartitioning[S].push(n),P!=p&&P!=D&&P!=S&&i.facetPartitioning[P].push(n)}if(T&&i&&i.facetPositions){const e=i.depthSortedFacets[n];e.ind=3*n,e.sqDistance=r.P.DistanceSquared(i.facetPositions[n],E)}s[g]+=u,s[m]+=f,s[x]+=_,s[M]+=u,s[y]+=f,s[b]+=_,s[A]+=u,s[I]+=f,s[v]+=_}for(n=0;n<s.length/3;n++)u=s[3*n],f=s[3*n+1],_=s[3*n+2],p=Math.sqrt(u*u+f*f+_*_),p=0===p?1:p,u/=p,f/=p,_/=p,s[3*n]=u,s[3*n+1]=f,s[3*n+2]=_}static _ComputeSides(e,t,s,i,n,a,o){const h=s.length,l=i.length;let c,d;switch(e=e||u.DEFAULTSIDE){case u.FRONTSIDE:break;case u.BACKSIDE:for(c=0;c<h;c+=3){const e=s[c];s[c]=s[c+2],s[c+2]=e}for(d=0;d<l;d++)i[d]=-i[d];break;case u.DOUBLESIDE:{const e=t.length,u=e/3;for(let s=0;s<e;s++)t[e+s]=t[s];for(c=0;c<h;c+=3)s[c+h]=s[c+2]+u,s[c+1+h]=s[c+1]+u,s[c+2+h]=s[c]+u;for(d=0;d<l;d++)i[l+d]=-i[d];const f=n.length;let _=0;for(_=0;_<f;_++)n[_+f]=n[_];for(a=a||new r.Lt(0,0,1,1),o=o||new r.Lt(0,0,1,1),_=0,c=0;c<f/2;c++)n[_]=a.x+(a.z-a.x)*n[_],n[_+1]=a.y+(a.w-a.y)*n[_+1],n[_+f]=o.x+(o.z-o.x)*n[_+f],n[_+f+1]=o.y+(o.w-o.y)*n[_+f+1],_+=2;break}}}static ImportVertexData(e,t){const s=new u,i=e.positions;i&&s.set(i,n.o.PositionKind);const r=e.normals;r&&s.set(r,n.o.NormalKind);const a=e.tangents;a&&s.set(a,n.o.TangentKind);const h=e.uvs;h&&s.set(h,n.o.UVKind);const l=e.uv2s;l&&s.set(l,n.o.UV2Kind);const c=e.uv3s;c&&s.set(c,n.o.UV3Kind);const d=e.uv4s;d&&s.set(d,n.o.UV4Kind);const f=e.uv5s;f&&s.set(f,n.o.UV5Kind);const _=e.uv6s;_&&s.set(_,n.o.UV6Kind);const p=e.colors;p&&s.set(o.HE.CheckColors4(p,i.length/3),n.o.ColorKind);const g=e.matricesIndices;g&&s.set(g,n.o.MatricesIndicesKind);const m=e.matricesWeights;m&&s.set(m,n.o.MatricesWeightsKind);const x=e.indices;x&&(s.indices=x),t.setAllVerticesData(s,e.updatable)}}u.FRONTSIDE=0,u.BACKSIDE=1,u.DOUBLESIDE=2,u.DEFAULTSIDE=0,(0,i.gn)([l.G6.filter(((...[e])=>!Array.isArray(e)))],u,"_TransformVector3Coordinates",null),(0,i.gn)([l.G6.filter(((...[e])=>!Array.isArray(e)))],u,"_TransformVector3Normals",null),(0,i.gn)([l.G6.filter(((...[e])=>!Array.isArray(e)))],u,"_TransformVector4Normals",null),(0,i.gn)([l.G6.filter(((...[e])=>!Array.isArray(e)))],u,"_FlipFaces",null)},779:(e,t,s)=>{s.d(t,{V:()=>ze});var i=s(5412),r=s(6791),n=s(2186),a=s(2341),o=s(6629);function h(e){let t=e.pathArray;const s=e.closeArray||!1,i=e.closePath||!1,r=e.invertUV||!1,h=Math.floor(t[0].length/2);let l=e.offset||h;l=l>h?h:Math.floor(l);const c=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,d=e.uvs,u=e.colors,f=[],_=[],p=[],g=[],m=[],x=[],M=[],y=[];let b;const A=[],I=[];let v,D,S;if(t.length<2){const e=[],s=[];for(D=0;D<t[0].length-l;D++)e.push(t[0][D]),s.push(t[0][D+l]);t=[e,s]}let P=0;const T=i?1:0;let O,C,E,R,B,F;for(b=t[0].length,v=0;v<t.length;v++){for(M[v]=0,m[v]=[0],O=t[v],C=O.length,b=b<C?b:C,S=0;S<C;)f.push(O[S].x,O[S].y,O[S].z),S>0&&(E=O[S].subtract(O[S-1]).length(),R=E+M[v],m[v].push(R),M[v]=R),S++;i&&(S--,f.push(O[0].x,O[0].y,O[0].z),E=O[S].subtract(O[0]).length(),R=E+M[v],m[v].push(R),M[v]=R),A[v]=C+T,I[v]=P,P+=C+T}let w,V,L=null,N=null;for(D=0;D<b+T;D++){for(y[D]=0,x[D]=[0],v=0;v<t.length-1;v++)B=t[v],F=t[v+1],D===b?(L=B[0],N=F[0]):(L=B[D],N=F[D]),E=N.subtract(L).length(),R=E+y[D],x[D].push(R),y[D]=R;s&&N&&L&&(B=t[v],F=t[0],D===b&&(N=F[0]),E=N.subtract(L).length(),R=E+y[D],y[D]=R)}if(d)for(v=0;v<d.length;v++)g.push(d[v].x,o.e.UseOpenGLOrientationForUV?1-d[v].y:d[v].y);else for(v=0;v<t.length;v++)for(D=0;D<b+T;D++)w=0!=M[v]?m[v][D]/M[v]:0,V=0!=y[D]?x[D][v]/y[D]:0,r?g.push(V,w):g.push(w,o.e.UseOpenGLOrientationForUV?1-V:V);v=0;let U=0,W=A[v]-1,k=A[v+1]-1,z=W<k?W:k,K=I[1]-I[0];const j=s?A.length:A.length-1;for(;U<=z&&v<j;)_.push(U,U+K,U+1),_.push(U+K+1,U+1,U+K),U+=1,U===z&&(v++,v===A.length-1?(K=I[0]-I[v],W=A[v]-1,k=A[0]-1):(K=I[v+1]-I[v],W=A[v]-1,k=A[v+1]-1),U=I[v],z=W<k?W+U:k+U);if(a.x.ComputeNormals(f,_,p),i){let e=0,s=0;for(v=0;v<t.length;v++)e=3*I[v],s=v+1<t.length?3*(I[v+1]-1):p.length-3,p[e]=.5*(p[e]+p[s]),p[e+1]=.5*(p[e+1]+p[s+1]),p[e+2]=.5*(p[e+2]+p[s+2]),p[s]=p[e],p[s+1]=p[e+1],p[s+2]=p[e+2]}a.x._ComputeSides(c,f,_,p,g,e.frontUVs,e.backUVs);let G=null;if(u){G=new Float32Array(4*u.length);for(let e=0;e<u.length;e++)G[4*e]=u[e].r,G[4*e+1]=u[e].g,G[4*e+2]=u[e].b,G[4*e+3]=u[e].a}const H=new a.x,q=new Float32Array(f),Y=new Float32Array(p),Z=new Float32Array(g);return H.indices=_,H.positions=q,H.normals=Y,H.uvs=Z,G&&H.set(G,n.o.ColorKind),i&&(H._idx=I),H}function l(e,t,s=null){const l=t.pathArray,c=t.closeArray,d=t.closePath,u=r.Kj._GetDefaultSideOrientation(t.sideOrientation),f=t.instance,_=t.updatable;if(f){const e=i.jp.Vector3[0].setAll(Number.MAX_VALUE),s=i.jp.Vector3[1].setAll(-Number.MAX_VALUE),h=t=>{let i=l[0].length;const n=f;let a=0;const o=n._originalBuilderSideOrientation===r.Kj.DOUBLESIDE?2:1;for(let r=1;r<=o;++r)for(let r=0;r<l.length;++r){const o=l[r],h=o.length;i=i<h?i:h;for(let r=0;r<i;++r){const i=o[r];t[a]=i.x,t[a+1]=i.y,t[a+2]=i.z,e.minimizeInPlaceFromFloats(i.x,i.y,i.z),s.maximizeInPlaceFromFloats(i.x,i.y,i.z),a+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const e=o[0];t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z,a+=3}}},c=f.getVerticesData(n.o.PositionKind);if(h(c),f.hasBoundingInfo?f.getBoundingInfo().reConstruct(e,s,f._worldMatrix):f.buildBoundingInfo(e,s,f._worldMatrix),f.updateVerticesData(n.o.PositionKind,c,!1,!1),t.colors){const e=f.getVerticesData(n.o.ColorKind);for(let s=0,i=0;s<t.colors.length;s++,i+=4){const r=t.colors[s];e[i]=r.r,e[i+1]=r.g,e[i+2]=r.b,e[i+3]=r.a}f.updateVerticesData(n.o.ColorKind,e,!1,!1)}if(t.uvs){const e=f.getVerticesData(n.o.UVKind);for(let s=0;s<t.uvs.length;s++)e[2*s]=t.uvs[s].x,e[2*s+1]=o.e.UseOpenGLOrientationForUV?1-t.uvs[s].y:t.uvs[s].y;f.updateVerticesData(n.o.UVKind,e,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){const e=f.getIndices(),t=f.getVerticesData(n.o.NormalKind),s=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(a.x.ComputeNormals(c,e,t,s),f._creationDataStorage&&f._creationDataStorage.closePath){let e=0,s=0;for(let i=0;i<l.length;i++)e=3*f._creationDataStorage.idx[i],s=i+1<l.length?3*(f._creationDataStorage.idx[i+1]-1):t.length-3,t[e]=.5*(t[e]+t[s]),t[e+1]=.5*(t[e+1]+t[s+1]),t[e+2]=.5*(t[e+2]+t[s+2]),t[s]=t[e],t[s+1]=t[e+1],t[s+2]=t[e+2]}f.areNormalsFrozen||f.updateVerticesData(n.o.NormalKind,t,!1,!1)}return f}{const i=new r.Kj(e,s);i._originalBuilderSideOrientation=u,i._creationDataStorage=new r.gW;const n=h(t);return d&&(i._creationDataStorage.idx=n._idx),i._creationDataStorage.closePath=d,i._creationDataStorage.closeArray=c,n.applyToMesh(i,_),i}}function c(e){const t=new Array,s=new Array,i=new Array,r=new Array,n=e.radius||.5,h=e.tessellation||64,l=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,c=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);const d=2*Math.PI*l,u=1===l?d/h:d/(h-1);let f=0;for(let e=0;e<h;e++){const e=Math.cos(f),s=Math.sin(f),i=(e+1)/2,a=(1-s)/2;t.push(n*e,n*s,0),r.push(i,o.e.UseOpenGLOrientationForUV?1-a:a),f+=u}1===l&&(t.push(t[3],t[4],t[5]),r.push(r[2],o.e.UseOpenGLOrientationForUV?1-r[3]:r[3]));const _=t.length/3;for(let e=1;e<_-1;e++)s.push(e+1,0,e);a.x.ComputeNormals(t,s,i),a.x._ComputeSides(c,t,s,i,r,e.frontUVs,e.backUVs);const p=new a.x;return p.indices=s,p.positions=t,p.normals=i,p.uvs=r,p}function d(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,c(t).applyToMesh(i,t.updatable),i}a.x.CreateRibbon=h,r.Kj.CreateRibbon=(e,t,s=!1,i,r,n,a=!1,o,h)=>l(e,{pathArray:t,closeArray:s,closePath:i,offset:r,updatable:a,sideOrientation:o,instance:h},n),a.x.CreateDisc=c,r.Kj.CreateDisc=(e,t,s,i=null,r,n)=>d(e,{radius:t,tessellation:s,sideOrientation:n,updatable:r},i);var u=s(2922);function f(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[];let n=[];const h=e.width||e.size||1,l=e.height||e.size||1,c=e.depth||e.size||1,d=e.wrap||!1;let f=void 0===e.topBaseAt?1:e.topBaseAt,_=void 0===e.bottomBaseAt?0:e.bottomBaseAt;f=(f+4)%4,_=(_+4)%4;let p=[2,0,3,1][f],g=[2,0,1,3][_],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(d){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],s=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const i=[17,18,19,16],r=[22,23,20,21];for(;p>0;)e.unshift(e.pop()),i.unshift(i.pop()),p--;for(;g>0;)s.unshift(s.pop()),r.unshift(r.pop()),g--;e=e.flat(),s=s.flat(),m=m.concat(e).concat(s),t.push(i[0],i[2],i[3],i[0],i[1],i[2]),t.push(r[0],r[2],r[3],r[0],r[1],r[2])}const x=[h/2,l/2,c/2];n=m.reduce(((e,t,s)=>e.concat(t*x[s%3])),[]);const M=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,y=e.faceUV||new Array(6),b=e.faceColors,A=[];for(let e=0;e<6;e++)void 0===y[e]&&(y[e]=new i.Lt(0,0,1,1)),b&&void 0===b[e]&&(b[e]=new u.HE(1,1,1,1));for(let e=0;e<6;e++)if(r.push(y[e].z,o.e.UseOpenGLOrientationForUV?1-y[e].w:y[e].w),r.push(y[e].x,o.e.UseOpenGLOrientationForUV?1-y[e].w:y[e].w),r.push(y[e].x,o.e.UseOpenGLOrientationForUV?1-y[e].y:y[e].y),r.push(y[e].z,o.e.UseOpenGLOrientationForUV?1-y[e].y:y[e].y),b)for(let t=0;t<4;t++)A.push(b[e].r,b[e].g,b[e].b,b[e].a);a.x._ComputeSides(M,n,t,s,r,e.frontUVs,e.backUVs);const I=new a.x;if(I.indices=t,I.positions=n,I.normals=s,I.uvs=r,b){const e=M===a.x.DOUBLESIDE?A.concat(A):A;I.colors=e}return I}function _(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,f(t).applyToMesh(i,t.updatable),i}function p(e){const t=e.pattern||r.Kj.NO_FLIP,s=e.tileWidth||e.tileSize||1,i=e.tileHeight||e.tileSize||1,n=e.alignHorizontal||0,o=e.alignVertical||0,h=e.width||e.size||1,l=Math.floor(h/s);let c=h-l*s;const d=e.height||e.size||1,u=Math.floor(d/i);let f=d-u*i;const _=s*l/2,p=i*u/2;let g=0,m=0,x=0,M=0,y=0,b=0;if(c>0||f>0){switch(x=-_,M=-p,y=_,b=p,n){case r.Kj.CENTER:c/=2,x-=c,y+=c;break;case r.Kj.LEFT:y+=c,g=-c/2;break;case r.Kj.RIGHT:x-=c,g=c/2}switch(o){case r.Kj.CENTER:f/=2,M-=f,b+=f;break;case r.Kj.BOTTOM:b+=f,m=-f/2;break;case r.Kj.TOP:M-=f,m=f/2}}const A=[],I=[],v=[];v[0]=[0,0,1,0,1,1,0,1],v[1]=[0,0,1,0,1,1,0,1],t!==r.Kj.ROTATE_TILE&&t!==r.Kj.ROTATE_ROW||(v[1]=[1,1,0,1,0,0,1,0]),t!==r.Kj.FLIP_TILE&&t!==r.Kj.FLIP_ROW||(v[1]=[1,0,0,0,0,1,1,1]),t!==r.Kj.FLIP_N_ROTATE_TILE&&t!==r.Kj.FLIP_N_ROTATE_ROW||(v[1]=[0,1,1,1,1,0,0,0]);let D=[];const S=[],P=[];let T=0;for(let e=0;e<u;e++)for(let n=0;n<l;n++)A.push(n*s-_+g,e*i-p+m,0),A.push((n+1)*s-_+g,e*i-p+m,0),A.push((n+1)*s-_+g,(e+1)*i-p+m,0),A.push(n*s-_+g,(e+1)*i-p+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),D=t===r.Kj.FLIP_TILE||t===r.Kj.ROTATE_TILE||t===r.Kj.FLIP_N_ROTATE_TILE?D.concat(v[(n%2+e%2)%2]):t===r.Kj.FLIP_ROW||t===r.Kj.ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_ROW?D.concat(v[e%2]):D.concat(v[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(c>0||f>0){const e=f>0&&(o===r.Kj.CENTER||o===r.Kj.TOP),a=f>0&&(o===r.Kj.CENTER||o===r.Kj.BOTTOM),h=c>0&&(n===r.Kj.CENTER||n===r.Kj.RIGHT),d=c>0&&(n===r.Kj.CENTER||n===r.Kj.LEFT);let v,O,C,E,R=[];if(e&&h&&(A.push(x+g,M+m,0),A.push(-_+g,M+m,0),A.push(-_+g,M+f+m,0),A.push(x+g,M+f+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=1-c/s,O=1-f/i,C=1,E=1,R=[v,O,C,O,C,E,v,E],t===r.Kj.ROTATE_ROW&&(R=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),t===r.Kj.FLIP_ROW&&(R=[1-v,O,1-C,O,1-C,E,1-v,E]),t===r.Kj.FLIP_N_ROTATE_ROW&&(R=[v,1-O,C,1-O,C,1-E,v,1-E]),D=D.concat(R),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&d&&(A.push(_+g,M+m,0),A.push(y+g,M+m,0),A.push(y+g,M+f+m,0),A.push(_+g,M+f+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=0,O=1-f/i,C=c/s,E=1,R=[v,O,C,O,C,E,v,E],(t===r.Kj.ROTATE_ROW||t===r.Kj.ROTATE_TILE&&l%2==0)&&(R=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),(t===r.Kj.FLIP_ROW||t===r.Kj.FLIP_TILE&&l%2==0)&&(R=[1-v,O,1-C,O,1-C,E,1-v,E]),(t===r.Kj.FLIP_N_ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_TILE&&l%2==0)&&(R=[v,1-O,C,1-O,C,1-E,v,1-E]),D=D.concat(R),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&h&&(A.push(x+g,p+m,0),A.push(-_+g,p+m,0),A.push(-_+g,b+m,0),A.push(x+g,b+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=1-c/s,O=0,C=1,E=f/i,R=[v,O,C,O,C,E,v,E],(t===r.Kj.ROTATE_ROW&&u%2==1||t===r.Kj.ROTATE_TILE&&u%1==0)&&(R=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),(t===r.Kj.FLIP_ROW&&u%2==1||t===r.Kj.FLIP_TILE&&u%2==0)&&(R=[1-v,O,1-C,O,1-C,E,1-v,E]),(t===r.Kj.FLIP_N_ROTATE_ROW&&u%2==1||t===r.Kj.FLIP_N_ROTATE_TILE&&u%2==0)&&(R=[v,1-O,C,1-O,C,1-E,v,1-E]),D=D.concat(R),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&d&&(A.push(_+g,p+m,0),A.push(y+g,p+m,0),A.push(y+g,b+m,0),A.push(_+g,b+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,v=0,O=0,C=c/s,E=f/i,R=[v,O,C,O,C,E,v,E],(t===r.Kj.ROTATE_ROW&&u%2==1||t===r.Kj.ROTATE_TILE&&(u+l)%2==1)&&(R=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),(t===r.Kj.FLIP_ROW&&u%2==1||t===r.Kj.FLIP_TILE&&(u+l)%2==1)&&(R=[1-v,O,1-C,O,1-C,E,1-v,E]),(t===r.Kj.FLIP_N_ROTATE_ROW&&u%2==1||t===r.Kj.FLIP_N_ROTATE_TILE&&(u+l)%2==1)&&(R=[v,1-O,C,1-O,C,1-E,v,1-E]),D=D.concat(R),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];v=0,O=1-f/i,C=1,E=1,e[0]=[v,O,C,O,C,E,v,E],e[1]=[v,O,C,O,C,E,v,E],t!==r.Kj.ROTATE_TILE&&t!==r.Kj.ROTATE_ROW||(e[1]=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),t!==r.Kj.FLIP_TILE&&t!==r.Kj.FLIP_ROW||(e[1]=[1-v,O,1-C,O,1-C,E,1-v,E]),t!==r.Kj.FLIP_N_ROTATE_TILE&&t!==r.Kj.FLIP_N_ROTATE_ROW||(e[1]=[v,1-O,C,1-O,C,1-E,v,1-E]);for(let i=0;i<l;i++)A.push(i*s-_+g,M+m,0),A.push((i+1)*s-_+g,M+m,0),A.push((i+1)*s-_+g,M+f+m,0),A.push(i*s-_+g,M+f+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,D=t===r.Kj.FLIP_TILE||t===r.Kj.ROTATE_TILE||t===r.Kj.FLIP_N_ROTATE_TILE?D.concat(e[(i+1)%2]):t===r.Kj.FLIP_ROW||t===r.Kj.ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_ROW?D.concat(e[1]):D.concat(e[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const e=[];v=0,O=0,C=1,E=f/i,e[0]=[v,O,C,O,C,E,v,E],e[1]=[v,O,C,O,C,E,v,E],t!==r.Kj.ROTATE_TILE&&t!==r.Kj.ROTATE_ROW||(e[1]=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),t!==r.Kj.FLIP_TILE&&t!==r.Kj.FLIP_ROW||(e[1]=[1-v,O,1-C,O,1-C,E,1-v,E]),t!==r.Kj.FLIP_N_ROTATE_TILE&&t!==r.Kj.FLIP_N_ROTATE_ROW||(e[1]=[v,1-O,C,1-O,C,1-E,v,1-E]);for(let i=0;i<l;i++)A.push(i*s-_+g,b-f+m,0),A.push((i+1)*s-_+g,b-f+m,0),A.push((i+1)*s-_+g,b+m,0),A.push(i*s-_+g,b+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,D=t===r.Kj.FLIP_TILE||t===r.Kj.ROTATE_TILE||t===r.Kj.FLIP_N_ROTATE_TILE?D.concat(e[(i+u)%2]):t===r.Kj.FLIP_ROW||t===r.Kj.ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_ROW?D.concat(e[u%2]):D.concat(e[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const e=[];v=1-c/s,O=0,C=1,E=1,e[0]=[v,O,C,O,C,E,v,E],e[1]=[v,O,C,O,C,E,v,E],t!==r.Kj.ROTATE_TILE&&t!==r.Kj.ROTATE_ROW||(e[1]=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),t!==r.Kj.FLIP_TILE&&t!==r.Kj.FLIP_ROW||(e[1]=[1-v,O,1-C,O,1-C,E,1-v,E]),t!==r.Kj.FLIP_N_ROTATE_TILE&&t!==r.Kj.FLIP_N_ROTATE_ROW||(e[1]=[v,1-O,C,1-O,C,1-E,v,1-E]);for(let s=0;s<u;s++)A.push(x+g,s*i-p+m,0),A.push(x+c+g,s*i-p+m,0),A.push(x+c+g,(s+1)*i-p+m,0),A.push(x+g,(s+1)*i-p+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,D=t===r.Kj.FLIP_TILE||t===r.Kj.ROTATE_TILE||t===r.Kj.FLIP_N_ROTATE_TILE?D.concat(e[(s+1)%2]):t===r.Kj.FLIP_ROW||t===r.Kj.ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_ROW?D.concat(e[s%2]):D.concat(e[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(d){const e=[];v=0,O=0,C=c/i,E=1,e[0]=[v,O,C,O,C,E,v,E],e[1]=[v,O,C,O,C,E,v,E],t!==r.Kj.ROTATE_TILE&&t!==r.Kj.ROTATE_ROW||(e[1]=[1-v,1-O,1-C,1-O,1-C,1-E,1-v,1-E]),t!==r.Kj.FLIP_TILE&&t!==r.Kj.FLIP_ROW||(e[1]=[1-v,O,1-C,O,1-C,E,1-v,E]),t!==r.Kj.FLIP_N_ROTATE_TILE&&t!==r.Kj.FLIP_N_ROTATE_ROW||(e[1]=[v,1-O,C,1-O,C,1-E,v,1-E]);for(let s=0;s<u;s++)A.push(y-c+g,s*i-p+m,0),A.push(y+g,s*i-p+m,0),A.push(y+g,(s+1)*i-p+m,0),A.push(y-c+g,(s+1)*i-p+m,0),P.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,D=t===r.Kj.FLIP_TILE||t===r.Kj.ROTATE_TILE||t===r.Kj.FLIP_N_ROTATE_TILE?D.concat(e[(s+l)%2]):t===r.Kj.FLIP_ROW||t===r.Kj.ROTATE_ROW||t===r.Kj.FLIP_N_ROTATE_ROW?D.concat(e[s%2]):D.concat(e[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),I.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const O=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE;a.x._ComputeSides(O,A,P,I,D,e.frontUVs,e.backUVs);const C=new a.x;C.indices=P,C.positions=A,C.normals=I,C.uvs=D;const E=O===a.x.DOUBLESIDE?S.concat(S):S;return C.colors=E,C}function g(e){const t=e.faceUV||new Array(6),s=e.faceColors,n=e.pattern||r.Kj.NO_FLIP,h=e.width||e.size||1,l=e.height||e.size||1,c=e.depth||e.size||1,d=e.tileWidth||e.tileSize||1,f=e.tileHeight||e.tileSize||1,_=e.alignHorizontal||0,g=e.alignVertical||0,m=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===t[e]&&(t[e]=new i.Lt(0,0,1,1)),s&&void 0===s[e]&&(s[e]=new u.HE(1,1,1,1));const x=h/2,M=l/2,y=c/2,b=[];for(let e=0;e<2;e++)b[e]=p({pattern:n,tileWidth:d,tileHeight:f,width:h,height:l,alignVertical:g,alignHorizontal:_,sideOrientation:m});for(let e=2;e<4;e++)b[e]=p({pattern:n,tileWidth:d,tileHeight:f,width:c,height:l,alignVertical:g,alignHorizontal:_,sideOrientation:m});let A=g;g===r.Kj.BOTTOM?A=r.Kj.TOP:g===r.Kj.TOP&&(A=r.Kj.BOTTOM);for(let e=4;e<6;e++)b[e]=p({pattern:n,tileWidth:d,tileHeight:f,width:h,height:c,alignVertical:A,alignHorizontal:_,sideOrientation:m});let I=[],v=[],D=[],S=[];const P=[],T=[],O=[],C=[];let E=0,R=0;for(let e=0;e<6;e++){const r=b[e].positions.length;T[e]=[],O[e]=[];for(let t=0;t<r/3;t++)T[e].push(new i.P(b[e].positions[3*t],b[e].positions[3*t+1],b[e].positions[3*t+2])),O[e].push(new i.P(b[e].normals[3*t],b[e].normals[3*t+1],b[e].normals[3*t+2]));E=b[e].uvs.length,C[e]=[];for(let s=0;s<E;s+=2)C[e][s]=t[e].x+(t[e].z-t[e].x)*b[e].uvs[s],C[e][s+1]=t[e].y+(t[e].w-t[e].y)*b[e].uvs[s+1],o.e.UseOpenGLOrientationForUV&&(C[e][s+1]=1-C[e][s+1]);if(D=D.concat(C[e]),S=S.concat(b[e].indices.map((e=>e+R))),R+=T[e].length,s)for(let t=0;t<4;t++)P.push(s[e].r,s[e].g,s[e].b,s[e].a)}const B=new i.P(0,0,y),F=i.y3.RotationY(Math.PI);I=T[0].map((e=>i.P.TransformNormal(e,F).add(B))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),v=O[0].map((e=>i.P.TransformNormal(e,F))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]),I=I.concat(T[1].map((e=>e.subtract(B))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(O[1].map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const w=new i.P(x,0,0),V=i.y3.RotationY(-Math.PI/2);I=I.concat(T[2].map((e=>i.P.TransformNormal(e,V).add(w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(O[2].map((e=>i.P.TransformNormal(e,V))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const L=i.y3.RotationY(Math.PI/2);I=I.concat(T[3].map((e=>i.P.TransformNormal(e,L).subtract(w))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(O[3].map((e=>i.P.TransformNormal(e,L))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const N=new i.P(0,M,0),U=i.y3.RotationX(Math.PI/2);I=I.concat(T[4].map((e=>i.P.TransformNormal(e,U).add(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(O[4].map((e=>i.P.TransformNormal(e,U))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[]));const W=i.y3.RotationX(-Math.PI/2);I=I.concat(T[5].map((e=>i.P.TransformNormal(e,W).subtract(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),v=v.concat(O[5].map((e=>i.P.TransformNormal(e,W))).map((e=>[e.x,e.y,e.z])).reduce(((e,t)=>e.concat(t)),[])),a.x._ComputeSides(m,I,S,v,D);const k=new a.x;if(k.indices=S,k.positions=I,k.normals=v,k.uvs=D,s){const e=m===a.x.DOUBLESIDE?P.concat(P):P;k.colors=e}return k}function m(e){const t=e.segments||32,s=e.diameterX||e.diameter||1,r=e.diameterY||e.diameter||1,n=e.diameterZ||e.diameter||1,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=e.slice&&e.slice<=0?1:e.slice||1,c=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,d=!!e.dedupTopBottomIndices,u=new i.P(s/2,r/2,n/2),f=2+t,_=2*f,p=[],g=[],m=[],x=[];for(let e=0;e<=f;e++){const t=e/f,s=t*Math.PI*l;for(let e=0;e<=_;e++){const r=e/_,n=r*Math.PI*2*h,a=i.y3.RotationZ(-s),l=i.y3.RotationY(n),c=i.P.TransformCoordinates(i.P.Up(),a),d=i.P.TransformCoordinates(c,l),f=d.multiply(u),p=d.divide(u).normalize();g.push(f.x,f.y,f.z),m.push(p.x,p.y,p.z),x.push(r,o.e.UseOpenGLOrientationForUV?1-t:t)}if(e>0){const t=g.length/3;for(let s=t-2*(_+1);s+_+2<t;s++)d?(e>1&&(p.push(s),p.push(s+1),p.push(s+_+1)),(e<f||l<1)&&(p.push(s+_+1),p.push(s+1),p.push(s+_+2))):(p.push(s),p.push(s+1),p.push(s+_+1),p.push(s+_+1),p.push(s+1),p.push(s+_+2))}}a.x._ComputeSides(c,g,p,m,x,e.frontUVs,e.backUVs);const M=new a.x;return M.indices=p,M.positions=g,M.normals=m,M.uvs=x,M}function x(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,m(t).applyToMesh(i,t.updatable),i}a.x.CreateBox=f,r.Kj.CreateBox=(e,t,s=null,i,r)=>_(e,{size:t,sideOrientation:r,updatable:i},s),a.x.CreateTiledPlane=p,a.x.CreateTiledBox=g,a.x.CreateSphere=m,r.Kj.CreateSphere=(e,t,s,i,r,n)=>x(e,{segments:t,diameterX:s,diameterY:s,diameterZ:s,sideOrientation:n,updatable:r},i);var M=s(253),y=s(5241);function b(e){const t=e.height||2;let s=0===e.diameterTop?0:e.diameterTop||e.diameter||1,n=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;s=s||1e-5,n=n||1e-5;const h=e.tessellation||24,l=e.subdivisions||1,c=!!e.hasRings,d=!!e.enclose,f=0===e.cap?0:e.cap||r.Kj.CAP_ALL,_=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,p=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,g=e.faceUV||new Array(3),m=e.faceColors,x=2+(1+(1!==_&&d?2:0))*(c?l:1);let M;for(M=0;M<x;M++)m&&void 0===m[M]&&(m[M]=new u.HE(1,1,1,1));for(M=0;M<x;M++)g&&void 0===g[M]&&(g[M]=new i.Lt(0,0,1,1));const b=new Array,A=new Array,I=new Array,v=new Array,D=new Array,S=2*Math.PI*_/h;let P,T,O;const C=(n-s)/2/t,E=i.P.Zero(),R=i.P.Zero(),B=i.P.Zero(),F=i.P.Zero(),w=i.P.Zero(),V=y.RD.Y;let L,N,U,W=1,k=1,z=0,K=0;for(L=0;L<=l;L++)for(T=L/l,O=(T*(s-n)+n)/2,W=c&&0!==L&&L!==l?2:1,U=0;U<W;U++){for(c&&(k+=U),d&&(k+=2*U),N=0;N<=h;N++)P=N*S,E.x=Math.cos(-P)*O,E.y=-t/2+T*t,E.z=Math.sin(-P)*O,0===s&&L===l?(R.x=I[I.length-3*(h+1)],R.y=I[I.length-3*(h+1)+1],R.z=I[I.length-3*(h+1)+2]):(R.x=E.x,R.z=E.z,R.y=Math.sqrt(R.x*R.x+R.z*R.z)*C,R.normalize()),0===N&&(B.copyFrom(E),F.copyFrom(R)),A.push(E.x,E.y,E.z),I.push(R.x,R.y,R.z),K=c?z!==k?g[k].y:g[k].w:g[k].y+(g[k].w-g[k].y)*T,v.push(g[k].x+(g[k].z-g[k].x)*N/h,o.e.UseOpenGLOrientationForUV?1-K:K),m&&D.push(m[k].r,m[k].g,m[k].b,m[k].a);1!==_&&d&&(A.push(E.x,E.y,E.z),A.push(0,E.y,0),A.push(0,E.y,0),A.push(B.x,B.y,B.z),i.P.CrossToRef(V,R,w),w.normalize(),I.push(w.x,w.y,w.z,w.x,w.y,w.z),i.P.CrossToRef(F,V,w),w.normalize(),I.push(w.x,w.y,w.z,w.x,w.y,w.z),K=c?z!==k?g[k+1].y:g[k+1].w:g[k+1].y+(g[k+1].w-g[k+1].y)*T,v.push(g[k+1].x,o.e.UseOpenGLOrientationForUV?1-K:K),v.push(g[k+1].z,o.e.UseOpenGLOrientationForUV?1-K:K),K=c?z!==k?g[k+2].y:g[k+2].w:g[k+2].y+(g[k+2].w-g[k+2].y)*T,v.push(g[k+2].x,o.e.UseOpenGLOrientationForUV?1-K:K),v.push(g[k+2].z,o.e.UseOpenGLOrientationForUV?1-K:K),m&&(D.push(m[k+1].r,m[k+1].g,m[k+1].b,m[k+1].a),D.push(m[k+1].r,m[k+1].g,m[k+1].b,m[k+1].a),D.push(m[k+2].r,m[k+2].g,m[k+2].b,m[k+2].a),D.push(m[k+2].r,m[k+2].g,m[k+2].b,m[k+2].a))),z!==k&&(z=k)}const j=1!==_&&d?h+4:h;for(L=0,k=0;k<l;k++){let e=0,t=0,s=0,i=0;for(N=0;N<h;N++)e=L*(j+1)+N,t=(L+1)*(j+1)+N,s=L*(j+1)+(N+1),i=(L+1)*(j+1)+(N+1),b.push(e,t,s),b.push(i,s,t);1!==_&&d&&(b.push(e+2,t+2,s+2),b.push(i+2,s+2,t+2),b.push(e+4,t+4,s+4),b.push(i+4,s+4,t+4)),L=c?L+2:L+1}const G=e=>{const r=e?s/2:n/2;if(0===r)return;let a,l,c;const d=e?g[x-1]:g[0];let u=null;m&&(u=e?m[x-1]:m[0]);const f=A.length/3,p=e?t/2:-t/2,M=new i.P(0,p,0);A.push(M.x,M.y,M.z),I.push(0,e?1:-1,0);const y=d.y+.5*(d.w-d.y);v.push(d.x+.5*(d.z-d.x),o.e.UseOpenGLOrientationForUV?1-y:y),u&&D.push(u.r,u.g,u.b,u.a);const S=new i.FM(.5,.5);for(c=0;c<=h;c++){a=2*Math.PI*c*_/h;const t=Math.cos(-a),s=Math.sin(-a);l=new i.P(t*r,p,s*r);const n=new i.FM(t*S.x+.5,s*S.y+.5);A.push(l.x,l.y,l.z),I.push(0,e?1:-1,0);const f=d.y+(d.w-d.y)*n.y;v.push(d.x+(d.z-d.x)*n.x,o.e.UseOpenGLOrientationForUV?1-f:f),u&&D.push(u.r,u.g,u.b,u.a)}for(c=0;c<h;c++)e?(b.push(f),b.push(f+(c+2)),b.push(f+(c+1))):(b.push(f),b.push(f+(c+1)),b.push(f+(c+2)))};f!==r.Kj.CAP_START&&f!==r.Kj.CAP_ALL||G(!1),f!==r.Kj.CAP_END&&f!==r.Kj.CAP_ALL||G(!0),a.x._ComputeSides(p,A,b,I,v,e.frontUVs,e.backUVs);const H=new a.x;return H.indices=b,H.positions=A,H.normals=I,H.uvs=v,m&&(H.colors=D),H}function A(e,t={},s){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,b(t).applyToMesh(i,t.updatable),i}function I(e){const t=[],s=[],r=[],n=[],h=e.diameter||1,l=e.thickness||.5,c=e.tessellation||16,d=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,u=c+1;for(let e=0;e<=c;e++){const a=e/c,d=e*Math.PI*2/c-Math.PI/2,f=i.y3.Translation(h/2,0,0).multiply(i.y3.RotationY(d));for(let h=0;h<=c;h++){const d=1-h/c,_=h*Math.PI*2/c+Math.PI,p=Math.cos(_),g=Math.sin(_);let m=new i.P(p,g,0),x=m.scale(l/2);const M=new i.FM(a,d);x=i.P.TransformCoordinates(x,f),m=i.P.TransformNormal(m,f),s.push(x.x,x.y,x.z),r.push(m.x,m.y,m.z),n.push(M.x,o.e.UseOpenGLOrientationForUV?1-M.y:M.y);const y=(e+1)%u,b=(h+1)%u;t.push(e*u+h),t.push(e*u+b),t.push(y*u+h),t.push(e*u+b),t.push(y*u+b),t.push(y*u+h)}}a.x._ComputeSides(d,s,t,r,n,e.frontUVs,e.backUVs);const f=new a.x;return f.indices=t,f.positions=s,f.normals=r,f.uvs=n,f}function v(e,t={},s){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,I(t).applyToMesh(i,t.updatable),i}function D(e){const t=new Array,s=new Array,r=new Array,n=new Array,h=e.radius||2,l=e.tube||.5,c=e.radialSegments||32,d=e.tubularSegments||32,u=e.p||2,f=e.q||3,_=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,p=e=>{const t=Math.cos(e),s=Math.sin(e),r=f/u*e,n=Math.cos(r),a=h*(2+n)*.5*t,o=h*(2+n)*s*.5,l=h*Math.sin(r)*.5;return new i.P(a,o,l)};let g,m;for(g=0;g<=c;g++){const e=g%c/c*2*u*Math.PI,t=p(e),r=p(e+.01),a=r.subtract(t);let h=r.add(t);const f=i.P.Cross(a,h);for(h=i.P.Cross(f,a),f.normalize(),h.normalize(),m=0;m<d;m++){const e=m%d/d*2*Math.PI,i=-l*Math.cos(e),r=l*Math.sin(e);s.push(t.x+i*h.x+r*f.x),s.push(t.y+i*h.y+r*f.y),s.push(t.z+i*h.z+r*f.z),n.push(g/c),n.push(o.e.UseOpenGLOrientationForUV?1-m/d:m/d)}}for(g=0;g<c;g++)for(m=0;m<d;m++){const e=(m+1)%d,s=g*d+m,i=(g+1)*d+m,r=(g+1)*d+e,n=g*d+e;t.push(n),t.push(i),t.push(s),t.push(n),t.push(r),t.push(i)}a.x.ComputeNormals(s,t,r),a.x._ComputeSides(_,s,t,r,n,e.frontUVs,e.backUVs);const x=new a.x;return x.indices=t,x.positions=s,x.normals=r,x.uvs=n,x}function S(e,t={},s){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,D(t).applyToMesh(i,t.updatable),i}a.x.CreateCylinder=b,r.Kj.CreateCylinder=(e,t,s,i,n,a,o,h,l)=>(void 0!==o&&o instanceof M.x||(void 0!==o&&(l=h||r.Kj.DEFAULTSIDE,h=o),o=a,a=1),A(e,{height:t,diameterTop:s,diameterBottom:i,tessellation:n,subdivisions:a,sideOrientation:l,updatable:h},o)),a.x.CreateTorus=I,r.Kj.CreateTorus=(e,t,s,i,r,n,a)=>v(e,{diameter:t,thickness:s,tessellation:i,sideOrientation:a,updatable:n},r),a.x.CreateTorusKnot=D,r.Kj.CreateTorusKnot=(e,t,s,i,r,n,a,o,h,l)=>S(e,{radius:t,tube:s,radialSegments:i,tubularSegments:r,p:n,q:a,sideOrientation:l,updatable:h},o);var P=s(658),T=s(7142),O=s(2827),C=s(4179);r.Kj._instancedMeshFactory=(e,t)=>{const s=new E(e,t);if(t.instancedBuffers){s.instancedBuffers={};for(const e in t.instancedBuffers)s.instancedBuffers[e]=t.instancedBuffers[e]}return s};class E extends T.x{constructor(e,t){super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const e of t.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}get material(){return this._sourceMesh.material}get visibility(){return this._sourceMesh.visibility}get skeleton(){return this._sourceMesh.skeleton}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&P.Y.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t){return this._sourceMesh.getVerticesData(e,t)}setVerticesData(e,t,s,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,s,i),this.sourceMesh}updateVerticesData(e,t,s,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,s,i),this.sourceMesh}setIndices(e,t=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,t=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;const s=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e,t),s),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||P.Y.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==C.Y.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new i.y3);const e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,i.jp.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(i.jp.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;const t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,t=null,s,i){const r=(i||this._sourceMesh).createInstance(e);if(O.j.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!s)for(let e=0;e<this.getScene().meshes.length;e++){const t=this.getScene().meshes[e];t.parent===this&&t.clone(t.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,t,s){const i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);i&&s&&s(this,i);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(i,t,s);return i}}r.Kj.prototype.registerInstancedBuffer=function(e,t){var s,i;if(null===(i=null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[e])||void 0===i||i.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const e of this.instances)e.instancedBuffers={};this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new n.o(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(const t of this.instances)t.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},r.Kj.prototype._processInstancedBuffers=function(e,t){const s=e?e.length:0;for(const i in this.instancedBuffers){let r=this._userInstancedBuffersStorage.sizes[i];const a=this._userInstancedBuffersStorage.strides[i],o=(s+1)*a;for(;r<o;)r*=2;this._userInstancedBuffersStorage.data[i].length!=r&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[i]=r,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));const h=this._userInstancedBuffersStorage.data[i];let l=0;if(t){const e=this.instancedBuffers[i];e.toArray?e.toArray(h,l):e.copyToArray?e.copyToArray(h,l):h[l]=e,l+=a}for(let t=0;t<s;t++){const s=e[t].instancedBuffers[i];s.toArray?s.toArray(h,l):s.copyToArray?s.copyToArray(h,l):h[l]=s,l+=a}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(h,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new n.o(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,a,!0),this._invalidateInstanceVertexArrayObject())}},r.Kj.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},r.Kj.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}};var R=s(2067),B=s(8137),F=s(5356),w=s(2108),V=s(646),L=s(708),N=s(4910),U=s(4520),W=s(5953),k=s(6181);const z={effect:null,subMesh:null};class K extends U.a{constructor(e,t,s,r={},n=!0){super(e,t,n),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new i.y3,this._cachedWorldViewProjectionMatrix=new i.y3,this._multiview=!1,this._shaderPath=s,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...r}}get shaderPath(){return this._shaderPath}set shaderPath(e){this._shaderPath=e}get options(){return this._options}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)}setTexture(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this}setTextureArray(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this}setExternalTexture(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setUInt(e,t){return this._checkUniform(e),this._uints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor3Array(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setColor4Array(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setQuaternion(e,t){return this._checkUniform(e),this._quaternions[e]=t,this}setQuaternionArray(e,t){return this._checkUniform(e),this._quaternionsArrays[e]=t.reduce(((e,t)=>(t.toArray(e,e.length),e)),[]),this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}setMatrices(e,t){this._checkUniform(e);const s=new Float32Array(16*t.length);for(let e=0;e<t.length;e++)t[e].copyToArray(s,16*e);return this._matrixArrays[e]=s,this}setMatrix3x3(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this}setMatrix2x2(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this}setArray2(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this}setArray3(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this}setArray4(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this}setUniformBuffer(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this}setTextureSampler(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this}setStorageBuffer(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this}isReadyForSubMesh(e,t,s){return this.isReady(e,s,t)}isReady(e,t,s){var i,r,a,o;const h=s&&this._storeEffectOnSubMeshes;if(this.isFrozen)if(h){if(s.effect&&s.effect._wasPreviouslyReady)return!0}else{const e=this._drawWrapper.effect;if(e&&e._wasPreviouslyReady&&e._wasPreviouslyUsingInstances===t)return!0}const l=this.getScene(),c=l.getEngine(),d=[],u=[],f=new L.L;let _=this._shaderPath,p=this._options.uniforms,g=this._options.uniformBuffers,m=this._options.samplers;c.getCaps().multiview&&l.activeCamera&&l.activeCamera.outputRenderTarget&&l.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,d.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.indexOf("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(let e=0;e<this._options.defines.length;e++){const t=0===this._options.defines[e].indexOf("#define")?this._options.defines[e]:`#define ${this._options.defines[e]}`;d.push(t)}for(let e=0;e<this._options.attributes.length;e++)u.push(this._options.attributes[e]);if(e&&e.isVerticesDataPresent(n.o.ColorKind)&&(u.push(n.o.ColorKind),d.push("#define VERTEXCOLOR")),t&&(d.push("#define INSTANCES"),w.G.PushAttributesForInstances(u),(null==e?void 0:e.hasThinInstances)&&(d.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(n.o.ColorInstanceKind)&&(u.push(n.o.ColorInstanceKind),d.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){u.push(n.o.MatricesIndicesKind),u.push(n.o.MatricesWeightsKind),e.numBoneInfluencers>4&&(u.push(n.o.MatricesIndicesExtraKind),u.push(n.o.MatricesWeightsExtraKind));const t=e.skeleton;d.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),f.addCPUSkinningFallback(0,e),t.isUsingTextureForMatrices?(d.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(d.push("#define BonesPerMesh "+(t.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else d.push("#define NUM_BONE_INFLUENCERS 0");let x=0;const M=e?e.morphTargetManager:null;if(M){const e=M.supportsUVs&&-1!==d.indexOf("#define UV1"),t=M.supportsTangents&&-1!==d.indexOf("#define TANGENT"),s=M.supportsNormals&&-1!==d.indexOf("#define NORMAL");x=M.numInfluencers,e&&d.push("#define MORPHTARGETS_UV"),t&&d.push("#define MORPHTARGETS_TANGENT"),s&&d.push("#define MORPHTARGETS_NORMAL"),x>0&&d.push("#define MORPHTARGETS"),M.isUsingTextureForTargets&&(d.push("#define MORPHTARGETS_TEXTURE"),-1===this._options.uniforms.indexOf("morphTargetTextureIndices")&&this._options.uniforms.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),d.push("#define NUM_MORPH_INFLUENCERS "+x);for(let i=0;i<x;i++)u.push(n.o.PositionKind+i),s&&u.push(n.o.NormalKind+i),t&&u.push(n.o.TangentKind+i),e&&u.push(n.o.UVKind+"_"+i);x>0&&(p=p.slice(),p.push("morphTargetInfluences"),p.push("morphTargetTextureInfo"),p.push("morphTargetTextureIndices"))}else d.push("#define NUM_MORPH_INFLUENCERS 0");if(e){const t=e.bakedVertexAnimationManager;t&&t.isEnabled&&(d.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===this._options.uniforms.indexOf("bakedVertexAnimationSettings")&&this._options.uniforms.push("bakedVertexAnimationSettings"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")&&this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTime")&&this._options.uniforms.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),w.G.PrepareAttributesForBakedVertexAnimation(u,e,d)}for(const e in this._textures)if(!this._textures[e].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&d.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,k.qx)(p),(0,k.AN)(this,l,d)),this.customShaderNameResolve&&(p=p.slice(),g=g.slice(),m=m.slice(),_=this.customShaderNameResolve(_,p,g,m,d,u));const y=h?s._getDrawWrapper():this._drawWrapper,b=null!==(i=null==y?void 0:y.effect)&&void 0!==i?i:null,A=null!==(r=null==y?void 0:y.defines)&&void 0!==r?r:null,I=d.join("\n");let v=b;return A!==I&&(v=c.createEffect(_,{attributes:u,uniformsNames:p,uniformBuffersNames:g,samplers:m,defines:I,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:x},shaderLanguage:this._options.shaderLanguage},c),h?s.setEffect(v,I,this._materialContext):y&&y.setEffect(v,I),this._onEffectCreatedObservable&&(z.effect=v,z.subMesh=null!==(a=null!=s?s:null==e?void 0:e.subMeshes[0])&&void 0!==a?a:null,this._onEffectCreatedObservable.notifyObservers(z))),v._wasPreviouslyUsingInstances=!!t,null!==(o=!(null==v?void 0:v.isReady()))&&void 0!==o&&!o&&(b!==v&&l.resetCachedMaterial(),v._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(e,t){const s=this.getScene(),i=null!=t?t:this.getEffect();i&&(-1!==this._options.uniforms.indexOf("world")&&i.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(s.getViewMatrix(),this._cachedWorldViewMatrix),i.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(s.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),i.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))}bindForSubMesh(e,t,s){var i;this.bind(e,t,null===(i=s._drawWrapperOverride)||void 0===i?void 0:i.effect,s)}bind(e,t,s,i){var r;const n=i&&this._storeEffectOnSubMeshes,a=null!=s?s:n?i.effect:this.getEffect();if(!a)return;this._activeEffect=a,this.bindOnlyWorldMatrix(e,s);const o=this._options.uniformBuffers;let h=!1;if(a&&o&&o.length>0&&this.getScene().getEngine().supportsUniformBuffers)for(let s=0;s<o.length;++s)switch(o[s]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(a,"Mesh"),t.transferToEffect(e));break;case"Scene":w.G.BindSceneUniformBuffer(a,this.getScene().getSceneUniformBuffer()),this.getScene().finalizeSceneUbo(),h=!0}const l=t&&n?this._mustRebind(this.getScene(),a,t.visibility):this.getScene().getCachedMaterial()!==this;if(a&&l){let e;for(e in h||-1===this._options.uniforms.indexOf("view")||a.setMatrix("view",this.getScene().getViewMatrix()),h||-1===this._options.uniforms.indexOf("projection")||a.setMatrix("projection",this.getScene().getProjectionMatrix()),h||-1===this._options.uniforms.indexOf("viewProjection")||(a.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&a.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&a.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),w.G.BindBonesParameters(t,a),(0,k.an)(a,this,this.getScene()),this._textures)a.setTexture(e,this._textures[e]);for(e in this._textureArrays)a.setTextureArray(e,this._textureArrays[e]);for(e in this._externalTextures)a.setExternalTexture(e,this._externalTextures[e]);for(e in this._ints)a.setInt(e,this._ints[e]);for(e in this._uints)a.setUInt(e,this._uints[e]);for(e in this._floats)a.setFloat(e,this._floats[e]);for(e in this._floatsArrays)a.setArray(e,this._floatsArrays[e]);for(e in this._colors3)a.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)a.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){const t=this._colors4[e];a.setFloat4(e,t.r,t.g,t.b,t.a)}for(e in this._colors4Arrays)a.setArray4(e,this._colors4Arrays[e]);for(e in this._vectors2)a.setVector2(e,this._vectors2[e]);for(e in this._vectors3)a.setVector3(e,this._vectors3[e]);for(e in this._vectors4)a.setVector4(e,this._vectors4[e]);for(e in this._quaternions)a.setQuaternion(e,this._quaternions[e]);for(e in this._matrices)a.setMatrix(e,this._matrices[e]);for(e in this._matrixArrays)a.setMatrices(e,this._matrixArrays[e]);for(e in this._matrices3x3)a.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)a.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)a.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)a.setArray3(e,this._vectors3Arrays[e]);for(e in this._vectors4Arrays)a.setArray4(e,this._vectors4Arrays[e]);for(e in this._quaternionsArrays)a.setArray4(e,this._quaternionsArrays[e]);for(e in this._uniformBuffers){const t=this._uniformBuffers[e].getBuffer();t&&a.bindUniformBuffer(t,e)}for(e in this._textureSamplers)a.setTextureSampler(e,this._textureSamplers[e]);for(e in this._storageBuffers)a.setStorageBuffer(e,this._storageBuffers[e])}if(a&&t&&(l||!this.isFrozen)){const e=t.morphTargetManager;e&&e.numInfluencers>0&&w.G.BindMorphTargetParameters(t,a);const s=t.bakedVertexAnimationManager;s&&s.isEnabled&&(null===(r=t.bakedVertexAnimationManager)||void 0===r||r.bind(a,!!a._wasPreviouslyUsingInstances))}this._afterBind(t,a)}getActiveTextures(){const e=super.getActiveTextures();for(const t in this._textures)e.push(this._textures[t]);for(const t in this._textureArrays){const s=this._textureArrays[t];for(let t=0;t<s.length;t++)e.push(s[t])}return e}hasTexture(e){if(super.hasTexture(e))return!0;for(const t in this._textures)if(this._textures[t]===e)return!0;for(const t in this._textureArrays){const s=this._textureArrays[t];for(let t=0;t<s.length;t++)if(s[t]===e)return!0}return!1}clone(e){const t=B.p4.Clone((()=>new K(e,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);t.name=e,t.id=e,"object"==typeof t._shaderPath&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((e=>{const t=this._options[e];Array.isArray(t)&&(this._options[e]=t.slice(0))})),this.stencil.copyTo(t.stencil);for(const e in this._textures)t.setTexture(e,this._textures[e]);for(const e in this._textureArrays)t.setTextureArray(e,this._textureArrays[e]);for(const e in this._externalTextures)t.setExternalTexture(e,this._externalTextures[e]);for(const e in this._ints)t.setInt(e,this._ints[e]);for(const e in this._uints)t.setUInt(e,this._uints[e]);for(const e in this._floats)t.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)t.setFloats(e,this._floatsArrays[e]);for(const e in this._colors3)t.setColor3(e,this._colors3[e]);for(const e in this._colors3Arrays)t._colors3Arrays[e]=this._colors3Arrays[e];for(const e in this._colors4)t.setColor4(e,this._colors4[e]);for(const e in this._colors4Arrays)t._colors4Arrays[e]=this._colors4Arrays[e];for(const e in this._vectors2)t.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)t.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)t.setVector4(e,this._vectors4[e]);for(const e in this._quaternions)t.setQuaternion(e,this._quaternions[e]);for(const e in this._quaternionsArrays)t._quaternionsArrays[e]=this._quaternionsArrays[e];for(const e in this._matrices)t.setMatrix(e,this._matrices[e]);for(const e in this._matrixArrays)t._matrixArrays[e]=this._matrixArrays[e].slice();for(const e in this._matrices3x3)t.setMatrix3x3(e,this._matrices3x3[e]);for(const e in this._matrices2x2)t.setMatrix2x2(e,this._matrices2x2[e]);for(const e in this._vectors2Arrays)t.setArray2(e,this._vectors2Arrays[e]);for(const e in this._vectors3Arrays)t.setArray3(e,this._vectors3Arrays[e]);for(const e in this._vectors4Arrays)t.setArray4(e,this._vectors4Arrays[e]);for(const e in this._uniformBuffers)t.setUniformBuffer(e,this._uniformBuffers[e]);for(const e in this._textureSamplers)t.setTextureSampler(e,this._textureSamplers[e]);for(const e in this._storageBuffers)t.setStorageBuffer(e,this._storageBuffers[e]);return t}dispose(e,t,s){if(t){let e;for(e in this._textures)this._textures[e].dispose();for(e in this._textureArrays){const t=this._textureArrays[e];for(let e=0;e<t.length;e++)t[e].dispose()}}this._textures={},super.dispose(e,t,s)}serialize(){const e=B.p4.Serialize(this);let t;for(t in e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];const s=this._textureArrays[t];for(let i=0;i<s.length;i++)e.textureArrays[t].push(s[i].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.FloatArrays={},this._floatsArrays)e.FloatArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(e,t,s){const r=B.p4.Parse((()=>new K(e.name,t,e.shaderPath,e.options,e.storeEffectOnSubMeshes)),e,t,s);let n;for(n in e.stencil&&r.stencil.parse(e.stencil,t,s),e.textures)r.setTexture(n,F.x.Parse(e.textures[n],t,s));for(n in e.textureArrays){const i=e.textureArrays[n],a=new Array;for(let e=0;e<i.length;e++)a.push(F.x.Parse(i[e],t,s));r.setTextureArray(n,a)}for(n in e.ints)r.setInt(n,e.ints[n]);for(n in e.uints)r.setUInt(n,e.uints[n]);for(n in e.floats)r.setFloat(n,e.floats[n]);for(n in e.floatsArrays)r.setFloats(n,e.floatsArrays[n]);for(n in e.colors3)r.setColor3(n,u.Wo.FromArray(e.colors3[n]));for(n in e.colors3Arrays){const t=e.colors3Arrays[n].reduce(((e,t,s)=>(s%3==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>u.Wo.FromArray(e)));r.setColor3Array(n,t)}for(n in e.colors4)r.setColor4(n,u.HE.FromArray(e.colors4[n]));for(n in e.colors4Arrays){const t=e.colors4Arrays[n].reduce(((e,t,s)=>(s%4==0?e.push([t]):e[e.length-1].push(t),e)),[]).map((e=>u.HE.FromArray(e)));r.setColor4Array(n,t)}for(n in e.vectors2)r.setVector2(n,i.FM.FromArray(e.vectors2[n]));for(n in e.vectors3)r.setVector3(n,i.P.FromArray(e.vectors3[n]));for(n in e.vectors4)r.setVector4(n,i.Lt.FromArray(e.vectors4[n]));for(n in e.quaternions)r.setQuaternion(n,i._f.FromArray(e.quaternions[n]));for(n in e.matrices)r.setMatrix(n,i.y3.FromArray(e.matrices[n]));for(n in e.matrixArray)r._matrixArrays[n]=new Float32Array(e.matrixArray[n]);for(n in e.matrices3x3)r.setMatrix3x3(n,e.matrices3x3[n]);for(n in e.matrices2x2)r.setMatrix2x2(n,e.matrices2x2[n]);for(n in e.vectors2Arrays)r.setArray2(n,e.vectors2Arrays[n]);for(n in e.vectors3Arrays)r.setArray3(n,e.vectors3Arrays[n]);for(n in e.vectors4Arrays)r.setArray4(n,e.vectors4Arrays[n]);for(n in e.quaternionsArrays)r.setArray4(n,e.quaternionsArrays[n]);return r}static ParseFromFileAsync(e,t,s,i=""){return new Promise(((r,n)=>{const a=new N.g;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const t=JSON.parse(a.responseText),n=this.Parse(t,s||W.l.LastCreatedScene,i);e&&(n.name=e),r(n)}else n("Unable to load the ShaderMaterial")})),a.open("GET",t),a.send()}))}static ParseFromSnippetAsync(e,t,s=""){return new Promise(((i,r)=>{const n=new N.g;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const r=JSON.parse(JSON.parse(n.responseText).jsonPayload),a=JSON.parse(r.shaderMaterial),o=this.Parse(a,t||W.l.LastCreatedScene,s);o.snippetId=e,i(o)}else r("Unable to load the snippet "+e)})),n.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),n.send()}))}}K.SnippetUrl="https://snippet.babylonjs.com",K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,V.H)("BABYLON.ShaderMaterial",K);var j=s(1206);s(1919),s(6260);j.v.ShadersStore.colorPixelShader="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\n#define VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}",s(1003),s(9378),s(9310),s(7449),s(5532),s(4869),s(366),s(1275),s(7612);j.v.ShadersStore.colorVertexShader="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}",r.Kj._LinesMeshParser=(e,t)=>G.Parse(e,t);class G extends r.Kj{_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}constructor(e,t=null,s=null,i=null,r,a,o,h){super(e,t,s,i,r),this.useVertexColor=a,this.useVertexAlpha=o,this.color=new u.Wo(1,1,1),this.alpha=1,i&&(this.color=i.color.clone(),this.alpha=i.alpha,this.useVertexColor=i.useVertexColor,this.useVertexAlpha=i.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[n.o.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};!1===o?l.needAlphaBlending=!1:l.defines.push("#define VERTEXALPHA"),a?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(n.o.ColorKind)):(l.uniforms.push("color"),this._color4=new u.HE),h?this.material=h:(this.material=new K("colorShader",this.getScene(),"color",l,!1),this.material.doNotSerialize=!0)}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=R.F.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;const s=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._userInstancedBuffersStorage?this._geometry._bind(t,s,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(t,s),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:e,g:t,b:s}=this.color;this._color4.set(e,t,s,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const i=this.getScene().getEngine();return this._unIndexed?i.drawArraysType(R.F.LineListDrawMode,e.verticesStart,e.verticesCount,s):i.drawElementsType(R.F.LineListDrawMode,e.indexStart,e.indexCount,s),this}dispose(e,t=!1,s){s||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e,t=null,s){return new G(e,this.getScene(),t,this,s)}createInstance(e){const t=new H(e,this);if(this.instancedBuffers){t.instancedBuffers={};for(const e in this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e]}return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){const s=new G(e.name,t);return s.color=u.Wo.FromArray(e.color),s.alpha=e.alpha,s}}class H extends E{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}function q(e){const t=[],s=[],i=e.lines,r=e.colors,n=[];let o=0;for(let e=0;e<i.length;e++){const a=i[e];for(let i=0;i<a.length;i++){if(s.push(a[i].x,a[i].y,a[i].z),r){const t=r[e];n.push(t[i].r,t[i].g,t[i].b,t[i].a)}i>0&&(t.push(o-1),t.push(o)),o++}}const h=new a.x;return h.indices=t,h.positions=s,r&&(h.colors=n),h}function Y(e){const t=e.dashSize||3,s=e.gapSize||1,r=e.dashNb||200,n=e.points,o=new Array,h=new Array,l=i.P.Zero();let c=0,d=0,u=0,f=0,_=0,p=0,g=0;for(g=0;g<n.length-1;g++)n[g+1].subtractToRef(n[g],l),c+=l.length();for(u=c/r,f=t*u/(t+s),g=0;g<n.length-1;g++){n[g+1].subtractToRef(n[g],l),d=Math.floor(l.length()/u),l.normalize();for(let e=0;e<d;e++)_=u*e,o.push(n[g].x+_*l.x,n[g].y+_*l.y,n[g].z+_*l.z),o.push(n[g].x+(_+f)*l.x,n[g].y+(_+f)*l.y,n[g].z+(_+f)*l.z),h.push(p,p+1),p+=2}const m=new a.x;return m.positions=o,m.indices=h,m}function Z(e,t,s){const i=t.instance,r=t.lines,a=t.colors;if(i){const e=i.getVerticesData(n.o.PositionKind);let t,s;a&&(t=i.getVerticesData(n.o.ColorKind));let o=0,h=0;for(let i=0;i<r.length;i++){const n=r[i];for(let r=0;r<n.length;r++)e[o]=n[r].x,e[o+1]=n[r].y,e[o+2]=n[r].z,a&&t&&(s=a[i],t[h]=s[r].r,t[h+1]=s[r].g,t[h+2]=s[r].b,t[h+3]=s[r].a,h+=4),o+=3}return i.updateVerticesData(n.o.PositionKind,e,!1,!1),a&&t&&i.updateVerticesData(n.o.ColorKind,t,!1,!1),i}const o=new G(e,s,null,void 0,void 0,!!a,t.useVertexAlpha,t.material);return q(t).applyToMesh(o,t.updatable),o}function X(e,t,s=null){const i=t.colors?[t.colors]:null;return Z(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:i,useVertexAlpha:t.useVertexAlpha,material:t.material},s)}function Q(e,t,s=null){const n=t.points,a=t.instance,o=t.gapSize||1,h=t.dashSize||3;if(a){const e=e=>{const t=i.P.Zero(),s=e.length/6;let r=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;for(u=0;u<n.length-1;u++)n[u+1].subtractToRef(n[u],t),r+=t.length();h=r/s;const _=a._creationDataStorage.dashSize;for(l=_*h/(_+a._creationDataStorage.gapSize),u=0;u<n.length-1;u++)for(n[u+1].subtractToRef(n[u],t),o=Math.floor(t.length()/h),t.normalize(),f=0;f<o&&d<e.length;)c=h*f,e[d]=n[u].x+c*t.x,e[d+1]=n[u].y+c*t.y,e[d+2]=n[u].z+c*t.z,e[d+3]=n[u].x+(c+l)*t.x,e[d+4]=n[u].y+(c+l)*t.y,e[d+5]=n[u].z+(c+l)*t.z,d+=6,f++;for(;d<e.length;)e[d]=n[u].x,e[d+1]=n[u].y,e[d+2]=n[u].z,d+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&P.Y.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(e,!1),a}const l=new G(e,s,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return Y(t).applyToMesh(l,t.updatable),l._creationDataStorage=new r.gW,l._creationDataStorage.dashSize=h,l._creationDataStorage.gapSize=o,l}a.x.CreateLineSystem=q,a.x.CreateDashedLines=Y,r.Kj.CreateLines=(e,t,s=null,i=!1,r=null)=>X(e,{points:t,updatable:i,instance:r},s),r.Kj.CreateDashedLines=(e,t,s,i,r,n=null,a,o)=>Q(e,{points:t,dashSize:s,gapSize:i,dashNb:r,updatable:a,instance:o},n);var $=s(3118),J=s(4551);class ee extends i.FM{constructor(e,t){super(e.x,e.y),this.index=t}}class te{constructor(){this.elements=new Array}add(e){const t=new Array;return e.forEach((e=>{const s=new ee(e,this.elements.length);t.push(s),this.elements.push(s)})),t}computeBounds(){const e=new i.FM(this.elements[0].x,this.elements[0].y),t=new i.FM(this.elements[0].x,this.elements[0].y);return this.elements.forEach((s=>{s.x<e.x?e.x=s.x:s.x>t.x&&(t.x=s.x),s.y<e.y?e.y=s.y:s.y>t.y&&(t.y=s.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class se{_addToepoint(e){for(const t of e)this._epoints.push(t.x,t.y)}constructor(e,t,s,i=earcut){let r;this._points=new te,this._outlinepoints=new te,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=e,this._scene=s||W.l.LastCreatedScene,r=t instanceof $.ZZ?t.getPoints():t,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),void 0===this.bjsEarcut&&P.Y.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);const t=new te;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(e=!1,t=0,s=2){const i=new r.Kj(this._name,this._scene),a=this.buildVertexData(t,s);return i.setVerticesData(n.o.PositionKind,a.positions,e),i.setVerticesData(n.o.NormalKind,a.normals,e),i.setVerticesData(n.o.UVKind,a.uvs,e),i.setIndices(a.indices),i}buildVertexData(e=0,t=2){const s=new a.x,i=new Array,r=new Array,n=new Array,o=this._points.computeBounds();this._points.elements.forEach((e=>{i.push(0,1,0),r.push(e.x,0,e.y),n.push((e.x-o.min.x)/o.width,(e.y-o.min.y)/o.height)}));const h=new Array,l=this.bjsEarcut(this._epoints,this._eholes,2);for(let e=0;e<l.length;e++)h.push(l[e]);if(e>0){const s=r.length/3;this._points.elements.forEach((t=>{i.push(0,-1,0),r.push(t.x,-e,t.y),n.push(1-(t.x-o.min.x)/o.width,1-(t.y-o.min.y)/o.height)}));const a=h.length;for(let e=0;e<a;e+=3){const t=h[e+0],i=h[e+1],r=h[e+2];h.push(r+s),h.push(i+s),h.push(t+s)}this._addSide(r,i,n,h,o,this._outlinepoints,e,!1,t),this._holes.forEach((s=>{this._addSide(r,i,n,h,o,s,e,!0,t)}))}return s.indices=h,s.positions=r,s.normals=i,s.uvs=n,s}_addSide(e,t,s,r,n,a,o,h,l){let c=e.length/3,d=0;for(let u=0;u<a.elements.length;u++){const f=a.elements[u],_=a.elements[(u+1)%a.elements.length];e.push(f.x,0,f.y),e.push(f.x,-o,f.y),e.push(_.x,0,_.y),e.push(_.x,-o,_.y);const p=a.elements[(u+a.elements.length-1)%a.elements.length],g=a.elements[(u+2)%a.elements.length];let m=new i.P(-(_.y-f.y),0,_.x-f.x),x=new i.P(-(f.y-p.y),0,f.x-p.x),M=new i.P(-(g.y-_.y),0,g.x-_.x);h||(m=m.scale(-1),x=x.scale(-1),M=M.scale(-1));const y=m.normalizeToNew();let b=x.normalizeToNew(),A=M.normalizeToNew();const I=i.P.Dot(b,y);b=I>l?I<J.kn-1?new i.P(f.x,0,f.y).subtract(new i.P(_.x,0,_.y)).normalize():x.add(m).normalize():y;const v=i.P.Dot(M,m);A=v>l?v<J.kn-1?new i.P(_.x,0,_.y).subtract(new i.P(f.x,0,f.y)).normalize():M.add(m).normalize():y,s.push(d/n.width,0),s.push(d/n.width,1),d+=m.length(),s.push(d/n.width,0),s.push(d/n.width,1),t.push(b.x,b.y,b.z),t.push(b.x,b.y,b.z),t.push(A.x,A.y,A.z),t.push(A.x,A.y,A.z),h?(r.push(c),r.push(c+2),r.push(c+1),r.push(c+1),r.push(c+2),r.push(c+3)):(r.push(c),r.push(c+1),r.push(c+2),r.push(c+1),r.push(c+3),r.push(c+2)),c+=4}}}function ie(e,t,s,r,h,l,c){const d=s||new Array(3),f=r,_=[],p=c||!1;for(let e=0;e<3;e++)void 0===d[e]&&(d[e]=new i.Lt(0,0,1,1)),f&&void 0===f[e]&&(f[e]=new u.HE(1,1,1,1));const g=e.getVerticesData(n.o.PositionKind),m=e.getVerticesData(n.o.NormalKind),x=e.getVerticesData(n.o.UVKind),M=e.getIndices(),y=g.length/9;let b=0,A=0,I=0,v=0,D=0;const S=[0];if(p)for(let e=y;e<g.length/3;e+=4)A=g[3*(e+2)]-g[3*e],I=g[3*(e+2)+2]-g[3*e+2],v=Math.sqrt(A*A+I*I),D+=v,S.push(D);let P=0,T=0;for(let e=0;e<m.length;e+=3)Math.abs(m[e+1])<.001&&(T=1),Math.abs(m[e+1]-1)<.001&&(T=0),Math.abs(m[e+1]+1)<.001&&(T=2),P=e/3,1===T?(b=P-y,x[2*P]=b%4<1.5?p?d[T].x+(d[T].z-d[T].x)*S[Math.floor(b/4)]/D:d[T].x:p?d[T].x+(d[T].z-d[T].x)*S[Math.floor(b/4)+1]/D:d[T].z,x[2*P+1]=b%2==0?o.e.UseOpenGLOrientationForUV?1-d[T].w:d[T].w:o.e.UseOpenGLOrientationForUV?1-d[T].y:d[T].y):(x[2*P]=(1-x[2*P])*d[T].x+x[2*P]*d[T].z,x[2*P+1]=(1-x[2*P+1])*d[T].y+x[2*P+1]*d[T].w,o.e.UseOpenGLOrientationForUV&&(x[2*P+1]=1-x[2*P+1])),f&&_.push(f[T].r,f[T].g,f[T].b,f[T].a);a.x._ComputeSides(t,g,M,m,x,h,l);const O=new a.x;if(O.indices=M,O.positions=g,O.normals=m,O.uvs=x,f){const e=t===a.x.DOUBLESIDE?_.concat(_):_;O.colors=e}return O}function re(e,t,s=null,n=earcut){t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation);const a=t.shape,o=t.holes||[],h=t.depth||0,l=t.smoothingThreshold||2,c=[];let d=[];for(let e=0;e<a.length;e++)c[e]=new i.FM(a[e].x,a[e].z);c[0].equalsWithEpsilon(c[c.length-1],1e-8)&&c.pop();const u=new se(e,c,s||W.l.LastCreatedScene,n);for(let e=0;e<o.length;e++){d=[];for(let t=0;t<o[e].length;t++)d.push(new i.FM(o[e][t].x,o[e][t].z));u.addHole(d)}const f=u.build(!1,h,l);return f._originalBuilderSideOrientation=t.sideOrientation,ie(f,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(f,t.updatable),f}function ne(e,t,s=null,i=earcut){return re(e,t,s,i)}function ae(e,t,s=null){const i=t.path,n=t.shape,a=t.scale||1,o=t.rotation||0,h=0===t.cap?0:t.cap||r.Kj.NO_CAP,l=t.updatable,c=r.Kj._GetDefaultSideOrientation(t.sideOrientation),d=t.instance||null,u=t.invertUV||!1,f=t.closeShape||!1;return he(e,n,i,a,o,null,null,t.closePath||!1,f,h,!1,s,!!l,c,d,u,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function oe(e,t,s=null){const i=t.path,n=t.shape,a=t.scaleFunction||(()=>1),o=t.rotationFunction||(()=>0),h=t.closePath||t.ribbonCloseArray||!1,l=t.closeShape||t.ribbonClosePath||!1,c=0===t.cap?0:t.cap||r.Kj.NO_CAP,d=t.updatable,u=t.firstNormal||null,f=t.adjustFrame||!1;return he(e,n,i,null,null,a,o,h,l,c,!0,s,!!d,r.Kj._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,u,f)}function he(e,t,s,n,a,o,h,c,d,u,f,_,p,g,m,x,M,y,b,A){const I=(e,t,s,n,a,o,h,l,c,d,u)=>{const f=s.getTangents(),_=s.getNormals(),p=s.getBinormals(),g=s.getDistances();if(u)for(let e=0;e<f.length;e++)if(0==f[e].x&&0==f[e].y&&0==f[e].z&&f[e].copyFrom(f[e-1]),0==_[e].x&&0==_[e].y&&0==_[e].z&&_[e].copyFrom(_[e-1]),0==p[e].x&&0==p[e].y&&0==p[e].z&&p[e].copyFrom(p[e-1]),e>0){let t=f[e-1];i.P.Dot(t,f[e])<0&&f[e].scaleInPlace(-1),t=_[e-1],i.P.Dot(t,_[e])<0&&_[e].scaleInPlace(-1),t=p[e-1],i.P.Dot(t,p[e])<0&&p[e].scaleInPlace(-1)}let m=0;const x=d&&l?l:()=>null!==o?o:0,M=d&&h?h:()=>null!==a?a:1;let y=c===r.Kj.NO_CAP||c===r.Kj.CAP_END?0:2;const b=i.jp.Matrix[0];for(let s=0;s<t.length;s++){const r=new Array,a=x(s,g[s]),o=M(s,g[s]);i.y3.RotationAxisToRef(f[s],m,b);for(let n=0;n<e.length;n++){const a=f[s].scale(e[n].z).add(_[s].scale(e[n].x)).add(p[s].scale(e[n].y)),h=i.P.Zero();i.P.TransformCoordinatesToRef(a,b,h),h.scaleInPlace(o).addInPlace(t[s]),r[n]=h}n[y]=r,m+=a,y++}const A=e=>{const t=Array(),s=i.P.Zero();let r;for(r=0;r<e.length;r++)s.addInPlace(e[r]);for(s.scaleInPlace(1/e.length),r=0;r<e.length;r++)t.push(s);return t};switch(c){case r.Kj.NO_CAP:break;case r.Kj.CAP_START:n[0]=A(n[2]),n[1]=n[2];break;case r.Kj.CAP_END:n[y]=n[y-1],n[y+1]=A(n[y-1]);break;case r.Kj.CAP_ALL:n[0]=A(n[2]),n[1]=n[2],n[y]=n[y-1],n[y+1]=A(n[y-1])}return n};let v,D;if(m){const e=m._creationDataStorage;return v=b?e.path3D.update(s,b):e.path3D.update(s),D=I(t,s,e.path3D,e.pathArray,n,a,o,h,e.cap,f,A),l("",{pathArray:D,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:m},_||void 0)}v=b?new $.$B(s,b):new $.$B(s),D=I(t,s,v,new Array,n,a,o,h,u=u<0||u>3?0:u,f,A);const S=l(e,{pathArray:D,closeArray:c,closePath:d,updatable:p,sideOrientation:g,invertUV:x,frontUVs:M||void 0,backUVs:y||void 0},_);return S._creationDataStorage.pathArray=D,S._creationDataStorage.path3D=v,S._creationDataStorage.cap=u,S}function le(e,t,s=null){const n=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,a=void 0===t.closed||t.closed,o=t.shape,h=t.radius||1,c=t.tessellation||64,d=t.clip||0,u=t.updatable,f=r.Kj._GetDefaultSideOrientation(t.sideOrientation),_=t.cap||r.Kj.NO_CAP,p=2*Math.PI,g=new Array,m=t.invertUV||!1;let x=0,M=0;const y=p/c*n;let b,A;for(x=0;x<=c-d;x++){for(A=[],_!=r.Kj.CAP_START&&_!=r.Kj.CAP_ALL||(A.push(new i.P(0,o[0].y,0)),A.push(new i.P(Math.cos(x*y)*o[0].x*h,o[0].y,Math.sin(x*y)*o[0].x*h))),M=0;M<o.length;M++)b=new i.P(Math.cos(x*y)*o[M].x*h,o[M].y,Math.sin(x*y)*o[M].x*h),A.push(b);_!=r.Kj.CAP_END&&_!=r.Kj.CAP_ALL||(A.push(new i.P(Math.cos(x*y)*o[o.length-1].x*h,o[o.length-1].y,Math.sin(x*y)*o[o.length-1].x*h)),A.push(new i.P(0,o[o.length-1].y,0))),g.push(A)}return l(e,{pathArray:g,closeArray:a,sideOrientation:f,updatable:u,invertUV:m,frontUVs:t.frontUVs,backUVs:t.backUVs},s)}function ce(e){const t=[],s=[],i=[],r=[],n=e.width||e.size||1,h=e.height||e.size||1,l=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,c=n/2,d=h/2;s.push(-c,-d,0),i.push(0,0,-1),r.push(0,o.e.UseOpenGLOrientationForUV?1:0),s.push(c,-d,0),i.push(0,0,-1),r.push(1,o.e.UseOpenGLOrientationForUV?1:0),s.push(c,d,0),i.push(0,0,-1),r.push(1,o.e.UseOpenGLOrientationForUV?0:1),s.push(-c,d,0),i.push(0,0,-1),r.push(0,o.e.UseOpenGLOrientationForUV?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),a.x._ComputeSides(l,s,t,i,r,e.frontUVs,e.backUVs);const u=new a.x;return u.indices=t,u.positions=s,u.normals=i,u.uvs=r,u}function de(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,ce(t).applyToMesh(i,t.updatable),t.sourcePlane&&(i.translate(t.sourcePlane.normal,-t.sourcePlane.d),i.setDirection(t.sourcePlane.normal.scale(-1))),i}a.x.CreatePolygon=ie,r.Kj.CreatePolygon=(e,t,s,i,r,n,a=earcut)=>re(e,{shape:t,holes:i,updatable:r,sideOrientation:n},s,a),r.Kj.ExtrudePolygon=(e,t,s,i,r,n,a,o=earcut)=>ne(e,{shape:t,holes:r,depth:s,updatable:n,sideOrientation:a},i,o),r.Kj.ExtrudeShape=(e,t,s,i,n,a,o=null,h,l,c)=>ae(e,{shape:t,path:s,scale:i,rotation:n,cap:0===a?0:a||r.Kj.NO_CAP,sideOrientation:l,instance:c,updatable:h},o),r.Kj.ExtrudeShapeCustom=(e,t,s,i,n,a,o,h,l,c,d,u)=>oe(e,{shape:t,path:s,scaleFunction:i,rotationFunction:n,ribbonCloseArray:a,ribbonClosePath:o,cap:0===h?0:h||r.Kj.NO_CAP,sideOrientation:d,instance:u,updatable:c},l),r.Kj.CreateLathe=(e,t,s,i,r,n,a)=>le(e,{shape:t,radius:s,tessellation:i,sideOrientation:a,updatable:n},r),a.x.CreatePlane=ce,r.Kj.CreatePlane=(e,t,s,i,r)=>de(e,{size:t,width:t,height:t,sideOrientation:r,updatable:i},s),r.Kj._GroundMeshParser=(e,t)=>ue.Parse(e,t);class ue extends r.Kj{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){const s=this.getWorldMatrix(),r=i.jp.Matrix[5];s.invertToRef(r);const n=i.jp.Vector3[8];if(i.P.TransformCoordinatesFromFloatsToRef(e,0,t,r,n),e=n.x,t=n.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(e,t),o=-(a.x*e+a.z*t+a.w)/a.y;return i.P.TransformCoordinatesFromFloatsToRef(0,o,0,s,n),n.y}getNormalAtCoordinates(e,t){const s=new i.P(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,s),s}getNormalAtCoordinatesToRef(e,t,s){const r=this.getWorldMatrix(),n=i.jp.Matrix[5];r.invertToRef(n);const a=i.jp.Vector3[8];if(i.P.TransformCoordinatesFromFloatsToRef(e,0,t,n,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(e,t);return i.P.TransformNormalFromFloatsToRef(o.x,o.y,o.z,r,s),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){const s=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[i*this._subdivisionsX+s];let n;return n=t<r.slope.x*e+r.slope.y?r.facet1:r.facet2,n}_initHeightQuads(){const e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let s=0;s<t;s++)for(let t=0;t<e;t++){const r={slope:i.FM.Zero(),facet1:new i.Lt(0,0,0,0),facet2:new i.Lt(0,0,0,0)};this._heightQuads[s*e+t]=r}return this}_computeHeightQuads(){const e=this.getVerticesData(n.o.PositionKind);if(!e)return this;const t=i.jp.Vector3[3],s=i.jp.Vector3[2],r=i.jp.Vector3[1],a=i.jp.Vector3[0],o=i.jp.Vector3[4],h=i.jp.Vector3[5],l=i.jp.Vector3[6],c=i.jp.Vector3[7],d=i.jp.Vector3[8];let u=0,f=0,_=0,p=0,g=0,m=0,x=0;const M=this._subdivisionsX,y=this._subdivisionsY;for(let n=0;n<y;n++)for(let y=0;y<M;y++){u=3*y,f=n*(M+1)*3,_=(n+1)*(M+1)*3,t.x=e[f+u],t.y=e[f+u+1],t.z=e[f+u+2],s.x=e[f+u+3],s.y=e[f+u+4],s.z=e[f+u+5],r.x=e[_+u],r.y=e[_+u+1],r.z=e[_+u+2],a.x=e[_+u+3],a.y=e[_+u+4],a.z=e[_+u+5],p=(a.z-t.z)/(a.x-t.x),g=t.z-p*t.x,s.subtractToRef(t,o),r.subtractToRef(t,h),a.subtractToRef(t,l),i.P.CrossToRef(l,h,c),i.P.CrossToRef(o,l,d),c.normalize(),d.normalize(),m=-(c.x*t.x+c.y*t.y+c.z*t.z),x=-(d.x*s.x+d.y*s.y+d.z*s.z);const b=this._heightQuads[n*M+y];b.slope.copyFromFloats(p,g),b.facet1.copyFromFloats(c.x,c.y,c.z,m),b.facet2.copyFromFloats(d.x,d.y,d.z,x)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){const s=new ue(e.name,t);return s._subdivisionsX=e.subdivisionsX||1,s._subdivisionsY=e.subdivisionsY||1,s._minX=e.minX,s._maxX=e.maxX,s._minZ=e.minZ,s._maxZ=e.maxZ,s._width=e.width,s._height=e.height,s}}var fe=s(8658);function _e(e){const t=[],s=[],r=[],n=[];let h,l;const c=e.width||1,d=e.height||1,u=e.subdivisionsX||e.subdivisions||1,f=e.subdivisionsY||e.subdivisions||1;for(h=0;h<=f;h++)for(l=0;l<=u;l++){const e=new i.P(l*c/u-c/2,0,(f-h)*d/f-d/2),t=new i.P(0,1,0);s.push(e.x,e.y,e.z),r.push(t.x,t.y,t.z),n.push(l/u,o.e.UseOpenGLOrientationForUV?h/f:1-h/f)}for(h=0;h<f;h++)for(l=0;l<u;l++)t.push(l+1+(h+1)*(u+1)),t.push(l+1+h*(u+1)),t.push(l+h*(u+1)),t.push(l+(h+1)*(u+1)),t.push(l+1+(h+1)*(u+1)),t.push(l+h*(u+1));const _=new a.x;return _.indices=t,_.positions=s,_.normals=r,_.uvs=n,_}function pe(e){const t=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,s=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,r=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,n=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,o=e.subdivisions||{w:1,h:1},h=e.precision||{w:1,h:1},l=new Array,c=new Array,d=new Array,u=new Array;let f,_,p,g;o.h=o.h<1?1:o.h,o.w=o.w<1?1:o.w,h.w=h.w<1?1:h.w,h.h=h.h<1?1:h.h;const m=(r-t)/o.w,x=(n-s)/o.h;function M(e,t,s,r){const n=c.length/3,a=h.w+1;for(f=0;f<h.h;f++)for(_=0;_<h.w;_++){const e=[n+_+f*a,n+(_+1)+f*a,n+(_+1)+(f+1)*a,n+_+(f+1)*a];l.push(e[1]),l.push(e[2]),l.push(e[3]),l.push(e[0]),l.push(e[1]),l.push(e[3])}const o=i.P.Zero(),p=new i.P(0,1,0);for(f=0;f<=h.h;f++)for(o.z=f*(r-t)/h.h+t,_=0;_<=h.w;_++)o.x=_*(s-e)/h.w+e,o.y=0,c.push(o.x,o.y,o.z),d.push(p.x,p.y,p.z),u.push(_/h.w,f/h.h)}for(p=0;p<o.h;p++)for(g=0;g<o.w;g++)M(t+g*m,s+p*x,t+(g+1)*m,s+(p+1)*x);const y=new a.x;return y.indices=l,y.positions=c,y.normals=d,y.uvs=u,y}function ge(e){const t=[],s=[],r=[],n=[];let o,h;const l=e.colorFilter||new u.Wo(.3,.59,.11),c=e.alphaFilter||0;let d=!1;if(e.minHeight>e.maxHeight){d=!0;const t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(o=0;o<=e.subdivisions;o++)for(h=0;h<=e.subdivisions;h++){const t=new i.P(h*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-o)*e.height/e.subdivisions-e.height/2),a=4*(((t.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(t.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let u=e.buffer[a]/255,f=e.buffer[a+1]/255,_=e.buffer[a+2]/255;const p=e.buffer[a+3]/255;d&&(u=1-u,f=1-f,_=1-_);const g=u*l.r+f*l.g+_*l.b;t.y=p>=c?e.minHeight+(e.maxHeight-e.minHeight)*g:e.minHeight-J.kn,s.push(t.x,t.y,t.z),r.push(0,0,0),n.push(h/e.subdivisions,1-o/e.subdivisions)}for(o=0;o<e.subdivisions;o++)for(h=0;h<e.subdivisions;h++){const i=h+1+(o+1)*(e.subdivisions+1),r=h+1+o*(e.subdivisions+1),n=h+o*(e.subdivisions+1),a=h+(o+1)*(e.subdivisions+1),l=s[3*i+1]>=e.minHeight,c=s[3*r+1]>=e.minHeight,d=s[3*n+1]>=e.minHeight;l&&c&&d&&(t.push(i),t.push(r),t.push(n)),s[3*a+1]>=e.minHeight&&l&&d&&(t.push(a),t.push(i),t.push(n))}a.x.ComputeNormals(s,t,r);const f=new a.x;return f.indices=t,f.positions=s,f.normals=r,f.uvs=n,f}function me(e,t={},s){const i=new ue(e,s);return i._setReady(!1),i._subdivisionsX=t.subdivisionsX||t.subdivisions||1,i._subdivisionsY=t.subdivisionsY||t.subdivisions||1,i._width=t.width||1,i._height=t.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,_e(t).applyToMesh(i,t.updatable),i._setReady(!0),i}function xe(e,t,s=null){const i=new r.Kj(e,s);return pe(t).applyToMesh(i,t.updatable),i}function Me(e,t,s={},i=null){const r=s.width||10,n=s.height||10,a=s.subdivisions||1,o=s.minHeight||0,h=s.maxHeight||1,l=s.colorFilter||new u.Wo(.3,.59,.11),c=s.alphaFilter||0,d=s.updatable,f=s.onReady;i=i||W.l.LastCreatedScene;const _=new ue(e,i);return _._subdivisionsX=a,_._subdivisionsY=a,_._width=r,_._height=n,_._maxX=_._width/2,_._maxZ=_._height/2,_._minX=-_._maxX,_._minZ=-_._maxZ,_._setReady(!1),fe.w1.LoadImage(t,(e=>{const t=e.width,s=e.height;if(i.isDisposed)return;const u=null==i?void 0:i.getEngine().resizeImageBitmap(e,t,s);ge({width:r,height:n,subdivisions:a,minHeight:o,maxHeight:h,colorFilter:l,buffer:u,bufferWidth:t,bufferHeight:s,alphaFilter:c}).applyToMesh(_,d),f&&f(_),_._setReady(!0)}),(()=>{}),i.offlineProvider),_}function ye(e,t,s=null){const n=t.path;let a=t.instance,o=1;void 0!==t.radius?o=t.radius:a&&(o=a._creationDataStorage.radius);const h=t.tessellation||64,c=t.radiusFunction||null;let d=t.cap||r.Kj.NO_CAP;const u=t.invertUV||!1,f=t.updatable,_=r.Kj._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const p=(e,t,s,n,a,o,h,l)=>{const c=t.getTangents(),d=t.getNormals(),u=t.getDistances(),f=2*Math.PI/a*l,_=o||(()=>n);let p,g,m,x;const M=i.jp.Matrix[0];let y=h===r.Kj.NO_CAP||h===r.Kj.CAP_END?0:2;for(let t=0;t<e.length;t++){g=_(t,u[t]),p=Array(),m=d[t];for(let s=0;s<a;s++)i.y3.RotationAxisToRef(c[t],f*s,M),x=p[s]?p[s]:i.P.Zero(),i.P.TransformCoordinatesToRef(m,M,x),x.scaleInPlace(g).addInPlace(e[t]),p[s]=x;s[y]=p,y++}const b=(t,s)=>{const i=Array();for(let r=0;r<t;r++)i.push(e[s]);return i};switch(h){case r.Kj.NO_CAP:break;case r.Kj.CAP_START:s[0]=b(a,0),s[1]=s[2].slice(0);break;case r.Kj.CAP_END:s[y]=s[y-1].slice(0),s[y+1]=b(a,e.length-1);break;case r.Kj.CAP_ALL:s[0]=b(a,0),s[1]=s[2].slice(0),s[y]=s[y-1].slice(0),s[y+1]=b(a,e.length-1)}return s};let g,m;if(a){const e=a._creationDataStorage,s=t.arc||e.arc;return g=e.path3D.update(n),m=p(n,g,e.pathArray,o,e.tessellation,c,e.cap,s),a=l("",{pathArray:m,instance:a}),e.path3D=g,e.pathArray=m,e.arc=s,e.radius=o,a}g=new $.$B(n),d=d<0||d>3?0:d,m=p(n,g,new Array,o,h,c,d,t.arc);const x=l(e,{pathArray:m,closePath:!0,closeArray:!1,updatable:f,sideOrientation:_,invertUV:u,frontUVs:t.frontUVs,backUVs:t.backUVs},s);return x._creationDataStorage.pathArray=m,x._creationDataStorage.path3D=g,x._creationDataStorage.tessellation=h,x._creationDataStorage.cap=d,x._creationDataStorage.arc=t.arc,x._creationDataStorage.radius=o,x}function be(e){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const s=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,r=e.size,n=e.sizeX||r||1,h=e.sizeY||r||1,l=e.sizeZ||r||1,c=e.custom||t[s],d=c.face.length,f=e.faceUV||new Array(d),_=e.faceColors,p=void 0===e.flat||e.flat,g=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,m=new Array,x=new Array,M=new Array,y=new Array,b=new Array;let A=0,I=0;const v=new Array;let D,S,P,T,O,C,E=0,R=0;if(p)for(R=0;R<d;R++)_&&void 0===_[R]&&(_[R]=new u.HE(1,1,1,1)),f&&void 0===f[R]&&(f[R]=new i.Lt(0,0,1,1));if(p)for(R=0;R<d;R++){const e=c.face[R].length;for(P=2*Math.PI/e,T=.5*Math.tan(P/2),O=.5,E=0;E<e;E++)m.push(c.vertex[c.face[R][E]][0]*n,c.vertex[c.face[R][E]][1]*h,c.vertex[c.face[R][E]][2]*l),v.push(A),A++,D=f[R].x+(f[R].z-f[R].x)*(.5+T),S=f[R].y+(f[R].w-f[R].y)*(O-.5),y.push(D,o.e.UseOpenGLOrientationForUV?1-S:S),C=T*Math.cos(P)-O*Math.sin(P),O=T*Math.sin(P)+O*Math.cos(P),T=C,_&&b.push(_[R].r,_[R].g,_[R].b,_[R].a);for(E=0;E<e-2;E++)x.push(v[0+I],v[E+2+I],v[E+1+I]);I+=e}else{for(E=0;E<c.vertex.length;E++)m.push(c.vertex[E][0]*n,c.vertex[E][1]*h,c.vertex[E][2]*l),y.push(0,o.e.UseOpenGLOrientationForUV?1:0);for(R=0;R<d;R++)for(E=0;E<c.face[R].length-2;E++)x.push(c.face[R][0],c.face[R][E+2],c.face[R][E+1])}a.x.ComputeNormals(m,x,M),a.x._ComputeSides(g,m,x,M,y,e.frontUVs,e.backUVs);const B=new a.x;return B.positions=m,B.indices=x,B.normals=M,B.uvs=y,_&&p&&(B.colors=b),B}function Ae(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,be(t).applyToMesh(i,t.updatable),i}function Ie(e){const t=e.sideOrientation||a.x.DEFAULTSIDE,s=e.radius||1,r=void 0===e.flat||e.flat,n=e.subdivisions||4,h=e.radiusX||s,l=e.radiusY||s,c=e.radiusZ||s,d=(1+Math.sqrt(5))/2,u=[-1,d,-0,1,d,0,-1,-d,0,1,-d,0,0,-1,-d,0,1,-d,0,-1,d,0,1,d,d,0,1,d,0,-1,-d,0,1,-d,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],_=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=new Array,x=new Array,M=new Array,y=new Array;let b=0;const A=new Array(3),I=new Array(3);let v;for(v=0;v<3;v++)A[v]=i.P.Zero(),I[v]=i.FM.Zero();for(let e=0;e<20;e++){for(v=0;v<3;v++){const t=f[3*e+v];A[v].copyFromFloats(u[3*_[t]],u[3*_[t]+1],u[3*_[t]+2]),A[v].normalize(),I[v].copyFromFloats(.134765625*p[2*t]+.05859375+-.0390625*g[e],.2333984375*p[2*t+1]+.025390625+.01953125*g[e])}const t=(e,t,s,a)=>{const d=i.P.Lerp(A[0],A[2],t/n),u=i.P.Lerp(A[1],A[2],t/n),f=n===t?A[2]:i.P.Lerp(d,u,e/(n-t));let _;if(f.normalize(),r){const e=i.P.Lerp(A[0],A[2],a/n),t=i.P.Lerp(A[1],A[2],a/n);_=i.P.Lerp(e,t,s/(n-a))}else _=new i.P(f.x,f.y,f.z);_.x/=h,_.y/=l,_.z/=c,_.normalize();const p=i.FM.Lerp(I[0],I[2],t/n),g=i.FM.Lerp(I[1],I[2],t/n),v=n===t?I[2]:i.FM.Lerp(p,g,e/(n-t));x.push(f.x*h,f.y*l,f.z*c),M.push(_.x,_.y,_.z),y.push(v.x,o.e.UseOpenGLOrientationForUV?1-v.y:v.y),m.push(b),b++};for(let e=0;e<n;e++)for(let s=0;s+e<n;s++)t(s,e,s+1/3,e+1/3),t(s+1,e,s+1/3,e+1/3),t(s,e+1,s+1/3,e+1/3),s+e+1<n&&(t(s+1,e,s+2/3,e+2/3),t(s+1,e+1,s+2/3,e+2/3),t(s,e+1,s+2/3,e+2/3))}a.x._ComputeSides(t,x,m,M,y,e.frontUVs,e.backUVs);const D=new a.x;return D.indices=m,D.positions=x,D.normals=M,D.uvs=y,D}function ve(e,t={},s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,Ie(t).applyToMesh(i,t.updatable),i}a.x.CreateGround=_e,a.x.CreateTiledGround=pe,a.x.CreateGroundFromHeightMap=ge,r.Kj.CreateGround=(e,t,s,i,r,n)=>me(e,{width:t,height:s,subdivisions:i,updatable:n},r),r.Kj.CreateTiledGround=(e,t,s,i,r,n,a,o,h)=>xe(e,{xmin:t,zmin:s,xmax:i,zmax:r,subdivisions:n,precision:a,updatable:h},o),r.Kj.CreateGroundFromHeightMap=(e,t,s,i,r,n,a,o,h,l,c)=>Me(e,t,{width:s,height:i,subdivisions:r,minHeight:n,maxHeight:a,updatable:h,onReady:l,alphaFilter:c},o),r.Kj.CreateTube=(e,t,s,i,r,n,a,o,h,l)=>ye(e,{path:t,radius:s,tessellation:i,radiusFunction:r,arc:1,cap:n,updatable:o,sideOrientation:h,instance:l},a),a.x.CreatePolyhedron=be,r.Kj.CreatePolyhedron=(e,t,s)=>Ae(e,t,s),a.x.CreateIcoSphere=Ie,r.Kj.CreateIcoSphere=(e,t,s)=>ve(e,t,s);var De=s(1226);const Se=new i.P(1,0,0),Pe=new i.P(-1,0,0),Te=new i.P(0,1,0),Oe=new i.P(0,-1,0),Ce=new i.P(0,0,1),Ee=new i.P(0,0,-1);class Re{constructor(e=i.P.Zero(),t=i.P.Up(),s=i.FM.Zero(),r=0,n=0,a=null,o=null,h=null,l=null){this.position=e,this.normal=t,this.uv=s,this.vertexIdx=r,this.vertexIdxForBones=n,this.localPositionOverride=a,this.localNormalOverride=o,this.matrixIndicesOverride=h,this.matrixWeightsOverride=l}clone(){var e,t,s,i;return new Re(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(e=this.localPositionOverride)||void 0===e?void 0:e.slice(),null===(t=this.localNormalOverride)||void 0===t?void 0:t.slice(),null===(s=this.matrixIndicesOverride)||void 0===s?void 0:s.slice(),null===(i=this.matrixWeightsOverride)||void 0===i?void 0:i.slice())}}function Be(e,t,s){const h=!!t.skeleton,l=s.localMode||h,c=null!==t.overrideMaterialSideOrientation&&void 0!==t.overrideMaterialSideOrientation,d=t.getIndices(),u=h?t.getPositionData(!0,!0):t.getVerticesData(n.o.PositionKind),f=h?t.getNormalsData(!0,!0):t.getVerticesData(n.o.NormalKind),_=l?h?t.getVerticesData(n.o.PositionKind):u:null,p=l?h?t.getVerticesData(n.o.NormalKind):f:null,g=t.getVerticesData(n.o.UVKind),m=h?t.getVerticesData(n.o.MatricesIndicesKind):null,x=h?t.getVerticesData(n.o.MatricesWeightsKind):null,M=h?t.getVerticesData(n.o.MatricesIndicesExtraKind):null,y=h?t.getVerticesData(n.o.MatricesWeightsExtraKind):null,b=s.position||i.P.Zero();let A=s.normal||i.P.Up();const I=s.size||i.P.One(),v=s.angle||0;if(!A){const e=new i.P(0,0,1),s=t.getScene().activeCamera,r=i.P.TransformCoordinates(e,s.getWorldMatrix());A=s.globalPosition.subtract(r)}const D=-Math.atan2(A.z,A.x)-Math.PI/2,S=Math.sqrt(A.x*A.x+A.z*A.z),P=Math.atan2(A.y,S),T=i.y3.RotationYawPitchRoll(D,P,v).multiply(i.y3.Translation(b.x,b.y,b.z)),O=i.y3.Invert(T),C=t.getWorldMatrix().multiply(O),E=new a.x;E.indices=[],E.positions=[],E.normals=[],E.uvs=[],E.matricesIndices=h?[]:null,E.matricesWeights=h?[]:null,E.matricesIndicesExtra=M?[]:null,E.matricesWeightsExtra=y?[]:null;let R=0;const B=e=>{const t=new Re;if(!d||!u||!f)return t;const r=d[e];if(t.vertexIdx=3*r,t.vertexIdxForBones=4*r,t.position=new i.P(u[3*r],u[3*r+1],u[3*r+2]),i.P.TransformCoordinatesToRef(t.position,C,t.position),t.normal=new i.P(f[3*r],f[3*r+1],f[3*r+2]),i.P.TransformNormalToRef(t.normal,C,t.normal),s.captureUVS&&g){const e=g[2*r+1];t.uv=new i.FM(g[2*r],o.e.UseOpenGLOrientationForUV?1-e:e)}return t},F=[0,0,0,0],w=(e,t)=>{if(0===e.length)return e;const s=.5*Math.abs(i.P.Dot(I,t)),r=(e,t,s,i)=>{for(let r=0;r<i;++r)if(e[s+r]===t)return s+r;return-1},n=(e,n)=>{var a,o,h,l,c,d,u,f,g,M,y,b,A,I,v,D;const S=i.P.GetClipFactor(e.position,n.position,t,s);let P=F,T=F;if(m&&x){const t=e.matrixIndicesOverride?0:e.vertexIdxForBones,s=null!==(a=e.matrixIndicesOverride)&&void 0!==a?a:m,i=null!==(o=e.matrixWeightsOverride)&&void 0!==o?o:x,c=n.matrixIndicesOverride?0:n.vertexIdxForBones,d=null!==(h=n.matrixIndicesOverride)&&void 0!==h?h:m,u=null!==(l=n.matrixWeightsOverride)&&void 0!==l?l:x;P=[0,0,0,0],T=[0,0,0,0];let f=0;for(let e=0;e<4;++e)if(i[t+e]>0){const n=r(d,s[t+e],c,4);P[f]=s[t+e],T[f]=De.R.Lerp(i[t+e],n>=0?u[n]:0,S),f++}for(let e=0;e<4&&f<4;++e){const i=d[c+e];-1===r(s,i,t,4)&&(P[f]=i,T[f]=De.R.Lerp(0,u[c+e],S),f++)}const _=T[0]+T[1]+T[2]+T[3];T[0]/=_,T[1]/=_,T[2]/=_,T[3]/=_}const O=e.localPositionOverride?e.localPositionOverride[0]:null!==(c=null==_?void 0:_[e.vertexIdx])&&void 0!==c?c:0,C=e.localPositionOverride?e.localPositionOverride[1]:null!==(d=null==_?void 0:_[e.vertexIdx+1])&&void 0!==d?d:0,E=e.localPositionOverride?e.localPositionOverride[2]:null!==(u=null==_?void 0:_[e.vertexIdx+2])&&void 0!==u?u:0,R=n.localPositionOverride?n.localPositionOverride[0]:null!==(f=null==_?void 0:_[n.vertexIdx])&&void 0!==f?f:0,B=n.localPositionOverride?n.localPositionOverride[1]:null!==(g=null==_?void 0:_[n.vertexIdx+1])&&void 0!==g?g:0,w=n.localPositionOverride?n.localPositionOverride[2]:null!==(M=null==_?void 0:_[n.vertexIdx+2])&&void 0!==M?M:0,V=e.localNormalOverride?e.localNormalOverride[0]:null!==(y=null==p?void 0:p[e.vertexIdx])&&void 0!==y?y:0,L=e.localNormalOverride?e.localNormalOverride[1]:null!==(b=null==p?void 0:p[e.vertexIdx+1])&&void 0!==b?b:0,N=e.localNormalOverride?e.localNormalOverride[2]:null!==(A=null==p?void 0:p[e.vertexIdx+2])&&void 0!==A?A:0,U=V+((n.localNormalOverride?n.localNormalOverride[0]:null!==(I=null==p?void 0:p[n.vertexIdx])&&void 0!==I?I:0)-V)*S,W=L+((n.localNormalOverride?n.localNormalOverride[1]:null!==(v=null==p?void 0:p[n.vertexIdx+1])&&void 0!==v?v:0)-L)*S,k=N+((n.localNormalOverride?n.localNormalOverride[2]:null!==(D=null==p?void 0:p[n.vertexIdx+2])&&void 0!==D?D:0)-N)*S,z=Math.sqrt(U*U+W*W+k*k);return new Re(i.P.Lerp(e.position,n.position,S),i.P.Lerp(e.normal,n.normal,S).normalize(),i.FM.Lerp(e.uv,n.uv,S),-1,-1,_?[O+(R-O)*S,C+(B-C)*S,E+(w-E)*S]:null,p?[U/z,W/z,k/z]:null,P,T)};let a=null;e.length>3&&(a=new Array);for(let r=0;r<e.length;r+=3){let o=0,h=null,l=null,c=null,d=null;const u=i.P.Dot(e[r].position,t)-s>0,f=i.P.Dot(e[r+1].position,t)-s>0,_=i.P.Dot(e[r+2].position,t)-s>0;switch(o=(u?1:0)+(f?1:0)+(_?1:0),o){case 0:e.length>3?(a.push(e[r]),a.push(e[r+1]),a.push(e[r+2])):a=e;break;case 1:if(a=null!=a?a:new Array,u&&(h=e[r+1],l=e[r+2],c=n(e[r],h),d=n(e[r],l)),f){h=e[r],l=e[r+2],c=n(e[r+1],h),d=n(e[r+1],l),a.push(c),a.push(l.clone()),a.push(h.clone()),a.push(l.clone()),a.push(c.clone()),a.push(d);break}_&&(h=e[r],l=e[r+1],c=n(e[r+2],h),d=n(e[r+2],l)),h&&l&&c&&d&&(a.push(h.clone()),a.push(l.clone()),a.push(c),a.push(d),a.push(c.clone()),a.push(l.clone()));break;case 2:a=null!=a?a:new Array,u||(h=e[r].clone(),l=n(h,e[r+1]),c=n(h,e[r+2]),a.push(h),a.push(l),a.push(c)),f||(h=e[r+1].clone(),l=n(h,e[r+2]),c=n(h,e[r]),a.push(h),a.push(l),a.push(c)),_||(h=e[r+2].clone(),l=n(h,e[r]),c=n(h,e[r+1]),a.push(h),a.push(l),a.push(c))}}return a},V=new Array(3);for(let e=0;e<d.length;e+=3){let t=V;if(t[0]=B(e),c&&l?(t[1]=B(e+2),t[2]=B(e+1)):(t[1]=B(e+1),t[2]=B(e+2)),!(s.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=w(t,Se),t&&(t=w(t,Pe),t&&(t=w(t,Te),t&&(t=w(t,Oe),t&&(t=w(t,Ce),t&&(t=w(t,Ee),t)))))))for(let e=0;e<t.length;e++){const i=t[e];if(E.indices.push(R),l?(i.localPositionOverride?(E.positions[3*R]=i.localPositionOverride[0],E.positions[3*R+1]=i.localPositionOverride[1],E.positions[3*R+2]=i.localPositionOverride[2]):_&&(E.positions[3*R]=_[i.vertexIdx],E.positions[3*R+1]=_[i.vertexIdx+1],E.positions[3*R+2]=_[i.vertexIdx+2]),i.localNormalOverride?(E.normals[3*R]=i.localNormalOverride[0],E.normals[3*R+1]=i.localNormalOverride[1],E.normals[3*R+2]=i.localNormalOverride[2]):p&&(E.normals[3*R]=p[i.vertexIdx],E.normals[3*R+1]=p[i.vertexIdx+1],E.normals[3*R+2]=p[i.vertexIdx+2])):(i.position.toArray(E.positions,3*R),i.normal.toArray(E.normals,3*R)),E.matricesIndices&&E.matricesWeights&&(i.matrixIndicesOverride?(E.matricesIndices[4*R]=i.matrixIndicesOverride[0],E.matricesIndices[4*R+1]=i.matrixIndicesOverride[1],E.matricesIndices[4*R+2]=i.matrixIndicesOverride[2],E.matricesIndices[4*R+3]=i.matrixIndicesOverride[3]):(m&&(E.matricesIndices[4*R]=m[i.vertexIdxForBones],E.matricesIndices[4*R+1]=m[i.vertexIdxForBones+1],E.matricesIndices[4*R+2]=m[i.vertexIdxForBones+2],E.matricesIndices[4*R+3]=m[i.vertexIdxForBones+3]),M&&E.matricesIndicesExtra&&(E.matricesIndicesExtra[4*R]=M[i.vertexIdxForBones],E.matricesIndicesExtra[4*R+1]=M[i.vertexIdxForBones+1],E.matricesIndicesExtra[4*R+2]=M[i.vertexIdxForBones+2],E.matricesIndicesExtra[4*R+3]=M[i.vertexIdxForBones+3])),i.matrixWeightsOverride?(E.matricesWeights[4*R]=i.matrixWeightsOverride[0],E.matricesWeights[4*R+1]=i.matrixWeightsOverride[1],E.matricesWeights[4*R+2]=i.matrixWeightsOverride[2],E.matricesWeights[4*R+3]=i.matrixWeightsOverride[3]):(x&&(E.matricesWeights[4*R]=x[i.vertexIdxForBones],E.matricesWeights[4*R+1]=x[i.vertexIdxForBones+1],E.matricesWeights[4*R+2]=x[i.vertexIdxForBones+2],E.matricesWeights[4*R+3]=x[i.vertexIdxForBones+3]),y&&E.matricesWeightsExtra&&(E.matricesWeightsExtra[4*R]=y[i.vertexIdxForBones],E.matricesWeightsExtra[4*R+1]=y[i.vertexIdxForBones+1],E.matricesWeightsExtra[4*R+2]=y[i.vertexIdxForBones+2],E.matricesWeightsExtra[4*R+3]=y[i.vertexIdxForBones+3]))),s.captureUVS)i.uv.toArray(E.uvs,2*R);else{E.uvs.push(.5+i.position.x/I.x);const e=.5+i.position.y/I.y;E.uvs.push(o.e.UseOpenGLOrientationForUV?1-e:e)}R++}}const L=new r.Kj(e,t.getScene());return E.applyToMesh(L),l?(L.skeleton=t.skeleton,L.parent=t):(L.position=b.clone(),L.rotation=new i.P(P,D,v)),L.computeWorldMatrix(!0),L.refreshBoundingInfo(!0,!0),L}function Fe(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){const t=Math.max(e.subdivisions?e.subdivisions:2,1),s=Math.max(e.tessellation?e.tessellation:16,3),r=Math.max(e.height?e.height:1,0),n=Math.max(e.radius?e.radius:.25,0),h=Math.max(e.capSubdivisions?e.capSubdivisions:6,1),l=s,c=t,d=Math.max(e.radiusTop?e.radiusTop:n,0),u=Math.max(e.radiusBottom?e.radiusBottom:n,0),f=r-(d+u),_=2*Math.PI,p=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:h,1),g=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:h,1),m=Math.acos((u-d)/r);let x=[];const M=[],y=[],b=[];let A=0;const I=[],v=.5*f,D=.5*Math.PI;let S,P;const T=i.P.Zero(),O=i.P.Zero(),C=Math.cos(m),E=Math.sin(m),R=new i.FM(d*E,v+d*C).subtract(new i.FM(u*E,u*C-v)).length(),B=d*m+R+u*(D-m);let F=0;for(P=0;P<=p;P++){const e=[],t=D-m*(P/p);F+=d*m/p;const s=Math.cos(t),i=Math.sin(t),r=s*d;for(S=0;S<=l;S++){const t=S/l,n=t*_+0,a=Math.sin(n),h=Math.cos(n);O.x=r*a,O.y=v+i*d,O.z=r*h,M.push(O.x,O.y,O.z),T.set(s*a,i,s*h),y.push(T.x,T.y,T.z),b.push(t,o.e.UseOpenGLOrientationForUV?F/B:1-F/B),e.push(A),A++}I.push(e)}const w=r-d-u+C*d-C*u,V=E*(u-d)/w;for(P=1;P<=c;P++){const e=[];F+=R/c;const t=E*(P*(u-d)/c+d);for(S=0;S<=l;S++){const s=S/l,i=s*_+0,r=Math.sin(i),n=Math.cos(i);O.x=t*r,O.y=v+C*d-P*w/c,O.z=t*n,M.push(O.x,O.y,O.z),T.set(r,V,n).normalize(),y.push(T.x,T.y,T.z),b.push(s,o.e.UseOpenGLOrientationForUV?F/B:1-F/B),e.push(A),A++}I.push(e)}for(P=1;P<=g;P++){const e=[],t=D-m-(Math.PI-m)*(P/g);F+=u*m/g;const s=Math.cos(t),i=Math.sin(t),r=s*u;for(S=0;S<=l;S++){const t=S/l,n=t*_+0,a=Math.sin(n),h=Math.cos(n);O.x=r*a,O.y=i*u-v,O.z=r*h,M.push(O.x,O.y,O.z),T.set(s*a,i,s*h),y.push(T.x,T.y,T.z),b.push(t,o.e.UseOpenGLOrientationForUV?F/B:1-F/B),e.push(A),A++}I.push(e)}for(S=0;S<l;S++)for(P=0;P<p+c+g;P++){const e=I[P][S],t=I[P+1][S],s=I[P+1][S+1],i=I[P][S+1];x.push(e),x.push(t),x.push(i),x.push(t),x.push(s),x.push(i)}if(x=x.reverse(),e.orientation&&!e.orientation.equals(i.P.Up())){const t=new i.y3;e.orientation.clone().scale(.5*Math.PI).cross(i.P.Up()).toQuaternion().toRotationMatrix(t);const s=i.P.Zero();for(let e=0;e<M.length;e+=3)s.set(M[e],M[e+1],M[e+2]),i.P.TransformCoordinatesToRef(s.clone(),t,s),M[e]=s.x,M[e+1]=s.y,M[e+2]=s.z}const L=new a.x;return L.positions=M,L.normals=y,L.uvs=b,L.indices=x,L}function we(e,t={orientation:i.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},s=null){const n=new r.Kj(e,s);return Fe(t).applyToMesh(n,t.updatable),n}r.Kj.CreateDecal=(e,t,s,i,r,n)=>Be(e,t,{position:s,normal:i,size:r,angle:n}),r.Kj.CreateCapsule=(e,t,s)=>we(e,t,s),a.x.CreateCapsule=Fe;class Ve{constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(Math.floor(e),P.Y.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(Math.floor(t),P.Y.Warn("y is not an integer, floor(y) used"))}clone(){return new Ve(this.x,this.y)}rotate60About(e){const t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){const t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&(Math.floor(e),P.Y.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(Math.floor(t),P.Y.Warn("n not an integer only floor(n) used"));const s=this.x;return this.x=e-s-this.y,this.y=t+s,this}rotateNeg120(e,t){e!==Math.floor(e)&&(Math.floor(e),P.Y.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(Math.floor(t),P.Y.Warn("n is not an integer,   floor(n) used"));const s=this.x;return this.x=this.y-t,this.y=e+t-s-this.y,this}toCartesianOrigin(e,t){const s=i.P.Zero();return s.x=e.x+2*this.x*t+this.y*t,s.y=e.y+Math.sqrt(3)*this.y*t,s}static Zero(){return new Ve(0,0)}}class Le{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Ne("icosahedron","Regular",[[0,J.Q_,-1],[-J.Q_,1,0],[-1,0,-J.Q_],[1,0,-J.Q_],[J.Q_,1,0],[0,J.Q_,1],[-1,0,J.Q_],[-J.Q_,-1,0],[0,-J.Q_,-1],[J.Q_,-1,0],[1,0,J.Q_],[0,-J.Q_,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const t={},s=this.m,i=this.n;let r,n,a,o,h,l=s,c=1,d=0;0!==i&&(l=De.R.HCF(s,i)),c=s/l,d=i/l;const u=Ve.Zero(),f=new Ve(s,i),_=new Ve(-i,s+i),p=Ve.Zero(),g=Ve.Zero(),m=Ve.Zero();let x,M,y,b,A=[];const I=[],v=this.vertByDist,D=(s,i,r,n)=>{x=s+"|"+r,M=i+"|"+n,x in t||M in t?x in t&&!(M in t)?t[M]=t[x]:M in t&&!(x in t)&&(t[x]=t[M]):(t[x]=e,t[M]=e,e++),v[r][0]>2?I[t[x]]=[-v[r][0],v[r][1],t[x]]:I[t[x]]=[A[v[r][0]],v[r][1],t[x]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let M=0;M<20;M++){if(A=this.IDATA.face[M],a=A[2],o=A[1],h=A[0],y=u.x+"|"+u.y,x=M+"|"+y,x in t||(t[x]=a,I[a]=[A[v[y][0]],v[y][1]]),y=f.x+"|"+f.y,x=M+"|"+y,x in t||(t[x]=o,I[o]=[A[v[y][0]],v[y][1]]),y=_.x+"|"+_.y,x=M+"|"+y,x in t||(t[x]=h,I[h]=[A[v[y][0]],v[y][1]]),r=this.IDATA.edgematch[M][0],n=this.IDATA.edgematch[M][1],"B"===n)for(let e=1;e<l;e++)g.x=s-e*(c+d),g.y=i+e*c,m.x=-e*d,m.y=e*(c+d),y=g.x+"|"+g.y,b=m.x+"|"+m.y,D(M,r,y,b);if("O"===n)for(let e=1;e<l;e++)m.x=-e*d,m.y=e*(c+d),p.x=e*c,p.y=e*d,y=m.x+"|"+m.y,b=p.x+"|"+p.y,D(M,r,y,b);if(r=this.IDATA.edgematch[M][2],n=this.IDATA.edgematch[M][3],n&&"A"===n)for(let e=1;e<l;e++)p.x=e*c,p.y=e*d,g.x=s-(l-e)*(c+d),g.y=i+(l-e)*c,y=p.x+"|"+p.y,b=g.x+"|"+g.y,D(M,r,y,b);for(let s=0;s<this.vertices.length;s++)y=this.vertices[s].x+"|"+this.vertices[s].y,x=M+"|"+y,x in t||(t[x]=e++,v[y][0]>2?I[t[x]]=[-v[y][0],v[y][1],t[x]]:I[t[x]]=[A[v[y][0]],v[y][1],t[x]])}this.closestTo=I,this.vecToidx=t}calcCoeffs(){const e=this.m,t=this.n,s=Math.sqrt(3)/3,i=e*e+t*t+e*t;this.coau=(e+t)/i,this.cobu=-t/i,this.coav=-s*(e-t)/i,this.cobv=s*(2*e+t)/i}createInnerFacets(){const e=this.m,t=this.n;for(let s=0;s<t+e+1;s++)for(let e=this.min[s];e<this.max[s]+1;e++)e<this.max[s]&&e<this.max[s+1]+1&&this.innerFacets.push(["|"+e+"|"+s,"|"+e+"|"+(s+1),"|"+(e+1)+"|"+s]),s>0&&e<this.max[s-1]&&e+1<this.max[s]+1&&this.innerFacets.push(["|"+e+"|"+s,"|"+(e+1)+"|"+s,"|"+(e+1)+"|"+(s-1)])}edgeVecsABOB(){const e=this.m,t=this.n,s=new Ve(-t,e+t);for(let i=1;i<e+t;i++){const e=new Ve(this.min[i],i),t=new Ve(this.min[i-1],i-1),r=new Ve(this.min[i+1],i+1),n=e.clone(),a=t.clone(),o=r.clone();n.rotate60About(s),a.rotate60About(s),o.rotate60About(s);const h=new Ve(this.max[n.y],n.y),l=new Ve(this.max[n.y-1],n.y-1),c=new Ve(this.max[n.y-1]-1,n.y-1);n.x===h.x&&n.y===h.y||(n.x!==l.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,l,c]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,c,h])):n.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,l]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,l,r])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,l]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,l,h])))}}mapABOBtoOBOA(){const e=new Ve(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const s=[];for(let i=0;i<3;i++)e.x=this.isoVecsABOB[t][i].x,e.y=this.isoVecsABOB[t][i].y,0===this.vertexTypes[t][i]&&e.rotateNeg120(this.m,this.n),s.push(e.clone());this.isoVecsOBOA.push(s)}}mapABOBtoBAOA(){const e=new Ve(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const s=[];for(let i=0;i<3;i++)e.x=this.isoVecsABOB[t][i].x,e.y=this.isoVecsABOB[t][i].y,1===this.vertexTypes[t][i]&&e.rotate120(this.m,this.n),s.push(e.clone());this.isoVecsBAOA.push(s)}}MapToFace(e,t){const s=this.IDATA.face[e],r=s[2],n=s[1],a=s[0],o=i.P.FromArray(this.IDATA.vertex[r]),h=i.P.FromArray(this.IDATA.vertex[n]),l=i.P.FromArray(this.IDATA.vertex[a]),c=h.subtract(o),d=l.subtract(o),u=c.scale(this.coau).add(d.scale(this.cobu)),f=c.scale(this.coav).add(d.scale(this.cobv)),_=[];let p,g=i.jp.Vector3[0];for(let s=0;s<this.cartesian.length;s++)g=u.scale(this.cartesian[s].x).add(f.scale(this.cartesian[s].y)).add(o),_[s]=[g.x,g.y,g.z],p=e+"|"+this.vertices[s].x+"|"+this.vertices[s].y,t.vertex[this.vecToidx[p]]=[g.x,g.y,g.z]}build(e,t){const s=new Array,i=Ve.Zero(),r=new Ve(e,t),n=new Ve(-t,e+t);s.push(i,r,n);for(let i=t;i<e+1;i++)for(let t=0;t<e+1-i;t++)s.push(new Ve(t,i));if(t>0){const i=De.R.HCF(e,t),r=e/i,n=t/i;for(let a=1;a<i;a++)s.push(new Ve(a*r,a*n)),s.push(new Ve(-a*n,a*(r+n))),s.push(new Ve(e-a*(r+n),t+a*r));const a=e/t;for(let i=1;i<t;i++)for(let r=0;r<i*a;r++)s.push(new Ve(r,i)),s.push(new Ve(r,i).rotate120(e,t)),s.push(new Ve(r,i).rotateNeg120(e,t))}s.sort(((e,t)=>e.x-t.x)),s.sort(((e,t)=>e.y-t.y));const a=new Array(e+t+1),o=new Array(e+t+1);for(let e=0;e<a.length;e++)a[e]=1/0,o[e]=-1/0;let h=0,l=0;const c=s.length;for(let e=0;e<c;e++)l=s[e].x,h=s[e].y,a[h]=Math.min(l,a[h]),o[h]=Math.max(l,o[h]);const d=(s,i)=>{const r=s.clone();return"A"===i&&r.rotateNeg120(e,t),"B"===i&&r.rotate120(e,t),r.x<0?r.y:r.x+r.y},u=[],f=[],_=[],p=[],g={},m=[];let x=-1,M=-1;for(let e=0;e<c;e++)u[e]=s[e].toCartesianOrigin(new Ve(0,0),.5),f[e]=d(s[e],"O"),_[e]=d(s[e],"A"),p[e]=d(s[e],"B"),f[e]===_[e]&&_[e]===p[e]?(x=3,M=f[e]):f[e]===_[e]?(x=4,M=f[e]):_[e]===p[e]?(x=5,M=_[e]):p[e]===f[e]&&(x=6,M=f[e]),f[e]<_[e]&&f[e]<p[e]&&(x=2,M=f[e]),_[e]<f[e]&&_[e]<p[e]&&(x=1,M=_[e]),p[e]<_[e]&&p[e]<f[e]&&(x=0,M=p[e]),m.push([x,M,s[e].x,s[e].y]);m.sort(((e,t)=>e[2]-t[2])),m.sort(((e,t)=>e[3]-t[3])),m.sort(((e,t)=>e[1]-t[1])),m.sort(((e,t)=>e[0]-t[0]));for(let e=0;e<m.length;e++)g[m[e][2]+"|"+m[e][3]]=[m[e][0],m[e][1],e];return this.m=e,this.n=t,this.vertices=s,this.vertByDist=g,this.cartesian=u,this.min=a,this.max=o,this}}class Ne{constructor(e,t,s,i){this.name=e,this.category=t,this.vertex=s,this.face=i}}class Ue extends Ne{innerToData(e,t){for(let s=0;s<t.innerFacets.length;s++)this.face.push(t.innerFacets[s].map((s=>t.vecToidx[e+s])))}mapABOBtoDATA(e,t){const s=t.IDATA.edgematch[e][0];for(let i=0;i<t.isoVecsABOB.length;i++){const r=[];for(let n=0;n<3;n++)0===t.vertexTypes[i][n]?r.push(e+"|"+t.isoVecsABOB[i][n].x+"|"+t.isoVecsABOB[i][n].y):r.push(s+"|"+t.isoVecsABOB[i][n].x+"|"+t.isoVecsABOB[i][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapOBOAtoDATA(e,t){const s=t.IDATA.edgematch[e][0];for(let i=0;i<t.isoVecsOBOA.length;i++){const r=[];for(let n=0;n<3;n++)1===t.vertexTypes[i][n]?r.push(e+"|"+t.isoVecsOBOA[i][n].x+"|"+t.isoVecsOBOA[i][n].y):r.push(s+"|"+t.isoVecsOBOA[i][n].x+"|"+t.isoVecsOBOA[i][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapBAOAtoDATA(e,t){const s=t.IDATA.edgematch[e][2];for(let i=0;i<t.isoVecsBAOA.length;i++){const r=[];for(let n=0;n<3;n++)1===t.vertexTypes[i][n]?r.push(e+"|"+t.isoVecsBAOA[i][n].x+"|"+t.isoVecsBAOA[i][n].y):r.push(s+"|"+t.isoVecsBAOA[i][n].x+"|"+t.isoVecsBAOA[i][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}orderData(e){const t=[];for(let e=0;e<13;e++)t[e]=[];const s=e.closestTo;for(let e=0;e<s.length;e++)s[e][0]>-1?s[e][1]>0&&t[s[e][0]].push([e,s[e][1]]):t[12].push([e,s[e][0]]);const i=[];for(let e=0;e<12;e++)i[e]=e;let r=12;for(let e=0;e<12;e++){t[e].sort(((e,t)=>e[1]-t[1]));for(let s=0;s<t[e].length;s++)i[t[e][s][0]]=r++}for(let e=0;e<t[12].length;e++)i[t[12][e][0]]=r++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(i[e]);this.vertex.sort(((e,t)=>e[3]-t[3]));for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let t=0;t<this.face[e].length;t++)this.face[e][t]=i[this.face[e][t]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){const s=[],i=[];let r=t.pop();i.push(r);let n=this.face[r].indexOf(e);n=(n+2)%3;let a=this.face[r][n];s.push(a);let o=0;for(;t.length>0;)r=t[o],this.face[r].indexOf(a)>-1?(n=(this.face[r].indexOf(a)+1)%3,a=this.face[r][n],s.push(a),i.push(r),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(s),i}toGoldbergPolyhedronData(){const e=new Ne("GeoDual","Goldberg",[],[]);e.name="GD dual";const t=this.vertex.length,s=new Array(t);for(let e=0;e<t;e++)s[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)s[this.face[e][t]].push(e);let i=0,r=0,n=0,a=[],o=[];this.adjacentFaces=[];for(let t=0;t<s.length;t++)e.face[t]=this.setOrder(t,s[t].concat([])),s[t].forEach((t=>{i=0,r=0,n=0,a=this.face[t];for(let e=0;e<3;e++)o=this.vertex[a[e]],i+=o[0],r+=o[1],n+=o[2];e.vertex[t]=[i/3,r/3,n/3]}));return e}static BuildGeodesicData(e){const t=new Ue("Geodesic-m-n","Geodesic",[[0,J.Q_,-1],[-J.Q_,1,0],[-1,0,-J.Q_],[1,0,-J.Q_],[J.Q_,1,0],[0,J.Q_,1],[-1,0,J.Q_],[-J.Q_,-1,0],[0,-J.Q_,-1],[J.Q_,-1,0],[1,0,J.Q_],[0,-J.Q_,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let s=0;s<e.IDATA.face.length;s++)e.MapToFace(s,t),t.innerToData(s,e),"B"===e.IDATA.edgematch[s][1]&&t.mapABOBtoDATA(s,e),"O"===e.IDATA.edgematch[s][1]&&t.mapOBOAtoDATA(s,e),"A"===e.IDATA.edgematch[s][3]&&t.mapBAOAtoDATA(s,e);return t.orderData(e),t.vertex=t.vertex.map((function(e){const t=e[0],s=e[1],i=e[2],r=Math.sqrt(t*t+s*s+i*i);return e[0]*=1/r,e[1]*=1/r,e[2]*=1/r,e})),t}}r.Kj._GoldbergMeshParser=(e,t)=>We.Parse(e,t);class We extends r.Kj{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(P.Y.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(P.Y.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(P.Y.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let t=0;t<e.length;t++){const s=e[t][0],i=e[t][1],r=e[t][2];for(let e=s;e<i+1;e++)this.goldbergData.faceColors[e]=r}const t=[];for(let e=0;e<12;e++)for(let s=0;s<5;s++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let s=0;s<6;s++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return t}setGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.setVerticesData(n.o.ColorKind,t)}updateGoldbergFaceColors(e){const t=this._changeGoldbergFaceColors(e);this.updateVerticesData(n.o.ColorKind,t)}_changeGoldbergFaceUVs(e){const t=this.getVerticesData(n.o.UVKind);for(let s=0;s<e.length;s++){const i=e[s][0],r=e[s][1],n=e[s][2],a=e[s][3],o=e[s][4],h=[],l=[];let c,d;for(let e=0;e<5;e++)c=n.x+a*Math.cos(o+e*Math.PI/2.5),d=n.y+a*Math.sin(o+e*Math.PI/2.5),c<0&&(c=0),c>1&&(c=1),h.push(c,d);for(let e=0;e<6;e++)c=n.x+a*Math.cos(o+e*Math.PI/3),d=n.y+a*Math.sin(o+e*Math.PI/3),c<0&&(c=0),c>1&&(c=1),l.push(c,d);for(let e=i;e<Math.min(12,r+1);e++)for(let s=0;s<5;s++)t[10*e+2*s]=h[2*s],t[10*e+2*s+1]=h[2*s+1];for(let e=Math.max(12,i);e<r+1;e++)for(let s=0;s<6;s++)t[12*e-24+2*s]=l[2*s],t[12*e-23+2*s]=l[2*s+1]}return t}setGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.setVerticesData(n.o.UVKind,t)}updateGoldbergFaceUVs(e){const t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(n.o.UVKind,t)}placeOnGoldbergFaceAt(e,t,s){const r=i.P.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=r,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(s.x)).add(this.goldbergData.faceYaxis[t].scale(s.y)).add(this.goldbergData.faceZaxis[t].scale(s.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const e of this.goldbergData.faceColors)t.faceColors.push(e.asArray())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const e of this.goldbergData.faceCenters)t.faceCenters.push(e.asArray())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)t.faceZaxis.push(e.asArray())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)t.faceYaxis.push(e.asArray())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)t.faceXaxis.push(e.asArray())}e.goldbergData=t}static Parse(e,t){const s=e.goldbergData;s.faceColors=s.faceColors.map((e=>u.HE.FromArray(e))),s.faceCenters=s.faceCenters.map((e=>i.P.FromArray(e))),s.faceZaxis=s.faceZaxis.map((e=>i.P.FromArray(e))),s.faceXaxis=s.faceXaxis.map((e=>i.P.FromArray(e))),s.faceYaxis=s.faceYaxis.map((e=>i.P.FromArray(e)));const r=new We(e.name,t);return r.goldbergData=s,r}}function ke(e,t,s=null){const n=t.size,h=t.sizeX||n||1,l=t.sizeY||n||1,c=t.sizeZ||n||1;let d=t.m||1;d!==Math.floor(d)&&(Math.floor(d),P.Y.Warn("m not an integer only floor(m) used"));let f=t.n||0;if(f!==Math.floor(f)&&(Math.floor(f),P.Y.Warn("n not an integer only floor(n) used")),f>d){const e=f;f=d,d=e,P.Y.Warn("n > m therefore m and n swapped")}const _=new Le;_.build(d,f);const p=Ue.BuildGeodesicData(_),g=p.toGoldbergPolyhedronData(),m=new We(e,s);t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),m._originalBuilderSideOrientation=t.sideOrientation;const x=function(e,t){const s=e.size,r=e.sizeX||s||1,n=e.sizeY||s||1,h=e.sizeZ||s||1,l=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,c=new Array,d=new Array,u=new Array,f=new Array;let _=1/0,p=-1/0,g=1/0,m=-1/0;for(let e=0;e<t.vertex.length;e++)_=Math.min(_,t.vertex[e][0]*r),p=Math.max(p,t.vertex[e][0]*r),g=Math.min(g,t.vertex[e][1]*n),m=Math.max(m,t.vertex[e][1]*n);let x=0;for(let e=0;e<t.face.length;e++){const s=t.face[e],a=i.P.FromArray(t.vertex[s[0]]),l=i.P.FromArray(t.vertex[s[2]]),M=i.P.FromArray(t.vertex[s[1]]),y=l.subtract(a),b=M.subtract(a),A=i.P.Cross(b,y).normalize();for(let e=0;e<s.length;e++){u.push(A.x,A.y,A.z);const i=t.vertex[s[e]];c.push(i[0]*r,i[1]*n,i[2]*h);const a=(i[1]*n-g)/(m-g);f.push((i[0]*r-_)/(p-_),o.e.UseOpenGLOrientationForUV?1-a:a)}for(let e=0;e<s.length-2;e++)d.push(x,x+e+2,x+e+1);x+=s.length}a.x._ComputeSides(l,c,d,u,f);const M=new a.x;return M.positions=c,M.indices=d,M.normals=u,M.uvs=f,M}(t,g);x.applyToMesh(m,t.updatable),m.goldbergData.nbSharedFaces=p.sharedNodes,m.goldbergData.nbUnsharedFaces=p.poleNodes,m.goldbergData.adjacentFaces=p.adjacentFaces,m.goldbergData.nbFaces=m.goldbergData.nbSharedFaces+m.goldbergData.nbUnsharedFaces,m.goldbergData.nbFacesAtPole=(m.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<p.vertex.length;e++)m.goldbergData.faceCenters.push(i.P.FromArray(p.vertex[e])),m.goldbergData.faceCenters[e].x*=h,m.goldbergData.faceCenters[e].y*=l,m.goldbergData.faceCenters[e].z*=c,m.goldbergData.faceColors.push(new u.HE(1,1,1,1));for(let e=0;e<g.face.length;e++){const t=g.face[e],s=i.P.FromArray(g.vertex[t[0]]),r=i.P.FromArray(g.vertex[t[2]]),n=i.P.FromArray(g.vertex[t[1]]),a=r.subtract(s),o=n.subtract(s),h=i.P.Cross(o,a).normalize(),l=i.P.Cross(o,h).normalize();m.goldbergData.faceXaxis.push(o.normalize()),m.goldbergData.faceYaxis.push(h),m.goldbergData.faceZaxis.push(l)}return m}r.Kj.CreateGoldberg=ke;const ze={CreateBox:_,CreateTiledBox:function(e,t,s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,g(t).applyToMesh(i,t.updatable),i},CreateSphere:x,CreateDisc:d,CreateIcoSphere:ve,CreateRibbon:l,CreateCylinder:A,CreateTorus:v,CreateTorusKnot:S,CreateLineSystem:Z,CreateLines:X,CreateDashedLines:Q,ExtrudeShape:ae,ExtrudeShapeCustom:oe,CreateLathe:le,CreateTiledPlane:function(e,t,s=null){const i=new r.Kj(e,s);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,p(t).applyToMesh(i,t.updatable),i},CreatePlane:de,CreateGround:me,CreateTiledGround:xe,CreateGroundFromHeightMap:Me,CreatePolygon:re,ExtrudePolygon:ne,CreateTube:ye,CreatePolyhedron:Ae,CreateGeodesic:function(e,t,s=null){let i=t.m||1;i!==Math.floor(i)&&(Math.floor(i),P.Y.Warn("m not an integer only floor(m) used"));let r=t.n||0;if(r!==Math.floor(r)&&(Math.floor(r),P.Y.Warn("n not an integer only floor(n) used")),r>i){const e=r;r=i,i=e,P.Y.Warn("n > m therefore m and n swapped")}const n=new Le;return n.build(i,r),Ae(e,{custom:Ue.BuildGeodesicData(n),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},s)},CreateGoldberg:ke,CreateDecal:Be,CreateCapsule:we}},2175:(e,t,s)=>{s.d(t,{P:()=>h});var i=s(2186);class r{constructor(e,t,s){this.bu=e,this.bv=t,this.distance=s,this.faceId=0,this.subMeshId=0}}var n=s(2543),a=s(7303),o=s(7050);class h{get materialDefines(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines}set materialDefines(e){var t;(null!==(t=this._mainDrawWrapperOverride)&&void 0!==t?t:this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e,t=!1){e=null!=e?e:this._engine.currentRenderPassId;let s=this._drawWrappers[e];return!s&&t&&(this._drawWrappers[e]=s=new o.q(this._mesh.getScene().getEngine())),s}_removeDrawWrapper(e,t=!0){var s;t&&(null===(s=this._drawWrappers[e])||void 0===s||s.dispose()),this._drawWrappers[e]=void 0}get effect(){var e,t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(t=null===(e=this._getDrawWrapper())||void 0===e?void 0:e.effect)&&void 0!==t?t:null}get _drawWrapper(){var e;return null!==(e=this._mainDrawWrapperOverride)&&void 0!==e?e:this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,s,i=!0){const r=this._drawWrapper;r.setEffect(e,t,i),void 0!==s&&(r.materialContext=s),e||(r.defines=null,r.materialContext=void 0)}resetDrawCache(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(const e of this._drawWrappers)null==e||e.dispose()}this._drawWrappers=[]}static AddToMesh(e,t,s,i,r,n,a,o=!0){return new h(e,t,s,i,r,n,a,o)}constructor(e,t,s,i,r,n,a,o=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=s,this.indexStart=i,this.indexCount=r,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=n,this._renderingMesh=a||n,h&&n.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=n.subMeshes.length-1,o&&(this.refreshBoundingInfo(),n.computeWorldMatrix(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){return(this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null)||this._renderingMesh}getMaterial(e=!0){var t;const s=null!==(t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==t?t:this._renderingMesh.material;if(!s)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(s)){const e=s.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return s}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(i.o.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.getIndices();let s;if(0===this.indexStart&&this.indexCount===t.length){const e=this._renderingMesh.getBoundingInfo();s={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else s=(0,a.y)(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new n.j(s.minimum,s.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}isCompletelyInFrustum(e){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){const s=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)s.push(e[t],e[t+1],e[t+1],e[t+2],e[t+2],e[t]);this._linesIndexBuffer=t.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer}canIntersects(e){const t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}intersects(e,t,s,i,r){const n=this.getMaterial();if(!n)return null;let a=3,o=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,o=!0}return 4===n.fillMode?s.length?this._intersectLines(e,t,s,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,s,this._mesh.intersectionThreshold,i):!s.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,s,i,r):this._intersectTriangles(e,t,s,a,o,i,r)}_intersectLines(e,t,s,i,n){let a=null;for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){const h=t[s[o]],l=t[s[o+1]],c=e.intersectionSegment(h,l,i);if(!(c<0)&&(n||!a||c<a.distance)&&(a=new r(null,null,c),a.faceId=o/2,n))break}return a}_intersectUnIndexedLines(e,t,s,i,n){let a=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){const o=t[s],h=t[s+1],l=e.intersectionSegment(o,h,i);if(!(l<0)&&(n||!a||l<a.distance)&&(a=new r(null,null,l),a.faceId=s/2,n))break}return a}_intersectTriangles(e,t,s,i,r,n,a){let o=null,h=-1;for(let l=this.indexStart;l<this.indexStart+this.indexCount-(3-i);l+=i){h++;const i=s[l],c=s[l+1],d=s[l+2];if(r&&4294967295===d){l+=2;continue}const u=t[i],f=t[c],_=t[d];if(!u||!f||!_)continue;if(a&&!a(u,f,_,e,i,c,d))continue;const p=e.intersectsTriangle(u,f,_);if(p){if(p.distance<0)continue;if((n||!o||p.distance<o.distance)&&(o=p,o.faceId=h,n))break}}return o}_intersectUnIndexedTriangles(e,t,s,i,r){let n=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=3){const a=t[s],o=t[s+1],h=t[s+2];if(r&&!r(a,o,h,e,-1,-1,-1))continue;const l=e.intersectsTriangle(a,o,h);if(l){if(l.distance<0)continue;if((i||!n||l.distance<n.distance)&&(n=l,n.faceId=s/3,i))break}}return n}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){const s=new h(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return s;s._boundingInfo=new n.j(e.minimum,e.maximum)}return s}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,s,i,r,n=!0){let a=Number.MAX_VALUE,o=-Number.MAX_VALUE;const l=(r||i).getIndices();for(let e=t;e<t+s;e++){const t=l[e];t<a&&(a=t),t>o&&(o=t)}return new h(e,a,o-a+1,t,s,i,r,n)}}},4179:(e,t,s)=>{s.d(t,{Y:()=>l});var i=s(1069),r=s(8137),n=s(8139),a=s(5412),o=s(6387),h=s(5241);class l extends o.N{get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._cache.useBillboardPosition=0!=(this._billboardMode&l.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)}constructor(e,t=null,s=!0){super(e,t),this._forward=new a.P(0,0,1),this._up=new a.P(0,1,0),this._right=new a.P(1,0,0),this._position=a.P.Zero(),this._rotation=a.P.Zero(),this._rotationQuaternion=null,this._scaling=a.P.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=l.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=a.y3.Zero(),this._usePivotMatrix=!1,this._absolutePosition=a.P.Zero(),this._absoluteScaling=a.P.Zero(),this._absoluteRotationQuaternion=a._f.Identity(),this._pivotMatrix=a.y3.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new n.y$,this._nonUniformScaling=!1,s&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(e){this._position=e,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(e){this._scaling=e,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return a.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return a.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return a.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=a.y3.Identity()),this._poseMatrix}_isSynchronized(){const e=this._cache;return!(this._billboardMode!==e.billboardMode||this._billboardMode!==l.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1,e.useBillboardPosition=!1,e.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(e){return this.setPivotMatrix(e,!1)}setPivotMatrix(e,t=!0){return this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.y3.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(e=null,t,s){const i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);i&&s&&s(this,i);for(const e of this.getChildTransformNodes(!0))e.instantiateHierarchy(i,t,s);return i}freezeWorldMatrix(e=null,t=!1){return e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||a._f.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(e){if(!e)return this;let t,s,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],s=arguments[1],i=arguments[2]}else t=e.x,s=e.y,i=e.z;if(this.parent){const e=a.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),a.P.TransformCoordinatesFromFloatsToRef(t,s,i,e,this.position)}else this.position.x=t,this.position.y=s,this.position.z=i;return this._absolutePosition.copyFrom(e),this}setPositionWithLocalVector(e){return this.computeWorldMatrix(),this.position=a.P.TransformNormal(e,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const e=a.jp.Matrix[0];return this._localMatrix.invertToRef(e),a.P.TransformNormal(this.position,e)}locallyTranslate(e){return this.computeWorldMatrix(!0),this.position=a.P.TransformCoordinates(e,this._localMatrix),this}lookAt(e,t=0,s=0,i=0,r=h.T.LOCAL){const n=l._LookAtVectorCache,o=r===h.T.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(o,n),this.setDirection(n,t,s,i),r===h.T.WORLD&&this.parent)if(this.rotationQuaternion){const e=a.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(e);const t=a.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),e.multiplyToRef(t,e),this.rotationQuaternion.fromRotationMatrix(e)}else{const e=a.jp.Quaternion[0];a._f.FromEulerVectorToRef(this.rotation,e);const t=a.jp.Matrix[0];e.toRotationMatrix(t);const s=a.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.invert(),t.multiplyToRef(s,t),e.fromRotationMatrix(t),e.toEulerAnglesToRef(this.rotation)}return this}getDirection(e){const t=a.P.Zero();return this.getDirectionToRef(e,t),t}getDirectionToRef(e,t){return a.P.TransformNormalToRef(e,this.getWorldMatrix(),t),this}setDirection(e,t=0,s=0,i=0){const r=-Math.atan2(e.z,e.x)+Math.PI/2,n=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,n);return this.rotationQuaternion?a._f.RotationYawPitchRollToRef(r+t,o+s,i,this.rotationQuaternion):(this.rotation.x=o+s,this.rotation.y=r+t,this.rotation.z=i),this}setPivotPoint(e,t=h.T.LOCAL){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const s=this.getWorldMatrix();if(t==h.T.WORLD){const t=a.jp.Matrix[0];s.invertToRef(t),e=a.P.TransformCoordinates(e,t)}return this.setPivotMatrix(a.y3.Translation(-e.x,-e.y,-e.z),!0)}getPivotPoint(){const e=a.P.Zero();return this.getPivotPointToRef(e),e}getPivotPointToRef(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const e=a.P.Zero();return this.getAbsolutePivotPointToRef(e),e}getAbsolutePivotPointToRef(e){return this.getPivotPointToRef(e),a.P.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this}markAsDirty(e){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.markAsDirty(e);return super.markAsDirty(e)}setParent(e,t=!1,s=!1){if(!e&&!this.parent)return this;const i=a.jp.Quaternion[0],r=a.jp.Vector3[0],n=a.jp.Vector3[1],o=a.jp.Matrix[1];a.y3.IdentityToRef(o);const h=a.jp.Matrix[0];this.computeWorldMatrix(!0);let c=this.rotationQuaternion;return c||(c=l._TmpRotation,a._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),a.y3.ComposeToRef(this.scaling,c,this.position,h),this.parent&&h.multiplyToRef(this.parent.computeWorldMatrix(!0),h),e&&(e.computeWorldMatrix(!0).invertToRef(o),h.multiplyToRef(o,h)),h.decompose(n,i,r,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(n),this.position.copyFrom(r),this.parent=e,s&&this.setPivotMatrix(a.y3.Identity()),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)}attachToBone(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(e=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(e,t,s){let i;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),s&&s!==h.T.LOCAL){if(this.parent){const t=a.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),e=a.P.TransformNormal(e,t)}i=a._f.RotationAxisToRef(e,t,l._RotationAxisCache),i.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else i=a._f.RotationAxisToRef(e,t,l._RotationAxisCache),this.rotationQuaternion.multiplyToRef(i,this.rotationQuaternion);return this}rotateAround(e,t,s){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const i=a.jp.Vector3[0],r=a.jp.Vector3[1],n=a.jp.Vector3[2],o=a.jp.Quaternion[0],h=a.jp.Matrix[0],l=a.jp.Matrix[1],c=a.jp.Matrix[2],d=a.jp.Matrix[3];return e.subtractToRef(this.position,i),a.y3.TranslationToRef(i.x,i.y,i.z,h),a.y3.TranslationToRef(-i.x,-i.y,-i.z,l),a.y3.RotationAxisToRef(t,s,c),l.multiplyToRef(c,d),d.multiplyToRef(h,d),d.decompose(r,o,n),this.position.addInPlace(n),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(e,t,s){const i=e.scale(t);if(s&&s!==h.T.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{const e=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(e)}return this}addRotation(e,t,s){let i;this.rotationQuaternion?i=this.rotationQuaternion:(i=a.jp.Quaternion[1],a._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));const r=a.jp.Quaternion[0];return a._f.RotationYawPitchRollToRef(t,e,s,r),i.multiplyInPlace(r),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(e=!1,t=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const s=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===s||this.isSynchronized()))return this._currentRenderId=s,this._worldMatrix;t=t||this.getScene().activeCamera,this._updateCache();const i=this._cache;i.pivotMatrixUpdated=!1,i.billboardMode=this.billboardMode,i.infiniteDistance=this.infiniteDistance,i.parent=this._parentNode,this._currentRenderId=s,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const r=this._getEffectiveParent(),n=l._TmpScaling;let o,h=this._position;if(this._infiniteDistance&&!this.parent&&t){const e=t.getWorldMatrix(),s=new a.P(e.m[12],e.m[13],e.m[14]);h=l._TmpTranslation,h.copyFromFloats(this._position.x+s.x,this._position.y+s.y,this._position.z+s.z)}if(n.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,o=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(a._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(o=l._TmpRotation,a._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,o)),this._usePivotMatrix){const e=a.jp.Matrix[1];a.y3.ScalingToRef(n.x,n.y,n.z,e);const t=a.jp.Matrix[0];o.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(e,a.jp.Matrix[4]),a.jp.Matrix[4].multiplyToRef(t,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(h.x,h.y,h.z)}else a.y3.ComposeToRef(n,o,h,this._localMatrix);if(r&&r.getWorldMatrix){if(e&&r.computeWorldMatrix(e),i.useBillboardPath){this._transformToBoneReferal?r.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.jp.Matrix[7]):a.jp.Matrix[7].copyFrom(r.getWorldMatrix());const e=a.jp.Vector3[5],t=a.jp.Vector3[6],s=a.jp.Quaternion[0];a.jp.Matrix[7].decompose(t,s,e),a.y3.ScalingToRef(t.x,t.y,t.z,a.jp.Matrix[7]),a.jp.Matrix[7].setTranslation(e),l.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(s,e),this._localMatrix.setTranslation(e)),this._localMatrix.multiplyToRef(a.jp.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(r.getWorldMatrix(),a.jp.Matrix[6]),a.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(i.useBillboardPath&&t&&this.billboardMode&&!i.useBillboardPosition){const e=a.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(e),a.jp.Matrix[1].copyFrom(t.getViewMatrix()),a.jp.Matrix[1].setTranslationFromFloats(0,0,0),a.jp.Matrix[1].invertToRef(a.jp.Matrix[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){a.jp.Matrix[0].decompose(void 0,a.jp.Quaternion[0],void 0);const e=a.jp.Vector3[1];a.jp.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(e.z=0),a.y3.RotationYawPitchRollToRef(e.y,e.x,e.z,a.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.jp.Vector3[0])}else if(i.useBillboardPath&&t&&i.useBillboardPosition){const e=a.jp.Vector3[0];this._worldMatrix.getTranslationToRef(e);const s=t.globalPosition;this._worldMatrix.invertToRef(a.jp.Matrix[1]);const i=a.jp.Vector3[1];a.P.TransformCoordinatesToRef(s,a.jp.Matrix[1],i),i.normalize();const r=-Math.atan2(i.z,i.x)+Math.PI/2,n=Math.sqrt(i.x*i.x+i.z*i.z),o=-Math.atan2(i.y,n);if(a._f.RotationYawPitchRollToRef(r,o,0,a.jp.Quaternion[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){const e=a.jp.Vector3[1];a.jp.Quaternion[0].toEulerAnglesToRef(e),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(e.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(e.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(e.z=0),a.y3.RotationYawPitchRollToRef(e.y,e.x,e.z,a.jp.Matrix[0])}else a.y3.FromQuaternionToRef(a.jp.Quaternion[0],a.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):r&&r._nonUniformScaling?this._updateNonUniformScalingState(r._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(e=!0){if(this.computeWorldMatrix(),e){const e=this.getChildren();for(let t=0;t<e.length;++t){const s=e[t];if(s){s.computeWorldMatrix();const e=a.jp.Matrix[0];s._localMatrix.multiplyToRef(this._localMatrix,e);const t=a.jp.Quaternion[0];e.decompose(s.scaling,t,s.position),s.rotationQuaternion?s.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(s.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=a._f.Identity()),this._worldMatrix=a.y3.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this}unregisterAfterWorldMatrixUpdate(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this}getPositionInCameraSpace(e=null){return e||(e=this.getScene().activeCamera),a.P.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())}getDistanceToCamera(e=null){return e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()}clone(e,t,s){const i=r.p4.Clone((()=>new l(e,this.getScene())),this);if(i.name=e,i.id=e,t&&(i.parent=t),!s){const t=this.getDescendants(!0);for(let s=0;s<t.length;s++){const r=t[s];r.clone&&r.clone(e+"."+r.name,i)}}return i}serialize(e){const t=r.p4.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),t}static Parse(e,t,s){const i=r.p4.Parse((()=>new l(e.name,t)),e,t,s);return e.localMatrix?i.setPreTransformMatrix(a.y3.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(a.y3.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i._waitingParsedUniqueId=e.uniqueId,void 0!==e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(i._waitingParentInstanceIndex=e.parentInstanceIndex),i}getChildTransformNodes(e,t){const s=[];return this._getDescendants(s,e,(e=>(!t||t(e))&&e instanceof l)),s}dispose(e,t=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),e){const e=this.getChildTransformNodes(!0);for(const t of e)t.parent=null,t.computeWorldMatrix(!0)}super.dispose(e,t)}normalizeToUnitCube(e=!0,t=!1,s){let i=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(i=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const n=this.getHierarchyBoundingVectors(e,s),a=n.max.subtract(n.min),o=Math.max(a.x,a.y,a.z);if(0===o)return this;const h=1/o;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&i&&this.rotation.copyFrom(i)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}l.BILLBOARDMODE_NONE=0,l.BILLBOARDMODE_X=1,l.BILLBOARDMODE_Y=2,l.BILLBOARDMODE_Z=4,l.BILLBOARDMODE_ALL=7,l.BILLBOARDMODE_USE_POSITION=128,l.BillboardUseParentOrientation=!1,l._TmpRotation=a._f.Zero(),l._TmpScaling=a.P.Zero(),l._TmpTranslation=a.P.Zero(),l._LookAtVectorCache=new a.P(0,0,0),l._RotationAxisCache=new a._f,(0,i.gn)([(0,r.hd)("position")],l.prototype,"_position",void 0),(0,i.gn)([(0,r.hd)("rotation")],l.prototype,"_rotation",void 0),(0,i.gn)([(0,r.mv)("rotationQuaternion")],l.prototype,"_rotationQuaternion",void 0),(0,i.gn)([(0,r.hd)("scaling")],l.prototype,"_scaling",void 0),(0,i.gn)([(0,r.qC)("billboardMode")],l.prototype,"_billboardMode",void 0),(0,i.gn)([(0,r.qC)()],l.prototype,"scalingDeterminant",void 0),(0,i.gn)([(0,r.qC)("infiniteDistance")],l.prototype,"_infiniteDistance",void 0),(0,i.gn)([(0,r.qC)()],l.prototype,"ignoreNonUniformScaling",void 0),(0,i.gn)([(0,r.qC)()],l.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},140:(e,t,s)=>{function i(e,t,s){try{const i=e.next();i.done?t(i):i.value?i.value.then((()=>{i.value=void 0,t(i)}),s):t(i)}catch(e){s(e)}}function r(e=25){let t;return(s,r,n)=>{const a=performance.now();void 0===t||a-t>e?(t=a,setTimeout((()=>{i(s,r,n)}),0)):i(s,r,n)}}function n(e,t,s,i,r){const n=()=>{let a;const o=e=>{e.done?s(e.value):void 0===a?a=!0:n()};do{a=void 0,r&&r.aborted?i(new Error("Aborted")):t(e,o,i),void 0===a&&(a=!1)}while(a)};n()}function a(e,t){let s;return n(e,i,(e=>s=e),(e=>{throw e}),t),s}function o(e,t,s){return new Promise(((i,r)=>{n(e,t,i,r,s)}))}function h(e,t){return(...s)=>a(e(...s),t)}s.d(t,{KO:()=>r,s3:()=>a,sM:()=>o,vp:()=>h})},366:(e,t,s)=>{s(1206).v.IncludesShadersStore.bakedVertexAnimation="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n"},9378:(e,t,s)=>{s(1206).v.IncludesShadersStore.bakedVertexAnimationDeclaration="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n"},1003:(e,t,s)=>{s(1206).v.IncludesShadersStore.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n"},4869:(e,t,s)=>{s(1206).v.IncludesShadersStore.bonesVertex="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n"},6260:(e,t,s)=>{s(1206).v.IncludesShadersStore.clipPlaneFragment="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n"},1919:(e,t,s)=>{s(1206).v.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n"},1275:(e,t,s)=>{s(1206).v.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n"},9310:(e,t,s)=>{s(1206).v.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n"},7449:(e,t,s)=>{s(1206).v.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n"},5532:(e,t,s)=>{s(1206).v.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n"},7612:(e,t,s)=>{s(1206).v.IncludesShadersStore.vertexColorMixing="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n"},6387:(e,t,s)=>{s.d(t,{N:()=>c});var i=s(1069),r=s(5412),n=s(8137),a=s(8139),o=s(5953),h=s(9069);class l{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new a.y$,this._onClonedObservable=new a.y$}}class c{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,s,i){const r=this._NodeConstructors[e];return r?r(t,s,i):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null){this._isDirty=!1,this._nodeDataStorage=new l,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new a.y$,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||o.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={},this._cache.parent=void 0}updateCache(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}_getDescendants(e,t=!1,s){if(this._children)for(let i=0;i<this._children.length;i++){const r=this._children[i];s&&!s(r)||e.push(r),t||r._getDescendants(e,!1,s)}}getDescendants(e,t){const s=new Array;return this._getDescendants(s,e,t),s}getChildMeshes(e,t){const s=[];return this._getDescendants(s,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),s}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const s=this.animations[t];if(s.name===e)return s}return null}createAnimationRange(e,t,s){if(!this._ranges[e]){this._ranges[e]=c._AnimationRangeFactory(e,t,s);for(let i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].createRange(e,t,s)}}deleteAnimationRange(e,t=!0){for(let s=0,i=this.animations.length;s<i;s++)this.animations[s]&&this.animations[s].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,s,i){const r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,s,i):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const s=this._ranges[t];if(!s)continue;const i={};i.name=t,i.from=s.from,i.to=s.to,e.push(i)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=r.y3.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const s=this.getDescendants(!0);for(const i of s)i.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,s){if(t.ranges)for(let s=0;s<t.ranges.length;s++){const i=t.ranges[s];e.createAnimationRange(i.name,i.from,i.to)}}getHierarchyBoundingVectors(e=!0,t=null){let s,i;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const n=this;if(n.getBoundingInfo&&n.subMeshes){const e=n.getBoundingInfo();s=e.boundingBox.minimumWorld.clone(),i=e.boundingBox.maximumWorld.clone()}else s=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const n of e){const e=n;if(e.computeWorldMatrix(!0),t&&!t(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const a=e.getBoundingInfo().boundingBox,o=a.minimumWorld,h=a.maximumWorld;r.P.CheckExtends(o,s,i),r.P.CheckExtends(h,s,i)}}return{min:s,max:i}}}c._AnimationRangeFactory=(e,t,s)=>{throw(0,h.S)("AnimationRange")},c._NodeConstructors={},(0,i.gn)([(0,n.qC)()],c.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],c.prototype,"id",void 0),(0,i.gn)([(0,n.qC)()],c.prototype,"uniqueId",void 0),(0,i.gn)([(0,n.qC)()],c.prototype,"state",void 0),(0,i.gn)([(0,n.qC)()],c.prototype,"metadata",void 0)}},e=>{var t=t=>e(e.s=t);t(6791),t(779)}]);